{"file_contents":{"attached_assets/secure_executor_1758734351640.py":{"content":"# backend/secure_executor.py\r\nimport io\r\nimport contextlib\r\nimport matplotlib.pyplot as plt\r\n\r\ndef run_generated_code(code: str, local_vars: dict):\r\n\r\n\r\n    output_buffer = io.StringIO()\r\n\r\n    if 'df' not in local_vars:\r\n        return \"No DataFrame provided\", \"Missing df\"\r\n\r\n    print(\"[üîç] Columns in df before exec:\", local_vars['df'].columns.tolist())\r\n\r\n    try:\r\n        with contextlib.redirect_stdout(output_buffer):\r\n            exec(code, {}, local_vars)\r\n\r\n        if plt.get_fignums():\r\n            plot_path = \"data/plot.png\"\r\n            plt.savefig(plot_path)\r\n            plt.close()\r\n\r\n        result = local_vars.get(\"result\", output_buffer.getvalue())\r\n        summary = local_vars.get(\"summary\", \"No summary provided.\")\r\n        return result, summary\r\n\r\n    except Exception as e:\r\n        print(\"‚ùå Code execution error:\", e)  # Logs error to terminal\r\n        return \"Error occurred during code execution.\", str(e)\r\n","size_bytes":944},"client/src/components/chart-config/MapConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface MapConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function MapConfig({ config, onChange, columns = [] }: MapConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"location\">Location Column</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.location || \"\"}\n            onValueChange={(value) => updateConfig(\"location\", value)}\n          >\n            <SelectTrigger id=\"location\" data-testid=\"select-location\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"location\"\n            placeholder=\"Select a dataset first\"\n            value={config.location || \"\"}\n            onChange={(e) => updateConfig(\"location\", e.target.value)}\n            data-testid=\"input-location\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metric\">Value Metric</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.metric || \"\"}\n            onValueChange={(value) => updateConfig(\"metric\", value)}\n          >\n            <SelectTrigger id=\"metric\" data-testid=\"select-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"metric\"\n            placeholder=\"Select a dataset first\"\n            value={config.metric || \"\"}\n            onChange={(e) => updateConfig(\"metric\", e.target.value)}\n            data-testid=\"input-metric\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"mapType\">Map Type</Label>\n        <Select\n          value={config.mapType || \"country\"}\n          onValueChange={(value) => updateConfig(\"mapType\", value)}\n        >\n          <SelectTrigger id=\"mapType\" data-testid=\"select-map-type\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"country\">Country</SelectItem>\n            <SelectItem value=\"us_state\">US State</SelectItem>\n            <SelectItem value=\"world\">World</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"colorScheme\">Color Scheme</Label>\n        <Select\n          value={config.colorScheme || \"sequential\"}\n          onValueChange={(value) => updateConfig(\"colorScheme\", value)}\n        >\n          <SelectTrigger id=\"colorScheme\" data-testid=\"select-color-scheme\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"sequential\">Sequential</SelectItem>\n            <SelectItem value=\"diverging\">Diverging</SelectItem>\n            <SelectItem value=\"categorical\">Categorical</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3877},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"attached_assets/models_1758734366912.py":{"content":"# backend/db/models.py\r\nfrom __future__ import annotations\r\n\r\nfrom typing import Optional\r\nfrom datetime import datetime\r\n\r\nfrom sqlalchemy.orm import Mapped, mapped_column\r\nfrom sqlalchemy import (\r\n    String,\r\n    BigInteger,\r\n    Enum,\r\n    Boolean,\r\n    DateTime,\r\n    TIMESTAMP,\r\n    UniqueConstraint,\r\n    text,\r\n)\r\n\r\nfrom .session import Base\r\n\r\n\r\nclass User(Base):\r\n    __tablename__ = \"users\"\r\n\r\n    id: Mapped[int] = mapped_column(BigInteger, primary_key=True, autoincrement=True)\r\n    email: Mapped[str] = mapped_column(String(255), unique=True, index=True, nullable=False)\r\n\r\n    # store a bcrypt/argon2 hash (NULL allowed for SSO-only accounts)\r\n    password_hash: Mapped[Optional[str]] = mapped_column(String(255), nullable=True)\r\n\r\n    name: Mapped[Optional[str]] = mapped_column(String(100), nullable=True)\r\n\r\n    # optional SSO linkage\r\n    sso_provider: Mapped[Optional[str]] = mapped_column(\r\n        Enum(\"google\", \"microsoft\", \"github\", name=\"sso_provider\"),\r\n        nullable=True,\r\n    )\r\n    sso_sub: Mapped[Optional[str]] = mapped_column(String(255), nullable=True)\r\n\r\n    is_active: Mapped[bool] = mapped_column(Boolean, nullable=False, server_default=text(\"1\"))\r\n    last_login_at: Mapped[Optional[datetime]] = mapped_column(DateTime, nullable=True)\r\n\r\n    # match your MySQL schema:\r\n    # created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\r\n    # updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\r\n    created_at: Mapped[datetime] = mapped_column(\r\n        TIMESTAMP, nullable=False, server_default=text(\"CURRENT_TIMESTAMP\")\r\n    )\r\n    updated_at: Mapped[datetime] = mapped_column(\r\n        TIMESTAMP,\r\n        nullable=False,\r\n        server_default=text(\"CURRENT_TIMESTAMP\"),\r\n        server_onupdate=text(\"CURRENT_TIMESTAMP\"),\r\n    )\r\n\r\n    __table_args__ = (\r\n        UniqueConstraint(\"sso_provider\", \"sso_sub\", name=\"uq_users_sso\"),\r\n    )\r\n","size_bytes":1916},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  /* Dark theme colors matching the design reference exactly */\n  --background: hsl(222, 84%, 5%);\n  --foreground: hsl(210, 40%, 98%);\n  --card: hsl(222, 84%, 5%);\n  --card-foreground: hsl(210, 40%, 98%);\n  --popover: hsl(222, 84%, 5%);\n  --popover-foreground: hsl(210, 40%, 98%);\n  --primary: hsl(239, 84%, 67%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(160, 84%, 39%);\n  --secondary-foreground: hsl(210, 40%, 98%);\n  --muted: hsl(215, 32%, 27%);\n  --muted-foreground: hsl(215, 20%, 65%);\n  --accent: hsl(43, 96%, 56%);\n  --accent-foreground: hsl(210, 40%, 98%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(210, 40%, 98%);\n  --border: hsl(215, 28%, 17%);\n  --input: hsl(215, 28%, 17%);\n  --ring: hsl(239, 84%, 67%);\n  --chart-1: hsl(239, 84%, 67%);\n  --chart-2: hsl(160, 84%, 39%);\n  --chart-3: hsl(43, 96%, 56%);\n  --chart-4: hsl(147, 78%, 42%);\n  --chart-5: hsl(341, 75%, 51%);\n  --sidebar: hsl(222, 84%, 5%);\n  --sidebar-foreground: hsl(210, 40%, 98%);\n  --sidebar-primary: hsl(239, 84%, 67%);\n  --sidebar-primary-foreground: hsl(210, 40%, 98%);\n  --sidebar-accent: hsl(215, 32%, 27%);\n  --sidebar-accent-foreground: hsl(239, 84%, 67%);\n  --sidebar-border: hsl(215, 28%, 17%);\n  --sidebar-ring: hsl(239, 84%, 67%);\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 0.5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00), 0px 1px 2px -1px hsl(239, 84%, 67%, 0.00);\n  --shadow: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00), 0px 1px 2px -1px hsl(239, 84%, 67%, 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00), 0px 2px 4px -1px hsl(239, 84%, 67%, 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00), 0px 4px 6px -1px hsl(239, 84%, 67%, 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00), 0px 8px 10px -1px hsl(239, 84%, 67%, 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(239, 84%, 67%, 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n}\n\n.dark {\n  --background: hsl(222, 84%, 5%);\n  --foreground: hsl(210, 40%, 98%);\n  --card: hsl(222, 84%, 5%);\n  --card-foreground: hsl(210, 40%, 98%);\n  --popover: hsl(222, 84%, 5%);\n  --popover-foreground: hsl(210, 40%, 98%);\n  --primary: hsl(239, 84%, 67%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(160, 84%, 39%);\n  --secondary-foreground: hsl(210, 40%, 98%);\n  --muted: hsl(215, 32%, 27%);\n  --muted-foreground: hsl(215, 20%, 65%);\n  --accent: hsl(43, 96%, 56%);\n  --accent-foreground: hsl(210, 40%, 98%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(210, 40%, 98%);\n  --border: hsl(215, 28%, 17%);\n  --input: hsl(215, 28%, 17%);\n  --ring: hsl(239, 84%, 67%);\n  --chart-1: hsl(239, 84%, 67%);\n  --chart-2: hsl(160, 84%, 39%);\n  --chart-3: hsl(43, 96%, 56%);\n  --chart-4: hsl(147, 78%, 42%);\n  --chart-5: hsl(341, 75%, 51%);\n  --sidebar: hsl(222, 84%, 5%);\n  --sidebar-foreground: hsl(210, 40%, 98%);\n  --sidebar-primary: hsl(239, 84%, 67%);\n  --sidebar-primary-foreground: hsl(210, 40%, 98%);\n  --sidebar-accent: hsl(215, 32%, 27%);\n  --sidebar-accent-foreground: hsl(239, 84%, 67%);\n  --sidebar-border: hsl(215, 28%, 17%);\n  --sidebar-ring: hsl(239, 84%, 67%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: 'Inter', system-ui, sans-serif;\n  }\n}\n\n/* Voice recording animations matching the design reference */\n.voice-pulse {\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n.voice-recording {\n  background: radial-gradient(circle, rgba(239, 68, 68, 0.3) 0%, rgba(239, 68, 68, 0.1) 50%, transparent 100%);\n  animation: recording-pulse 1.5s ease-in-out infinite;\n}\n\n@keyframes recording-pulse {\n  0%, 100% { \n    transform: scale(1); \n    opacity: 1; \n  }\n  50% { \n    transform: scale(1.05); \n    opacity: 0.8; \n  }\n}\n\n/* Glassmorphism effects for modern UI matching design reference */\n.glassmorphism {\n  background: rgba(255, 255, 255, 0.05);\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* Chart container styling with gradient background */\n.chart-container {\n  background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);\n}\n\n/* KPI card hover effects for interactivity matching design reference */\n.kpi-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);\n}\n\n/* Sidebar navigation smooth transitions */\n.sidebar-nav {\n  transition: all 0.3s ease;\n}\n\n/* Page transition animations matching design reference */\n.page-transition {\n  opacity: 0;\n  animation: fadeIn 0.5s ease-out forwards;\n}\n\n@keyframes fadeIn {\n  to { \n    opacity: 1; \n  }\n}\n\n/* Custom scrollbar styling for dark theme */\n::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n::-webkit-scrollbar-track {\n  background: hsl(var(--muted));\n}\n\n::-webkit-scrollbar-thumb {\n  background: hsl(var(--muted-foreground));\n  border-radius: 3px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: hsl(var(--foreground));\n}\n\n/* Text truncation utilities */\n.line-clamp-2 {\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n\n.line-clamp-3 {\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n\n/* Focus states for accessibility */\n.focus-visible {\n  outline: 2px solid hsl(var(--ring));\n  outline-offset: 2px;\n}\n\n/* Selection styling to match theme */\n::selection {\n  background: hsl(var(--primary), 0.3);\n  color: hsl(var(--primary-foreground));\n}\n\n/* Voice button gradient animations matching design reference */\n.voice-btn {\n  position: relative;\n  background: linear-gradient(45deg, hsl(0, 84%, 60%), hsl(341, 75%, 51%));\n  transition: all 0.3s ease;\n}\n\n.voice-btn:hover {\n  background: linear-gradient(45deg, hsl(0, 84%, 65%), hsl(341, 75%, 56%));\n  transform: scale(1.05);\n}\n\n.voice-btn.recording {\n  animation: recording-pulse 1.5s ease-in-out infinite;\n}\n\n/* Gradient backgrounds for action buttons matching design reference */\n.gradient-primary {\n  background: linear-gradient(45deg, hsl(var(--primary)), hsl(var(--secondary)));\n}\n\n.gradient-primary:hover {\n  background: linear-gradient(45deg, hsl(var(--primary), 0.9), hsl(var(--secondary), 0.9));\n}\n\n/* Dark theme card enhancements */\n.dark-card {\n  background: hsl(var(--card));\n  border: 1px solid hsl(var(--border));\n}\n\n.dark-input {\n  background: hsl(var(--input));\n  border: 1px solid hsl(var(--border));\n  color: hsl(var(--foreground));\n}\n\n.dark-input:focus {\n  ring: 2px solid hsl(var(--ring));\n  border-color: transparent;\n}\n\n/* Status indicators with exact design reference colors */\n.status-ready {\n  background: hsl(160, 84%, 39%, 0.2);\n  color: hsl(160, 84%, 39%);\n  border: 1px solid hsl(160, 84%, 39%, 0.3);\n}\n\n.status-processing {\n  background: hsl(43, 96%, 56%, 0.2);\n  color: hsl(43, 96%, 56%);\n  border: 1px solid hsl(43, 96%, 56%, 0.3);\n}\n\n.status-error {\n  background: hsl(0, 84%, 60%, 0.2);\n  color: hsl(0, 84%, 60%);\n  border: 1px solid hsl(0, 84%, 60%, 0.3);\n}\n\n/* Navigation active states matching design reference */\n.nav-active {\n  background: hsl(var(--primary), 0.2);\n  color: hsl(var(--primary));\n  font-weight: 500;\n}\n\n/* Interactive elements hover states */\n.interactive-hover:hover {\n  background: hsl(var(--muted));\n  color: hsl(var(--foreground));\n  transform: translateY(-1px);\n  transition: all 0.2s ease;\n}\n\n/* Loading states */\n.loading-shimmer {\n  background: linear-gradient(90deg, hsl(var(--muted)) 0%, hsl(var(--muted-foreground), 0.2) 50%, hsl(var(--muted)) 100%);\n  background-size: 200% 100%;\n  animation: shimmer 1.5s infinite;\n}\n\n@keyframes shimmer {\n  0% {\n    background-position: -200% 0;\n  }\n  100% {\n    background-position: 200% 0;\n  }\n}\n\n/* Chart styling overrides to match dark theme */\n.recharts-cartesian-grid line {\n  stroke: hsl(var(--border));\n}\n\n.recharts-text {\n  fill: hsl(var(--muted-foreground));\n}\n\n.recharts-tooltip-wrapper {\n  background: hsl(var(--card)) !important;\n  border: 1px solid hsl(var(--border)) !important;\n  border-radius: 6px !important;\n}\n\n/* Login modal glassmorphism effects from design reference */\n.login-modal .glassmorphism {\n  background: rgba(255, 255, 255, 0.05);\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* Voice status component styling */\n.voice-status {\n  background: hsl(0, 84%, 60%, 0.2);\n  border: 1px solid hsl(0, 84%, 60%, 0.3);\n}\n\n/* Top bar glassmorphism backdrop matching design reference */\n.top-bar-glass {\n  background: rgba(255, 255, 255, 0.05);\n  backdrop-filter: blur(10px);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* Brand logo gradient from design reference */\n.brand-logo {\n  background: linear-gradient(45deg, hsl(var(--primary)), hsl(var(--secondary)));\n}\n\n/* Hero section gradients from auth page design reference */\n.hero-gradient {\n  background: linear-gradient(135deg, \n    hsl(var(--primary), 0.2) 0%, \n    hsl(var(--secondary), 0.2) 50%, \n    hsl(var(--accent), 0.2) 100%\n  );\n}\n\n/* Upload drag and drop area styling */\n.upload-dropzone {\n  border: 2px dashed hsl(var(--border));\n  transition: all 0.3s ease;\n}\n\n.upload-dropzone.dragging {\n  border-color: hsl(var(--primary));\n  background: hsl(var(--primary), 0.05);\n}\n\n.upload-dropzone:hover {\n  border-color: hsl(var(--primary), 0.5);\n}\n\n/* Data table styling for dark theme */\n.data-table {\n  background: hsl(var(--card));\n  border: 1px solid hsl(var(--border));\n}\n\n.data-table th {\n  background: hsl(var(--muted));\n  color: hsl(var(--muted-foreground));\n  font-weight: 500;\n}\n\n.data-table tr:hover {\n  background: hsl(var(--muted), 0.5);\n}\n\n/* Action button gradients matching design reference */\n.action-primary {\n  background: linear-gradient(45deg, hsl(var(--primary)), hsl(var(--primary), 0.8));\n}\n\n.action-secondary {\n  background: linear-gradient(45deg, hsl(var(--secondary)), hsl(var(--secondary), 0.8));\n}\n\n.action-accent {\n  background: linear-gradient(45deg, hsl(var(--accent)), hsl(var(--accent), 0.8));\n}\n\n/* Notification badge styling */\n.notification-badge {\n  background: hsl(var(--destructive));\n  color: hsl(var(--destructive-foreground));\n  font-size: 0.75rem;\n  border-radius: 50%;\n  min-width: 1.25rem;\n  height: 1.25rem;\n}\n\n/* Mobile responsive adjustments */\n@media (max-width: 768px) {\n  .sidebar-nav {\n    transform: translateX(-100%);\n  }\n  \n  .sidebar-nav.open {\n    transform: translateX(0);\n  }\n  \n  .mobile-overlay {\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(2px);\n  }\n}\n\n/* High contrast mode support */\n@media (prefers-contrast: high) {\n  :root {\n    --border: hsl(215, 28%, 25%);\n    --muted: hsl(215, 32%, 35%);\n  }\n}\n\n/* Reduced motion support */\n@media (prefers-reduced-motion: reduce) {\n  .voice-recording,\n  .voice-pulse,\n  .page-transition {\n    animation: none;\n  }\n  \n  .interactive-hover:hover {\n    transform: none;\n  }\n}\n\n/* React Grid Layout - Power BI-style improvements */\n.react-grid-item {\n  transition: all 200ms ease;\n  transition-property: left, top, width, height;\n}\n\n.react-grid-item.cssTransforms {\n  transition-property: transform, width, height;\n}\n\n.react-grid-item.react-draggable-dragging {\n  transition: none;\n  z-index: 100;\n  will-change: transform;\n  cursor: grabbing !important;\n}\n\n.react-grid-item.resizing {\n  transition: none;\n  z-index: 100;\n  will-change: transform, width, height;\n}\n\n/* Better resize handles */\n.react-resizable-handle {\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  background-color: transparent;\n  z-index: 10;\n}\n\n.react-resizable-handle::after {\n  content: \"\";\n  position: absolute;\n  right: 3px;\n  bottom: 3px;\n  width: 8px;\n  height: 8px;\n  border-right: 2px solid hsl(var(--primary));\n  border-bottom: 2px solid hsl(var(--primary));\n  opacity: 0.6;\n  transition: opacity 200ms ease;\n}\n\n.react-grid-item:hover .react-resizable-handle::after {\n  opacity: 1;\n}\n\n.react-resizable-handle-se {\n  bottom: 0;\n  right: 0;\n  cursor: se-resize;\n}\n\n/* Grid placeholder with visual feedback */\n.react-grid-placeholder {\n  background: hsl(var(--primary) / 0.2) !important;\n  border: 2px dashed hsl(var(--primary)) !important;\n  border-radius: 0.5rem;\n  transition-duration: 100ms;\n  z-index: 2;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  -o-user-select: none;\n  user-select: none;\n}\n","size_bytes":12674},"server/services/sql-generator.ts":{"content":"/**\n * SQL Query Generator Service\n * \n * Generates SQL queries from natural language using AI\n * PRIVACY: Only uses schema information, never real data\n */\n\nimport OpenAI from \"openai\";\n\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY\n});\n\ninterface SQLGenerationRequest {\n  question: string;\n  tableName: string;\n  schemaName?: string;\n  columns: Array<{ name: string; type: string }>;\n  databaseType: string;\n}\n\ninterface SQLGenerationResponse {\n  sql: string;\n  explanation: string;\n  resultType: 'single_value' | 'table' | 'aggregation';\n}\n\n/**\n * Generate SQL query from natural language question\n * Only uses schema information - no real data exposure\n */\nexport async function generateSQLQuery(request: SQLGenerationRequest): Promise<SQLGenerationResponse> {\n  const { question, tableName, schemaName, columns, databaseType } = request;\n  \n  // Build fully qualified table name\n  const fullTableName = schemaName ? `${schemaName}.${tableName}` : tableName;\n  \n  // Create schema description (NO REAL DATA)\n  const schemaDescription = `Table: ${fullTableName}\nColumns:\n${columns.map(col => `  - ${col.name} (${col.type})`).join('\\n')}\n\nDatabase Type: ${databaseType}`;\n\n  const systemPrompt = `You are an expert SQL query generator. Generate SQL queries based on natural language questions and table schemas.\n\nIMPORTANT RULES:\n1. Generate ONLY valid SQL for ${databaseType} databases\n2. Use proper syntax for ${databaseType} (e.g., TOP for SQL Server, LIMIT for others)\n3. Return ONLY executable SQL - no explanations in the SQL itself\n4. For SQL Server, use TOP N instead of LIMIT N\n5. Always use fully qualified table names\n6. Be precise with aggregations (COUNT, SUM, AVG, etc.)\n7. Use DISTINCT when counting unique values\n8. Handle NULL values appropriately\n\nReturn your response in JSON format:\n{\n  \"sql\": \"The complete SQL query\",\n  \"explanation\": \"Brief explanation of what the query does\",\n  \"resultType\": \"single_value\" (for COUNT, SUM, etc.) or \"table\" (for SELECT with rows) or \"aggregation\" (for GROUP BY)\",\n  \"visualizationHint\": \"bar\" or \"line\" or \"pie\" or \"table\" (suggest best visualization for the data)\n}\n\nNote: If user requests \"heatmap\", generate a GROUP BY query and suggest \"table\" or \"bar\" visualization as we don't support heatmaps yet.`;\n\n  const userPrompt = `${schemaDescription}\n\nUser Question: ${question}\n\nGenerate the SQL query that answers this question. Be precise and use the correct ${databaseType} syntax.`;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt }\n      ],\n      response_format: { type: \"json_object\" },\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    return {\n      sql: result.sql || \"\",\n      explanation: result.explanation || \"SQL query generated\",\n      resultType: result.resultType || \"table\"\n    };\n  } catch (error) {\n    console.error(\"SQL generation error:\", error);\n    throw new Error(`Failed to generate SQL query: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\n/**\n * Extract column information from database query results\n */\nexport function extractColumnInfo(sampleData: any[]): Array<{ name: string; type: string }> {\n  if (!sampleData || sampleData.length === 0) {\n    return [];\n  }\n  \n  const firstRow = sampleData[0];\n  const columns: Array<{ name: string; type: string }> = [];\n  \n  for (const [key, value] of Object.entries(firstRow)) {\n    let type = 'string';\n    \n    if (value === null || value === undefined) {\n      type = 'unknown';\n    } else if (typeof value === 'number') {\n      type = Number.isInteger(value) ? 'integer' : 'float';\n    } else if (value instanceof Date) {\n      type = 'date';\n    } else if (typeof value === 'boolean') {\n      type = 'boolean';\n    }\n    \n    columns.push({ name: key, type });\n  }\n  \n  return columns;\n}\n","size_bytes":3971},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/table-selection-modal.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { \n  Database, \n  Table, \n  Search, \n  CheckSquare, \n  Square,\n  Loader2,\n  Info,\n  BarChart3\n} from \"lucide-react\";\n\ninterface TableSelectionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  connectionName: string;\n  databaseType: string;\n  connectionConfig: any;\n  onTablesSelected: (selectedTables: string[], deselectedTableIds?: number[]) => void;\n  connectionId?: string;\n}\n\ninterface DatabaseTable {\n  name: string;\n  schema: string;\n  type: 'table' | 'view';\n  rowCount?: number;\n  columns: Array<{\n    name: string;\n    type: string;\n    nullable: boolean;\n    isPrimaryKey: boolean;\n  }>;\n}\n\ninterface SchemaInfo {\n  schemas: string[];\n  tables: DatabaseTable[];\n}\n\nexport default function TableSelectionModal({\n  isOpen,\n  onClose,\n  connectionName,\n  databaseType,\n  connectionConfig,\n  onTablesSelected,\n  connectionId\n}: TableSelectionModalProps) {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedTables, setSelectedTables] = useState<Set<string>>(new Set());\n  const [isCreatingDatasets, setIsCreatingDatasets] = useState(false);\n  const hasInitialized = useRef(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch schema information\n  const { data: schemaInfo, isLoading: isLoadingSchema, error } = useQuery({\n    queryKey: ['/api/database-connectors/schema', databaseType, connectionConfig],\n    queryFn: async () => {\n      const response = await apiRequest('POST', '/api/database-connectors/schema', {\n        type: databaseType,\n        config: connectionConfig\n      });\n      return response.json() as Promise<SchemaInfo>;\n    },\n    enabled: isOpen && !!databaseType && !!connectionConfig,\n  });\n\n  // Fetch existing tables for this connection (if editing)\n  const { data: existingTables = [], isFetched: existingTablesFetched } = useQuery({\n    queryKey: ['/api/connections', connectionId, 'tables'],\n    queryFn: async () => {\n      const response = await apiRequest('GET', `/api/connections/${connectionId}/tables`);\n      return response.json();\n    },\n    enabled: isOpen && !!connectionId,\n  });\n\n  // Reset selection when modal opens, or pre-select existing tables when editing\n  useEffect(() => {\n    if (isOpen && !hasInitialized.current) {\n      if (connectionId && existingTablesFetched) {\n        // Editing: data has been fetched (even if empty)\n        if (existingTables.length > 0) {\n          // Pre-select existing tables\n          const preSelected = new Set<string>(\n            existingTables.map((t: any) => `${t.metadata?.schemaName}.${t.metadata?.tableName}` as string)\n          );\n          setSelectedTables(preSelected);\n        } else {\n          // Connection exists but has no tables - start with empty selection\n          setSelectedTables(new Set<string>());\n        }\n        setSearchTerm(\"\");\n        hasInitialized.current = true;\n      } else if (!connectionId) {\n        // New connection (not editing) - initialize empty and mark as initialized\n        setSelectedTables(new Set<string>());\n        setSearchTerm(\"\");\n        hasInitialized.current = true;\n      }\n      // If connectionId exists but data hasn't been fetched yet, wait for it\n    } else if (!isOpen) {\n      // Reset flag when modal closes\n      hasInitialized.current = false;\n    }\n  }, [isOpen, connectionId, existingTables, existingTablesFetched]);\n\n  const createDatasetsMutation = useMutation({\n    mutationFn: async (tableIds: string[]) => {\n      const results = await Promise.all(\n        tableIds.map(async (tableId) => {\n          const table = schemaInfo?.tables.find(t => `${t.schema}.${t.name}` === tableId);\n          if (!table) throw new Error(`Table ${tableId} not found`);\n\n          return apiRequest('POST', '/api/data-sources/table', {\n            connectionId,\n            connectionName,\n            databaseType,\n            connectionConfig,\n            tableName: table.name,\n            schemaName: table.schema,\n            tableMetadata: table\n          });\n        })\n      );\n      return results;\n    },\n    onError: (error) => {\n      toast({\n        title: \"Import failed\",\n        description: error instanceof Error ? error.message : 'Failed to import tables',\n        variant: \"destructive\",\n      });\n    },\n    onSettled: () => {\n      setIsCreatingDatasets(false);\n    },\n  });\n\n  const handleTableToggle = (tableId: string) => {\n    const newSelection = new Set(selectedTables);\n    if (newSelection.has(tableId)) {\n      newSelection.delete(tableId);\n    } else {\n      newSelection.add(tableId);\n    }\n    setSelectedTables(newSelection);\n  };\n\n  const handleSelectAll = () => {\n    if (!schemaInfo) return;\n    \n    const filteredTableIds = schemaInfo.tables\n      .filter(table => \n        table.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        table.schema.toLowerCase().includes(searchTerm.toLowerCase())\n      )\n      .map(table => `${table.schema}.${table.name}`);\n\n    if (selectedTables.size === filteredTableIds.length) {\n      // Deselect all filtered tables\n      const newSelection = new Set(selectedTables);\n      filteredTableIds.forEach(id => newSelection.delete(id));\n      setSelectedTables(newSelection);\n    } else {\n      // Select all filtered tables\n      const newSelection = new Set(selectedTables);\n      filteredTableIds.forEach(id => newSelection.add(id));\n      setSelectedTables(newSelection);\n    }\n  };\n\n  const handleImportSelected = () => {\n    if (selectedTables.size === 0) {\n      toast({\n        title: \"No tables selected\",\n        description: \"Please select at least one table to import.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    // If editing, calculate which tables were deselected\n    let deselectedTableIds: number[] = [];\n    if (connectionId && existingTables.length > 0) {\n      const existingTableKeys = new Set(\n        existingTables.map((t: any) => `${t.metadata?.schemaName}.${t.metadata?.tableName}`)\n      );\n      \n      deselectedTableIds = existingTables\n        .filter((t: any) => {\n          const tableKey = `${t.metadata?.schemaName}.${t.metadata?.tableName}`;\n          return !selectedTables.has(tableKey);\n        })\n        .map((t: any) => t.id);\n    }\n    \n    setIsCreatingDatasets(true);\n    \n    // Create datasets for selected tables, then notify parent with deselected IDs\n    createDatasetsMutation.mutate(Array.from(selectedTables), {\n      onSuccess: () => {\n        onTablesSelected(Array.from(selectedTables), deselectedTableIds);\n        onClose();\n      }\n    });\n  };\n\n  const filteredTables = schemaInfo?.tables.filter(table => \n    table.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    table.schema.toLowerCase().includes(searchTerm.toLowerCase())\n  ) || [];\n\n  const groupedBySchema = filteredTables.reduce((acc, table) => {\n    if (!acc[table.schema]) {\n      acc[table.schema] = [];\n    }\n    acc[table.schema].push(table);\n    return acc;\n  }, {} as Record<string, DatabaseTable[]>);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Database className=\"h-5 w-5\" />\n            Select Tables from {connectionName}\n          </DialogTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Choose the tables you want to import as datasets. Each selected table will become an individual dataset in NEX House.\n          </p>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden flex flex-col space-y-4\">\n          {/* Search and Controls */}\n          <div className=\"flex items-center justify-between gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search tables...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n                data-testid=\"input-search-tables\"\n              />\n            </div>\n            <Button\n              variant=\"outline\"\n              onClick={handleSelectAll}\n              disabled={isLoadingSchema || filteredTables.length === 0}\n              data-testid=\"button-select-all\"\n            >\n              {selectedTables.size === filteredTables.length && filteredTables.length > 0 ? (\n                <>\n                  <Square className=\"h-4 w-4 mr-2\" />\n                  Deselect All\n                </>\n              ) : (\n                <>\n                  <CheckSquare className=\"h-4 w-4 mr-2\" />\n                  Select All\n                </>\n              )}\n            </Button>\n          </div>\n\n          {/* Loading State */}\n          {isLoadingSchema && (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin mr-2\" />\n              <span>Loading database schema...</span>\n            </div>\n          )}\n\n          {/* Error State */}\n          {error && (\n            <Card className=\"border-destructive\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-2 text-destructive\">\n                  <Info className=\"h-4 w-4\" />\n                  <span>Failed to load database schema: {error instanceof Error ? error.message : 'Unknown error'}</span>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Tables List */}\n          {schemaInfo && !isLoadingSchema && (\n            <div className=\"flex-1 overflow-y-auto space-y-4\">\n              {Object.entries(groupedBySchema).map(([schema, tables]) => (\n                <Card key={schema}>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"flex items-center gap-2 text-lg\">\n                      <Database className=\"h-4 w-4\" />\n                      Schema: {schema}\n                      <Badge variant=\"secondary\">{tables.length} table(s)</Badge>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                      {tables.map((table) => {\n                        const tableId = `${table.schema}.${table.name}`;\n                        const isSelected = selectedTables.has(tableId);\n                        \n                        return (\n                          <div\n                            key={tableId}\n                            className={`\n                              p-3 border rounded-lg cursor-pointer transition-all\n                              ${isSelected \n                                ? 'border-primary bg-primary/5 shadow-sm' \n                                : 'border-border hover:border-primary/50 hover:bg-muted/50'\n                              }\n                            `}\n                            onClick={() => handleTableToggle(tableId)}\n                            data-testid={`table-${tableId}`}\n                          >\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <Checkbox \n                                checked={isSelected}\n                                onChange={() => handleTableToggle(tableId)}\n                                className=\"pointer-events-none\"\n                              />\n                              <Table className=\"h-4 w-4 text-primary\" />\n                              <span className=\"font-medium text-sm\">{table.name}</span>\n                              <Badge variant={table.type === 'view' ? 'outline' : 'secondary'} className=\"text-xs\">\n                                {table.type}\n                              </Badge>\n                            </div>\n                            \n                            <div className=\"text-xs text-muted-foreground space-y-1\">\n                              <div className=\"flex items-center gap-1\">\n                                <BarChart3 className=\"h-3 w-3\" />\n                                {table.columns.length} column(s)\n                                {table.rowCount && (\n                                  <span className=\"ml-1\">‚Ä¢ {table.rowCount.toLocaleString()} rows</span>\n                                )}\n                              </div>\n                              <div className=\"truncate\">\n                                Columns: {table.columns.slice(0, 3).map(col => col.name).join(', ')}\n                                {table.columns.length > 3 && '...'}\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n\n              {filteredTables.length === 0 && !isLoadingSchema && (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  {searchTerm ? 'No tables match your search.' : 'No tables found in this database.'}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex items-center justify-between pt-4 border-t\">\n            <div className=\"text-sm text-muted-foreground\">\n              {selectedTables.size} table(s) selected\n            </div>\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" onClick={onClose} disabled={isCreatingDatasets}>\n                Cancel\n              </Button>\n              <Button \n                onClick={handleImportSelected}\n                disabled={selectedTables.size === 0 || isCreatingDatasets}\n                data-testid=\"button-import-tables\"\n              >\n                {isCreatingDatasets ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    Importing...\n                  </>\n                ) : (\n                  `Import ${selectedTables.size} Table(s)`\n                )}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":14928},"client/src/pages/chart-builder-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  ArrowLeft, \n  Save, \n  Database, \n  BarChart3, \n  X,\n  Loader2 \n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { CHART_CATALOG, type ChartType } from \"@/lib/chart-catalog\";\nimport type { DataSource } from \"@shared/schema\";\nimport { BigNumberConfig } from \"@/components/chart-config/BigNumberConfig\";\nimport { BarChartConfig } from \"@/components/chart-config/BarChartConfig\";\nimport { LineChartConfig } from \"@/components/chart-config/LineChartConfig\";\nimport { PieChartConfig } from \"@/components/chart-config/PieChartConfig\";\nimport { ScatterChartConfig } from \"@/components/chart-config/ScatterChartConfig\";\nimport { HeatmapConfig } from \"@/components/chart-config/HeatmapConfig\";\nimport { TableConfig } from \"@/components/chart-config/TableConfig\";\nimport { FunnelConfig } from \"@/components/chart-config/FunnelConfig\";\nimport { TreemapConfig } from \"@/components/chart-config/TreemapConfig\";\nimport { RadarConfig } from \"@/components/chart-config/RadarConfig\";\nimport { MapConfig } from \"@/components/chart-config/MapConfig\";\nimport { WaterfallConfig } from \"@/components/chart-config/WaterfallConfig\";\nimport { SankeyConfig } from \"@/components/chart-config/SankeyConfig\";\nimport { HistogramConfig } from \"@/components/chart-config/HistogramConfig\";\nimport { MultiValueConfig } from \"@/components/chart-config/MultiValueConfig\";\n\ninterface ChartBuilderPageProps {\n  chartType?: string;\n  onBack?: () => void;\n}\n\nexport default function ChartBuilderPage({ chartType: chartTypeProp, onBack }: ChartBuilderPageProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  // Get chart type from props (or fallback to URL params for standalone access)\n  const urlParams = new URLSearchParams(window.location.search);\n  const chartTypeId = chartTypeProp || urlParams.get(\"type\") || \"bar\";\n  \n  const chartType = CHART_CATALOG.find((c) => c.id === chartTypeId);\n  \n  // Form state\n  const [title, setTitle] = useState(`New ${chartType?.name || \"Chart\"}`);\n  const [selectedDatasets, setSelectedDatasets] = useState<string[]>([]);\n  const [config, setConfig] = useState<Record<string, any>>({});\n  const [availableColumns, setAvailableColumns] = useState<string[]>([]);\n  \n  // Fetch columns from selected datasets\n  useEffect(() => {\n    const fetchColumns = async () => {\n      if (selectedDatasets.length === 0) {\n        setAvailableColumns([]);\n        return;\n      }\n\n      try {\n        const columnSets = await Promise.all(\n          selectedDatasets.map(async (datasetId) => {\n            const response = await fetch(`/api/data-sources/${datasetId}/columns`, {\n              credentials: \"include\",\n            });\n            if (response.ok) {\n              const data = await response.json();\n              const columns = data.columns || [];\n              // Extract column names from column objects\n              return columns.map((col: any) => typeof col === 'string' ? col : col.name);\n            }\n            return [];\n          })\n        );\n\n        // Combine and deduplicate columns from all datasets\n        const allColumns = Array.from(new Set(columnSets.flat()));\n        setAvailableColumns(allColumns);\n      } catch (error) {\n        console.error(\"Failed to fetch columns:\", error);\n        setAvailableColumns([]);\n      }\n    };\n\n    fetchColumns();\n  }, [selectedDatasets]);\n  \n  // Initialize config with defaults based on chart type\n  useEffect(() => {\n    const getDefaultConfig = (type: string) => {\n      switch (type) {\n        case \"big_number\":\n        case \"big_number_trendline\":\n        case \"gauge\":\n          return {\n            metric: \"\",\n            format: \"number\",\n            decimals: \"0\",\n            currency: \"USD\",\n            prefix: \"\",\n            suffix: \"\",\n          };\n        case \"bar\":\n        case \"stacked_bar\":\n        case \"grouped_bar\":\n        case \"horizontal_bar\":\n          return {\n            xAxis: \"\",\n            yAxis: \"\",\n            aggregation: \"sum\",\n            limit: \"\",\n            sortOrder: \"desc\",\n          };\n        case \"line\":\n        case \"multi_line\":\n        case \"smooth_line\":\n        case \"stepped_line\":\n        case \"area\":\n        case \"stacked_area\":\n          return {\n            xAxis: \"\",\n            yAxis: \"\",\n            groupBy: \"\",\n            lineStyle: \"linear\",\n            showDataPoints: false,\n            showArea: false,\n          };\n        case \"pie\":\n        case \"donut\":\n          return {\n            category: \"\",\n            value: \"\",\n            limit: \"\",\n            donutMode: type === \"donut\",\n            showLabels: true,\n            showPercentages: false,\n          };\n        case \"scatter\":\n        case \"bubble\":\n          return {\n            xAxis: \"\",\n            yAxis: \"\",\n            size: \"\",\n            color: \"\",\n            limit: \"\",\n          };\n        case \"heatmap\":\n        case \"calendar_heatmap\":\n          return {\n            xAxis: \"\",\n            yAxis: \"\",\n            metric: \"\",\n            colorScheme: \"blues\",\n          };\n        case \"table\":\n        case \"pivot_table\":\n          return {\n            columns: \"\",\n            orderBy: \"\",\n            limit: \"\",\n            pagination: true,\n            search: true,\n          };\n        case \"funnel\":\n          return {\n            stage: \"\",\n            metric: \"\",\n            orientation: \"vertical\",\n            labelPosition: \"inside\",\n          };\n        case \"treemap\":\n        case \"sunburst\":\n          return {\n            category: \"\",\n            subcategory: \"\",\n            metric: \"\",\n            colorMetric: \"\",\n          };\n        case \"radar\":\n          return {\n            category: \"\",\n            series: \"\",\n            metric: \"\",\n            fillArea: true,\n          };\n        case \"country_map\":\n        case \"geojson_map\":\n          return {\n            location: \"\",\n            metric: \"\",\n            mapType: \"country\",\n            colorScheme: \"sequential\",\n          };\n        case \"waterfall\":\n          return {\n            category: \"\",\n            metric: \"\",\n            sortOrder: \"none\",\n            totalLabel: \"Total\",\n          };\n        case \"sankey\":\n          return {\n            source: \"\",\n            target: \"\",\n            value: \"\",\n            nodeAlign: \"justify\",\n          };\n        case \"histogram\":\n        case \"boxplot\":\n          return {\n            column: \"\",\n            bins: \"\",\n            binRange: \"\",\n            cumulative: false,\n            normalized: false,\n          };\n        case \"multi_value_card\":\n          return {\n            metrics: \"\",\n            labels: \"\",\n            format: \"\",\n            showTrend: false,\n          };\n        default:\n          return {};\n      }\n    };\n    \n    setConfig(getDefaultConfig(chartTypeId));\n  }, [chartTypeId]);\n  \n  // Fetch data sources\n  const { data: dataSources = [], isLoading: isLoadingDataSources } = useQuery<DataSource[]>({\n    queryKey: [\"/api/data-sources\"],\n  });\n  \n  // Create chart mutation\n  const createChartMutation = useMutation({\n    mutationFn: async (chartData: any) => {\n      const response = await fetch(\"/api/charts\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(chartData),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to create chart\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/charts\"] });\n      toast({\n        title: \"Chart created\",\n        description: \"Your chart has been created successfully.\",\n      });\n      if (onBack) {\n        onBack();\n      } else {\n        setLocation(\"/\");\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n  \n  const handleDatasetToggle = (datasetId: string) => {\n    setSelectedDatasets((prev) =>\n      prev.includes(datasetId)\n        ? prev.filter((id) => id !== datasetId)\n        : [...prev, datasetId]\n    );\n  };\n  \n  const handleRemoveDataset = (datasetId: string) => {\n    setSelectedDatasets((prev) => prev.filter((id) => id !== datasetId));\n  };\n  \n  const handleSave = () => {\n    if (!title.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a chart title.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (selectedDatasets.length === 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please select at least one dataset.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    createChartMutation.mutate({\n      title,\n      type: chartTypeId,\n      config,\n      dataSourceIds: selectedDatasets,\n    });\n  };\n  \n  const renderChartConfig = () => {\n    const configMap: Record<string, any> = {\n      big_number: BigNumberConfig,\n      big_number_trendline: BigNumberConfig,\n      gauge: BigNumberConfig,\n      bar: BarChartConfig,\n      stacked_bar: BarChartConfig,\n      grouped_bar: BarChartConfig,\n      horizontal_bar: BarChartConfig,\n      line: LineChartConfig,\n      multi_line: LineChartConfig,\n      smooth_line: LineChartConfig,\n      stepped_line: LineChartConfig,\n      area: LineChartConfig,\n      stacked_area: LineChartConfig,\n      pie: PieChartConfig,\n      donut: PieChartConfig,\n      scatter: ScatterChartConfig,\n      bubble: ScatterChartConfig,\n      heatmap: HeatmapConfig,\n      calendar_heatmap: HeatmapConfig,\n      table: TableConfig,\n      pivot_table: TableConfig,\n      funnel: FunnelConfig,\n      treemap: TreemapConfig,\n      sunburst: TreemapConfig,\n      radar: RadarConfig,\n      country_map: MapConfig,\n      geojson_map: MapConfig,\n      waterfall: WaterfallConfig,\n      sankey: SankeyConfig,\n      histogram: HistogramConfig,\n      boxplot: HistogramConfig,\n      multi_value_card: MultiValueConfig,\n    };\n    \n    const ConfigComponent = configMap[chartTypeId];\n    \n    if (!ConfigComponent) {\n      return (\n        <Card>\n          <CardContent className=\"p-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              Configuration options for this chart type are coming soon.\n            </p>\n          </CardContent>\n        </Card>\n      );\n    }\n    \n    return <ConfigComponent config={config} onChange={setConfig} columns={availableColumns} />;\n  };\n  \n  return (\n    <div className=\"flex h-screen bg-background\">\n      {/* Left Panel - Configuration */}\n      <div className=\"w-[400px] border-r border-border bg-card\">\n        <ScrollArea className=\"h-full\">\n          <div className=\"p-6 space-y-6\">\n            {/* Header */}\n            <div className=\"space-y-4\">\n              <Button\n                variant=\"ghost\"\n                onClick={() => {\n                  if (onBack) {\n                    onBack();\n                  } else {\n                    setLocation(\"/\");\n                  }\n                }}\n                className=\"pl-0\"\n                data-testid=\"button-back-to-charts\"\n              >\n                <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                Back to Charts\n              </Button>\n              \n              <div>\n                <h1 className=\"text-2xl font-bold\">Chart Builder</h1>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Configure your {chartType?.name || \"chart\"}\n                </p>\n              </div>\n            </div>\n            \n            <Separator />\n            \n            {/* Chart Type Info */}\n            <div className=\"space-y-2\">\n              <Label>Chart Type</Label>\n              <Card>\n                <CardContent className=\"p-3\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"h-12 w-12 bg-gradient-to-br from-primary/10 to-secondary/10 rounded-lg flex items-center justify-center shrink-0\">\n                      <BarChart3 className=\"h-6 w-6 text-primary/70\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h3 className=\"font-medium text-sm\">{chartType?.name}</h3>\n                      <p className=\"text-xs text-muted-foreground line-clamp-2\">\n                        {chartType?.description}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n            \n            <Separator />\n            \n            {/* Chart Title */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"title\">Chart Title</Label>\n              <Input\n                id=\"title\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                placeholder=\"Enter chart title\"\n                data-testid=\"input-chart-title\"\n              />\n            </div>\n            \n            <Separator />\n            \n            {/* Dataset Selection */}\n            <div className=\"space-y-3\">\n              <Label>Select Datasets</Label>\n              \n              {/* Selected Datasets */}\n              {selectedDatasets.length > 0 && (\n                <div className=\"flex flex-wrap gap-2\">\n                  {selectedDatasets.map((datasetId) => {\n                    const dataset = dataSources.find((ds) => ds.id === datasetId);\n                    return (\n                      <Badge\n                        key={datasetId}\n                        variant=\"secondary\"\n                        className=\"pr-1\"\n                        data-testid={`badge-selected-dataset-${datasetId}`}\n                      >\n                        <Database className=\"mr-1 h-3 w-3\" />\n                        {dataset?.name || \"Unknown\"}\n                        <button\n                          onClick={() => handleRemoveDataset(datasetId)}\n                          className=\"ml-1 hover:bg-destructive/20 rounded-sm p-0.5\"\n                          data-testid={`button-remove-dataset-${datasetId}`}\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </button>\n                      </Badge>\n                    );\n                  })}\n                </div>\n              )}\n              \n              {/* Dataset Selector */}\n              <Select onValueChange={handleDatasetToggle}>\n                <SelectTrigger data-testid=\"select-dataset\">\n                  <SelectValue placeholder=\"Choose a dataset\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {isLoadingDataSources ? (\n                    <div className=\"flex items-center justify-center p-4\">\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    </div>\n                  ) : dataSources.length === 0 ? (\n                    <div className=\"p-4 text-center text-sm text-muted-foreground\">\n                      No datasets available\n                    </div>\n                  ) : (\n                    dataSources\n                      .filter((ds) => !selectedDatasets.includes(ds.id))\n                      .map((ds) => (\n                        <SelectItem key={ds.id} value={ds.id} data-testid={`option-dataset-${ds.id}`}>\n                          <div className=\"flex items-center gap-2\">\n                            <Database className=\"h-4 w-4\" />\n                            <span>{ds.name}</span>\n                            <Badge variant=\"outline\" className=\"ml-auto\">\n                              {ds.type}\n                            </Badge>\n                          </div>\n                        </SelectItem>\n                      ))\n                  )}\n                </SelectContent>\n              </Select>\n              \n              {selectedDatasets.length === 0 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  Select one or more datasets to visualize\n                </p>\n              )}\n            </div>\n            \n            <Separator />\n            \n            {/* Chart Configuration */}\n            <div className=\"space-y-3\">\n              <Label>Chart Configuration</Label>\n              {renderChartConfig()}\n            </div>\n          </div>\n        </ScrollArea>\n        \n        {/* Save Button */}\n        <div className=\"p-4 border-t border-border\">\n          <Button\n            onClick={handleSave}\n            className=\"w-full\"\n            disabled={createChartMutation.isPending}\n            data-testid=\"button-save-chart\"\n          >\n            {createChartMutation.isPending ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Creating...\n              </>\n            ) : (\n              <>\n                <Save className=\"mr-2 h-4 w-4\" />\n                Create Chart\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n      \n      {/* Right Panel - Preview */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        <div className=\"p-6 border-b border-border bg-card\">\n          <h2 className=\"text-lg font-semibold\">Preview</h2>\n          <p className=\"text-sm text-muted-foreground\">\n            Chart preview will appear here\n          </p>\n        </div>\n        \n        <div className=\"flex-1 flex items-center justify-center p-6 bg-muted/10\">\n          <Card className=\"w-full max-w-4xl\">\n            <CardHeader>\n              <CardTitle>{title}</CardTitle>\n              <CardDescription>\n                {selectedDatasets.length > 0\n                  ? `Visualizing ${selectedDatasets.length} dataset${selectedDatasets.length > 1 ? \"s\" : \"\"}`\n                  : \"Select datasets to see preview\"}\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"h-96 flex items-center justify-center\">\n              <div className=\"text-center space-y-2\">\n                <BarChart3 className=\"h-16 w-16 mx-auto text-muted-foreground/50\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  Chart preview will be displayed here\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":19089},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/chart-config/MultiValueConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\n\ninterface MultiValueConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n}\n\nexport function MultiValueConfig({ config, onChange }: MultiValueConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metrics\">Metrics (comma-separated)</Label>\n        <Input\n          id=\"metrics\"\n          placeholder=\"e.g., COUNT(*), SUM(revenue), AVG(rating)\"\n          value={config.metrics || \"\"}\n          onChange={(e) => updateConfig(\"metrics\", e.target.value)}\n          data-testid=\"input-metrics\"\n        />\n        <p className=\"text-xs text-muted-foreground\">\n          Each metric will be displayed as a card\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"labels\">Labels (comma-separated)</Label>\n        <Input\n          id=\"labels\"\n          placeholder=\"e.g., Total Orders, Revenue, Avg Rating\"\n          value={config.labels || \"\"}\n          onChange={(e) => updateConfig(\"labels\", e.target.value)}\n          data-testid=\"input-labels\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"format\">Number Format</Label>\n        <Input\n          id=\"format\"\n          placeholder=\"e.g., 0,0 or $0,0.00\"\n          value={config.format || \"\"}\n          onChange={(e) => updateConfig(\"format\", e.target.value)}\n          data-testid=\"input-format\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Label htmlFor=\"showTrend\">Show Trend</Label>\n        <Switch\n          id=\"showTrend\"\n          checked={config.showTrend || false}\n          onCheckedChange={(checked) => updateConfig(\"showTrend\", checked)}\n          data-testid=\"switch-show-trend\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":2044},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"attached_assets/page_1758734436469.tsx":{"content":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport TopNav from \"@/components/nav/TopNav\";\r\n\r\n/* ----------------------------- Types & Models ----------------------------- */\r\ntype KPI = {\r\n  id: string;\r\n  question: string;        // e.g., \"What were my sales in May?\"\r\n  value: string;           // e.g., \"$1,234,567\"\r\n  lastUpdated: string;     // ISO string\r\n  unit?: string;\r\n};\r\n\r\ntype QA = {\r\n  id: string;\r\n  question: string;\r\n  answer: string;\r\n  createdAt: string;       // ISO\r\n};\r\n\r\n/* ------------------------------- Utilities -------------------------------- */\r\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE ?? \"http://localhost:8000\";\r\n\r\nfunction formatTimeAgo(iso: string) {\r\n  const d = new Date(iso);\r\n  const diff = Math.max(0, Date.now() - d.getTime());\r\n  const mins = Math.floor(diff / 60000);\r\n  if (mins < 1) return \"just now\";\r\n  if (mins < 60) return `${mins}m ago`;\r\n  const hours = Math.floor(mins / 60);\r\n  if (hours < 24) return `${hours}h ago`;\r\n  const days = Math.floor(hours / 24);\r\n  return `${days}d ago`;\r\n}\r\n\r\n/* ------------------------------- Page ------------------------------------- */\r\nexport default function DashboardPage() {\r\n  const router = useRouter();\r\n\r\n  // Basic auth guard (localStorage for now; you can switch to HttpOnly cookie later)\r\n  const [userEmail, setUserEmail] = useState<string | null>(null);\r\n  const [checking, setChecking] = useState(true);\r\n\r\n  // Data (local-first placeholder; wire to backend soon)\r\n  const [kpis, setKpis] = useState<KPI[]>([]);\r\n  const [qa, setQa] = useState<QA[]>([]);\r\n\r\n  useEffect(() => {\r\n    const token = typeof window !== \"undefined\" ? localStorage.getItem(\"nex_token\") : null;\r\n    const email = typeof window !== \"undefined\" ? localStorage.getItem(\"nex_user\") : null;\r\n\r\n    if (!token) {\r\n      router.replace(\"/login?next=/dashboard\");\r\n      return;\r\n    }\r\n\r\n    setUserEmail(email);\r\n\r\n    // Load KPIs & QAs from localStorage for now\r\n    try {\r\n      const savedKpis = localStorage.getItem(\"nex_kpis\");\r\n      const savedQa = localStorage.getItem(\"nex_qa\");\r\n\r\n      if (savedKpis) {\r\n        setKpis(JSON.parse(savedKpis));\r\n      } else {\r\n        // Seed example KPIs for first render\r\n        const sample: KPI[] = [\r\n          {\r\n            id: \"kpi-1\",\r\n            question: \"What were my sales in May?\",\r\n            value: \"‚Çπ 1,24,50,000\",\r\n            lastUpdated: new Date().toISOString(),\r\n          },\r\n          {\r\n            id: \"kpi-2\",\r\n            question: \"How many orders did we receive yesterday?\",\r\n            value: \"3,482\",\r\n            lastUpdated: new Date().toISOString(),\r\n          },\r\n          {\r\n            id: \"kpi-3\",\r\n            question: \"Top SKU by revenue (last 7 days)?\",\r\n            value: \"SKU-AX910\",\r\n            lastUpdated: new Date().toISOString(),\r\n          },\r\n        ];\r\n        setKpis(sample);\r\n        localStorage.setItem(\"nex_kpis\", JSON.stringify(sample));\r\n      }\r\n\r\n      if (savedQa) {\r\n        setQa(JSON.parse(savedQa));\r\n      } else {\r\n        const sampleQa: QA[] = [\r\n          {\r\n            id: \"qa-1\",\r\n            question: \"What were my sales in May?\",\r\n            answer: \"‚Çπ 1,24,50,000\",\r\n            createdAt: new Date().toISOString(),\r\n          },\r\n          {\r\n            id: \"qa-2\",\r\n            question: \"Average order value last month?\",\r\n            answer: \"‚Çπ 4,320\",\r\n            createdAt: new Date().toISOString(),\r\n          },\r\n        ];\r\n        setQa(sampleQa);\r\n        localStorage.setItem(\"nex_qa\", JSON.stringify(sampleQa));\r\n      }\r\n    } catch {\r\n      // ignore for now\r\n    } finally {\r\n      setChecking(false);\r\n    }\r\n  }, [router]);\r\n\r\n  // Stub: refresh all KPIs (later: call your backend to recompute)\r\n  async function refreshKpis() {\r\n    // Example: await fetch(`${API_BASE}/kpis/refresh`, { method: \"POST\" });\r\n    const updated = kpis.map(k => ({ ...k, lastUpdated: new Date().toISOString() }));\r\n    setKpis(updated);\r\n    localStorage.setItem(\"nex_kpis\", JSON.stringify(updated));\r\n  }\r\n\r\n  if (checking) {\r\n    return (\r\n      <main className=\"min-h-dvh bg-gray-950 text-white\">\r\n        <TopNav variant=\"dashboard\" />\r\n        <div className=\"max-w-7xl mx-auto p-6\">\r\n          <div className=\"h-8 w-64 bg-white/10 rounded animate-pulse\" />\r\n          <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6\">\r\n            {Array.from({ length: 6 }).map((_, i) => (\r\n              <div key={i} className=\"h-28 rounded-2xl border border-white/10 bg-white/5 animate-pulse\" />\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <main className=\"min-h-dvh bg-gray-950 text-white\">\r\n      {/* Animated, sticky global nav with Dashboard tab */}\r\n      <TopNav variant=\"dashboard\" />\r\n\r\n      {/* Content */}\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        {/* Heading + actions */}\r\n        <div className=\"flex items-center justify-between gap-3\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold\">Dashboard</h1>\r\n            <p className=\"text-white/60\">Pinned KPIs and recent questions</p>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              onClick={refreshKpis}\r\n              className=\"rounded-lg bg-white/10 hover:bg-white/20 px-3 py-2 text-sm\"\r\n              title=\"Refresh KPIs\"\r\n            >\r\n              Refresh\r\n            </button>\r\n            <a\r\n              href=\"/assistant\"\r\n              className=\"rounded-lg bg-indigo-500/90 hover:bg-indigo-500 px-3 py-2 text-sm\"\r\n              title=\"Ask NEX Assistant\"\r\n            >\r\n              Ask NEX Assistant\r\n            </a>\r\n          </div>\r\n        </div>\r\n\r\n        {/* KPI Grid */}\r\n        <section className=\"mt-6\">\r\n          <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {kpis.map(k => (\r\n              <div\r\n                key={k.id}\r\n                className=\"rounded-2xl border border-white/10 bg-white/5 p-5 hover:bg-white/10 transition\"\r\n              >\r\n                <div className=\"text-xs uppercase tracking-wide text-white/60\">\r\n                  KPI\r\n                </div>\r\n                <div className=\"text-base font-semibold mt-1\">\r\n                  {k.question}\r\n                </div>\r\n                <div className=\"text-2xl font-bold mt-3\">{k.value}</div>\r\n                <div className=\"text-xs text-white/50 mt-2\">\r\n                  Last updated {formatTimeAgo(k.lastUpdated)}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </section>\r\n\r\n        {/* Recent Q&A */}\r\n        <section className=\"mt-8\">\r\n          <h2 className=\"text-lg font-semibold\">Recent Q&A</h2>\r\n          <div className=\"mt-3 rounded-2xl border border-white/10 bg-white/5 divide-y divide-white/10\">\r\n            {qa.length === 0 && (\r\n              <div className=\"p-4 text-white/60\">No questions yet. Ask something in NEX Assistant.</div>\r\n            )}\r\n            {qa.map(item => (\r\n              <div key={item.id} className=\"p-4\">\r\n                <div className=\"text-sm text-white/70\">Q: {item.question}</div>\r\n                <div className=\"text-base font-semibold mt-1\">A: {item.answer}</div>\r\n                <div className=\"text-xs text-white/50 mt-1\">\r\n                  {formatTimeAgo(item.createdAt)}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </section>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n","size_bytes":7552},"client/src/pages/assistant-page.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { submitAiQuery, transcribeAudio, getDataSources, createKpi } from \"@/lib/api\";\nimport { VoiceRecorder, SpeechRecognition } from \"@/lib/voice\";\nimport VoiceButton from \"@/components/voice/voice-button\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Brain, Send, User, Pin, Check, X } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport ChartContainer from \"@/components/dashboard/chart-container\";\nimport { KPICustomizationDialog, type KPIConfig } from \"@/components/kpi/kpi-customization-dialog\";\n\ninterface ChatMessage {\n  id: string;\n  type: 'user' | 'assistant';\n  content: string;\n  timestamp: Date;\n  isVoice?: boolean;\n  chartData?: any;\n  chartType?: string;\n  kpiValue?: string;\n  unit?: string;\n  sqlQuery?: string;\n}\n\nexport default function AssistantPage() {\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [inputValue, setInputValue] = useState(\"\");\n  const [selectedDataSources, setSelectedDataSources] = useState<string[]>([]);\n  const [isRecording, setIsRecording] = useState(false);\n  const [isTranscribing, setIsTranscribing] = useState(false);\n  const [kpiDialogOpen, setKpiDialogOpen] = useState(false);\n  const [pendingKpi, setPendingKpi] = useState<{ question: string; answer: string } | null>(null);\n  const voiceRecorderRef = useRef<VoiceRecorder | null>(null);\n  const speechRecognitionRef = useRef<SpeechRecognition | null>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: dataSources = [] } = useQuery({\n    queryKey: [\"/api/data-sources\"],\n    queryFn: () => getDataSources(),\n  });\n\n  const aiQueryMutation = useMutation({\n    mutationFn: ({ question, dataSourceIds, isVoiceQuery }: { \n      question: string; \n      dataSourceIds?: string[]; \n      isVoiceQuery?: boolean;\n    }) => submitAiQuery(question, dataSourceIds, isVoiceQuery),\n    onSuccess: (response) => {\n      const assistantMessage: ChatMessage = {\n        id: response.id,\n        type: 'assistant',\n        content: response.answer,\n        timestamp: new Date(response.createdAt),\n        chartData: response.chartData,\n        chartType: response.chartType,\n        kpiValue: response.kpiValue,\n        unit: response.unit,\n        sqlQuery: response.sqlQuery,\n      };\n      \n      setMessages(prev => [...prev, assistantMessage]);\n      \n      // Invalidate queries to refresh data\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai/queries\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const kpiMutation = useMutation({\n    mutationFn: ({ question, value, config }: { question: string; value: string; config: KPIConfig }) => \n      createKpi({\n        question: config.title || question,\n        value,\n        unit: undefined,\n        changePercent: undefined,\n        dashboardId: config.dashboardId || undefined,\n        visualType: config.visualType,\n        format: config.format,\n        decimalPlaces: config.decimalPlaces,\n        currencyCode: config.currencyCode,\n        prefix: config.prefix || undefined,\n        suffix: config.suffix || undefined,\n      }),\n    onSuccess: () => {\n      toast({\n        title: \"KPI Created\",\n        description: \"Your KPI has been added to the dashboard.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/kpis\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\"] });\n      setKpiDialogOpen(false);\n      setPendingKpi(null);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error creating KPI\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  useEffect(() => {\n    voiceRecorderRef.current = new VoiceRecorder();\n    speechRecognitionRef.current = new SpeechRecognition();\n  }, []);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSubmit = async (question: string, isVoiceQuery = false) => {\n    if (!question.trim()) return;\n\n    // Add user message\n    const userMessage: ChatMessage = {\n      id: Date.now().toString(),\n      type: 'user',\n      content: question,\n      timestamp: new Date(),\n      isVoice: isVoiceQuery,\n    };\n    \n    setMessages(prev => [...prev, userMessage]);\n\n    // Submit to AI with selected data sources\n    aiQueryMutation.mutate({\n      question: question.trim(),\n      dataSourceIds: selectedDataSources.length > 0 ? selectedDataSources : undefined,\n      isVoiceQuery,\n    });\n\n    setInputValue(\"\");\n  };\n\n  const handleFormSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    handleSubmit(inputValue);\n  };\n\n  const handleVoiceRecording = async () => {\n    if (!voiceRecorderRef.current) return;\n\n    try {\n      if (isRecording) {\n        // Stop recording\n        setIsRecording(false);\n        setIsTranscribing(true);\n\n        const audioBlob = await voiceRecorderRef.current.stopRecording();\n        const { transcription } = await transcribeAudio(audioBlob);\n        \n        setIsTranscribing(false);\n        \n        if (transcription.trim()) {\n          handleSubmit(transcription, true);\n        } else {\n          toast({\n            title: \"No speech detected\",\n            description: \"Please try speaking again.\",\n            variant: \"destructive\",\n          });\n        }\n      } else {\n        // Start recording\n        await voiceRecorderRef.current.startRecording();\n        setIsRecording(true);\n      }\n    } catch (error) {\n      console.error('Voice recording error:', error);\n      setIsRecording(false);\n      setIsTranscribing(false);\n      \n      // Try speech recognition as fallback only if available\n      if (speechRecognitionRef.current?.isAvailable()) {\n        try {\n          const transcription = await speechRecognitionRef.current.startListening();\n          if (transcription && transcription.trim()) {\n            handleSubmit(transcription, true);\n            return; // Success - exit early\n          }\n        } catch (speechError) {\n          console.error('Speech recognition fallback error:', speechError);\n        }\n      }\n      \n      // Show error toast only if all methods failed\n      toast({\n        title: \"Voice input failed\",\n        description: \"Please check your microphone permissions and try typing instead.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCreateKpi = (question: string, answer: string) => {\n    setPendingKpi({ question, answer });\n    setKpiDialogOpen(true);\n  };\n\n  const handleSaveKpi = (config: KPIConfig) => {\n    if (!pendingKpi) return;\n    \n    const numMatch = pendingKpi.answer.match(/[\\d,]+\\.?\\d*/);\n    const value = numMatch ? numMatch[0].replace(/,/g, '') : '0';\n    \n    kpiMutation.mutate({ \n      question: pendingKpi.question, \n      value,\n      config \n    });\n  };\n\n  return (\n    <div className=\"p-6 max-w-4xl mx-auto\">\n      <div className=\"mb-6\">\n        <h2 className=\"text-2xl font-bold mb-2\">NEX AI</h2>\n        <p className=\"text-muted-foreground\">\n          Ask questions about your data using voice or text\n        </p>\n      </div>\n\n      {/* Dataset Selection */}\n      {dataSources.length > 0 && (\n        <div className=\"mb-6\">\n          <Card className=\"p-4\">\n            <CardHeader className=\"p-0 pb-4\">\n              <CardTitle className=\"text-base\">Dataset Selection</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Select one or more datasets to analyze. NEX AI will automatically join related tables to answer your questions.\n              </p>\n            </CardHeader>\n            <div className=\"space-y-3\">\n              {/* Multi-select dropdown */}\n              <div className=\"relative\">\n                <Select\n                  value={selectedDataSources.length > 0 ? \"multi\" : \"\"}\n                  onValueChange={(value) => {\n                    if (value === \"all\") {\n                      setSelectedDataSources(dataSources.map(ds => ds.id));\n                    } else if (value === \"clear\") {\n                      setSelectedDataSources([]);\n                    }\n                  }}\n                  data-testid=\"select-data-source\"\n                >\n                  <SelectTrigger className=\"max-w-full\">\n                    <SelectValue placeholder=\"Select datasets...\">\n                      {selectedDataSources.length === 0 ? (\n                        \"Select datasets...\"\n                      ) : selectedDataSources.length === dataSources.length ? (\n                        `All Datasets (${dataSources.length})`\n                      ) : (\n                        `${selectedDataSources.length} dataset${selectedDataSources.length > 1 ? 's' : ''} selected`\n                      )}\n                    </SelectValue>\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\" data-testid=\"select-all-datasets\">\n                      Select All Datasets\n                    </SelectItem>\n                    {selectedDataSources.length > 0 && (\n                      <SelectItem value=\"clear\" data-testid=\"clear-datasets\">\n                        Clear Selection\n                      </SelectItem>\n                    )}\n                    <div className=\"border-t my-1\" />\n                    {dataSources.map((source) => (\n                      <div\n                        key={source.id}\n                        className=\"flex items-center gap-2 px-2 py-1.5 cursor-pointer hover:bg-muted rounded-sm\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          if (selectedDataSources.includes(source.id)) {\n                            setSelectedDataSources(selectedDataSources.filter(id => id !== source.id));\n                          } else {\n                            setSelectedDataSources([...selectedDataSources, source.id]);\n                          }\n                        }}\n                        data-testid={`select-dataset-${source.id}`}\n                      >\n                        <div className={`h-4 w-4 border rounded flex items-center justify-center ${\n                          selectedDataSources.includes(source.id) ? 'bg-primary border-primary' : 'border-input'\n                        }`}>\n                          {selectedDataSources.includes(source.id) && (\n                            <Check className=\"h-3 w-3 text-primary-foreground\" />\n                          )}\n                        </div>\n                        <span className=\"flex-1 text-sm\">{source.name}</span>\n                        <span className=\"text-xs text-muted-foreground\">\n                          {source.type}\n                        </span>\n                      </div>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              {/* Selected datasets tags */}\n              {selectedDataSources.length > 0 && (\n                <div className=\"flex flex-wrap gap-2\">\n                  {selectedDataSources.map(id => {\n                    const source = dataSources.find(ds => ds.id === id);\n                    return source ? (\n                      <span\n                        key={id}\n                        className=\"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-primary/10 border border-primary/30 text-xs\"\n                      >\n                        <span className=\"font-medium\">{source.name}</span>\n                        <button\n                          onClick={() => setSelectedDataSources(selectedDataSources.filter(sid => sid !== id))}\n                          className=\"hover:bg-primary/20 rounded-sm p-0.5\"\n                          data-testid={`remove-dataset-${id}`}\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </button>\n                      </span>\n                    ) : null;\n                  })}\n                </div>\n              )}\n              \n              {/* Info message */}\n              {selectedDataSources.length > 1 && (\n                <div className=\"text-sm p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800\">\n                  <div className=\"text-blue-700 dark:text-blue-300\">\n                    üí° NEX AI will automatically detect relationships and join tables as needed\n                  </div>\n                </div>\n              )}\n              \n              {selectedDataSources.length === 0 && (\n                <div className=\"text-sm p-3 bg-muted/50 rounded-lg border\" data-testid=\"no-selection-info\">\n                  <div className=\"text-muted-foreground\">\n                    No datasets selected. Select at least one dataset to start analyzing.\n                  </div>\n                </div>\n              )}\n            </div>\n          </Card>\n        </div>\n      )}\n\n      {/* Chat Interface */}\n      <Card className=\"overflow-hidden\">\n        {/* Messages */}\n        <div className=\"h-96 overflow-y-auto p-6 space-y-4\">\n          {messages.length === 0 && (\n            <div className=\"text-center text-muted-foreground py-8\">\n              <Brain className=\"mx-auto h-12 w-12 mb-4 text-primary\" />\n              <p className=\"text-lg font-medium mb-2\">Welcome to NEX AI</p>\n              <p>Ask me anything about your data. I can help you analyze trends, create charts, and generate insights.</p>\n            </div>\n          )}\n          \n          {messages.map((message) => (\n            <div key={message.id} className=\"flex gap-4\">\n              <div className=\"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center\">\n                {message.type === 'user' ? (\n                  <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n                    <User className=\"h-4 w-4\" />\n                  </div>\n                ) : (\n                  <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center\">\n                    <Brain className=\"h-4 w-4 text-white\" />\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"flex-1 space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm font-medium\">\n                    {message.type === 'user' ? 'You' : 'NEX-AI'}\n                  </span>\n                  {message.isVoice && (\n                    <span className=\"text-xs bg-red-500/20 text-red-400 px-2 py-1 rounded\">\n                      Voice\n                    </span>\n                  )}\n                  <span className=\"text-xs text-muted-foreground\">\n                    {message.timestamp.toLocaleTimeString()}\n                  </span>\n                </div>\n                \n                <div className=\"text-sm\">{message.content}</div>\n                \n                {/* SQL Query Display */}\n                {message.sqlQuery && (\n                  <div className=\"mt-3 p-3 bg-muted/50 rounded-lg border\" data-testid={`sql-query-${message.id}`}>\n                    <div className=\"text-xs font-medium text-muted-foreground mb-2\">Generated SQL Query:</div>\n                    <code className=\"text-xs font-mono block p-2 bg-background rounded border\">\n                      {message.sqlQuery}\n                    </code>\n                  </div>\n                )}\n                \n                {/* Chart Visualization */}\n                {message.chartData && message.chartType && (\n                  <div className=\"mt-4\">\n                    <ChartContainer\n                      title=\"Generated Chart\"\n                      type={message.chartType as any}\n                      data={message.chartData}\n                    />\n                  </div>\n                )}\n                \n                {/* Action Buttons for Assistant Messages */}\n                {message.type === 'assistant' && (\n                  <div className=\"flex gap-2 mt-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleCreateKpi(\n                        messages[messages.indexOf(message) - 1]?.content || '',\n                        message.content\n                      )}\n                      disabled={kpiMutation.isPending}\n                      data-testid=\"button-create-kpi\"\n                    >\n                      <Pin className=\"h-3 w-3 mr-1\" />\n                      Pin as KPI\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n          \n          {aiQueryMutation.isPending && (\n            <div className=\"flex gap-4\">\n              <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center\">\n                <Brain className=\"h-4 w-4 text-white\" />\n              </div>\n              <div className=\"flex-1 space-y-2\">\n                <Skeleton className=\"h-4 w-16\" />\n                <Skeleton className=\"h-4 w-full\" />\n                <Skeleton className=\"h-4 w-3/4\" />\n              </div>\n            </div>\n          )}\n          \n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input Area */}\n        <div className=\"border-t border-border p-4\">\n          <form onSubmit={handleFormSubmit} className=\"flex items-center gap-3\">\n            <VoiceButton\n              isRecording={isRecording}\n              isTranscribing={isTranscribing}\n              onClick={handleVoiceRecording}\n            />\n            \n            <div className=\"flex-1\">\n              <Input\n                placeholder=\"Ask anything about your data...\"\n                value={inputValue}\n                onChange={(e) => setInputValue(e.target.value)}\n                disabled={aiQueryMutation.isPending}\n                data-testid=\"input-ai-query\"\n              />\n            </div>\n            \n            <Button\n              type=\"submit\"\n              disabled={!inputValue.trim() || aiQueryMutation.isPending}\n              data-testid=\"button-send-query\"\n            >\n              <Send className=\"h-4 w-4\" />\n            </Button>\n          </form>\n        </div>\n      </Card>\n\n      {/* KPI Customization Dialog */}\n      {pendingKpi && (\n        <KPICustomizationDialog\n          open={kpiDialogOpen}\n          onOpenChange={setKpiDialogOpen}\n          question={pendingKpi.question}\n          answer={pendingKpi.answer}\n          onSave={handleSaveKpi}\n          isPending={kpiMutation.isPending}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":19236},"docs/SEMANTIC_LAYER.md":{"content":"# Semantic Layer Architecture\n\n## Overview\n\nNEX Sight implements a production-grade semantic layer for business intelligence, following industry standards from Apache Superset, Domo, Power BI, and Tableau. The semantic layer provides a business-friendly abstraction over raw data, enabling reliable chart creation with built-in caching and type-safe query generation.\n\n## Architecture Components\n\n### 1. Semantic Layer (`server/services/semantic-layer.ts`)\n\nThe semantic layer defines business metrics and dimensions as reusable semantic objects:\n\n- **Metrics**: Quantitative measures that can be aggregated (revenue, count, average price)\n- **Dimensions**: Categorical attributes used for grouping (category, region, date)\n- **Datasets**: Collections of metrics and dimensions from data sources\n\n#### Key Features:\n- Auto-discovery of metrics and dimensions from data source schema\n- Support for multiple aggregation types (sum, avg, count, min, max, count_distinct)\n- Chart-type-aware configuration translation\n- Type-safe SQL query generation preventing injection attacks\n- Database-specific query optimization (PostgreSQL, MySQL, MS SQL)\n\n### 2. Query Cache (`server/services/query-cache.ts`)\n\nRedis-backed caching system with intelligent invalidation:\n\n- **Primary Cache**: Redis (when available) for distributed caching\n- **Fallback Cache**: In-memory Map for development/testing\n- **Cache Keys**: Content-based hashing of queries + config + data sources\n- **Invalidation**: Automatic cache clearing when data sources change\n- **Statistics**: Hit/miss tracking, cache size monitoring\n- **TTL Management**: Different cache durations per chart type\n\n#### Cache TTL Strategy:\n- KPIs (big_number, gauge): 60 seconds\n- Tables: 180 seconds (3 minutes)\n- Charts (bar, line, pie, etc.): 300 seconds (5 minutes)\n\n### 3. Chart Query Service (`server/services/chart-query-service.ts`)\n\nOrchestrates the complete query execution pipeline:\n\n1. **Semantic Translation**: Chart config ‚Üí Semantic QuerySpec\n2. **Cache Check**: Query Redis/memory cache first\n3. **Query Execution**: Generate and run SQL or process CSV\n4. **Result Caching**: Store results with appropriate TTL\n5. **Return Data**: Serve to client\n\n#### Supported Data Sources:\n- **CSV Files**: In-memory aggregation with semantic query application\n- **Database Tables**: SQL generation and execution (PostgreSQL, MySQL, MS SQL, MongoDB)\n\n## Supported Chart Types\n\nThe semantic layer supports 25+ chart types across all BI categories:\n\n### KPI / Metrics\n- `big_number` - Single metric display\n- `big_number_trendline` - Metric with trend sparkline\n- `gauge` - Gauge chart with min/max\n- `multi_value_card` - Multiple metrics card\n\n### Bar Charts\n- `bar` - Vertical bar chart\n- `stacked_bar` - Stacked bars\n- `grouped_bar` - Grouped comparison\n- `horizontal_bar` - Horizontal orientation\n\n### Line/Area Charts\n- `line` - Time series line\n- `multi_line` - Multiple lines\n- `smooth_line` - Bezier curves\n- `stepped_line` - Step transitions\n- `area` - Filled area chart\n- `stacked_area` - Stacked areas\n\n### Pie/Donut\n- `pie` - Pie chart\n- `donut` - Donut chart\n\n### Scatter/Bubble\n- `scatter` - X-Y correlation\n- `bubble` - 3D scatter with size\n\n### Heatmaps\n- `heatmap` - Value matrix\n- `calendar_heatmap` - Calendar layout\n\n### Distribution\n- `boxplot` - Statistical distribution\n- `histogram` - Frequency distribution\n\n### Flow\n- `funnel` - Conversion funnel\n- `waterfall` - Cumulative flow\n- `sankey` - Flow diagram\n\n### Hierarchical\n- `treemap` - Nested rectangles\n- `sunburst` - Hierarchical circles\n\n### Other\n- `radar` - Multi-variate comparison\n- `table` - Data table\n- `pivot_table` - Cross-tabulation\n\n### Maps\n- `country_map` - Geographic choropleth\n- `geojson_map` - Custom boundaries\n\n## API Endpoints\n\n### Chart Data\n```\nGET /api/charts/:id/data?limit=100\n```\nReturns aggregated chart data using semantic layer with caching.\n\n### Data Preview\n```\nGET /api/data-sources/:id/preview?limit=50\n```\nReturns preview data using semantic layer (raw or aggregated based on chart type).\n\n### Cache Management\n```\nGET /api/cache/stats\n```\nReturns cache statistics:\n```json\n{\n  \"type\": \"redis\",\n  \"hits\": 142,\n  \"misses\": 23,\n  \"hitRate\": \"86.06%\",\n  \"size\": 15,\n  \"keyCount\": 15\n}\n```\n\n```\nPOST /api/cache/clear\n```\nClears all cached queries.\n\n## Query Specification (QuerySpec)\n\nThe semantic layer uses a structured query specification:\n\n```typescript\ninterface QuerySpec {\n  dataset: SemanticDataset;\n  metrics: string[];        // Metrics to aggregate\n  dimensions: string[];     // Dimensions to group by\n  filters?: Filter[];       // WHERE conditions\n  sortBy?: string;          // ORDER BY column\n  sortOrder?: 'asc' | 'desc';\n  limit?: number;           // Result limit\n  offset?: number;          // Result offset\n}\n```\n\n### Filter Operators:\n- `eq` - Equal\n- `ne` - Not equal\n- `gt` - Greater than\n- `lt` - Less than\n- `gte` - Greater than or equal\n- `lte` - Less than or equal\n- `in` - In list\n- `like` - Pattern match\n\n## SQL Query Generation\n\nThe semantic layer generates optimized, type-safe SQL:\n\n### Example 1: Bar Chart\n**Config:**\n```json\n{\n  \"chartType\": \"bar\",\n  \"xAxis\": \"category\",\n  \"yAxis\": \"revenue\"\n}\n```\n\n**Generated SQL (PostgreSQL):**\n```sql\nSELECT category, SUM(revenue) as revenue \nFROM sales_data \nGROUP BY category \nORDER BY revenue DESC \nLIMIT 100\n```\n\n### Example 2: Time Series\n**Config:**\n```json\n{\n  \"chartType\": \"line\",\n  \"timeColumn\": \"date\",\n  \"metric\": \"sales\",\n  \"groupBy\": \"region\"\n}\n```\n\n**Generated SQL:**\n```sql\nSELECT date, region, SUM(sales) as sales \nFROM sales_data \nGROUP BY date, region \nORDER BY sales DESC \nLIMIT 100\n```\n\n### Example 3: Scatter Plot\n**Config:**\n```json\n{\n  \"chartType\": \"scatter\",\n  \"xAxis\": \"price\",\n  \"yAxis\": \"quantity\",\n  \"groupBy\": \"category\"\n}\n```\n\n**Generated SQL:**\n```sql\nSELECT category, price, quantity \nFROM products \nLIMIT 100\n```\n\n## CSV Query Processing\n\nFor CSV files, the semantic layer applies aggregation in-memory:\n\n1. **Parse CSV**: Stream parse to array of objects\n2. **Apply Filters**: Filter rows based on conditions\n3. **Group By Dimensions**: Create grouped map by dimension values\n4. **Aggregate Metrics**: Apply sum/avg/count/min/max\n5. **Sort & Limit**: Order results and apply limit\n\nThis allows CSV files to behave identically to database sources from the chart's perspective.\n\n## Frontend Integration\n\n### Live Preview Aggregation\n\nThe frontend applies the same semantic logic for live preview:\n\n```typescript\n// In chart-configuration-modal.tsx\nconst aggregatedData = aggregatePreviewData(rawData, config, chartType);\n\n// Backend uses identical logic:\nconst data = await ChartQueryService.executeChartQuery({\n  chartId: chart.id,\n  chartType: chart.type,\n  config: chart.config,\n  dataSource,\n  limit: 100\n});\n```\n\nThis ensures preview matches production exactly.\n\n### Configuration Mapping\n\nChart configurations map to semantic concepts:\n\n| Chart Config | Semantic Concept |\n|--------------|------------------|\n| `xAxis`, `dimension`, `category` | Dimension (GROUP BY) |\n| `yAxis`, `metric`, `value` | Metric (with aggregation) |\n| `timeColumn` | Time Dimension |\n| `groupBy` | Additional Dimension |\n| `aggregation` | Metric aggregation type |\n\n## Performance Optimization\n\n### Caching Strategy\n\n1. **Query-based keys**: Same query = same cache key\n2. **Config-aware**: Different chart configs = different keys\n3. **Source-aware**: Changes to data sources invalidate related queries\n4. **Automatic TTL**: Different expiry for different chart types\n\n### Query Optimization\n\n1. **Only necessary columns**: SELECT only required fields\n2. **Pushed-down filters**: WHERE clauses applied at database\n3. **Appropriate aggregation**: Use correct aggregation per metric type\n4. **Database-specific syntax**: Optimized for each database type\n\n## Security\n\n### SQL Injection Prevention\n\n1. **Identifier Sanitization**: Remove special characters from column/table names\n2. **Value Escaping**: Properly escape string values\n3. **Type-Safe Construction**: Build queries programmatically, never concatenate\n4. **No Dynamic SQL**: All queries use parameterized structure\n\n### Example Sanitization:\n\n```typescript\n// Input: \"users'; DROP TABLE users; --\"\n// Output: \"users\"\n\nsanitizeIdentifier(input: string): string {\n  return input.replace(/[^a-zA-Z0-9_.]/g, '');\n}\n```\n\n## Usage Examples\n\n### Creating a Chart with Semantic Layer\n\n```typescript\n// 1. User selects chart type and configuration\nconst config = {\n  xAxis: 'category',\n  yAxis: 'revenue',\n  aggregation: 'sum'\n};\n\n// 2. Frontend saves chart\nawait fetch('/api/charts', {\n  method: 'POST',\n  body: JSON.stringify({\n    type: 'bar',\n    config,\n    dataSourceIds: [dataSourceId]\n  })\n});\n\n// 3. Backend uses semantic layer\nconst data = await ChartQueryService.executeChartQuery({\n  chartType: 'bar',\n  config,\n  dataSource,\n  limit: 100\n});\n\n// 4. Results cached automatically\n// 5. Subsequent requests served from cache (< 100ms)\n```\n\n### Invalidating Cache on Data Update\n\n```typescript\n// When user uploads new CSV or refreshes data source\nawait storage.updateDataSource(id, { /* new data */ });\n\n// Cache automatically invalidated by data source ID\nawait queryCache.invalidateByDataSource(id);\n```\n\n## Monitoring\n\n### Cache Statistics\n\nMonitor cache performance:\n\n```bash\ncurl http://localhost:5000/api/cache/stats\n```\n\nResponse:\n```json\n{\n  \"type\": \"redis\",\n  \"hits\": 450,\n  \"misses\": 50,\n  \"hitRate\": \"90.00%\",\n  \"size\": 25,\n  \"keyCount\": 25\n}\n```\n\n### Performance Metrics\n\n- **Cache Hit Rate**: Target > 80%\n- **Query Response Time**: \n  - Cache hit: < 100ms\n  - Cache miss (database): < 2s\n  - Cache miss (CSV): < 500ms\n\n## Best Practices\n\n### 1. Define Clear Metrics\n\n```typescript\nconst metrics: Metric[] = [\n  {\n    field: 'revenue',\n    name: 'Total Revenue',\n    aggregation: 'sum',\n    type: 'currency'\n  },\n  {\n    field: 'orders',\n    name: 'Order Count',\n    aggregation: 'count',\n    type: 'number'\n  }\n];\n```\n\n### 2. Use Appropriate Aggregations\n\n- Revenue, Total: `sum`\n- Average Price: `avg`\n- Record Count: `count`\n- Unique Users: `count_distinct`\n- Date Range: `min`, `max`\n\n### 3. Optimize Cache TTL\n\n- Real-time dashboards: 30-60 seconds\n- Hourly reports: 5-10 minutes\n- Daily reports: 30-60 minutes\n\n### 4. Monitor Cache Performance\n\nRegularly check cache hit rates and adjust TTL accordingly.\n\n## Troubleshooting\n\n### Issue: Cache not working\n\n**Check:**\n1. Redis connection: `redis-cli ping`\n2. Cache stats: `GET /api/cache/stats`\n3. Logs for cache errors\n\n### Issue: Wrong aggregation results\n\n**Check:**\n1. Metric definition in dataset\n2. Chart config mapping to semantic spec\n3. SQL query in logs (search for \"Executing semantic query\")\n\n### Issue: Slow query performance\n\n**Solutions:**\n1. Check if query is cached\n2. Add database indexes on commonly grouped columns\n3. Increase cache TTL\n4. Review query complexity in logs\n\n## Future Enhancements\n\n1. **Calculated Metrics**: Define metrics as formulas (revenue/orders = AOV)\n2. **Metric Families**: Group related metrics (all revenue metrics)\n3. **Time Intelligence**: Built-in time comparisons (YoY, MoM)\n4. **Query Planning**: Optimize join strategies for multi-source charts\n5. **Incremental Refresh**: Update only changed data in cache\n","size_bytes":11232},"client/src/components/chart-config/RadarConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\n\ninterface RadarConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function RadarConfig({ config, onChange, columns = [] }: RadarConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"category\">Category (Axes)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.category || \"\"}\n            onValueChange={(value) => updateConfig(\"category\", value)}\n          >\n            <SelectTrigger id=\"category\" data-testid=\"select-category\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"category\"\n            placeholder=\"Select a dataset first\"\n            value={config.category || \"\"}\n            onChange={(e) => updateConfig(\"category\", e.target.value)}\n            data-testid=\"input-category\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"series\">Series (Optional)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.series || \"\"}\n            onValueChange={(value) => updateConfig(\"series\", value)}\n          >\n            <SelectTrigger id=\"series\" data-testid=\"select-series\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"\">None</SelectItem>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"series\"\n            placeholder=\"Select a dataset first\"\n            value={config.series || \"\"}\n            onChange={(e) => updateConfig(\"series\", e.target.value)}\n            data-testid=\"input-series\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metric\">Value Metric</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.metric || \"\"}\n            onValueChange={(value) => updateConfig(\"metric\", value)}\n          >\n            <SelectTrigger id=\"metric\" data-testid=\"select-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"metric\"\n            placeholder=\"Select a dataset first\"\n            value={config.metric || \"\"}\n            onChange={(e) => updateConfig(\"metric\", e.target.value)}\n            data-testid=\"input-metric\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Label htmlFor=\"fillArea\">Fill Area</Label>\n        <Switch\n          id=\"fillArea\"\n          checked={config.fillArea !== false}\n          onCheckedChange={(checked) => updateConfig(\"fillArea\", checked)}\n          data-testid=\"switch-fill-area\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":4049},"client/src/components/chart-config/WaterfallConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface WaterfallConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function WaterfallConfig({ config, onChange, columns = [] }: WaterfallConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"category\">Category (Steps)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.category || \"\"}\n            onValueChange={(value) => updateConfig(\"category\", value)}\n          >\n            <SelectTrigger id=\"category\" data-testid=\"select-category\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"category\"\n            placeholder=\"Select a dataset first\"\n            value={config.category || \"\"}\n            onChange={(e) => updateConfig(\"category\", e.target.value)}\n            data-testid=\"input-category\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metric\">Value Metric</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.metric || \"\"}\n            onValueChange={(value) => updateConfig(\"metric\", value)}\n          >\n            <SelectTrigger id=\"metric\" data-testid=\"select-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"metric\"\n            placeholder=\"Select a dataset first\"\n            value={config.metric || \"\"}\n            onChange={(e) => updateConfig(\"metric\", e.target.value)}\n            data-testid=\"input-metric\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"sortOrder\">Sort Order</Label>\n        <Select\n          value={config.sortOrder || \"none\"}\n          onValueChange={(value) => updateConfig(\"sortOrder\", value)}\n        >\n          <SelectTrigger id=\"sortOrder\" data-testid=\"select-sort-order\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"none\">None</SelectItem>\n            <SelectItem value=\"asc\">Ascending</SelectItem>\n            <SelectItem value=\"desc\">Descending</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"totalLabel\">Total Label</Label>\n        <Input\n          id=\"totalLabel\"\n          placeholder=\"e.g., Total, Final\"\n          value={config.totalLabel || \"Total\"}\n          onChange={(e) => updateConfig(\"totalLabel\", e.target.value)}\n          data-testid=\"input-total-label\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":3597},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/kpi/kpi-customization-dialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { getDashboards, type Dashboard } from \"@/lib/api\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { BigNumber } from \"./big-number\";\nimport { MultiValueCard } from \"./multi-value-card\";\nimport { Sparkles, TrendingUp, List } from \"lucide-react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\ninterface KPICustomizationDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  question: string;\n  answer: string;\n  onSave: (config: KPIConfig) => void;\n  isPending?: boolean;\n}\n\nexport interface KPIConfig {\n  title: string;\n  dashboardId: string | null;\n  visualType: 'big-number' | 'big-number-trendline' | 'multi-value';\n  format: 'number' | 'currency' | 'percentage';\n  decimalPlaces: number;\n  currencyCode: string;\n  prefix: string;\n  suffix: string;\n}\n\nconst CURRENCY_OPTIONS = [\n  { code: 'USD', symbol: '$', name: 'US Dollar' },\n  { code: 'EUR', symbol: '‚Ç¨', name: 'Euro' },\n  { code: 'GBP', symbol: '¬£', name: 'British Pound' },\n  { code: 'JPY', symbol: '¬•', name: 'Japanese Yen' },\n  { code: 'INR', symbol: '‚Çπ', name: 'Indian Rupee' },\n  { code: 'CAD', symbol: 'C$', name: 'Canadian Dollar' },\n  { code: 'AUD', symbol: 'A$', name: 'Australian Dollar' },\n];\n\nexport function KPICustomizationDialog({\n  open,\n  onOpenChange,\n  question,\n  answer,\n  onSave,\n  isPending = false,\n}: KPICustomizationDialogProps) {\n  const [config, setConfig] = useState<KPIConfig>({\n    title: question,\n    dashboardId: null,\n    visualType: 'big-number',\n    format: 'number',\n    decimalPlaces: 0,\n    currencyCode: 'USD',\n    prefix: '',\n    suffix: '',\n  });\n\n  // Update title when question changes\n  useEffect(() => {\n    setConfig(prev => ({ ...prev, title: question }));\n  }, [question]);\n\n  const { data: dashboards = [] } = useQuery<Dashboard[]>({\n    queryKey: [\"/api/dashboards\"],\n    queryFn: getDashboards,\n  });\n\n  // Extract values from answer - supports both numeric and text\n  const extractValues = (): { type: 'single' | 'multi', value: string, multiValues?: Array<{label: string, value: string}> } => {\n    // Try splitting by newlines first for line-by-line values\n    const lines = answer.split(/\\n/).map(l => l.trim()).filter(l => l);\n    \n    // Check for newline-separated labeled values\n    if (lines.length > 1 && lines.length <= 5) {\n      const hasLabels = lines.every(line => line.includes(':'));\n      if (hasLabels) {\n        const multiValues = lines.map(line => {\n          const colonIndex = line.indexOf(':');\n          return {\n            label: line.substring(0, colonIndex).trim(),\n            value: line.substring(colonIndex + 1).trim()\n          };\n        });\n        return { type: 'multi', value: answer, multiValues };\n      } else {\n        const multiValues = lines.map((line, i) => ({\n          label: `Value ${i + 1}`,\n          value: line\n        }));\n        return { type: 'multi', value: answer, multiValues };\n      }\n    }\n    \n    // Parse comma-separated labeled values using smarter detection\n    // Only treat as a new label if: comma followed by word characters (including spaces) and then colon\n    // This avoids false positives like \"Meeting, 2:00 PM\"\n    const segments: Array<{label: string, value: string}> = [];\n    const labelPattern = /([A-Za-z][\\w\\s]*?):\\s*/g;\n    let lastIndex = 0;\n    let match;\n    const matches: Array<{label: string, start: number, end: number}> = [];\n    \n    // Find all potential label positions\n    while ((match = labelPattern.exec(answer)) !== null) {\n      matches.push({\n        label: match[1].trim(),\n        start: match.index,\n        end: labelPattern.lastIndex\n      });\n    }\n    \n    // Extract values between labels\n    if (matches.length > 1) {\n      matches.forEach((m, i) => {\n        const nextMatch = matches[i + 1];\n        let valueEnd = nextMatch ? nextMatch.start : answer.length;\n        \n        // Trim trailing comma if present\n        let valueText = answer.substring(m.end, valueEnd).trim();\n        if (valueText.endsWith(',')) {\n          valueText = valueText.slice(0, -1).trim();\n        }\n        \n        segments.push({\n          label: m.label,\n          value: valueText\n        });\n      });\n      \n      if (segments.length > 1) {\n        return { type: 'multi', value: answer, multiValues: segments };\n      }\n    }\n    \n    // Single value - try numeric extraction first, fallback to text\n    const numMatch = answer.match(/[\\d,]+\\.?\\d*/);\n    const value = numMatch ? numMatch[0].replace(/,/g, '') : answer.trim();\n    return { type: 'single', value };\n  };\n\n  const extractedData = extractValues();\n  const value = extractedData.value;\n\n  // Auto-detect format from answer\n  useEffect(() => {\n    if (answer.includes('$') || answer.includes('USD') || answer.toLowerCase().includes('dollar')) {\n      setConfig(prev => ({ ...prev, format: 'currency', prefix: '$', suffix: '' }));\n    } else if (answer.includes('%') || answer.toLowerCase().includes('percent')) {\n      setConfig(prev => ({ ...prev, format: 'percentage', prefix: '', suffix: '%' }));\n    }\n  }, [answer]);\n\n  const formatPreviewValue = (val: string): string => {\n    const numVal = parseFloat(val);\n    if (isNaN(numVal)) return val;\n\n    switch (config.format) {\n      case 'currency':\n        const currencySymbol = CURRENCY_OPTIONS.find(c => c.code === config.currencyCode)?.symbol || '$';\n        return `${currencySymbol}${numVal.toFixed(config.decimalPlaces)}`;\n      case 'percentage':\n        return `${numVal.toFixed(config.decimalPlaces)}%`;\n      case 'number':\n      default:\n        return numVal.toFixed(config.decimalPlaces);\n    }\n  };\n\n  const handleSave = () => {\n    onSave(config);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-kpi-customization\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Sparkles className=\"h-5 w-5 text-primary\" />\n            Pin as KPI - Customize Your Card\n          </DialogTitle>\n          <DialogDescription>\n            Configure how your KPI will appear on the dashboard\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 py-4\">\n          {/* Configuration Panel */}\n          <div className=\"space-y-6\">\n            {/* KPI Title */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"kpi-title\" className=\"text-base font-semibold\">\n                KPI Title\n              </Label>\n              <Input\n                id=\"kpi-title\"\n                value={config.title}\n                onChange={(e) => setConfig({ ...config, title: e.target.value })}\n                placeholder=\"Enter a descriptive title for your KPI\"\n                data-testid=\"input-kpi-title\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                This will be displayed as the KPI card title on your dashboard\n              </p>\n            </div>\n\n            {/* Dashboard Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"dashboard\" className=\"text-base font-semibold\">\n                Select Dashboard\n              </Label>\n              <Select\n                value={config.dashboardId || \"\"}\n                onValueChange={(value) => setConfig({ ...config, dashboardId: value })}\n              >\n                <SelectTrigger id=\"dashboard\" data-testid=\"select-dashboard\">\n                  <SelectValue placeholder=\"Choose a dashboard...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {dashboards.map((dashboard) => (\n                    <SelectItem key={dashboard.id} value={dashboard.id} data-testid={`option-dashboard-${dashboard.id}`}>\n                      {dashboard.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {dashboards.length === 0 && (\n                <p className=\"text-sm text-muted-foreground\">\n                  No dashboards available. Create one first!\n                </p>\n              )}\n            </div>\n\n            {/* Visual Type */}\n            <div className=\"space-y-2\">\n              <Label className=\"text-base font-semibold\">Visual Style</Label>\n              <Tabs\n                value={config.visualType}\n                onValueChange={(value: any) => setConfig({ ...config, visualType: value })}\n                className=\"w-full\"\n              >\n                <TabsList className=\"grid w-full grid-cols-2\">\n                  <TabsTrigger value=\"big-number\" data-testid=\"visual-type-big-number\">\n                    <Sparkles className=\"h-3 w-3 mr-1\" />\n                    Single Value\n                  </TabsTrigger>\n                  <TabsTrigger value=\"multi-value\" data-testid=\"visual-type-multi-value\">\n                    <List className=\"h-3 w-3 mr-1\" />\n                    Multi-Value\n                  </TabsTrigger>\n                </TabsList>\n              </Tabs>\n              <p className=\"text-xs text-muted-foreground\">\n                {config.visualType === 'multi-value' \n                  ? 'Display multiple related values in one card'\n                  : 'Display a single metric prominently'}\n              </p>\n            </div>\n\n            {/* Format Type */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"format\" className=\"text-base font-semibold\">\n                Format Type\n              </Label>\n              <Select\n                value={config.format}\n                onValueChange={(value: any) => {\n                  const newConfig = { ...config, format: value };\n                  if (value === 'currency') {\n                    const symbol = CURRENCY_OPTIONS.find(c => c.code === config.currencyCode)?.symbol || '$';\n                    newConfig.prefix = symbol;\n                    newConfig.suffix = '';\n                  } else if (value === 'percentage') {\n                    newConfig.prefix = '';\n                    newConfig.suffix = '%';\n                  } else {\n                    newConfig.prefix = '';\n                    newConfig.suffix = '';\n                  }\n                  setConfig(newConfig);\n                }}\n              >\n                <SelectTrigger id=\"format\" data-testid=\"select-format\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"number\" data-testid=\"format-number\">Number</SelectItem>\n                  <SelectItem value=\"currency\" data-testid=\"format-currency\">Currency</SelectItem>\n                  <SelectItem value=\"percentage\" data-testid=\"format-percentage\">Percentage</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Currency Selection (if currency) */}\n            {config.format === 'currency' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"currency\" className=\"text-base font-semibold\">\n                  Currency\n                </Label>\n                <Select\n                  value={config.currencyCode}\n                  onValueChange={(value) => {\n                    const symbol = CURRENCY_OPTIONS.find(c => c.code === value)?.symbol || '$';\n                    setConfig({ ...config, currencyCode: value, prefix: symbol });\n                  }}\n                >\n                  <SelectTrigger id=\"currency\" data-testid=\"select-currency\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {CURRENCY_OPTIONS.map((currency) => (\n                      <SelectItem \n                        key={currency.code} \n                        value={currency.code}\n                        data-testid={`currency-${currency.code}`}\n                      >\n                        {currency.symbol} {currency.name} ({currency.code})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            {/* Decimal Places */}\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"decimals\" className=\"text-base font-semibold\">\n                  Decimal Places\n                </Label>\n                <span className=\"text-sm font-medium text-muted-foreground\" data-testid=\"decimal-value\">\n                  {config.decimalPlaces}\n                </span>\n              </div>\n              <Slider\n                id=\"decimals\"\n                min={0}\n                max={4}\n                step={1}\n                value={[config.decimalPlaces]}\n                onValueChange={([value]) => setConfig({ ...config, decimalPlaces: value })}\n                data-testid=\"slider-decimals\"\n              />\n            </div>\n\n            {/* Custom Prefix/Suffix */}\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"prefix\" className=\"text-sm font-semibold\">\n                  Prefix\n                </Label>\n                <Input\n                  id=\"prefix\"\n                  value={config.prefix}\n                  onChange={(e) => setConfig({ ...config, prefix: e.target.value })}\n                  placeholder=\"e.g., $\"\n                  data-testid=\"input-prefix\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"suffix\" className=\"text-sm font-semibold\">\n                  Suffix\n                </Label>\n                <Input\n                  id=\"suffix\"\n                  value={config.suffix}\n                  onChange={(e) => setConfig({ ...config, suffix: e.target.value })}\n                  placeholder=\"e.g., %\"\n                  data-testid=\"input-suffix\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Preview Panel */}\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-base font-semibold\">Live Preview</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                See how your KPI card will look\n              </p>\n            </div>\n\n            <Card className=\"border-2 border-dashed border-primary/50 bg-gradient-to-br from-background to-muted/20\">\n              <CardContent className=\"pt-6\">\n                {config.visualType === 'multi-value' && extractedData.multiValues ? (\n                  <MultiValueCard\n                    title={config.title}\n                    values={extractedData.multiValues.map(v => {\n                      const numVal = parseFloat(v.value);\n                      const isNumeric = !isNaN(numVal);\n                      \n                      return {\n                        label: v.label,\n                        value: isNumeric && config.format !== 'number' ? formatPreviewValue(v.value) : v.value,\n                        prefix: isNumeric ? (config.format === 'currency' ? '' : config.prefix) : '',\n                        suffix: isNumeric ? (config.format === 'percentage' ? '' : config.suffix) : '',\n                        highlight: false\n                      };\n                    })}\n                  />\n                ) : (\n                  <BigNumber\n                    title={config.title}\n                    value={formatPreviewValue(value)}\n                    prefix={config.format === 'currency' ? '' : config.prefix}\n                    suffix={config.format === 'percentage' ? '' : config.suffix}\n                    format={config.format}\n                    showComparison={false}\n                  />\n                )}\n              </CardContent>\n            </Card>\n\n            <div className=\"p-4 bg-muted/50 rounded-lg space-y-2\">\n              <p className=\"text-sm font-medium\">Preview Details:</p>\n              <div className=\"space-y-1 text-xs text-muted-foreground\">\n                <p>‚Ä¢ Title: <span className=\"text-foreground\">{config.title}</span></p>\n                <p>‚Ä¢ Value: <span className=\"text-foreground\">{config.prefix}{formatPreviewValue(value)}{config.suffix}</span></p>\n                <p>‚Ä¢ Style: <span className=\"text-foreground\">{config.visualType === 'big-number' ? 'Simple Card' : 'With Trendline'}</span></p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={isPending}\n            data-testid=\"button-cancel-kpi\"\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleSave}\n            disabled={!config.dashboardId || isPending}\n            data-testid=\"button-save-kpi\"\n            className=\"bg-gradient-to-r from-primary to-primary/80\"\n          >\n            <Sparkles className=\"h-4 w-4 mr-2\" />\n            {isPending ? 'Adding...' : 'Add to Dashboard'}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":17791},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/chart-config/HeatmapConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface HeatmapConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function HeatmapConfig({ config, onChange, columns = [] }: HeatmapConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"xAxis\">X-Axis (Categories)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.xAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"xAxis\", value)}\n          >\n            <SelectTrigger id=\"xAxis\" data-testid=\"select-xaxis\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"xAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.xAxis || \"\"}\n            onChange={(e) => updateConfig(\"xAxis\", e.target.value)}\n            data-testid=\"input-xaxis\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"yAxis\">Y-Axis (Categories)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.yAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"yAxis\", value)}\n          >\n            <SelectTrigger id=\"yAxis\" data-testid=\"select-yaxis\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"yAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.yAxis || \"\"}\n            onChange={(e) => updateConfig(\"yAxis\", e.target.value)}\n            data-testid=\"input-yaxis\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metric\">Value Metric</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.metric || \"\"}\n            onValueChange={(value) => updateConfig(\"metric\", value)}\n          >\n            <SelectTrigger id=\"metric\" data-testid=\"select-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"metric\"\n            placeholder=\"Select a dataset first\"\n            value={config.metric || \"\"}\n            onChange={(e) => updateConfig(\"metric\", e.target.value)}\n            data-testid=\"input-metric\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"colorScheme\">Color Scheme</Label>\n        <Select\n          value={config.colorScheme || \"blues\"}\n          onValueChange={(value) => updateConfig(\"colorScheme\", value)}\n        >\n          <SelectTrigger id=\"colorScheme\" data-testid=\"select-color-scheme\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"blues\">Blues</SelectItem>\n            <SelectItem value=\"greens\">Greens</SelectItem>\n            <SelectItem value=\"reds\">Reds</SelectItem>\n            <SelectItem value=\"rainbow\">Rainbow</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4273},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/chart-config/BarChartConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface BarChartConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function BarChartConfig({ config, onChange, columns = [] }: BarChartConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"xAxis\">X-Axis (Category)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.xAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"xAxis\", value)}\n          >\n            <SelectTrigger id=\"xAxis\" data-testid=\"select-x-axis\">\n              <SelectValue placeholder=\"Select category column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"xAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.xAxis || \"\"}\n            disabled\n            data-testid=\"input-x-axis\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Column to use for categories\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"yAxis\">Y-Axis (Value)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.yAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"yAxis\", value)}\n          >\n            <SelectTrigger id=\"yAxis\" data-testid=\"select-y-axis\">\n              <SelectValue placeholder=\"Select value column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"yAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.yAxis || \"\"}\n            disabled\n            data-testid=\"input-y-axis\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Column to measure\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"aggregation\">Aggregation</Label>\n        <Select\n          value={config.aggregation || \"sum\"}\n          onValueChange={(value) => updateConfig(\"aggregation\", value)}\n        >\n          <SelectTrigger id=\"aggregation\" data-testid=\"select-aggregation\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"sum\">Sum</SelectItem>\n            <SelectItem value=\"count\">Count</SelectItem>\n            <SelectItem value=\"avg\">Average</SelectItem>\n            <SelectItem value=\"min\">Minimum</SelectItem>\n            <SelectItem value=\"max\">Maximum</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"limit\">Limit (Top N)</Label>\n        <Input\n          id=\"limit\"\n          type=\"number\"\n          min=\"1\"\n          max=\"100\"\n          placeholder=\"10\"\n          value={config.limit || \"\"}\n          onChange={(e) => updateConfig(\"limit\", e.target.value)}\n          data-testid=\"input-limit\"\n        />\n        <p className=\"text-xs text-muted-foreground\">\n          Show top N items (leave empty for all)\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"sortOrder\">Sort Order</Label>\n        <Select\n          value={config.sortOrder || \"desc\"}\n          onValueChange={(value) => updateConfig(\"sortOrder\", value)}\n        >\n          <SelectTrigger id=\"sortOrder\" data-testid=\"select-sort-order\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"asc\">Ascending</SelectItem>\n            <SelectItem value=\"desc\">Descending</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"orientation\">Orientation</Label>\n        <Select\n          value={config.orientation || \"vertical\"}\n          onValueChange={(value) => updateConfig(\"orientation\", value)}\n        >\n          <SelectTrigger id=\"orientation\" data-testid=\"select-orientation\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"vertical\">Vertical Bars</SelectItem>\n            <SelectItem value=\"horizontal\">Horizontal Bars</SelectItem>\n          </SelectContent>\n        </Select>\n        <p className=\"text-xs text-muted-foreground\">\n          Choose bar direction - horizontal helps with long labels\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"labelDisplay\">Label Display</Label>\n        <Select\n          value={config.labelDisplay || \"hover\"}\n          onValueChange={(value) => updateConfig(\"labelDisplay\", value)}\n        >\n          <SelectTrigger id=\"labelDisplay\" data-testid=\"select-label-display\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"none\">Hidden</SelectItem>\n            <SelectItem value=\"hover\">Show on Hover</SelectItem>\n            <SelectItem value=\"always\">Always Visible</SelectItem>\n            <SelectItem value=\"inside\">Inside Bars</SelectItem>\n          </SelectContent>\n        </Select>\n        <p className=\"text-xs text-muted-foreground\">\n          How to display data labels\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"valueFormat\">Value Format</Label>\n        <Select\n          value={config.valueFormat || \"value\"}\n          onValueChange={(value) => updateConfig(\"valueFormat\", value)}\n        >\n          <SelectTrigger id=\"valueFormat\" data-testid=\"select-value-format\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"value\">Actual Values</SelectItem>\n            <SelectItem value=\"percentage\">Percentages</SelectItem>\n            <SelectItem value=\"both\">Values & Percentages</SelectItem>\n          </SelectContent>\n        </Select>\n        <p className=\"text-xs text-muted-foreground\">\n          How to format displayed values\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6766},"server/storage.ts":{"content":"import { \n  type User, \n  type InsertUser,\n  type DataSource,\n  type InsertDataSource,\n  type AiQuery,\n  type InsertAiQuery,\n  type KPI,\n  type InsertKPI,\n  type Chart,\n  type InsertChart,\n  type DashboardChart,\n  type InsertDashboardChart,\n  type View,\n  type InsertView,\n  type Connection,\n  type InsertConnection,\n  type Dashboard,\n  type InsertDashboard\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport session from \"express-session\";\nimport createMemoryStore from \"memorystore\";\nimport type { Store } from \"express-session\";\n\nconst MemoryStore = createMemoryStore(session);\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Data source operations\n  getDataSources(userId: string): Promise<DataSource[]>;\n  getDataSource(id: string): Promise<DataSource | undefined>;\n  createDataSource(dataSource: InsertDataSource & { connectionConfig?: any }): Promise<DataSource>;\n  updateDataSource(id: string, updates: Partial<DataSource>): Promise<DataSource | undefined>;\n  deleteDataSource(id: string): Promise<boolean>;\n  \n  // AI query operations\n  getAiQueries(userId: string, limit?: number): Promise<AiQuery[]>;\n  createAiQuery(query: InsertAiQuery): Promise<AiQuery>;\n  \n  // KPI operations\n  getKpis(userId: string): Promise<KPI[]>;\n  createKpi(kpi: InsertKPI): Promise<KPI>;\n  updateKpi(id: string, updates: Partial<KPI>): Promise<KPI | undefined>;\n  deleteKpi(id: string): Promise<boolean>;\n  \n  // Chart operations\n  getCharts(userId: string): Promise<Chart[]>;\n  getChart(id: string): Promise<Chart | undefined>;\n  createChart(chart: InsertChart): Promise<Chart>;\n  updateChart(id: string, updates: Partial<Chart>): Promise<Chart | undefined>;\n  deleteChart(id: string): Promise<boolean>;\n  \n  // View operations\n  getViews(userId: string): Promise<View[]>;\n  getView(id: string): Promise<View | undefined>;\n  createView(view: InsertView): Promise<View>;\n  updateView(id: string, updates: Partial<View>): Promise<View | undefined>;\n  deleteView(id: string): Promise<boolean>;\n  \n  // Connection operations\n  getConnections(userId: string): Promise<Connection[]>;\n  getConnection(id: string): Promise<Connection | undefined>;\n  createConnection(connection: InsertConnection): Promise<Connection>;\n  updateConnection(id: string, updates: Partial<Connection>): Promise<Connection | undefined>;\n  deleteConnection(id: string): Promise<boolean>;\n  getConnectionByNameAndUser(userId: string, name: string): Promise<Connection | undefined>;\n  \n  // Dashboard operations\n  getDashboards(userId: string): Promise<Dashboard[]>;\n  getDashboard(id: string): Promise<Dashboard | undefined>;\n  createDashboard(dashboard: InsertDashboard): Promise<Dashboard>;\n  updateDashboard(id: string, updates: Partial<Dashboard>): Promise<Dashboard | undefined>;\n  deleteDashboard(id: string): Promise<boolean>;\n  \n  // Dashboard Chart operations\n  getDashboardCharts(dashboardId: string): Promise<DashboardChart[]>;\n  getDashboardChart(id: string): Promise<DashboardChart | undefined>;\n  createDashboardChart(dashboardChart: InsertDashboardChart): Promise<DashboardChart>;\n  updateDashboardChart(id: string, updates: Partial<DashboardChart>): Promise<DashboardChart | undefined>;\n  deleteDashboardChart(id: string): Promise<boolean>;\n  deleteDashboardChartsByChartId(chartId: string): Promise<boolean>;\n  \n  // Session store\n  sessionStore: Store;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n  private dataSources: Map<string, DataSource>;\n  private aiQueries: Map<string, AiQuery>;\n  private kpis: Map<string, KPI>;\n  private charts: Map<string, Chart>;\n  private views: Map<string, View>;\n  private connections: Map<string, Connection>;\n  private dashboards: Map<string, Dashboard>;\n  private dashboardCharts: Map<string, DashboardChart>;\n  public sessionStore: Store;\n\n  constructor() {\n    this.users = new Map();\n    this.dataSources = new Map();\n    this.aiQueries = new Map();\n    this.kpis = new Map();\n    this.charts = new Map();\n    this.views = new Map();\n    this.connections = new Map();\n    this.dashboards = new Map();\n    this.dashboardCharts = new Map();\n    this.sessionStore = new MemoryStore({\n      checkPeriod: 86400000, // 24 hours\n    });\n  }\n\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.username === username);\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.email === email);\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const now = new Date();\n    const user: User = { \n      ...insertUser, \n      name: insertUser.name || null,\n      id, \n      createdAt: now, \n      updatedAt: now \n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  // Data source operations\n  async getDataSources(userId: string): Promise<DataSource[]> {\n    return Array.from(this.dataSources.values()).filter(ds => ds.userId === userId);\n  }\n\n  async getDataSource(id: string): Promise<DataSource | undefined> {\n    return this.dataSources.get(id);\n  }\n\n  async createDataSource(insertDataSource: InsertDataSource & { connectionConfig?: any }): Promise<DataSource> {\n    const id = randomUUID();\n    const now = new Date();\n    const dataSource: DataSource = {\n      ...insertDataSource,\n      status: insertDataSource.status || 'processing',\n      filename: insertDataSource.filename || null,\n      size: insertDataSource.size || null,\n      rowCount: insertDataSource.rowCount || null,\n      columnCount: insertDataSource.columnCount || null,\n      connectionConfig: insertDataSource.connectionConfig || null,\n      metadata: insertDataSource.metadata || null,\n      connectionId: insertDataSource.connectionId || null,\n      lastSyncedAt: insertDataSource.lastSyncedAt || null,\n      id,\n      createdAt: now,\n      updatedAt: now\n    };\n    this.dataSources.set(id, dataSource);\n    return dataSource;\n  }\n\n  async updateDataSource(id: string, updates: Partial<DataSource>): Promise<DataSource | undefined> {\n    const dataSource = this.dataSources.get(id);\n    if (!dataSource) return undefined;\n    \n    const updated = { ...dataSource, ...updates, updatedAt: new Date() };\n    this.dataSources.set(id, updated);\n    return updated;\n  }\n\n  async deleteDataSource(id: string): Promise<boolean> {\n    return this.dataSources.delete(id);\n  }\n\n  // AI query operations\n  async getAiQueries(userId: string, limit = 10): Promise<AiQuery[]> {\n    return Array.from(this.aiQueries.values())\n      .filter(query => query.userId === userId)\n      .sort((a, b) => new Date(b.createdAt!).getTime() - new Date(a.createdAt!).getTime())\n      .slice(0, limit);\n  }\n\n  async createAiQuery(insertQuery: InsertAiQuery): Promise<AiQuery> {\n    const id = randomUUID();\n    const query: AiQuery = {\n      ...insertQuery,\n      metadata: insertQuery.metadata || null,\n      isVoiceQuery: insertQuery.isVoiceQuery || null,\n      dataSourceId: insertQuery.dataSourceId || null,\n      id,\n      createdAt: new Date()\n    };\n    this.aiQueries.set(id, query);\n    return query;\n  }\n\n  // KPI operations\n  async getKpis(userId: string): Promise<KPI[]> {\n    return Array.from(this.kpis.values()).filter(kpi => kpi.userId === userId);\n  }\n\n  async createKpi(insertKpi: InsertKPI): Promise<KPI> {\n    const id = randomUUID();\n    const now = new Date();\n    const kpi: KPI = {\n      ...insertKpi,\n      dashboardId: insertKpi.dashboardId || null,\n      unit: insertKpi.unit || null,\n      changePercent: insertKpi.changePercent || null,\n      visualType: insertKpi.visualType || null,\n      format: insertKpi.format || null,\n      decimalPlaces: insertKpi.decimalPlaces ?? null,\n      currencyCode: insertKpi.currencyCode || null,\n      prefix: insertKpi.prefix || null,\n      suffix: insertKpi.suffix || null,\n      id,\n      lastUpdated: now,\n      createdAt: now\n    };\n    this.kpis.set(id, kpi);\n    return kpi;\n  }\n\n  async updateKpi(id: string, updates: Partial<KPI>): Promise<KPI | undefined> {\n    const kpi = this.kpis.get(id);\n    if (!kpi) return undefined;\n    \n    const updated = { ...kpi, ...updates, lastUpdated: new Date() };\n    this.kpis.set(id, updated);\n    return updated;\n  }\n\n  async deleteKpi(id: string): Promise<boolean> {\n    return this.kpis.delete(id);\n  }\n\n  // Chart operations\n  async getCharts(userId: string): Promise<Chart[]> {\n    return Array.from(this.charts.values()).filter(chart => chart.userId === userId);\n  }\n\n  async getChart(id: string): Promise<Chart | undefined> {\n    return this.charts.get(id);\n  }\n\n  async createChart(insertChart: InsertChart): Promise<Chart> {\n    const id = randomUUID();\n    const now = new Date();\n    const chart: Chart = {\n      ...insertChart,\n      query: insertChart.query || null,\n      dataSourceIds: insertChart.dataSourceIds || null,\n      id,\n      createdAt: now,\n      updatedAt: now\n    };\n    this.charts.set(id, chart);\n    return chart;\n  }\n\n  async updateChart(id: string, updates: Partial<Chart>): Promise<Chart | undefined> {\n    const chart = this.charts.get(id);\n    if (!chart) return undefined;\n    \n    const updated = { ...chart, ...updates, updatedAt: new Date() };\n    this.charts.set(id, updated);\n    return updated;\n  }\n\n  async deleteChart(id: string): Promise<boolean> {\n    await this.deleteDashboardChartsByChartId(id);\n    return this.charts.delete(id);\n  }\n\n  // View operations\n  async getViews(userId: string): Promise<View[]> {\n    return Array.from(this.views.values()).filter(view => view.userId === userId);\n  }\n\n  async getView(id: string): Promise<View | undefined> {\n    return this.views.get(id);\n  }\n\n  async createView(insertView: InsertView): Promise<View> {\n    const id = randomUUID();\n    const now = new Date();\n    const view: View = {\n      ...insertView,\n      description: insertView.description || null,\n      dataSourceId: insertView.dataSourceId || null,\n      resultData: insertView.resultData || null,\n      columns: insertView.columns || null,\n      rowCount: insertView.rowCount || null,\n      lastExecuted: null,\n      id,\n      createdAt: now,\n      updatedAt: now\n    };\n    this.views.set(id, view);\n    return view;\n  }\n\n  async updateView(id: string, updates: Partial<View>): Promise<View | undefined> {\n    const view = this.views.get(id);\n    if (!view) return undefined;\n    \n    const updated = { ...view, ...updates, updatedAt: new Date() };\n    this.views.set(id, updated);\n    return updated;\n  }\n\n  async deleteView(id: string): Promise<boolean> {\n    return this.views.delete(id);\n  }\n\n  // Connection operations\n  async getConnections(userId: string): Promise<Connection[]> {\n    return Array.from(this.connections.values()).filter(connection => connection.userId === userId);\n  }\n\n  async getConnection(id: string): Promise<Connection | undefined> {\n    return this.connections.get(id);\n  }\n\n  async createConnection(insertConnection: InsertConnection): Promise<Connection> {\n    const id = randomUUID();\n    const now = new Date();\n    const connection: Connection = {\n      ...insertConnection,\n      status: insertConnection.status || 'connected',\n      metadata: insertConnection.metadata || null,\n      id,\n      createdAt: now,\n      updatedAt: now,\n      lastTestedAt: null,\n    };\n    this.connections.set(id, connection);\n    return connection;\n  }\n\n  async updateConnection(id: string, updates: Partial<Connection>): Promise<Connection | undefined> {\n    const connection = this.connections.get(id);\n    if (!connection) return undefined;\n    \n    const updated: Connection = {\n      ...connection,\n      ...updates,\n      updatedAt: new Date()\n    };\n    this.connections.set(id, updated);\n    return updated;\n  }\n\n  async deleteConnection(id: string): Promise<boolean> {\n    return this.connections.delete(id);\n  }\n\n  async getConnectionByNameAndUser(userId: string, name: string): Promise<Connection | undefined> {\n    return Array.from(this.connections.values()).find(\n      connection => connection.userId === userId && connection.name === name\n    );\n  }\n\n  // Dashboard operations\n  async getDashboards(userId: string): Promise<Dashboard[]> {\n    return Array.from(this.dashboards.values()).filter(dashboard => dashboard.userId === userId);\n  }\n\n  async getDashboard(id: string): Promise<Dashboard | undefined> {\n    return this.dashboards.get(id);\n  }\n\n  async createDashboard(insertDashboard: InsertDashboard): Promise<Dashboard> {\n    const id = randomUUID();\n    const now = new Date();\n    const dashboard: Dashboard = {\n      ...insertDashboard,\n      description: insertDashboard.description || null,\n      id,\n      createdAt: now,\n      updatedAt: now\n    };\n    this.dashboards.set(id, dashboard);\n    return dashboard;\n  }\n\n  async updateDashboard(id: string, updates: Partial<Dashboard>): Promise<Dashboard | undefined> {\n    const dashboard = this.dashboards.get(id);\n    if (!dashboard) return undefined;\n    \n    const updated = { ...dashboard, ...updates, updatedAt: new Date() };\n    this.dashboards.set(id, updated);\n    return updated;\n  }\n\n  async deleteDashboard(id: string): Promise<boolean> {\n    const chartsToDelete = Array.from(this.dashboardCharts.values()).filter(\n      dc => dc.dashboardId === id\n    );\n    chartsToDelete.forEach(dc => this.dashboardCharts.delete(dc.id));\n    \n    const kpisToDelete = Array.from(this.kpis.values()).filter(\n      kpi => kpi.dashboardId === id\n    );\n    kpisToDelete.forEach(kpi => this.kpis.delete(kpi.id));\n    \n    return this.dashboards.delete(id);\n  }\n\n  // Dashboard Chart operations\n  async getDashboardCharts(dashboardId: string): Promise<DashboardChart[]> {\n    return Array.from(this.dashboardCharts.values()).filter(\n      dc => dc.dashboardId === dashboardId\n    );\n  }\n\n  async getDashboardChart(id: string): Promise<DashboardChart | undefined> {\n    return this.dashboardCharts.get(id);\n  }\n\n  async createDashboardChart(insertDashboardChart: InsertDashboardChart): Promise<DashboardChart> {\n    const id = randomUUID();\n    const dashboardChart: DashboardChart = {\n      ...insertDashboardChart,\n      x: insertDashboardChart.x ?? 0,\n      y: insertDashboardChart.y ?? 0,\n      w: insertDashboardChart.w ?? 4,\n      h: insertDashboardChart.h ?? 3,\n      id,\n      createdAt: new Date()\n    };\n    this.dashboardCharts.set(id, dashboardChart);\n    return dashboardChart;\n  }\n\n  async updateDashboardChart(id: string, updates: Partial<DashboardChart>): Promise<DashboardChart | undefined> {\n    const dashboardChart = this.dashboardCharts.get(id);\n    if (!dashboardChart) return undefined;\n    \n    const updated = { ...dashboardChart, ...updates };\n    this.dashboardCharts.set(id, updated);\n    return updated;\n  }\n\n  async deleteDashboardChart(id: string): Promise<boolean> {\n    return this.dashboardCharts.delete(id);\n  }\n\n  async deleteDashboardChartsByChartId(chartId: string): Promise<boolean> {\n    const chartsToDelete = Array.from(this.dashboardCharts.values()).filter(\n      dc => dc.chartId === chartId\n    );\n    chartsToDelete.forEach(dc => this.dashboardCharts.delete(dc.id));\n    return chartsToDelete.length > 0;\n  }\n}\n\nexport const storage = new MemStorage();\n","size_bytes":15536},"client/src/lib/api.ts":{"content":"import { apiRequest } from \"./queryClient\";\n\nexport interface DataSource {\n  id: string;\n  name: string;\n  type: string;\n  filename?: string;\n  size?: number;\n  rowCount?: number;\n  columnCount?: number;\n  status: string;\n  metadata?: any;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface AiQuery {\n  id: string;\n  question: string;\n  answer: string;\n  isVoiceQuery: string;\n  chartData?: any;\n  chartType?: string;\n  kpiValue?: string;\n  unit?: string;\n  sqlQuery?: string;\n  createdAt: string;\n}\n\nexport interface KPI {\n  id: string;\n  question: string;\n  value: string;\n  unit?: string;\n  changePercent?: string;\n  dashboardId?: string;\n  visualType?: string;\n  format?: string;\n  decimalPlaces?: number;\n  currencyCode?: string;\n  prefix?: string;\n  suffix?: string;\n  lastUpdated: string;\n}\n\nexport interface Dashboard {\n  id: string;\n  name: string;\n  description?: string;\n  kpiCount?: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Chart {\n  id: string;\n  title: string;\n  type: string;\n  config: any;\n  dataSourceId?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\n// Data Source API\nexport async function uploadDataSource(file: File): Promise<DataSource> {\n  const formData = new FormData();\n  formData.append('file', file);\n  \n  const response = await fetch('/api/data-sources/upload', {\n    method: 'POST',\n    body: formData,\n    credentials: 'include',\n  });\n  \n  if (!response.ok) {\n    const error = await response.text();\n    throw new Error(error || 'Upload failed');\n  }\n  \n  return response.json();\n}\n\nexport async function getDataSources(): Promise<DataSource[]> {\n  const response = await apiRequest('GET', '/api/data-sources');\n  return response.json();\n}\n\nexport async function deleteDataSource(id: string): Promise<void> {\n  await apiRequest('DELETE', `/api/data-sources/${id}`);\n}\n\n// AI Query API\nexport async function submitAiQuery(question: string, dataSourceIds?: string[], isVoiceQuery = false): Promise<AiQuery> {\n  const response = await apiRequest('POST', '/api/ai/query', {\n    question,\n    dataSourceIds,\n    isVoiceQuery\n  });\n  return response.json();\n}\n\nexport async function transcribeAudio(audioBlob: Blob): Promise<{ transcription: string }> {\n  const formData = new FormData();\n  formData.append('audio', audioBlob, 'recording.wav');\n  \n  const response = await fetch('/api/ai/voice', {\n    method: 'POST',\n    body: formData,\n    credentials: 'include',\n  });\n  \n  if (!response.ok) {\n    throw new Error('Failed to transcribe audio');\n  }\n  \n  return response.json();\n}\n\nexport async function getAiQueries(limit = 10): Promise<AiQuery[]> {\n  const response = await apiRequest('GET', `/api/ai/queries?limit=${limit}`);\n  return response.json();\n}\n\n// KPI API\nexport async function getKpis(): Promise<KPI[]> {\n  const response = await apiRequest('GET', '/api/kpis');\n  return response.json();\n}\n\nexport async function createKpi(kpi: Omit<KPI, 'id' | 'lastUpdated'>): Promise<KPI> {\n  const response = await apiRequest('POST', '/api/kpis', kpi);\n  return response.json();\n}\n\nexport async function createKpiFromQuery(question: string, answer: string): Promise<KPI> {\n  const response = await apiRequest('POST', '/api/kpis/from-query', {\n    question,\n    answer\n  });\n  return response.json();\n}\n\nexport async function updateKpi(id: string, updates: Partial<KPI>): Promise<KPI> {\n  const response = await apiRequest('PUT', `/api/kpis/${id}`, updates);\n  return response.json();\n}\n\nexport async function deleteKpi(id: string): Promise<void> {\n  await apiRequest('DELETE', `/api/kpis/${id}`);\n}\n\n// Chart API\nexport async function getCharts(): Promise<Chart[]> {\n  const response = await apiRequest('GET', '/api/charts');\n  return response.json();\n}\n\nexport async function getChart(id: string): Promise<Chart> {\n  const response = await apiRequest('GET', `/api/charts/${id}`);\n  return response.json();\n}\n\nexport async function createChart(chart: Omit<Chart, 'id' | 'createdAt' | 'updatedAt'>): Promise<Chart> {\n  const response = await apiRequest('POST', '/api/charts', chart);\n  return response.json();\n}\n\nexport async function updateChart(id: string, updates: Partial<Chart>): Promise<Chart> {\n  const response = await apiRequest('PUT', `/api/charts/${id}`, updates);\n  return response.json();\n}\n\nexport async function deleteChart(id: string): Promise<void> {\n  await apiRequest('DELETE', `/api/charts/${id}`);\n}\n\n// Data Preview API\nexport async function previewDataSource(id: string, limit = 10): Promise<any> {\n  const response = await apiRequest('GET', `/api/data-sources/${id}/preview?limit=${limit}`);\n  return response.json();\n}\n\n// Views API\nexport interface View {\n  id: string;\n  name: string;\n  description?: string;\n  sqlQuery: string;\n  dataSourceId?: string;\n  resultData?: any;\n  columns?: any;\n  rowCount?: number;\n  createdAt: string;\n  updatedAt: string;\n  lastExecuted?: string;\n}\n\nexport async function getViews(): Promise<View[]> {\n  const response = await apiRequest('GET', '/api/views');\n  return response.json();\n}\n\nexport async function getView(id: string): Promise<View> {\n  const response = await apiRequest('GET', `/api/views/${id}`);\n  return response.json();\n}\n\nexport async function createView(view: Omit<View, 'id' | 'createdAt' | 'updatedAt' | 'lastExecuted'>): Promise<View> {\n  const response = await apiRequest('POST', '/api/views', view);\n  return response.json();\n}\n\nexport async function updateView(id: string, updates: Partial<View>): Promise<View> {\n  const response = await apiRequest('PUT', `/api/views/${id}`, updates);\n  return response.json();\n}\n\nexport async function deleteView(id: string): Promise<void> {\n  await apiRequest('DELETE', `/api/views/${id}`);\n}\n\nexport async function executeView(id: string): Promise<any> {\n  const response = await apiRequest('POST', `/api/views/${id}/execute`);\n  return response.json();\n}\n\nexport async function executeSQLQuery(query: string): Promise<any> {\n  const response = await apiRequest('POST', '/api/sql/execute', { query });\n  return response.json();\n}\n\n// Connection API\nexport interface Connection {\n  id: string;\n  name: string;\n  type: string;\n  status: string;\n  metadata?: any;\n  createdAt: string;\n  updatedAt: string;\n  lastTestedAt?: string;\n}\n\nexport async function getConnections(): Promise<Connection[]> {\n  const response = await apiRequest('GET', '/api/connections');\n  return response.json();\n}\n\nexport async function getConnection(id: string): Promise<Connection> {\n  const response = await apiRequest('GET', `/api/connections/${id}`);\n  return response.json();\n}\n\nexport async function getConnectionTables(connectionId: string): Promise<DataSource[]> {\n  const response = await apiRequest('GET', `/api/connections/${connectionId}/tables`);\n  return response.json();\n}\n\n// Dashboard API\nexport async function getDashboards(): Promise<Dashboard[]> {\n  const response = await apiRequest('GET', '/api/dashboards');\n  return response.json();\n}\n\nexport async function getDashboard(id: string): Promise<Dashboard> {\n  const response = await apiRequest('GET', `/api/dashboards/${id}`);\n  return response.json();\n}\n\nexport async function createDashboard(dashboard: Omit<Dashboard, 'id' | 'createdAt' | 'updatedAt' | 'kpiCount'>): Promise<Dashboard> {\n  const response = await apiRequest('POST', '/api/dashboards', dashboard);\n  return response.json();\n}\n\nexport async function updateDashboard(id: string, updates: Partial<Dashboard>): Promise<Dashboard> {\n  const response = await apiRequest('PUT', `/api/dashboards/${id}`, updates);\n  return response.json();\n}\n\nexport async function deleteDashboard(id: string): Promise<void> {\n  await apiRequest('DELETE', `/api/dashboards/${id}`);\n}\n","size_bytes":7672},"client/src/pages/dashboard-view-page.tsx":{"content":"import { useState, useMemo, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, ArrowLeft, LayoutDashboard, TrendingUp, Settings, GripVertical } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport GridLayout, { type Layout } from \"react-grid-layout\";\nimport \"react-grid-layout/css/styles.css\";\nimport \"react-resizable/css/styles.css\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport KpiCard from \"@/components/dashboard/kpi-card\";\nimport { DrillDownModal } from \"@/components/chart/DrillDownModal\";\nimport { ChartTypeSelectionModal } from \"@/components/dashboard/chart-type-selection-modal\";\nimport { ChartConfigurationModal } from \"@/components/dashboard/chart-configuration-modal\";\nimport { ChartRenderer } from \"@/components/dashboard/chart-renderer\";\nimport type { Dashboard, Chart, DashboardChart } from \"@shared/schema\";\nimport type { KPI } from \"@/lib/api\";\nimport type { ChartType } from \"@/lib/chart-catalog\";\n\ninterface DashboardWithKpis extends Dashboard {\n  kpis: KPI[];\n}\n\ninterface DashboardChartWithDetails extends DashboardChart {\n  chart: Chart | null;\n}\n\ninterface DashboardViewPageProps {\n  dashboardId: string;\n  onBack: () => void;\n}\n\nexport default function DashboardViewPage({ dashboardId, onBack }: DashboardViewPageProps) {\n  const [addKpiDialogOpen, setAddKpiDialogOpen] = useState(false);\n  const [kpiQuestion, setKpiQuestion] = useState(\"\");\n  const [kpiValue, setKpiValue] = useState(\"\");\n  const [kpiUnit, setKpiUnit] = useState(\"\");\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [selectedChartId, setSelectedChartId] = useState<string | null>(null);\n  const [containerWidth, setContainerWidth] = useState(1200);\n  const gridContainerRef = useRef<HTMLDivElement>(null);\n  \n  // Chart creation flow state\n  const [isChartTypeModalOpen, setIsChartTypeModalOpen] = useState(false);\n  const [isChartConfigModalOpen, setIsChartConfigModalOpen] = useState(false);\n  const [selectedChartType, setSelectedChartType] = useState<ChartType | null>(null);\n  \n  const { toast } = useToast();\n\n  const { data: dashboard, isLoading } = useQuery<DashboardWithKpis>({\n    queryKey: [\"/api/dashboards\", dashboardId],\n    queryFn: async () => {\n      const response = await fetch(`/api/dashboards/${dashboardId}`, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Failed to fetch dashboard\");\n      return response.json();\n    },\n  });\n  \n  // Fetch dashboard charts\n  const { data: dashboardCharts = [] } = useQuery<DashboardChartWithDetails[]>({\n    queryKey: [\"/api/dashboards\", dashboardId, \"charts\"],\n    queryFn: async () => {\n      const response = await fetch(`/api/dashboards/${dashboardId}/charts`, { credentials: \"include\" });\n      if (!response.ok) return [];\n      return response.json();\n    },\n  });\n  \n  // Grid layout configuration with responsive side-by-side stacking\n  const layout: Layout[] = useMemo(() => {\n    return dashboardCharts.map((dc, index) => {\n      // Auto-calculate position for side-by-side layout if not already set\n      const cols = 12; // Total columns\n      const defaultWidth = 6; // 2 charts per row on desktop\n      const defaultHeight = 4; // Reduced height for less bulk\n      \n      // If positions are already set, use them\n      if (dc.x !== 0 || dc.y !== 0 || dc.w !== 4 || dc.h !== 3) {\n        return {\n          i: dc.id,\n          x: dc.x,\n          y: dc.y,\n          w: dc.w,\n          h: dc.h,\n          minW: 3,\n          minH: 3,\n        };\n      }\n      \n      // Auto-position: stack side by side\n      const chartsPerRow = Math.floor(cols / defaultWidth);\n      const row = Math.floor(index / chartsPerRow);\n      const col = index % chartsPerRow;\n      \n      return {\n        i: dc.id,\n        x: col * defaultWidth,\n        y: row * defaultHeight,\n        w: defaultWidth,\n        h: defaultHeight,\n        minW: 3,\n        minH: 3,\n      };\n    });\n  }, [dashboardCharts]);\n  \n  const updateLayoutMutation = useMutation({\n    mutationFn: async (updates: { id: string; x: number; y: number; w: number; h: number }[]) => {\n      await Promise.all(\n        updates.map((update) =>\n          apiRequest(\"PUT\", `/api/dashboard-charts/${update.id}`, {\n            x: update.x,\n            y: update.y,\n            w: update.w,\n            h: update.h,\n          })\n        )\n      );\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\", dashboardId, \"charts\"] });\n      toast({ title: \"Success\", description: \"Layout updated\" });\n    },\n  });\n  \n  const handleLayoutChange = (newLayout: Layout[]) => {\n    if (!isEditMode) return;\n    \n    const updates = newLayout.map((item) => {\n      const dc = dashboardCharts.find((c) => c.id === item.i);\n      if (!dc) return null;\n      return { id: dc.id, x: item.x, y: item.y, w: item.w, h: item.h };\n    }).filter((u) => u !== null) as { id: string; x: number; y: number; w: number; h: number }[];\n    \n    if (updates.length > 0) {\n      updateLayoutMutation.mutate(updates);\n    }\n  };\n\n  // Measure container width for responsive grid\n  useEffect(() => {\n    const updateWidth = () => {\n      if (gridContainerRef.current) {\n        setContainerWidth(gridContainerRef.current.offsetWidth);\n      }\n    };\n\n    updateWidth();\n    window.addEventListener('resize', updateWidth);\n    return () => window.removeEventListener('resize', updateWidth);\n  }, []);\n\n  const addKpiMutation = useMutation({\n    mutationFn: async (data: { question: string; value: string; unit?: string; dashboardId: string }) => {\n      return apiRequest(\"POST\", \"/api/kpis\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\", dashboardId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/kpis\"] });\n      setAddKpiDialogOpen(false);\n      setKpiQuestion(\"\");\n      setKpiValue(\"\");\n      setKpiUnit(\"\");\n      toast({\n        title: \"Success\",\n        description: \"KPI added successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add KPI\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAddKpi = () => {\n    if (!kpiQuestion.trim() || !kpiValue.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Question and value are required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    addKpiMutation.mutate({\n      question: kpiQuestion,\n      value: kpiValue,\n      unit: kpiUnit || undefined,\n      dashboardId: dashboardId,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Skeleton className=\"h-10 w-10\" />\n          <div className=\"flex-1\">\n            <Skeleton className=\"h-8 w-64 mb-2\" />\n            <Skeleton className=\"h-4 w-96\" />\n          </div>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i} className=\"p-6\">\n              <Skeleton className=\"h-8 w-8 mb-4\" />\n              <Skeleton className=\"h-8 w-24 mb-2\" />\n              <Skeleton className=\"h-4 w-32\" />\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!dashboard) {\n    return (\n      <div className=\"p-6\">\n        <Card className=\"p-12 text-center\">\n          <div className=\"text-muted-foreground\">\n            <LayoutDashboard className=\"mx-auto h-12 w-12 mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">Dashboard Not Found</h3>\n            <p className=\"mb-4\">The dashboard you're looking for doesn't exist</p>\n            <Button onClick={onBack} data-testid=\"button-back-to-dashboards\">\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back to Dashboards\n            </Button>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onBack}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <div>\n            <h2 className=\"text-2xl font-bold\">{dashboard.name}</h2>\n            <p className=\"text-muted-foreground\">\n              {dashboard.description || \"No description\"}\n            </p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={isEditMode ? \"default\" : \"outline\"}\n            onClick={() => setIsEditMode(!isEditMode)}\n            data-testid=\"button-edit-mode\"\n          >\n            <Settings className=\"mr-2 h-4 w-4\" />\n            {isEditMode ? \"Done\" : \"Edit Layout\"}\n          </Button>\n          <Button onClick={() => setIsChartTypeModalOpen(true)} data-testid=\"button-add-kpi\">\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add KPI\n          </Button>\n        </div>\n      </div>\n      \n      <Dialog open={addKpiDialogOpen} onOpenChange={setAddKpiDialogOpen}>\n        <DialogContent data-testid=\"dialog-add-kpi\">\n            <DialogHeader>\n              <DialogTitle>Add New KPI</DialogTitle>\n              <DialogDescription>\n                Add a new KPI to track on this dashboard\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"kpi-question\">KPI Name/Question</Label>\n                <Input\n                  id=\"kpi-question\"\n                  data-testid=\"input-kpi-question\"\n                  placeholder=\"e.g., Total Revenue\"\n                  value={kpiQuestion}\n                  onChange={(e) => setKpiQuestion(e.target.value)}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"kpi-value\">Value</Label>\n                <Input\n                  id=\"kpi-value\"\n                  data-testid=\"input-kpi-value\"\n                  placeholder=\"e.g., 125000\"\n                  value={kpiValue}\n                  onChange={(e) => setKpiValue(e.target.value)}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"kpi-unit\">Unit (Optional)</Label>\n                <Input\n                  id=\"kpi-unit\"\n                  data-testid=\"input-kpi-unit\"\n                  placeholder=\"e.g., USD, users, etc.\"\n                  value={kpiUnit}\n                  onChange={(e) => setKpiUnit(e.target.value)}\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setAddKpiDialogOpen(false);\n                  setKpiQuestion(\"\");\n                  setKpiValue(\"\");\n                  setKpiUnit(\"\");\n                }}\n                data-testid=\"button-cancel-kpi\"\n              >\n                Cancel\n              </Button>\n              <Button\n                onClick={handleAddKpi}\n                disabled={addKpiMutation.isPending}\n                data-testid=\"button-save-kpi\"\n              >\n                Add KPI\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n      {/* KPIs Grid */}\n      {(dashboard?.kpis?.length ?? 0) > 0 || dashboardCharts.length > 0 ? (\n        <>\n          {(dashboard?.kpis?.length ?? 0) > 0 && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {dashboard.kpis.map((kpi) => (\n                <KpiCard \n                  key={kpi.id} \n                  kpi={{\n                    ...kpi,\n                    unit: kpi.unit ?? undefined,\n                    changePercent: kpi.changePercent ?? undefined,\n                    visualType: kpi.visualType ?? undefined,\n                    prefix: kpi.prefix ?? undefined,\n                    format: kpi.format ?? undefined,\n                  } as KPI} \n                />\n              ))}\n            </div>\n          )}\n        </>\n      ) : (\n        <Card className=\"p-12 text-center\">\n          <div className=\"text-muted-foreground\">\n            <TrendingUp className=\"mx-auto h-12 w-12 mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No KPIs Yet</h3>\n            <p className=\"mb-4\">Add your first KPI to start tracking metrics</p>\n            <Button onClick={() => setIsChartTypeModalOpen(true)} data-testid=\"button-add-first-kpi\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Add KPI\n            </Button>\n          </div>\n        </Card>\n      )}\n      \n      {/* Charts Grid Layout */}\n      {dashboardCharts.length > 0 && (\n        <div className=\"mt-6\" ref={gridContainerRef}>\n          <h3 className=\"text-lg font-semibold mb-4\">Charts</h3>\n          <GridLayout\n            className=\"layout\"\n            layout={layout}\n            cols={12}\n            rowHeight={70}\n            width={containerWidth}\n            isDraggable={isEditMode}\n            isResizable={isEditMode}\n            onLayoutChange={handleLayoutChange}\n            draggableHandle=\".drag-handle\"\n            compactType=\"vertical\"\n            preventCollision={false}\n          >\n            {dashboardCharts.map((dc) => (\n              <div key={dc.id} className=\"bg-card border border-border rounded-lg overflow-hidden flex flex-col\">\n                <div className=\"flex items-center justify-between p-3 border-b\">\n                  <h4 className=\"font-medium\">{dc.chart?.title || \"Chart\"}</h4>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => setSelectedChartId(dc.chart?.id || null)}\n                      data-testid={`button-drill-down-${dc.chart?.id}`}\n                    >\n                      View Data\n                    </Button>\n                    {isEditMode && (\n                      <div className=\"drag-handle cursor-move\">\n                        <GripVertical className=\"h-4 w-4\" />\n                      </div>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex-1 p-4 min-h-[200px]\">\n                  {dc.chart?.id && <ChartRenderer chartId={dc.chart.id} />}\n                </div>\n              </div>\n            ))}\n          </GridLayout>\n        </div>\n      )}\n\n      {/* Drill-Down Modal */}\n      {selectedChartId && (\n        <DrillDownModal\n          isOpen={!!selectedChartId}\n          onClose={() => setSelectedChartId(null)}\n          chartId={selectedChartId}\n          chartTitle={\n            dashboardCharts.find((dc) => dc.chart?.id === selectedChartId)?.chart?.title || \"Chart\"\n          }\n        />\n      )}\n\n      {/* Chart Type Selection Modal */}\n      <ChartTypeSelectionModal\n        isOpen={isChartTypeModalOpen}\n        onClose={() => setIsChartTypeModalOpen(false)}\n        onSelectChartType={(chartType) => {\n          setSelectedChartType(chartType);\n          setIsChartTypeModalOpen(false);\n          setIsChartConfigModalOpen(true);\n        }}\n      />\n\n      {/* Chart Configuration Modal */}\n      {selectedChartType && (\n        <ChartConfigurationModal\n          isOpen={isChartConfigModalOpen}\n          onClose={() => {\n            setIsChartConfigModalOpen(false);\n            setSelectedChartType(null);\n          }}\n          chartType={selectedChartType}\n          dashboardId={dashboardId}\n          onBack={() => {\n            setIsChartConfigModalOpen(false);\n            setIsChartTypeModalOpen(true);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":16326},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/voice/voice-button.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Mic, MicOff, Loader2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VoiceButtonProps {\n  isRecording: boolean;\n  isTranscribing: boolean;\n  onClick: () => void;\n  disabled?: boolean;\n  size?: \"sm\" | \"default\" | \"lg\";\n}\n\nexport default function VoiceButton({ \n  isRecording, \n  isTranscribing, \n  onClick, \n  disabled = false,\n  size = \"default\"\n}: VoiceButtonProps) {\n  const getButtonClass = () => {\n    if (isRecording) {\n      return \"bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 voice-recording\";\n    }\n    if (isTranscribing) {\n      return \"bg-gradient-to-r from-yellow-500 to-orange-500\";\n    }\n    return \"bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600\";\n  };\n\n  const sizeClasses = {\n    sm: \"p-2\",\n    default: \"p-3\", \n    lg: \"p-4\"\n  };\n\n  const iconSizes = {\n    sm: \"h-4 w-4\",\n    default: \"h-5 w-5\",\n    lg: \"h-6 w-6\"\n  };\n\n  return (\n    <Button\n      onClick={onClick}\n      disabled={disabled || isTranscribing}\n      className={cn(\n        \"relative rounded-full text-white transition-all duration-300\",\n        sizeClasses[size],\n        getButtonClass()\n      )}\n      data-testid=\"button-voice-recording\"\n    >\n      {isTranscribing ? (\n        <Loader2 className={cn(\"animate-spin\", iconSizes[size])} />\n      ) : isRecording ? (\n        <MicOff className={iconSizes[size]} />\n      ) : (\n        <Mic className={iconSizes[size]} />\n      )}\n      \n      {isRecording && (\n        <div className=\"absolute inset-0 rounded-full opacity-0 voice-recording animate-pulse\" />\n      )}\n    </Button>\n  );\n}\n","size_bytes":1668},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n        \"recording-pulse\": {\n          \"0%, 100%\": {\n            transform: \"scale(1)\",\n            opacity: \"1\",\n          },\n          \"50%\": {\n            transform: \"scale(1.05)\",\n            opacity: \"0.8\",\n          },\n        },\n        fadeIn: {\n          to: {\n            opacity: \"1\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"recording-pulse\": \"recording-pulse 1.5s ease-in-out infinite\",\n        \"fade-in\": \"fadeIn 0.5s ease-out forwards\",\n      },\n      spacing: {\n        \"spacing\": \"var(--spacing)\",\n      },\n      letterSpacing: {\n        normal: \"var(--tracking-normal)\",\n      },\n      boxShadow: {\n        \"2xs\": \"var(--shadow-2xs)\",\n        xs: \"var(--shadow-xs)\",\n        sm: \"var(--shadow-sm)\",\n        DEFAULT: \"var(--shadow)\",\n        md: \"var(--shadow-md)\",\n        lg: \"var(--shadow-lg)\",\n        xl: \"var(--shadow-xl)\",\n        \"2xl\": \"var(--shadow-2xl)\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":3630},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider } from \"@/hooks/use-auth\";\nimport { ProtectedRoute } from \"@/lib/protected-route\";\nimport NotFound from \"@/pages/not-found\";\nimport AuthPage from \"@/pages/auth-page\";\nimport HomePage from \"@/pages/home-page\";\nimport WarehousePage from \"@/pages/warehouse-page\";\nimport DashboardPage from \"@/pages/dashboard-page\";\nimport DatasetsPage from \"@/pages/datasets-page\";\nimport KPIDashboard from \"@/pages/kpi-dashboard\";\nimport ChartsPage from \"@/pages/charts-page\";\nimport ChartBuilderPage from \"@/pages/chart-builder-page\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <ProtectedRoute path=\"/\" component={HomePage} />\n      <ProtectedRoute path=\"/dashboard\" component={DashboardPage} />\n      <ProtectedRoute path=\"/warehouse\" component={WarehousePage} />\n      <ProtectedRoute path=\"/datasets\" component={DatasetsPage} />\n      <ProtectedRoute path=\"/kpis\" component={KPIDashboard} />\n      <ProtectedRoute path=\"/charts\" component={ChartsPage} />\n      <ProtectedRoute path=\"/chart-builder\" component={ChartBuilderPage} />\n      <Route path=\"/auth\" component={AuthPage} />\n      <Route path=\"/login\" component={AuthPage} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1736},"attached_assets/tts_1758734351640.py":{"content":"import edge_tts\r\n\r\ndef speak(text: str):\r\n    # example implementation\r\n    communicate = edge_tts.Communicate(text, \"en-IN-NeerjaNeural\")\r\n    return communicate.save(\"output.mp3\")\r\n","size_bytes":183},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"attached_assets/main_1758734351640.py":{"content":"# backend/main.py\r\nfrom contextlib import asynccontextmanager\r\nimport asyncio\r\nfrom fastapi import FastAPI\r\nfrom fastapi.middleware.cors import CORSMiddleware\r\nfrom sqlalchemy.exc import OperationalError\r\n\r\nfrom backend.db.session import engine, Base\r\nimport backend.db.models  # IMPORTANT: register models\r\nfrom backend.services import auth as auth_router\r\nfrom backend.services import query_api, upload_api, list_api\r\nfrom backend.services import superset_connect as superset_router\r\n\r\n@asynccontextmanager\r\nasync def lifespan(app: FastAPI):\r\n    # ----- startup (retry DB create_all) -----\r\n    print(\"[lifespan] initializing‚Ä¶\")\r\n    attempts, delay = 0, 1.0\r\n    while attempts < 20:\r\n        try:\r\n            async with engine.begin() as conn:\r\n                await conn.run_sync(Base.metadata.create_all)\r\n            print(\"[lifespan] DB ready\")\r\n            break\r\n        except OperationalError as e:\r\n            attempts += 1\r\n            print(f\"[lifespan] DB not ready (attempt {attempts}) -> {e}\")\r\n            await asyncio.sleep(delay)\r\n            delay = min(delay * 1.6, 5.0)\r\n    else:\r\n        # Give up after retries but still start the API so /docs & /healthz work\r\n        print(\"[lifespan] DB not reachable after retries ‚Äî starting API anyway\")\r\n\r\n    yield\r\n    # ----- shutdown -----\r\n    print(\"[lifespan] disposing engine‚Ä¶\")\r\n    await engine.dispose()\r\n    print(\"[lifespan] bye\")\r\n\r\napp = FastAPI(\r\n    title=\"NEX AI Backend\",\r\n    docs_url=\"/docs\",\r\n    redoc_url=\"/redoc\",\r\n    lifespan=lifespan,\r\n)\r\n\r\n# CORS for your Next.js app\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=[\"http://localhost:3000\", \"http://127.0.0.1:3000\"],\r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n\r\n# Routers\r\napp.include_router(auth_router.router)\r\napp.include_router(upload_api.router)\r\napp.include_router(list_api.router)\r\napp.include_router(query_api.router)\r\napp.include_router(superset_router.router)\r\n\r\n@app.get(\"/healthz\")\r\nasync def healthz():\r\n    return {\"ok\": True}\r\n\r\napp.include_router(superset_router.router, prefix=\"/superset\", tags=[\"superset\"])","size_bytes":2136},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"attached_assets/session_1758734366912.py":{"content":"# backend/db/session.py\r\nimport os\r\nfrom sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker, AsyncSession\r\nfrom sqlalchemy.orm import sessionmaker, DeclarativeBase\r\n\r\n# Default to your compose URL; can be overridden via env\r\nDATABASE_URL = os.getenv(\r\n    \"DATABASE_URL\",\r\n    \"mysql+asyncmy://nexuser:nexpass123@db:3306/login_details\",\r\n)\r\n\r\nif not DATABASE_URL.startswith(\"mysql+asyncmy://\"):\r\n    raise RuntimeError(\r\n        \"DATABASE_URL must use the 'mysql+asyncmy' driver, e.g. \"\r\n        \"mysql+asyncmy://user:pass@db:3306/login_details\"\r\n    )\r\n\r\nclass Base(DeclarativeBase):\r\n    pass\r\n\r\n# Create async engine & session maker\r\nengine = create_async_engine(DATABASE_URL, pool_pre_ping=True, future=True)\r\nSessionLocal = async_sessionmaker(engine, expire_on_commit=False, class_=AsyncSession)\r\n\r\n__all__ = [\"DATABASE_URL\", \"engine\", \"SessionLocal\", \"Base\"]\r\n","size_bytes":885},"client/src/pages/datasets-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getDataSources, deleteDataSource, previewDataSource, getViews, createView, updateView, deleteView, executeView, executeSQLQuery } from \"@/lib/api\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Database, \n  Search, \n  Play,\n  Save,\n  Trash2, \n  Eye,\n  Download,\n  Calendar,\n  FileText,\n  MoreVertical,\n  Code,\n  TableProperties,\n  Plus,\n  ChevronDown,\n  ChevronRight\n} from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\n\n// Datasets Tab Component\nconst DatasetsTab = () => {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterType, setFilterType] = useState(\"all\");\n  const [previewData, setPreviewData] = useState<any>(null);\n  const [previewDialogOpen, setPreviewDialogOpen] = useState(false);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: dataSources = [], isLoading: dataSourcesLoading } = useQuery({\n    queryKey: [\"/api/data-sources\"],\n    queryFn: () => getDataSources(),\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: deleteDataSource,\n    onSuccess: () => {\n      toast({\n        title: \"Dataset deleted\",\n        description: \"The dataset has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/data-sources\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Delete failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredDataSources = dataSources.filter((source) => {\n    const matchesSearch = source.name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    let matchesFilter = false;\n    if (filterType === \"all\") {\n      matchesFilter = true;\n    } else if (filterType === \"csv\") {\n      matchesFilter = source.type === \"csv\";\n    } else if (filterType === \"tables\") {\n      matchesFilter = source.metadata?.isTableDataset === true;\n    } else if (filterType === \"database\") {\n      matchesFilter = source.type !== \"csv\" && source.metadata?.isTableDataset !== true;\n    } else {\n      matchesFilter = source.type === filterType;\n    }\n    \n    return matchesSearch && matchesFilter;\n  });\n\n  const formatFileSize = (bytes: number | undefined) => {\n    if (!bytes) return \"‚Äî\";\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(1024));\n    return Math.round((bytes / Math.pow(1024, i)) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'ready':\n        return 'bg-green-500/20 text-green-400 border-green-500/30';\n      case 'processing':\n        return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30';\n      case 'error':\n        return 'bg-red-500/20 text-red-400 border-red-500/30';\n      default:\n        return 'bg-gray-500/20 text-gray-400 border-gray-500/30';\n    }\n  };\n\n  const getTypeIcon = (source: any) => {\n    if (source.metadata?.isTableDataset) {\n      return <TableProperties className=\"h-4 w-4\" />;\n    }\n    \n    switch (source.type) {\n      case 'csv':\n        return <FileText className=\"h-4 w-4\" />;\n      case 'mysql':\n      case 'postgresql':\n      case 'sqlserver':\n      case 'oracle':\n        return <Database className=\"h-4 w-4\" />;\n      default:\n        return <Database className=\"h-4 w-4\" />;\n    }\n  };\n\n  const previewMutation = useMutation({\n    mutationFn: (sourceId: string) => previewDataSource(sourceId, 10),\n    onSuccess: (data) => {\n      setPreviewData(data);\n      setPreviewDialogOpen(true);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Preview failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handlePreviewData = (source: any) => {\n    previewMutation.mutate(source.id);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Search and Filter Bar */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex gap-4 items-center\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n              <Input\n                placeholder=\"Search datasets...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n                data-testid=\"input-search-datasets\"\n              />\n            </div>\n            \n            <div className=\"flex gap-2\">\n              <Button\n                variant={filterType === \"all\" ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setFilterType(\"all\")}\n                data-testid=\"filter-all\"\n              >\n                All\n              </Button>\n              <Button\n                variant={filterType === \"csv\" ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setFilterType(\"csv\")}\n                data-testid=\"filter-csv\"\n              >\n                CSV Files\n              </Button>\n              <Button\n                variant={filterType === \"tables\" ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setFilterType(\"tables\")}\n                data-testid=\"filter-tables\"\n              >\n                Tables\n              </Button>\n              <Button\n                variant={filterType === \"database\" ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setFilterType(\"database\")}\n                data-testid=\"filter-database\"\n              >\n                Databases\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Datasets Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TableProperties className=\"h-5 w-5\" />\n            Available Datasets ({filteredDataSources.length})\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Type</TableHead>\n                  <TableHead>Records</TableHead>\n                  <TableHead>Size</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Created</TableHead>\n                  <TableHead className=\"w-[100px]\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {dataSourcesLoading ? (\n                  Array.from({ length: 3 }).map((_, i) => (\n                    <TableRow key={i}>\n                      <TableCell><Skeleton className=\"h-4 w-32\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-20\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-20\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-24\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>\n                    </TableRow>\n                  ))\n                ) : filteredDataSources.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={7} className=\"text-center py-8 text-muted-foreground\">\n                      {searchTerm || filterType !== \"all\" ? \"No datasets match your search criteria\" : \"No datasets available\"}\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  filteredDataSources.map((source) => (\n                    <TableRow key={source.id} className=\"group\">\n                      <TableCell>\n                        <div className=\"flex items-center gap-3\">\n                          {getTypeIcon(source)}\n                          <div>\n                            <div className=\"font-medium\">\n                              {source.metadata?.isTableDataset \n                                ? `${source.metadata.schemaName}.${source.metadata.tableName}`\n                                : source.name\n                              }\n                            </div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {source.metadata?.isTableDataset \n                                ? `Table from ${source.metadata.parentConnection}` \n                                : source.type.toUpperCase()\n                              }\n                            </div>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"secondary\" className=\"capitalize\">\n                          {source.metadata?.isTableDataset \n                            ? `${source.type} table` \n                            : source.type\n                          }\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"font-mono text-sm\">\n                          {source.rowCount?.toLocaleString() || \"‚Äî\"}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"font-mono text-sm\">\n                          {formatFileSize(source.size)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge className={getStatusColor(source.status)}>\n                          {source.status}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"text-sm text-muted-foreground\">\n                          <Calendar className=\"inline h-3 w-3 mr-1\" />\n                          {formatDate(source.createdAt)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-1\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handlePreviewData(source)}\n                            data-testid={`button-preview-${source.id}`}\n                          >\n                            <Eye className=\"h-3 w-3\" />\n                          </Button>\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button size=\"sm\" variant=\"outline\" data-testid={`button-menu-${source.id}`}>\n                                <MoreVertical className=\"h-3 w-3\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem onClick={() => handlePreviewData(source)}>\n                                <Eye className=\"mr-2 h-4 w-4\" />\n                                Preview Data\n                              </DropdownMenuItem>\n                              <DropdownMenuItem>\n                                <Download className=\"mr-2 h-4 w-4\" />\n                                Export\n                              </DropdownMenuItem>\n                              <DropdownMenuItem\n                                onClick={() => deleteMutation.mutate(source.id)}\n                                className=\"text-red-600\"\n                              >\n                                <Trash2 className=\"mr-2 h-4 w-4\" />\n                                Delete\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Data Preview Dialog */}\n      <Dialog open={previewDialogOpen} onOpenChange={setPreviewDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Data Preview: {previewData?.name}</DialogTitle>\n          </DialogHeader>\n          {previewData && (\n            <div className=\"space-y-4\">\n              <div className=\"text-sm text-muted-foreground\">\n                Showing first 3 rows of {previewData.totalRows} total records\n              </div>\n              <div className=\"border rounded-lg overflow-hidden\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      {(previewData.columns || []).map((column: string, index: number) => (\n                        <TableHead key={index}>{column}</TableHead>\n                      ))}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {(previewData.rows || []).map((row: string[], rowIndex: number) => (\n                      <TableRow key={rowIndex}>\n                        {(row || []).map((cell: string, cellIndex: number) => (\n                          <TableCell key={cellIndex} className=\"font-mono text-sm\">\n                            {cell}\n                          </TableCell>\n                        ))}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\n// Views Tab Component\nconst ViewsTab = () => {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: views = [], isLoading } = useQuery({\n    queryKey: [\"/api/views\"],\n    queryFn: () => getViews(),\n  });\n\n  const deleteViewMutation = useMutation({\n    mutationFn: deleteView,\n    onSuccess: () => {\n      toast({\n        title: \"View deleted\",\n        description: \"The view has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/views\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Delete failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const executeViewMutation = useMutation({\n    mutationFn: executeView,\n    onSuccess: (result) => {\n      toast({\n        title: \"Query executed\",\n        description: `Returned ${result.rowCount} rows in ${result.executionTime}ms`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/views\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Execution failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Eye className=\"h-5 w-5\" />\n            Saved Views ({views.length})\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Records</TableHead>\n                  <TableHead>Created</TableHead>\n                  <TableHead>Last Executed</TableHead>\n                  <TableHead className=\"w-[100px]\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {isLoading ? (\n                  Array.from({ length: 2 }).map((_, i) => (\n                    <TableRow key={i}>\n                      <TableCell><Skeleton className=\"h-4 w-32\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-48\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-24\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-24\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-16\" /></TableCell>\n                    </TableRow>\n                  ))\n                ) : views.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={6} className=\"text-center py-8 text-muted-foreground\">\n                      No views created yet. Use the SQL Engine to create your first view.\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  views.map((view) => (\n                    <TableRow key={view.id} className=\"group\">\n                      <TableCell>\n                        <div className=\"font-medium\">{view.name}</div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"text-sm text-muted-foreground max-w-xs truncate\">\n                          {view.description}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"font-mono text-sm\">\n                          {view.rowCount ? view.rowCount.toLocaleString() : \"‚Äî\"}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {formatDate(view.createdAt)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {view.lastExecuted ? formatDate(view.lastExecuted) : 'Never'}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-1\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => executeViewMutation.mutate(view.id)}\n                            disabled={executeViewMutation.isPending}\n                            data-testid={`button-run-view-${view.id}`}\n                          >\n                            <Play className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            data-testid={`button-edit-view-${view.id}`}\n                          >\n                            <Code className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => deleteViewMutation.mutate(view.id)}\n                            disabled={deleteViewMutation.isPending}\n                            data-testid={`button-delete-view-${view.id}`}\n                          >\n                            <Trash2 className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\n// SQL Engine Tab Component\nconst SQLEngineTab = () => {\n  const [sqlQuery, setSqlQuery] = useState(\"SELECT * FROM sales_data LIMIT 10;\");\n  const [queryResults, setQueryResults] = useState<any>(null);\n  const [viewName, setViewName] = useState(\"\");\n  const [viewDescription, setViewDescription] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: dataSources = [] } = useQuery({\n    queryKey: [\"/api/data-sources\"],\n    queryFn: () => getDataSources(),\n  });\n\n  const executeSQLMutation = useMutation({\n    mutationFn: (query: string) => executeSQLQuery(query),\n    onSuccess: (result) => {\n      setQueryResults(result);\n      toast({\n        title: \"Query executed successfully\",\n        description: `Returned ${result.rowCount || 0} rows in ${result.executionTime || 0}ms`,\n      });\n    },\n    onError: (error: any) => {\n      console.error('SQL execution error:', error);\n      setQueryResults({\n        columns: ['Error'],\n        rows: [['Query execution failed: ' + (error.message || 'Unknown error')]],\n        rowCount: 0,\n        executionTime: 0\n      });\n      toast({\n        title: \"Query execution failed\",\n        description: error.message || 'Unknown error occurred',\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleExecuteQuery = () => {\n    if (!sqlQuery.trim()) {\n      toast({\n        title: \"No query to execute\",\n        description: \"Please enter a SQL query\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    executeSQLMutation.mutate(sqlQuery);\n  };\n\n  const handleSaveView = () => {\n    if (!viewName.trim()) {\n      alert(\"Please enter a view name\");\n      return;\n    }\n    \n    // Here you would save the view to the backend\n    alert(`View \"${viewName}\" saved successfully!`);\n    setViewName(\"\");\n    setViewDescription(\"\");\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Data Sources Reference */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Database className=\"h-5 w-5\" />\n            Available Data Sources\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            {dataSources.map((source) => {\n              const isTableDataset = source.metadata?.isTableDataset;\n              const tableName = isTableDataset \n                ? `${source.metadata.schemaName}.${source.metadata.tableName}`\n                : source.name.toLowerCase().replace(/\\s+/g, '_');\n              \n              const displayName = isTableDataset \n                ? `${source.metadata.schemaName}.${source.metadata.tableName}`\n                : source.name;\n                \n              const subtitle = isTableDataset \n                ? `${source.metadata.parentConnection} ‚Ä¢ ${source.metadata.tableType}`\n                : `${source.type.toUpperCase()} ‚Ä¢ ${source.rowCount?.toLocaleString() || 0} rows`;\n\n              return (\n                <div\n                  key={source.id}\n                  className=\"p-3 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors\"\n                  onClick={() => setSqlQuery(`SELECT * FROM ${tableName} LIMIT 10;`)}\n                  data-testid={`source-${source.id}`}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    {isTableDataset ? (\n                      <TableProperties className=\"h-4 w-4 text-primary\" />\n                    ) : source.type === 'csv' ? (\n                      <FileText className=\"h-4 w-4 text-primary\" />\n                    ) : (\n                      <Database className=\"h-4 w-4 text-primary\" />\n                    )}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium text-sm truncate\">{displayName}</div>\n                      <div className=\"text-xs text-muted-foreground truncate\">\n                        {subtitle}\n                      </div>\n                      {source.rowCount && (\n                        <div className=\"text-xs text-muted-foreground mt-1\">\n                          {source.rowCount.toLocaleString()} rows\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* SQL Query Editor */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Code className=\"h-5 w-5\" />\n            SQL Query Editor\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Textarea\n              placeholder=\"Enter your SQL query here...\"\n              value={sqlQuery}\n              onChange={(e) => setSqlQuery(e.target.value)}\n              className=\"font-mono min-h-32\"\n              data-testid=\"textarea-sql-query\"\n            />\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Button\n              onClick={handleExecuteQuery}\n              disabled={executeSQLMutation.isPending || !sqlQuery.trim()}\n              data-testid=\"button-execute-query\"\n            >\n              <Play className=\"mr-2 h-4 w-4\" />\n              {executeSQLMutation.isPending ? 'Executing...' : 'Execute Query'}\n            </Button>\n            \n            {queryResults && (\n              <Dialog>\n                <DialogTrigger asChild>\n                  <Button variant=\"outline\" data-testid=\"button-save-as-view\">\n                    <Save className=\"mr-2 h-4 w-4\" />\n                    Save as View\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Save Query as View</DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium mb-2\">View Name</label>\n                      <Input\n                        placeholder=\"Enter view name...\"\n                        value={viewName}\n                        onChange={(e) => setViewName(e.target.value)}\n                        data-testid=\"input-view-name\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium mb-2\">Description (Optional)</label>\n                      <Textarea\n                        placeholder=\"Describe what this view shows...\"\n                        value={viewDescription}\n                        onChange={(e) => setViewDescription(e.target.value)}\n                        data-testid=\"textarea-view-description\"\n                      />\n                    </div>\n                    <Button onClick={handleSaveView} className=\"w-full\" data-testid=\"button-confirm-save-view\">\n                      Save View\n                    </Button>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Query Results */}\n      {queryResults && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TableProperties className=\"h-5 w-5\" />\n              Query Results\n            </CardTitle>\n            <div className=\"text-sm text-muted-foreground\">\n              {queryResults.rowCount} rows returned in {queryResults.executionTime}ms\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"border rounded-lg overflow-hidden\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    {(queryResults.columns || []).map((column: string, index: number) => (\n                      <TableHead key={index}>{column}</TableHead>\n                    ))}\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {(queryResults.rows || []).map((row: string[], rowIndex: number) => (\n                    <TableRow key={rowIndex}>\n                      {(row || []).map((cell: string, cellIndex: number) => (\n                        <TableCell key={cellIndex} className=\"font-mono text-sm\">\n                          {cell}\n                        </TableCell>\n                      ))}\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n            {queryResults.rowCount > (queryResults.rows || []).length && (\n              <div className=\"text-center text-sm text-muted-foreground mt-4\">\n                Showing {(queryResults.rows || []).length} of {queryResults.rowCount} rows\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n\n// Main NEX House Component\nexport default function DatasetsPage() {\n  return (\n    <div className=\"p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">NEX House</h2>\n          <p className=\"text-muted-foreground\">\n            Data management, views, and SQL query engine\n          </p>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"datasets\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"datasets\" data-testid=\"tab-datasets\">\n            <Database className=\"mr-2 h-4 w-4\" />\n            Datasets\n          </TabsTrigger>\n          <TabsTrigger value=\"views\" data-testid=\"tab-views\">\n            <Eye className=\"mr-2 h-4 w-4\" />\n            Views\n          </TabsTrigger>\n          <TabsTrigger value=\"sql-engine\" data-testid=\"tab-sql-engine\">\n            <Code className=\"mr-2 h-4 w-4\" />\n            SQL Engine\n          </TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"datasets\" className=\"mt-6\">\n          <DatasetsTab />\n        </TabsContent>\n        \n        <TabsContent value=\"views\" className=\"mt-6\">\n          <ViewsTab />\n        </TabsContent>\n        \n        <TabsContent value=\"sql-engine\" className=\"mt-6\">\n          <SQLEngineTab />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":31064},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/chart-config/PieChartConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\n\ninterface PieChartConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function PieChartConfig({ config, onChange, columns = [] }: PieChartConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"category\">Category Field</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.category || \"\"}\n            onValueChange={(value) => updateConfig(\"category\", value)}\n          >\n            <SelectTrigger id=\"category\" data-testid=\"select-category\">\n              <SelectValue placeholder=\"Select category column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"category\"\n            placeholder=\"Select a dataset first\"\n            value={config.category || \"\"}\n            disabled\n            data-testid=\"input-category\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Column for slice labels\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"value\">Value Field</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.value || \"\"}\n            onValueChange={(value) => updateConfig(\"value\", value)}\n          >\n            <SelectTrigger id=\"value\" data-testid=\"select-value\">\n              <SelectValue placeholder=\"Select value column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"value\"\n            placeholder=\"Select a dataset first\"\n            value={config.value || \"\"}\n            disabled\n            data-testid=\"input-value\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Metric for slice sizes\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"limit\">Limit (Top N)</Label>\n        <Input\n          id=\"limit\"\n          type=\"number\"\n          min=\"1\"\n          max=\"20\"\n          placeholder=\"10\"\n          value={config.limit || \"\"}\n          onChange={(e) => updateConfig(\"limit\", e.target.value)}\n          data-testid=\"input-limit\"\n        />\n        <p className=\"text-xs text-muted-foreground\">\n          Show top N slices (leave empty for all)\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"donutMode\">Chart Style</Label>\n        <Select\n          value={config.donutMode ? \"donut\" : \"pie\"}\n          onValueChange={(value) => updateConfig(\"donutMode\", value === \"donut\")}\n        >\n          <SelectTrigger id=\"donutMode\" data-testid=\"select-chart-style\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"pie\">Pie Chart</SelectItem>\n            <SelectItem value=\"donut\">Donut Chart</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-0.5\">\n          <Label htmlFor=\"showLabels\">Show Labels</Label>\n          <p className=\"text-xs text-muted-foreground\">\n            Display labels on slices\n          </p>\n        </div>\n        <Switch\n          id=\"showLabels\"\n          checked={config.showLabels !== false}\n          onCheckedChange={(checked) => updateConfig(\"showLabels\", checked)}\n          data-testid=\"switch-show-labels\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-0.5\">\n          <Label htmlFor=\"showPercentages\">Show Percentages</Label>\n          <p className=\"text-xs text-muted-foreground\">\n            Display percentage values\n          </p>\n        </div>\n        <Switch\n          id=\"showPercentages\"\n          checked={config.showPercentages || false}\n          onCheckedChange={(checked) => updateConfig(\"showPercentages\", checked)}\n          data-testid=\"switch-show-percentages\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"labelDisplay\">Label Position</Label>\n        <Select\n          value={config.labelDisplay || \"outside\"}\n          onValueChange={(value) => updateConfig(\"labelDisplay\", value)}\n        >\n          <SelectTrigger id=\"labelDisplay\" data-testid=\"select-label-display\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"outside\">Outside Slices</SelectItem>\n            <SelectItem value=\"inside\">Inside Slices</SelectItem>\n            <SelectItem value=\"hover\">Show on Hover Only</SelectItem>\n            <SelectItem value=\"none\">Hidden</SelectItem>\n          </SelectContent>\n        </Select>\n        <p className=\"text-xs text-muted-foreground\">\n          Where to display slice labels\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"valueFormat\">Value Format</Label>\n        <Select\n          value={config.valueFormat || \"value\"}\n          onValueChange={(value) => updateConfig(\"valueFormat\", value)}\n        >\n          <SelectTrigger id=\"valueFormat\" data-testid=\"select-value-format\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"value\">Actual Values</SelectItem>\n            <SelectItem value=\"percentage\">Percentages Only</SelectItem>\n            <SelectItem value=\"both\">Values & Percentages</SelectItem>\n          </SelectContent>\n        </Select>\n        <p className=\"text-xs text-muted-foreground\">\n          How to format displayed values\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6464},"client/src/pages/charts-page.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport {\n  TrendingUp,\n  Brain,\n  MoreHorizontal,\n  Search,\n  ChevronDown,\n  ChevronRight,\n  Sparkles,\n  Trophy,\n  Box,\n} from \"lucide-react\";\nimport {\n  BigNumberIcon,\n  TrendlineIcon,\n  GaugeIcon,\n  BarChartIcon,\n  StackedBarIcon,\n  GroupedBarIcon,\n  LineChartIcon,\n  MultiLineIcon,\n  AreaChartIcon,\n  PieChartIcon,\n  DonutChartIcon,\n  ScatterPlotIcon,\n  BubbleChartIcon,\n  HeatmapIcon,\n  TableIcon,\n  FunnelIcon,\n  SankeyIcon,\n  TreemapIcon,\n  RadarIcon,\n  MapIcon,\n  WaterfallIcon,\n  BoxPlotIcon,\n  HistogramIcon,\n  SunburstIcon,\n  MultiValueCardIcon,\n} from \"@/components/icons/chart-icons\";\nimport {\n  CHART_CATALOG,\n  getCategories,\n  getTags,\n  searchCharts,\n  getChartsByCategory,\n  type ChartCategory,\n  type ChartType,\n} from \"@/lib/chart-catalog\";\n\nconst categoryIcons: Record<string, any> = {\n  Popular: Sparkles,\n  KPI: GaugeIcon,\n  Distribution: BarChartIcon,\n  Evolution: TrendingUp,\n  Correlation: ScatterPlotIcon,\n  \"Part of a Whole\": PieChartIcon,\n  Ranking: Trophy,\n  Map: MapIcon,\n  Flow: FunnelIcon,\n  Table: TableIcon,\n  \"Advanced-Analytics\": Brain,\n  Other: MoreHorizontal,\n};\n\nconst chartTypeIcons: Record<string, any> = {\n  big_number: BigNumberIcon,\n  big_number_trendline: TrendlineIcon,\n  gauge: GaugeIcon,\n  bar: BarChartIcon,\n  stacked_bar: StackedBarIcon,\n  grouped_bar: GroupedBarIcon,\n  line: LineChartIcon,\n  multi_line: MultiLineIcon,\n  smooth_line: LineChartIcon,\n  stepped_line: LineChartIcon,\n  area: AreaChartIcon,\n  stacked_area: AreaChartIcon,\n  pie: PieChartIcon,\n  donut: DonutChartIcon,\n  scatter: ScatterPlotIcon,\n  bubble: BubbleChartIcon,\n  heatmap: HeatmapIcon,\n  calendar_heatmap: HeatmapIcon,\n  boxplot: BoxPlotIcon,\n  histogram: HistogramIcon,\n  table: TableIcon,\n  pivot_table: TableIcon,\n  country_map: MapIcon,\n  geojson_map: MapIcon,\n  funnel: FunnelIcon,\n  sankey: SankeyIcon,\n  treemap: TreemapIcon,\n  sunburst: SunburstIcon,\n  waterfall: WaterfallIcon,\n  radar: RadarIcon,\n  multi_value_card: MultiValueCardIcon,\n};\n\ninterface ChartsPageProps {\n  onNavigateToBuilder?: (chartType: string) => void;\n}\n\nexport default function ChartsPage({ onNavigateToBuilder }: ChartsPageProps) {\n  const [, setLocation] = useLocation();\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"All charts\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [tagsExpanded, setTagsExpanded] = useState(false);\n\n  const categories = useMemo(() => getCategories(), []);\n  const tags = useMemo(() => getTags(), []);\n\n  // Get chart counts for each category\n  const categoryCounts = useMemo(() => {\n    const counts: Record<string, number> = { \"All charts\": CHART_CATALOG.length };\n    categories.forEach((cat) => {\n      counts[cat] = getChartsByCategory(cat).length;\n    });\n    return counts;\n  }, [categories]);\n\n  // Filter charts based on selected category and search query\n  const filteredCharts = useMemo(() => {\n    let charts = CHART_CATALOG;\n\n    // Filter by category\n    if (selectedCategory !== \"All charts\") {\n      charts = getChartsByCategory(selectedCategory as ChartCategory);\n    }\n\n    // Filter by search query\n    if (searchQuery.trim()) {\n      charts = searchCharts(searchQuery).filter((chart) => {\n        if (selectedCategory === \"All charts\") return true;\n        return chart.category.includes(selectedCategory as ChartCategory);\n      });\n    }\n\n    return charts;\n  }, [selectedCategory, searchQuery]);\n\n  const handleChartClick = (chart: ChartType) => {\n    if (onNavigateToBuilder) {\n      onNavigateToBuilder(chart.id);\n    } else {\n      setLocation(`/chart-builder?type=${chart.id}`);\n    }\n  };\n\n  const getChartIcon = (chartId: string) => {\n    return chartTypeIcons[chartId] || BarChartIcon;\n  };\n\n  return (\n    <div className=\"flex h-screen bg-background\">\n      {/* Left Sidebar */}\n      <div className=\"w-64 border-r border-border bg-card\">\n        <ScrollArea className=\"h-full\">\n          <div className=\"p-4 space-y-4\">\n            {/* All Charts Button */}\n            <Button\n              variant={selectedCategory === \"All charts\" ? \"default\" : \"ghost\"}\n              className=\"w-full justify-start\"\n              onClick={() => setSelectedCategory(\"All charts\")}\n              data-testid=\"button-category-all-charts\"\n            >\n              <Box className=\"mr-2 h-4 w-4\" />\n              All charts\n              <span className=\"ml-auto text-xs opacity-70\">\n                {categoryCounts[\"All charts\"]}\n              </span>\n            </Button>\n\n            {/* Recommended Tags Section */}\n            <div className=\"space-y-2\">\n              <Collapsible open={tagsExpanded} onOpenChange={setTagsExpanded}>\n                <CollapsibleTrigger\n                  className=\"flex items-center w-full text-sm font-medium text-muted-foreground hover:text-foreground transition-colors\"\n                  data-testid=\"button-toggle-tags\"\n                >\n                  {tagsExpanded ? (\n                    <ChevronDown className=\"mr-2 h-3 w-3\" />\n                  ) : (\n                    <ChevronRight className=\"mr-2 h-3 w-3\" />\n                  )}\n                  Recommended tags\n                </CollapsibleTrigger>\n                <CollapsibleContent className=\"mt-2 space-y-1\">\n                  {tags.map((tag) => (\n                    <Button\n                      key={tag}\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"w-full justify-start text-xs pl-6\"\n                      data-testid={`button-tag-${tag}`}\n                    >\n                      # {tag}\n                    </Button>\n                  ))}\n                </CollapsibleContent>\n              </Collapsible>\n            </div>\n\n            {/* Category Section */}\n            <div className=\"space-y-2\">\n              <h3 className=\"text-sm font-medium text-muted-foreground px-2\">Category</h3>\n              <div className=\"space-y-1\">\n                {categories.map((category) => {\n                  const IconComponent = categoryIcons[category] || MoreHorizontal;\n                  return (\n                    <Button\n                      key={category}\n                      variant={selectedCategory === category ? \"secondary\" : \"ghost\"}\n                      className=\"w-full justify-start\"\n                      onClick={() => setSelectedCategory(category)}\n                      data-testid={`button-category-${category.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                    >\n                      <IconComponent className=\"mr-2 h-4 w-4\" />\n                      {category}\n                      <span className=\"ml-auto text-xs opacity-70\">\n                        {categoryCounts[category] || 0}\n                      </span>\n                    </Button>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n        </ScrollArea>\n      </div>\n\n      {/* Main Content Area */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Search Bar */}\n        <div className=\"p-6 border-b border-border bg-card\">\n          <div className=\"relative max-w-2xl\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              type=\"text\"\n              placeholder=\"Search all charts\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-chart-search\"\n            />\n          </div>\n        </div>\n\n        {/* Chart Grid */}\n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-6\">\n            {filteredCharts.length > 0 ? (\n              <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n                {filteredCharts.map((chart) => {\n                  const IconComponent = getChartIcon(chart.id);\n                  return (\n                    <Card\n                      key={chart.id}\n                      className=\"group cursor-pointer hover:shadow-lg hover:border-primary/50 transition-all duration-200\"\n                      onClick={() => handleChartClick(chart)}\n                      data-testid={`card-chart-${chart.id}`}\n                    >\n                      <CardContent className=\"p-4 space-y-3\">\n                        {/* Chart Icon/Thumbnail */}\n                        <div className=\"aspect-square bg-gradient-to-br from-primary/10 to-secondary/10 rounded-lg flex items-center justify-center group-hover:from-primary/20 group-hover:to-secondary/20 transition-colors\">\n                          <IconComponent className=\"h-12 w-12 text-primary/70\" />\n                        </div>\n\n                        {/* Chart Info */}\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <h3 className=\"text-sm font-medium leading-tight line-clamp-2\">\n                              {chart.name}\n                            </h3>\n                            {chart.isDeprecated && (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"text-xs shrink-0 border-orange-500 text-orange-500\"\n                                data-testid={`badge-deprecated-${chart.id}`}\n                              >\n                                DEPRECATED\n                              </Badge>\n                            )}\n                          </div>\n                          {chart.requiresPlugin && (\n                            <Badge\n                              variant=\"outline\"\n                              className=\"text-xs border-blue-500 text-blue-500\"\n                            >\n                              Plugin\n                            </Badge>\n                          )}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n                <Search className=\"h-12 w-12 text-muted-foreground/50 mb-4\" />\n                <h3 className=\"text-lg font-medium text-muted-foreground mb-2\">\n                  No charts found\n                </h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Try adjusting your search or selecting a different category\n                </p>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </div>\n    </div>\n  );\n}\n","size_bytes":11082},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/hooks/use-auth.tsx":{"content":"import { createContext, ReactNode, useContext } from \"react\";\nimport {\n  useQuery,\n  useMutation,\n  UseMutationResult,\n} from \"@tanstack/react-query\";\nimport { insertUserSchema, User as SelectUser, InsertUser } from \"@shared/schema\";\nimport { getQueryFn, apiRequest, queryClient } from \"../lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype AuthContextType = {\n  user: SelectUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  loginMutation: UseMutationResult<SelectUser, Error, LoginData>;\n  logoutMutation: UseMutationResult<void, Error, void>;\n  registerMutation: UseMutationResult<SelectUser, Error, InsertUser>;\n};\n\ntype LoginData = {\n  email: string;\n  password: string;\n};\n\nexport const AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const { toast } = useToast();\n  \n  const {\n    data: user,\n    error,\n    isLoading,\n  } = useQuery<SelectUser | undefined, Error>({\n    queryKey: [\"/api/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginData) => {\n      const res = await apiRequest(\"POST\", \"/api/login\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n      toast({\n        title: \"Welcome back!\",\n        description: \"You have successfully logged in.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (credentials: InsertUser) => {\n      const res = await apiRequest(\"POST\", \"/api/register\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n      toast({\n        title: \"Welcome to NEX AI!\",\n        description: \"Your account has been created successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/logout\");\n    },\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/user\"], null);\n      queryClient.clear();\n      toast({\n        title: \"Goodbye!\",\n        description: \"You have been logged out successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Logout failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user: user ?? null,\n        isLoading,\n        error,\n        loginMutation,\n        logoutMutation,\n        registerMutation,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":3218},"client/src/components/dashboard/chart-container.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ExpandIcon } from \"lucide-react\";\nimport {\n  LineChart,\n  Line,\n  BarChart,\n  Bar,\n  PieChart,\n  Pie,\n  Cell,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n} from \"recharts\";\nimport { Heatmap } from \"@/components/charts/heatmap\";\n\ninterface ChartContainerProps {\n  title: string;\n  type: \"line\" | \"bar\" | \"pie\" | \"table\" | \"heatmap\";\n  data: any[];\n  showTitle?: boolean;\n  onExpand?: () => void;\n}\n\nconst COLORS = [\n  '#3b82f6', // Blue\n  '#10b981', // Green\n  '#f59e0b', // Amber\n  '#ef4444', // Red\n  '#8b5cf6', // Purple\n  '#ec4899', // Pink\n  '#06b6d4', // Cyan\n  '#84cc16', // Lime\n];\n\nexport default function ChartContainer({ \n  title, \n  type, \n  data, \n  showTitle = true,\n  onExpand \n}: ChartContainerProps) {\n  const formatValue = (value: any) => {\n    if (typeof value === 'number') {\n      if (value >= 1000000) {\n        return `‚Çπ${(value / 1000000).toFixed(1)}M`;\n      }\n      if (value >= 1000) {\n        return `‚Çπ${(value / 1000).toFixed(0)}K`;\n      }\n      return `‚Çπ${value.toLocaleString()}`;\n    }\n    return value;\n  };\n\n  const renderChart = () => {\n    if (!data || data.length === 0) {\n      return (\n        <div className=\"h-64 flex items-center justify-center text-muted-foreground\">\n          No data available\n        </div>\n      );\n    }\n\n    switch (type) {\n      case \"line\":\n        return (\n          <ResponsiveContainer width=\"100%\" height={300}>\n            <LineChart data={data}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n              <XAxis \n                dataKey=\"name\" \n                stroke=\"#6b7280\"\n                fontSize={12}\n              />\n              <YAxis \n                stroke=\"#6b7280\"\n                fontSize={12}\n                tickFormatter={formatValue}\n              />\n              <Tooltip \n                contentStyle={{\n                  backgroundColor: '#ffffff',\n                  border: '1px solid #e5e7eb',\n                  borderRadius: '6px',\n                  color: '#1f2937'\n                }}\n                formatter={(value: any) => [formatValue(value), 'Value']}\n              />\n              <Line \n                type=\"monotone\" \n                dataKey=\"value\" \n                stroke=\"#3b82f6\"\n                strokeWidth={2}\n                dot={{ fill: \"#3b82f6\", strokeWidth: 2, r: 4 }}\n                activeDot={{ r: 6, stroke: \"#3b82f6\", strokeWidth: 2 }}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        );\n\n      case \"bar\":\n        return (\n          <ResponsiveContainer width=\"100%\" height={300}>\n            <BarChart data={data}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n              <XAxis \n                dataKey=\"name\" \n                stroke=\"#6b7280\"\n                fontSize={12}\n              />\n              <YAxis \n                stroke=\"#6b7280\"\n                fontSize={12}\n                tickFormatter={formatValue}\n              />\n              <Tooltip \n                contentStyle={{\n                  backgroundColor: '#ffffff',\n                  border: '1px solid #e5e7eb',\n                  borderRadius: '6px',\n                  color: '#1f2937'\n                }}\n                formatter={(value: any) => [formatValue(value), 'Value']}\n              />\n              <Bar \n                dataKey=\"value\" \n                fill=\"#3b82f6\"\n                radius={[4, 4, 0, 0]}\n              />\n            </BarChart>\n          </ResponsiveContainer>\n        );\n\n      case \"pie\":\n        return (\n          <ResponsiveContainer width=\"100%\" height={300}>\n            <PieChart>\n              <Pie\n                data={data}\n                cx=\"50%\"\n                cy=\"50%\"\n                labelLine={false}\n                label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                outerRadius={80}\n                fill=\"#8884d8\"\n                dataKey=\"value\"\n              >\n                {data.map((entry, index) => (\n                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                ))}\n              </Pie>\n              <Tooltip \n                contentStyle={{\n                  backgroundColor: '#ffffff',\n                  border: '1px solid #e5e7eb',\n                  borderRadius: '6px',\n                  color: '#1f2937'\n                }}\n                formatter={(value: any) => [formatValue(value), 'Value']} \n              />\n            </PieChart>\n          </ResponsiveContainer>\n        );\n\n      case \"table\":\n        return (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead>\n                <tr className=\"border-b border-border\">\n                  {Object.keys(data[0] || {}).map((key) => (\n                    <th key={key} className=\"text-left p-2 font-medium\">\n                      {key}\n                    </th>\n                  ))}\n                </tr>\n              </thead>\n              <tbody>\n                {data.map((row, index) => (\n                  <tr key={index} className=\"border-b border-border/50\">\n                    {Object.values(row).map((value: any, i) => (\n                      <td key={i} className=\"p-2\">\n                        {typeof value === 'number' ? formatValue(value) : String(value)}\n                      </td>\n                    ))}\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        );\n\n      case \"heatmap\":\n        return <Heatmap data={data} />;\n\n      default:\n        return (\n          <div className=\"h-64 flex items-center justify-center text-muted-foreground\">\n            Unsupported chart type\n          </div>\n        );\n    }\n  };\n\n  return (\n    <Card className=\"w-full bg-white dark:bg-white\">\n      {showTitle && (\n        <CardHeader className=\"pb-2\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-lg\">{title}</CardTitle>\n            {onExpand && (\n              <Button \n                size=\"sm\" \n                variant=\"ghost\"\n                onClick={onExpand}\n                data-testid=\"button-expand-chart\"\n              >\n                <ExpandIcon className=\"h-4 w-4\" />\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n      )}\n      <CardContent className={showTitle ? \"pt-2\" : \"p-6\"}>\n        {/* White background for better chart visibility */}\n        <div className=\"bg-white dark:bg-white p-4 rounded-lg\">\n          {renderChart()}\n        </div>\n        {showTitle && (\n          <div className=\"mt-3 text-sm text-muted-foreground\">\n            Last updated 2 minutes ago\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":6950},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"attached_assets/page_1758734428843.tsx":{"content":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { listCSVs, uploadCSV, queryCSV } from \"@/lib/api\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function DataPage() {\r\n  const router = useRouter();\r\n\r\n  const [files, setFiles] = useState<string[]>([]);\r\n  const [selected, setSelected] = useState(\"\");\r\n  const [q, setQ] = useState(\"\");\r\n  const [resultText, setResultText] = useState(\"\");\r\n  const [tableHtml, setTableHtml] = useState<string>(\"\");\r\n  const [img, setImg] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // üîí Client-side guard to handle forward/back cache\r\n  useEffect(() => {\r\n    const hasCookie = document.cookie.split(\"; \").some((c) => c.startsWith(\"nex_token=\"));\r\n    const hasLocal = !!localStorage.getItem(\"nex_token\");\r\n    if (!hasCookie && !hasLocal) {\r\n      router.replace(\"/login?next=/data\");\r\n    }\r\n  }, [router]);\r\n\r\n  async function refresh() {\r\n    const res = await listCSVs();\r\n    setFiles(res.files || []);\r\n    if (!selected && res.files?.length) setSelected(res.files[0]);\r\n  }\r\n\r\n  useEffect(() => {\r\n    refresh();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function handleUpload(e: React.ChangeEvent<HTMLInputElement>) {\r\n    const f = e.target.files?.[0];\r\n    if (!f) return;\r\n    await uploadCSV(f);\r\n    await refresh();\r\n  }\r\n\r\n  async function runQuery() {\r\n    if (!q || !selected) return;\r\n    setLoading(true);\r\n    setImg(null);\r\n    setTableHtml(\"\");\r\n    setResultText(\"\");\r\n\r\n    try {\r\n      const res = await queryCSV(q, selected);\r\n\r\n      // 1) Chart image\r\n      if (\"imageUrl\" in res) {\r\n        setImg(res.imageUrl);\r\n        return;\r\n      }\r\n\r\n      // 2) HTML table\r\n      if (\"html\" in res) {\r\n        setTableHtml(res.html || \"\");\r\n        return;\r\n      }\r\n\r\n      // 3) Text-only normalization\r\n      const msg =\r\n        (res?.summary && res.summary !== \"Error occurred\")\r\n          ? res.summary\r\n          : (typeof res?.result === \"string\"\r\n              ? res.result\r\n              : (res?.message ?? (res ? JSON.stringify(res, null, 2) : \"\")));\r\n\r\n      setResultText(String(msg ?? \"\"));\r\n    } catch (e: any) {\r\n      setResultText(`Error: ${e.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main className=\"min-h-dvh bg-gray-950 text-white p-6\">\r\n      <div className=\"max-w-5xl mx-auto space-y-6\">\r\n        <h1 className=\"text-2xl font-semibold\">Data</h1>\r\n\r\n        {/* Upload */}\r\n        <div className=\"rounded-2xl border border-white/10 p-5\">\r\n          <label className=\"block text-sm text-white/70 mb-2\">Upload CSV</label>\r\n          <input\r\n            type=\"file\"\r\n            accept=\".csv\"\r\n            onChange={handleUpload}\r\n            className=\"file:mr-4 file:rounded-lg file:border-0 file:bg-white/10 file:px-4 file:py-2 file:text-white hover:file:bg-white/20\"\r\n          />\r\n        </div>\r\n\r\n        {/* File + Query */}\r\n        <div className=\"rounded-2xl border border-white/10 p-5 grid md:grid-cols-3 gap-4\">\r\n          <div className=\"space-y-3\">\r\n            <label className=\"block text-sm text-white/70\">Choose file</label>\r\n            {/* Native select with readable colors */}\r\n            <select\r\n              value={selected}\r\n              onChange={(e) => setSelected(e.target.value)}\r\n              className=\"w-full rounded-lg bg-white text-black border border-white/10 p-2\"\r\n            >\r\n              <option value=\"\" className=\"text-black\">-- Select --</option>\r\n              {files.map((f) => (\r\n                <option key={f} value={f} className=\"text-black\">{f}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"md:col-span-2 space-y-3\">\r\n            <label className=\"block text-sm text-white/70\">Ask a data question</label>\r\n            <input\r\n              value={q}\r\n              onChange={(e) => setQ(e.target.value)}\r\n              placeholder=\"e.g., total sales by month table format\"\r\n              className=\"w-full rounded-lg bg-white/5 border border-white/10 p-2\"\r\n              onKeyDown={(e) => { if (e.key === \"Enter\") runQuery(); }}\r\n            />\r\n            <button\r\n              onClick={runQuery}\r\n              disabled={loading || !q || !selected}\r\n              className=\"rounded-lg bg-white/10 hover:bg-white/20 px-4 py-2\"\r\n            >\r\n              {loading ? \"Running...\" : \"Run\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Result */}\r\n        <div className=\"rounded-2xl border border-white/10 p-5\">\r\n          <h2 className=\"text-lg font-medium\">Result</h2>\r\n          <div className=\"mt-3\">\r\n            {img ? (\r\n              <img\r\n                src={img}\r\n                alt=\"chart\"\r\n                className=\"rounded-xl border border-white/10\"\r\n              />\r\n            ) : tableHtml ? (\r\n              <div\r\n                className=\"overflow-x-auto rounded-xl border border-white/10\"\r\n                dangerouslySetInnerHTML={{ __html: tableHtml }}\r\n              />\r\n            ) : (\r\n              <p className=\"text-sm text-white/90\">\r\n                {resultText || \"No result yet.\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n","size_bytes":5318},"client/src/components/chart/DrillDownModal.tsx":{"content":"import { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Download, Loader2 } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface DrillDownModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  chartId: string;\n  chartTitle: string;\n}\n\nexport function DrillDownModal({\n  isOpen,\n  onClose,\n  chartId,\n  chartTitle,\n}: DrillDownModalProps) {\n  const { toast } = useToast();\n\n  const { data, isLoading, isError, error } = useQuery<{ data: any[]; query: string; chartTitle: string }>({\n    queryKey: [\"/api/charts\", chartId, \"drill-down\"],\n    queryFn: async () => {\n      const response = await fetch(`/api/charts/${chartId}/drill-down`, {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ message: \"Failed to fetch data\" }));\n        throw new Error(errorData.message || \"Failed to fetch data\");\n      }\n      return response.json();\n    },\n    enabled: isOpen,\n  });\n\n  const handleExportCSV = () => {\n    if (!data?.data || data.data.length === 0) {\n      toast({\n        title: \"No data\",\n        description: \"No data available to export\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const headers = Object.keys(data.data[0]);\n    const csvContent = [\n      headers.join(\",\"),\n      ...data.data.map((row) =>\n        headers.map((header) => {\n          const value = row[header];\n          return typeof value === \"string\" && value.includes(\",\")\n            ? `\"${value}\"`\n            : value;\n        }).join(\",\")\n      ),\n    ].join(\"\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = `${chartTitle.replace(/\\s+/g, \"_\")}_data.csv`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Success\",\n      description: \"Data exported successfully\",\n    });\n  };\n\n  const columns = data?.data && data.data.length > 0 ? Object.keys(data.data[0]) : [];\n  const rows = data?.data || [];\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[80vh]\">\n        <DialogHeader>\n          <DialogTitle>{chartTitle} - Data View</DialogTitle>\n          <DialogDescription>\n            {data?.query && `Query: ${data.query}`}\n          </DialogDescription>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin\" />\n          </div>\n        ) : isError ? (\n          <div className=\"text-center py-12 text-destructive\">\n            <p className=\"font-medium\">Error loading data</p>\n            <p className=\"text-sm mt-2\">{error?.message || \"Failed to fetch chart data\"}</p>\n          </div>\n        ) : rows.length === 0 ? (\n          <div className=\"text-center py-12 text-muted-foreground\">\n            No data available\n          </div>\n        ) : (\n          <>\n            <div className=\"flex justify-end mb-2\">\n              <Button\n                onClick={handleExportCSV}\n                variant=\"outline\"\n                size=\"sm\"\n                data-testid=\"button-export-csv\"\n              >\n                <Download className=\"mr-2 h-4 w-4\" />\n                Export CSV ({rows.length} rows)\n              </Button>\n            </div>\n\n            <ScrollArea className=\"h-[400px]\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    {columns.map((col) => (\n                      <TableHead key={col}>{col}</TableHead>\n                    ))}\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {rows.map((row, idx) => (\n                    <TableRow key={idx}>\n                      {columns.map((col) => (\n                        <TableCell key={col}>{row[col]?.toString() || \"-\"}</TableCell>\n                      ))}\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </ScrollArea>\n          </>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":4681},"client/src/components/chart-config/TableConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { X } from \"lucide-react\";\n\ninterface TableConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function TableConfig({ config, onChange, columns = [] }: TableConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  const selectedColumns: string[] = config.columns || [];\n\n  const toggleColumn = (column: string) => {\n    const updated = selectedColumns.includes(column)\n      ? selectedColumns.filter(col => col !== column)\n      : [...selectedColumns, column];\n    updateConfig(\"columns\", updated);\n  };\n\n  const removeColumn = (column: string) => {\n    updateConfig(\"columns\", selectedColumns.filter(col => col !== column));\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label>Columns to Display</Label>\n        {columns.length > 0 ? (\n          <>\n            <div className=\"border rounded-md p-3 space-y-2 max-h-48 overflow-y-auto\">\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <div key={col} className=\"flex items-center space-x-2\">\n                  <Checkbox\n                    id={`col-${col}`}\n                    checked={selectedColumns.includes(col)}\n                    onCheckedChange={() => toggleColumn(col)}\n                    data-testid={`checkbox-column-${col}`}\n                  />\n                  <label\n                    htmlFor={`col-${col}`}\n                    className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex-1\"\n                  >\n                    {col}\n                  </label>\n                </div>\n              ))}\n            </div>\n            {selectedColumns.length > 0 && (\n              <div className=\"flex flex-wrap gap-2 mt-2\">\n                {selectedColumns.map((col) => (\n                  <Badge key={col} variant=\"secondary\" className=\"gap-1\">\n                    {col}\n                    <X\n                      className=\"h-3 w-3 cursor-pointer hover:text-destructive\"\n                      onClick={() => removeColumn(col)}\n                      data-testid={`button-remove-column-${col}`}\n                    />\n                  </Badge>\n                ))}\n              </div>\n            )}\n          </>\n        ) : (\n          <div className=\"border rounded-md p-3 text-sm text-muted-foreground\">\n            Select a dataset first to see available columns\n          </div>\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Select which columns to display in the table\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"orderBy\">Order By</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.orderBy || \"\"}\n            onValueChange={(value) => updateConfig(\"orderBy\", value)}\n          >\n            <SelectTrigger id=\"orderBy\" data-testid=\"select-order-by\">\n              <SelectValue placeholder=\"Select column to order by\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"\">None</SelectItem>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"orderBy\"\n            placeholder=\"Select a dataset first\"\n            value={config.orderBy || \"\"}\n            disabled\n            data-testid=\"input-order-by\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Column to sort the table by\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"limit\">Row Limit</Label>\n        <Input\n          id=\"limit\"\n          type=\"number\"\n          placeholder=\"e.g., 100\"\n          value={config.limit || \"\"}\n          onChange={(e) => updateConfig(\"limit\", e.target.value)}\n          data-testid=\"input-limit\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Label htmlFor=\"pagination\">Enable Pagination</Label>\n        <Switch\n          id=\"pagination\"\n          checked={config.pagination || false}\n          onCheckedChange={(checked) => updateConfig(\"pagination\", checked)}\n          data-testid=\"switch-pagination\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Label htmlFor=\"search\">Enable Search</Label>\n        <Switch\n          id=\"search\"\n          checked={config.search || false}\n          onCheckedChange={(checked) => updateConfig(\"search\", checked)}\n          data-testid=\"switch-search\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":5200},"client/src/components/database-connector-form.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Loader2, CheckCircle, XCircle, Database, Cloud, FileText, Zap, Server } from 'lucide-react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface DatabaseConnectorSpec {\n  name: string;\n  displayName: string;\n  description: string;\n  icon: string;\n  category: 'relational' | 'warehouse' | 'nosql' | 'timeseries' | 'file' | 'api';\n  requiresHost: boolean;\n  requiresPort: boolean;\n  requiresDatabase: boolean;\n  requiresCredentials: boolean;\n  defaultPort?: number;\n  connectionStringTemplate: string;\n  npmPackages: string[];\n  testQuery: string;\n  supportsSchema: boolean;\n  supportsSSL: boolean;\n}\n\ninterface DatabaseConnectionConfig {\n  host?: string;\n  port?: number;\n  database?: string;\n  username?: string;\n  password?: string;\n  sslMode?: 'require' | 'prefer' | 'allow' | 'disable';\n  projectId?: string;\n  account?: string;\n  region?: string;\n  warehouse?: string;\n  role?: string;\n  filePath?: string;\n  baseUrl?: string;\n  apiKey?: string;\n  options?: Record<string, any>;\n}\n\ninterface ConnectionTestResult {\n  success: boolean;\n  message: string;\n  latency?: number;\n  metadata?: {\n    serverVersion?: string;\n    schemas?: string[];\n  };\n}\n\nconst getCategoryIcon = (category: string) => {\n  switch (category) {\n    case 'relational': return Database;\n    case 'warehouse': return Cloud;\n    case 'file': return FileText;\n    case 'nosql': return Zap;\n    case 'api': return Server;\n    default: return Database;\n  }\n};\n\n// Dynamic schema based on connector requirements\nconst createConnectionSchema = (connector: DatabaseConnectorSpec | null) => {\n  if (!connector) return z.object({});\n\n  const schema: any = {};\n\n  if (connector.requiresHost) {\n    schema.host = z.string().min(1, 'Host is required');\n  }\n  if (connector.requiresPort) {\n    schema.port = z.number().min(1).max(65535);\n  }\n  if (connector.requiresDatabase) {\n    schema.database = z.string().min(1, 'Database is required');\n  }\n  if (connector.requiresCredentials) {\n    schema.username = z.string().min(1, 'Username is required');\n    schema.password = z.string().min(1, 'Password is required');\n  }\n\n  // Cloud-specific fields\n  if (connector.name === 'bigquery') {\n    schema.projectId = z.string().min(1, 'Project ID is required');\n  }\n  if (connector.name === 'snowflake') {\n    schema.account = z.string().min(1, 'Account is required');\n    schema.warehouse = z.string().min(1, 'Warehouse is required');\n    schema.role = z.string().optional();\n  }\n\n  // File-based\n  if (connector.category === 'file') {\n    schema.filePath = z.string().min(1, 'File path is required');\n  }\n\n  // SSL support\n  if (connector.supportsSSL) {\n    schema.sslMode = z.enum(['require', 'prefer', 'allow', 'disable']).optional();\n  }\n\n  return z.object(schema);\n};\n\ninterface DatabaseConnectorFormProps {\n  onSubmit: (name: string, type: string, config: DatabaseConnectionConfig) => void;\n  onFileUpload?: (file: File, name: string) => void;\n  isLoading?: boolean;\n}\n\nexport default function DatabaseConnectorForm({ onSubmit, onFileUpload, isLoading }: DatabaseConnectorFormProps) {\n  const [selectedConnector, setSelectedConnector] = useState<DatabaseConnectorSpec | null>(null);\n  const [connectionTest, setConnectionTest] = useState<ConnectionTestResult | null>(null);\n  const [isTestingConnection, setIsTestingConnection] = useState(false);\n  const [connectionName, setConnectionName] = useState('');\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const { toast } = useToast();\n\n  // Fetch available connectors\n  const { data: connectors = [], isLoading: loadingConnectors } = useQuery({\n    queryKey: ['/api/database-connectors'],\n  });\n\n  // Group connectors by category\n  const connectorsByCategory = (connectors as DatabaseConnectorSpec[]).reduce((acc: Record<string, DatabaseConnectorSpec[]>, connector: DatabaseConnectorSpec) => {\n    if (!acc[connector.category]) {\n      acc[connector.category] = [];\n    }\n    acc[connector.category].push(connector);\n    return acc;\n  }, {});\n\n  // Dynamic form schema based on selected connector\n  const connectionSchema = createConnectionSchema(selectedConnector);\n  const form = useForm({\n    resolver: zodResolver(connectionSchema),\n    defaultValues: selectedConnector?.defaultPort ? { port: selectedConnector.defaultPort } : {},\n  });\n\n  // Reset form when connector changes\n  useEffect(() => {\n    if (selectedConnector) {\n      const defaultValues: any = {};\n      if (selectedConnector.defaultPort) {\n        defaultValues.port = selectedConnector.defaultPort;\n      }\n      if (selectedConnector.supportsSSL) {\n        defaultValues.sslMode = 'prefer';\n      }\n      form.reset(defaultValues);\n      setConnectionTest(null);\n    }\n  }, [selectedConnector, form]);\n\n  // Test connection mutation\n  const testConnectionMutation = useMutation({\n    mutationFn: async (config: DatabaseConnectionConfig) => {\n      const response = await fetch('/api/database-connectors/test', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ type: selectedConnector?.name, config }),\n      });\n      return response.json();\n    },\n    onSuccess: (result: ConnectionTestResult) => {\n      setConnectionTest(result);\n      if (result.success) {\n        toast({\n          title: 'Connection Successful',\n          description: result.message,\n        });\n      } else {\n        toast({\n          title: 'Connection Failed',\n          description: result.message,\n          variant: 'destructive',\n        });\n      }\n    },\n    onError: (error) => {\n      const errorMessage = error instanceof Error ? error.message : 'Connection test failed';\n      setConnectionTest({\n        success: false,\n        message: errorMessage,\n      });\n      toast({\n        title: 'Connection Error',\n        description: errorMessage,\n        variant: 'destructive',\n      });\n    },\n    onSettled: () => {\n      setIsTestingConnection(false);\n    },\n  });\n\n  const handleTestConnection = () => {\n    if (!selectedConnector) return;\n    \n    const config = form.getValues();\n    setIsTestingConnection(true);\n    testConnectionMutation.mutate(config);\n  };\n\n  const handleFileUpload = () => {\n    if (!selectedConnector || !connectionName.trim()) {\n      toast({\n        title: 'Missing Information',\n        description: 'Please select a connector and provide a connection name',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    if (!selectedFile) {\n      toast({\n        title: 'No File Selected',\n        description: 'Please select a file to upload',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    if (onFileUpload) {\n      onFileUpload(selectedFile, connectionName);\n    }\n  };\n\n  const handleSubmit = (config: DatabaseConnectionConfig) => {\n    if (!selectedConnector || !connectionName.trim()) {\n      toast({\n        title: 'Missing Information',\n        description: 'Please select a connector and provide a connection name',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    if (!connectionTest?.success) {\n      toast({\n        title: 'Test Connection First',\n        description: 'Please test the connection before saving',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    onSubmit(connectionName, selectedConnector.name, config);\n  };\n\n  const renderConnectionFields = () => {\n    if (!selectedConnector) return null;\n\n    // File-based connectors show file upload interface\n    if (selectedConnector.category === 'file') {\n      return (\n        <div className=\"space-y-4\">\n          <div className=\"border-2 border-dashed rounded-lg p-8 text-center transition-colors hover:border-primary/50\">\n            <FileText className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-medium mb-2\">\n              Select your {selectedConnector.displayName}\n            </h3>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Choose a file from your computer\n            </p>\n            <Input\n              type=\"file\"\n              accept={selectedConnector.name === 'csv' ? '.csv' : selectedConnector.name === 'excel' ? '.xlsx,.xls' : '.json'}\n              onChange={(e) => {\n                const file = e.target.files?.[0];\n                if (file) {\n                  setSelectedFile(file);\n                  // Auto-populate connection name from filename if empty\n                  if (!connectionName) {\n                    setConnectionName(file.name.replace(/\\.[^/.]+$/, ''));\n                  }\n                }\n              }}\n              className=\"max-w-xs mx-auto\"\n              data-testid=\"input-file-upload\"\n            />\n            {selectedFile && (\n              <div className=\"mt-4\">\n                <p className=\"text-sm text-primary\">\n                  Selected: {selectedFile.name} ({(selectedFile.size / 1024).toFixed(2)} KB)\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    // Database connectors show connection fields\n    return (\n      <div className=\"space-y-4\">\n        {/* Basic connection fields */}\n        {selectedConnector.requiresHost && (\n          <FormField\n            control={form.control}\n            name={\"host\" as any}\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Host</FormLabel>\n                <FormControl>\n                  <Input\n                    placeholder=\"localhost\"\n                    {...field}\n                    data-testid=\"input-host\"\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        {selectedConnector.requiresPort && (\n          <FormField\n            control={form.control}\n            name=\"port\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Port</FormLabel>\n                <FormControl>\n                  <Input\n                    type=\"number\"\n                    placeholder={selectedConnector.defaultPort?.toString() || \"3306\"}\n                    {...field}\n                    onChange={(e) => field.onChange(parseInt(e.target.value) || selectedConnector.defaultPort)}\n                    data-testid=\"input-port\"\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        {selectedConnector.requiresDatabase && (\n          <FormField\n            control={form.control}\n            name={\"database\" as any}\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Database</FormLabel>\n                <FormControl>\n                  <Input\n                    placeholder=\"my_database\"\n                    {...field}\n                    data-testid=\"input-database\"\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        {selectedConnector.requiresCredentials && (\n          <>\n            <FormField\n              control={form.control}\n              name={\"username\" as any}\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Username</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"user\"\n                      {...field}\n                      data-testid=\"input-username\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name={\"password\" as any}\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Password</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"password\"\n                      placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                      {...field}\n                      data-testid=\"input-password\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </>\n        )}\n\n        {/* Cloud-specific fields */}\n        {selectedConnector.name === 'bigquery' && (\n          <FormField\n            control={form.control}\n            name={\"projectId\" as any}\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Project ID</FormLabel>\n                <FormControl>\n                  <Input\n                    placeholder=\"my-project-id\"\n                    {...field}\n                    data-testid=\"input-project-id\"\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n\n        {selectedConnector.name === 'snowflake' && (\n          <>\n            <FormField\n              control={form.control}\n              name={\"account\" as any}\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Account</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"your-account\"\n                      {...field}\n                      data-testid=\"input-account\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name={\"warehouse\" as any}\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Warehouse</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"COMPUTE_WH\"\n                      {...field}\n                      data-testid=\"input-warehouse\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name={\"role\" as any}\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Role (Optional)</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"SYSADMIN\"\n                      {...field}\n                      data-testid=\"input-role\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </>\n        )}\n\n        {/* SSL Configuration */}\n        {selectedConnector.supportsSSL && (\n          <FormField\n            control={form.control}\n            name={\"sslMode\" as any}\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>SSL Mode</FormLabel>\n                <Select onValueChange={field.onChange} defaultValue={field.value}>\n                  <FormControl>\n                    <SelectTrigger data-testid=\"select-ssl-mode\">\n                      <SelectValue placeholder=\"Select SSL mode\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"require\">Require</SelectItem>\n                    <SelectItem value=\"prefer\">Prefer</SelectItem>\n                    <SelectItem value=\"allow\">Allow</SelectItem>\n                    <SelectItem value=\"disable\">Disable</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        )}\n      </div>\n    );\n  };\n\n  if (loadingConnectors) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n        <span className=\"ml-2\">Loading connectors...</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Connector Selection */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Select Database Connector</CardTitle>\n          <CardDescription>\n            Choose your database type to get started with the connection\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Tabs defaultValue={Object.keys(connectorsByCategory)[0]} className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-5\">\n              {Object.keys(connectorsByCategory).map((category) => (\n                <TabsTrigger key={category} value={category} className=\"capitalize\">\n                  {category}\n                </TabsTrigger>\n              ))}\n            </TabsList>\n\n            {Object.entries(connectorsByCategory).map(([category, categoryConnectors]) => (\n              <TabsContent key={category} value={category} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {categoryConnectors.map((connector) => {\n                    const IconComponent = getCategoryIcon(connector.category);\n                    const isSelected = selectedConnector?.name === connector.name;\n\n                    return (\n                      <Card\n                        key={connector.name}\n                        className={`cursor-pointer transition-all hover:shadow-md ${\n                          isSelected ? 'ring-2 ring-primary' : ''\n                        }`}\n                        onClick={() => setSelectedConnector(connector)}\n                        data-testid={`connector-${connector.name}`}\n                      >\n                        <CardContent className=\"p-4\">\n                          <div className=\"flex items-start space-x-3\">\n                            <div className=\"p-2 rounded-lg bg-muted\">\n                              <IconComponent className=\"h-5 w-5\" />\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <h3 className=\"font-medium text-sm\">{connector.displayName}</h3>\n                              <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">\n                                {connector.description}\n                              </p>\n                              <div className=\"mt-2\">\n                                <span className=\"inline-block px-2 py-1 text-xs rounded-md bg-secondary text-secondary-foreground\">\n                                  {connector.category}\n                                </span>\n                              </div>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </div>\n              </TabsContent>\n            ))}\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      {/* Connection Configuration */}\n      {selectedConnector && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              {(() => {\n                const IconComponent = getCategoryIcon(selectedConnector.category);\n                return <IconComponent className=\"h-5 w-5\" />;\n              })()}\n              Configure {selectedConnector.displayName} Connection\n            </CardTitle>\n            <CardDescription>\n              {selectedConnector.description}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6\">\n                {/* Connection Name */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"connection-name\">Connection Name *</Label>\n                  <Input\n                    id=\"connection-name\"\n                    placeholder=\"My Database Connection\"\n                    value={connectionName}\n                    onChange={(e) => setConnectionName(e.target.value)}\n                    data-testid=\"input-connection-name\"\n                  />\n                </div>\n\n                {/* Dynamic connection fields */}\n                {renderConnectionFields()}\n\n                {/* Connection Test - Only for database connectors */}\n                {selectedConnector.category !== 'file' && (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label className=\"text-base font-medium\">Connection Test</Label>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={handleTestConnection}\n                        disabled={isTestingConnection}\n                        data-testid=\"button-test-connection\"\n                      >\n                        {isTestingConnection ? (\n                          <>\n                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                            Testing...\n                          </>\n                        ) : (\n                          'Test Connection'\n                        )}\n                      </Button>\n                    </div>\n\n                    {connectionTest && (\n                      <Alert className={connectionTest.success ? 'border-green-500' : 'border-red-500'}>\n                        <div className=\"flex items-center gap-2\">\n                          {connectionTest.success ? (\n                            <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                          ) : (\n                            <XCircle className=\"h-4 w-4 text-red-600\" />\n                          )}\n                          <AlertDescription className=\"flex-1\">\n                            {connectionTest.message}\n                            {connectionTest.latency && (\n                              <span className=\"ml-2 text-muted-foreground\">\n                                ({connectionTest.latency}ms)\n                              </span>\n                            )}\n                          </AlertDescription>\n                        </div>\n                      </Alert>\n                    )}\n                  </div>\n                )}\n\n                {/* Submit Button */}\n                {selectedConnector.category === 'file' ? (\n                  <Button\n                    type=\"button\"\n                    className=\"w-full\"\n                    onClick={handleFileUpload}\n                    disabled={isLoading || !selectedFile || !connectionName.trim()}\n                    data-testid=\"button-upload-file\"\n                  >\n                    {isLoading ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Uploading...\n                      </>\n                    ) : (\n                      'Upload File'\n                    )}\n                  </Button>\n                ) : (\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full\"\n                    disabled={isLoading || !connectionTest?.success || !connectionName.trim()}\n                    data-testid=\"button-save-connection\"\n                  >\n                    {isLoading ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Creating Connection...\n                      </>\n                    ) : (\n                      'Save Connection'\n                    )}\n                  </Button>\n                )}\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":24630},"server/auth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport { Express } from \"express\";\nimport session from \"express-session\";\nimport { scrypt, randomBytes, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\nimport { storage } from \"./storage\";\nimport { User as SelectUser, insertUserSchema } from \"@shared/schema\";\n\ndeclare global {\n  namespace Express {\n    interface User extends SelectUser {}\n  }\n}\n\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password: string) {\n  const salt = randomBytes(16).toString(\"hex\");\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString(\"hex\")}.${salt}`;\n}\n\nasync function comparePasswords(supplied: string, stored: string) {\n  const [hashed, salt] = stored.split(\".\");\n  const hashedBuf = Buffer.from(hashed, \"hex\");\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}\n\nexport function setupAuth(app: Express) {\n  const sessionSettings: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET!,\n    resave: false,\n    saveUninitialized: false,\n    store: storage.sessionStore,\n    cookie: {\n      httpOnly: true,\n      secure: false, // Set to true in production with HTTPS\n      maxAge: 24 * 60 * 60 * 1000, // 24 hours\n    },\n  };\n\n  app.set(\"trust proxy\", 1);\n  app.use(session(sessionSettings));\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(\n    new LocalStrategy(\n      { usernameField: \"email\" },\n      async (email, password, done) => {\n        try {\n          const user = await storage.getUserByEmail(email);\n          if (!user || !(await comparePasswords(password, user.password))) {\n            return done(null, false, { message: \"Invalid email or password\" });\n          }\n          return done(null, user);\n        } catch (error) {\n          return done(error);\n        }\n      }\n    )\n  );\n\n  passport.serializeUser((user, done) => done(null, user.id));\n  passport.deserializeUser(async (id: string, done) => {\n    try {\n      const user = await storage.getUser(id);\n      done(null, user);\n    } catch (error) {\n      done(error);\n    }\n  });\n\n  app.post(\"/api/register\", async (req, res, next) => {\n    try {\n      const validation = insertUserSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ message: \"Invalid input data\" });\n      }\n\n      const { email, username } = validation.data;\n\n      // Check if user already exists\n      const existingUserByEmail = await storage.getUserByEmail(email);\n      if (existingUserByEmail) {\n        return res.status(400).json({ message: \"Email already exists\" });\n      }\n\n      const existingUserByUsername = await storage.getUserByUsername(username);\n      if (existingUserByUsername) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n\n      const user = await storage.createUser({\n        ...validation.data,\n        password: await hashPassword(validation.data.password),\n      });\n\n      req.login(user, (err) => {\n        if (err) return next(err);\n        res.status(201).json({ \n          id: user.id, \n          username: user.username, \n          email: user.email, \n          name: user.name \n        });\n      });\n    } catch (error) {\n      next(error);\n    }\n  });\n\n  app.post(\"/api/login\", (req, res, next) => {\n    passport.authenticate(\"local\", (err: any, user: any, info: any) => {\n      if (err) return next(err);\n      if (!user) {\n        return res.status(401).json({ message: info?.message || \"Authentication failed\" });\n      }\n      req.login(user, (err) => {\n        if (err) return next(err);\n        res.status(200).json({ \n          id: user.id, \n          username: user.username, \n          email: user.email, \n          name: user.name \n        });\n      });\n    })(req, res, next);\n  });\n\n  app.post(\"/api/logout\", (req, res, next) => {\n    req.logout((err) => {\n      if (err) return next(err);\n      res.sendStatus(200);\n    });\n  });\n\n  app.get(\"/api/user\", (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.sendStatus(401);\n    }\n    res.json({ \n      id: req.user!.id, \n      username: req.user!.username, \n      email: req.user!.email, \n      name: req.user!.name \n    });\n  });\n}\n\nexport function requireAuth(req: any, res: any, next: any) {\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n  next();\n}\n","size_bytes":4535},"client/src/components/chart-config/HistogramConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\n\ninterface HistogramConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function HistogramConfig({ config, onChange, columns = [] }: HistogramConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"column\">Data Column</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.column || \"\"}\n            onValueChange={(value) => updateConfig(\"column\", value)}\n          >\n            <SelectTrigger id=\"column\" data-testid=\"select-column\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"column\"\n            placeholder=\"Select a dataset first\"\n            value={config.column || \"\"}\n            onChange={(e) => updateConfig(\"column\", e.target.value)}\n            data-testid=\"input-column\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"bins\">Number of Bins</Label>\n        <Input\n          id=\"bins\"\n          type=\"number\"\n          placeholder=\"e.g., 20\"\n          value={config.bins || \"\"}\n          onChange={(e) => updateConfig(\"bins\", e.target.value)}\n          data-testid=\"input-bins\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"binRange\">Bin Range (Optional)</Label>\n        <Input\n          id=\"binRange\"\n          placeholder=\"e.g., 0-100\"\n          value={config.binRange || \"\"}\n          onChange={(e) => updateConfig(\"binRange\", e.target.value)}\n          data-testid=\"input-bin-range\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Label htmlFor=\"cumulative\">Cumulative</Label>\n        <Switch\n          id=\"cumulative\"\n          checked={config.cumulative || false}\n          onCheckedChange={(checked) => updateConfig(\"cumulative\", checked)}\n          data-testid=\"switch-cumulative\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Label htmlFor=\"normalized\">Normalized</Label>\n        <Switch\n          id=\"normalized\"\n          checked={config.normalized || false}\n          onCheckedChange={(checked) => updateConfig(\"normalized\", checked)}\n          data-testid=\"switch-normalized\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":3028},"client/src/lib/voice.ts":{"content":"export class VoiceRecorder {\n  private mediaRecorder: MediaRecorder | null = null;\n  private audioChunks: Blob[] = [];\n  private stream: MediaStream | null = null;\n\n  async startRecording(): Promise<void> {\n    try {\n      this.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      this.mediaRecorder = new MediaRecorder(this.stream);\n      this.audioChunks = [];\n\n      this.mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          this.audioChunks.push(event.data);\n        }\n      };\n\n      this.mediaRecorder.start();\n    } catch (error) {\n      throw new Error('Failed to start recording: ' + (error as Error).message);\n    }\n  }\n\n  async stopRecording(): Promise<Blob> {\n    return new Promise((resolve, reject) => {\n      if (!this.mediaRecorder) {\n        reject(new Error('No recording in progress'));\n        return;\n      }\n\n      this.mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });\n        this.cleanup();\n        resolve(audioBlob);\n      };\n\n      this.mediaRecorder.onerror = (event) => {\n        this.cleanup();\n        reject(new Error('Recording failed'));\n      };\n\n      this.mediaRecorder.stop();\n    });\n  }\n\n  isRecording(): boolean {\n    return this.mediaRecorder?.state === 'recording';\n  }\n\n  private cleanup(): void {\n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n      this.stream = null;\n    }\n    this.mediaRecorder = null;\n    this.audioChunks = [];\n  }\n}\n\nexport class SpeechRecognition {\n  private recognition: any = null;\n  private isSupported: boolean;\n\n  constructor() {\n    // Check for browser support\n    const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n    this.isSupported = !!SpeechRecognition;\n    \n    if (this.isSupported) {\n      this.recognition = new SpeechRecognition();\n      this.recognition.continuous = false;\n      this.recognition.interimResults = false;\n      this.recognition.lang = 'en-US';\n    }\n  }\n\n  isAvailable(): boolean {\n    return this.isSupported;\n  }\n\n  startListening(): Promise<string> {\n    return new Promise((resolve, reject) => {\n      if (!this.isSupported) {\n        reject(new Error('Speech recognition not supported'));\n        return;\n      }\n\n      this.recognition.onresult = (event: any) => {\n        const transcript = event.results[0][0].transcript;\n        resolve(transcript);\n      };\n\n      this.recognition.onerror = (event: any) => {\n        reject(new Error('Speech recognition error: ' + event.error));\n      };\n\n      this.recognition.onend = () => {\n        // Recognition ended\n      };\n\n      try {\n        this.recognition.start();\n      } catch (error) {\n        reject(new Error('Failed to start speech recognition'));\n      }\n    });\n  }\n\n  stopListening(): void {\n    if (this.recognition) {\n      this.recognition.stop();\n    }\n  }\n}\n","size_bytes":2946},"server/services/chart-query-service.ts":{"content":"import { SemanticLayer, SemanticDataset, QuerySpec } from './semantic-layer';\nimport { queryCache } from './query-cache';\nimport { DatabaseConnectorService } from './database-connectors';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport csvParser from 'csv-parser';\n\ninterface ChartDataRequest {\n  chartId: string;\n  chartType: string;\n  config: Record<string, any>;\n  dataSource: any;\n  limit?: number;\n}\n\nexport class ChartQueryService {\n  /**\n   * Execute chart query with semantic layer and caching\n   * This is the main entry point for getting chart data\n   */\n  static async executeChartQuery(request: ChartDataRequest): Promise<any[]> {\n    const { chartType, config, dataSource, limit } = request;\n\n    // 1. Create semantic dataset from data source\n    const semanticDataset = SemanticLayer.createDatasetFromMetadata(dataSource);\n\n    // 2. Translate chart config to query spec\n    const querySpec = SemanticLayer.translateChartConfig(chartType, config, semanticDataset);\n    \n    // Apply limit\n    if (limit) {\n      querySpec.limit = Math.min(limit, querySpec.limit || 1000);\n    }\n\n    // 3. Check cache first\n    const connectionType = semanticDataset.connectionType;\n    const query = SemanticLayer.buildQuery(querySpec, connectionType);\n    \n    const cachedResult = await queryCache.get(\n      query,\n      config,\n      [dataSource.id]\n    );\n\n    if (cachedResult) {\n      console.log(`‚ú® Serving from cache for chart type: ${chartType}`);\n      return cachedResult;\n    }\n\n    // 4. Execute query based on data source type\n    let result: any[] = [];\n\n    if (dataSource.type === 'csv' && dataSource.filename) {\n      result = await this.executeCSVQuery(dataSource, querySpec);\n    } else if (dataSource.metadata && dataSource.metadata.isTableDataset) {\n      result = await this.executeDatabaseQuery(query, connectionType, dataSource.metadata);\n    } else {\n      console.error('Unknown data source type:', dataSource.type);\n      return [];\n    }\n\n    // 5. Cache the result\n    await queryCache.set(\n      query,\n      result,\n      config,\n      [dataSource.id],\n      this.getCacheTTL(chartType)\n    );\n\n    console.log(`üìä Executed query for ${chartType}, returned ${result.length} rows`);\n    return result;\n  }\n\n  /**\n   * Execute query on CSV file\n   * Applies filtering, grouping, and aggregation in memory\n   */\n  private static async executeCSVQuery(\n    dataSource: any,\n    querySpec: QuerySpec\n  ): Promise<any[]> {\n    const filePath = path.join(process.cwd(), 'uploads', dataSource.filename);\n    \n    if (!fs.existsSync(filePath)) {\n      return [];\n    }\n\n    // Read CSV\n    const rawData = await this.parseCSVFile(filePath);\n\n    // Apply semantic query to in-memory data\n    return this.applyQuerySpec(rawData, querySpec);\n  }\n\n  /**\n   * Execute SQL query on database\n   */\n  private static async executeDatabaseQuery(\n    query: string,\n    connectionType: string,\n    metadata: any\n  ): Promise<any[]> {\n    const connectionConfig = {\n      host: metadata.host,\n      port: metadata.port,\n      database: metadata.database,\n      username: metadata.username,\n      password: metadata.password\n    };\n\n    console.log(`Executing semantic query on ${connectionType}:`, query);\n\n    try {\n      const result = await DatabaseConnectorService.executeQuery(\n        connectionType,\n        connectionConfig,\n        query\n      );\n\n      return result.rows || [];\n    } catch (error) {\n      console.error('Database query error:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Apply query spec to in-memory data (for CSV)\n   * Implements grouping, aggregation, filtering, sorting\n   */\n  private static applyQuerySpec(data: any[], spec: QuerySpec): any[] {\n    let result = [...data];\n\n    // Apply filters\n    if (spec.filters && spec.filters.length > 0) {\n      result = result.filter(row => {\n        return spec.filters!.every(filter => {\n          const value = row[filter.field];\n          switch (filter.operator) {\n            case 'eq': return value === filter.value;\n            case 'ne': return value !== filter.value;\n            case 'gt': return Number(value) > Number(filter.value);\n            case 'lt': return Number(value) < Number(filter.value);\n            case 'gte': return Number(value) >= Number(filter.value);\n            case 'lte': return Number(value) <= Number(filter.value);\n            case 'in': return filter.value.includes(value);\n            case 'like': return String(value).includes(filter.value);\n            default: return true;\n          }\n        });\n      });\n    }\n\n    // If we have metrics, apply grouping and aggregation\n    if (spec.metrics.length > 0 && spec.dimensions.length > 0) {\n      const grouped: Map<string, any> = new Map();\n\n      result.forEach(row => {\n        // Create group key from dimensions\n        const groupKey = spec.dimensions.map(dim => row[dim]).join('|');\n\n        if (!grouped.has(groupKey)) {\n          const groupRow: any = {};\n          // Add dimensions\n          spec.dimensions.forEach(dim => {\n            groupRow[dim] = row[dim];\n          });\n          // Initialize metrics\n          spec.metrics.forEach(metric => {\n            const metricDef = spec.dataset.metrics.find(m => m.field === metric);\n            const aggregation = metricDef?.aggregation || 'sum';\n            \n            if (aggregation === 'count') {\n              groupRow[metric] = 0;\n            } else if (aggregation === 'min') {\n              groupRow[metric] = Infinity;\n            } else if (aggregation === 'max') {\n              groupRow[metric] = -Infinity;\n            } else {\n              groupRow[metric] = 0;\n            }\n            groupRow[`_${metric}_count`] = 0;\n          });\n          grouped.set(groupKey, groupRow);\n        }\n\n        const groupRow = grouped.get(groupKey)!;\n\n        // Aggregate metrics\n        spec.metrics.forEach(metric => {\n          const metricDef = spec.dataset.metrics.find(m => m.field === metric);\n          const aggregation = metricDef?.aggregation || 'sum';\n          const value = parseFloat(row[metric]) || 0;\n\n          switch (aggregation) {\n            case 'sum':\n              groupRow[metric] += value;\n              break;\n            case 'avg':\n              groupRow[metric] += value;\n              groupRow[`_${metric}_count`]++;\n              break;\n            case 'count':\n              groupRow[metric]++;\n              break;\n            case 'min':\n              groupRow[metric] = Math.min(groupRow[metric], value);\n              break;\n            case 'max':\n              groupRow[metric] = Math.max(groupRow[metric], value);\n              break;\n            case 'count_distinct':\n              if (!groupRow[`_${metric}_set`]) {\n                groupRow[`_${metric}_set`] = new Set();\n              }\n              groupRow[`_${metric}_set`].add(value);\n              groupRow[metric] = groupRow[`_${metric}_set`].size;\n              break;\n          }\n        });\n      });\n\n      // Convert map to array and finalize averages\n      result = Array.from(grouped.values()).map(row => {\n        spec.metrics.forEach(metric => {\n          const metricDef = spec.dataset.metrics.find(m => m.field === metric);\n          if (metricDef?.aggregation === 'avg' && row[`_${metric}_count`] > 0) {\n            row[metric] = row[metric] / row[`_${metric}_count`];\n          }\n          // Clean up temporary fields\n          delete row[`_${metric}_count`];\n          delete row[`_${metric}_set`];\n        });\n        return row;\n      });\n    } else if (spec.metrics.length > 0) {\n      // Just metrics, no dimensions - single row result\n      const aggregated: any = {};\n      \n      spec.metrics.forEach(metric => {\n        const metricDef = spec.dataset.metrics.find(m => m.field === metric);\n        const aggregation = metricDef?.aggregation || 'sum';\n        \n        const values = result.map(r => parseFloat(r[metric]) || 0);\n        \n        switch (aggregation) {\n          case 'sum':\n            aggregated[metric] = values.reduce((a, b) => a + b, 0);\n            break;\n          case 'avg':\n            aggregated[metric] = values.reduce((a, b) => a + b, 0) / values.length;\n            break;\n          case 'count':\n            aggregated[metric] = values.length;\n            break;\n          case 'min':\n            aggregated[metric] = Math.min(...values);\n            break;\n          case 'max':\n            aggregated[metric] = Math.max(...values);\n            break;\n          case 'count_distinct':\n            aggregated[metric] = new Set(values).size;\n            break;\n        }\n      });\n      \n      result = [aggregated];\n    }\n\n    // Sort\n    if (spec.sortBy && result.length > 0) {\n      result.sort((a, b) => {\n        const aVal = Number(a[spec.sortBy!]) || 0;\n        const bVal = Number(b[spec.sortBy!]) || 0;\n        return spec.sortOrder === 'asc' ? aVal - bVal : bVal - aVal;\n      });\n    }\n\n    // Limit\n    if (spec.limit) {\n      result = result.slice(0, spec.limit);\n    }\n\n    // Offset\n    if (spec.offset) {\n      result = result.slice(spec.offset);\n    }\n\n    return result;\n  }\n\n  /**\n   * Parse CSV file\n   */\n  private static parseCSVFile(filePath: string): Promise<any[]> {\n    return new Promise((resolve, reject) => {\n      const results: any[] = [];\n      fs.createReadStream(filePath)\n        .pipe(csvParser())\n        .on('data', (data) => results.push(data))\n        .on('end', () => resolve(results))\n        .on('error', reject);\n    });\n  }\n\n  /**\n   * Get cache TTL based on chart type\n   * Different chart types have different cache durations\n   */\n  private static getCacheTTL(chartType: string): number {\n    switch (chartType) {\n      case 'big_number':\n      case 'gauge':\n        return 60; // 1 minute for KPIs\n      case 'table':\n        return 180; // 3 minutes for tables\n      default:\n        return 300; // 5 minutes for charts\n    }\n  }\n}\n","size_bytes":9907},"client/src/components/charts/heatmap.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\n\ninterface HeatmapCell {\n  x: string;\n  y: string;\n  value: number;\n}\n\ninterface HeatmapProps {\n  data: any[];\n  title?: string;\n  xKey?: string;\n  yKey?: string;\n  valueKey?: string;\n}\n\nexport function Heatmap({ data, title, xKey, yKey, valueKey }: HeatmapProps) {\n  if (!data || data.length === 0) {\n    return <div className=\"text-muted-foreground\">No data available</div>;\n  }\n\n  // Auto-detect keys if not provided\n  const keys = Object.keys(data[0]);\n  const detectedXKey = xKey || keys[0];\n  const detectedYKey = yKey || keys[1];\n  const detectedValueKey = valueKey || keys[2] || keys[1];\n\n  // Extract unique x and y values\n  const xValues = Array.from(new Set(data.map(d => d[detectedXKey])));\n  const yValues = Array.from(new Set(data.map(d => d[detectedYKey])));\n\n  // Create a map for quick lookup\n  const valueMap = new Map<string, number>();\n  data.forEach(d => {\n    const key = `${d[detectedXKey]}-${d[detectedYKey]}`;\n    valueMap.set(key, Number(d[detectedValueKey]) || 0);\n  });\n\n  // Find min and max values for color scaling\n  const allValues = Array.from(valueMap.values());\n  const minValue = Math.min(...allValues);\n  const maxValue = Math.max(...allValues);\n\n  // Color scale function\n  const getColor = (value: number): string => {\n    if (maxValue === minValue) return '#60a5fa'; // Blue-400\n    \n    const normalized = (value - minValue) / (maxValue - minValue);\n    \n    // Color gradient from light blue to dark blue\n    const colors = [\n      '#eff6ff', // Blue-50\n      '#dbeafe', // Blue-100\n      '#bfdbfe', // Blue-200\n      '#93c5fd', // Blue-300\n      '#60a5fa', // Blue-400\n      '#3b82f6', // Blue-500\n      '#2563eb', // Blue-600\n      '#1d4ed8', // Blue-700\n      '#1e40af', // Blue-800\n      '#1e3a8a', // Blue-900\n    ];\n    \n    const index = Math.floor(normalized * (colors.length - 1));\n    return colors[index];\n  };\n\n  // Determine if text should be light or dark based on background\n  const getTextColor = (value: number): string => {\n    if (maxValue === minValue) return 'text-white';\n    const normalized = (value - minValue) / (maxValue - minValue);\n    return normalized > 0.5 ? 'text-white' : 'text-gray-900';\n  };\n\n  return (\n    <div className=\"w-full overflow-auto\">\n      {title && <h3 className=\"text-lg font-semibold mb-4\">{title}</h3>}\n      \n      <div className=\"inline-block min-w-full\">\n        <table className=\"border-collapse\">\n          <thead>\n            <tr>\n              <th className=\"p-2 text-sm font-medium text-muted-foreground border border-border bg-muted/50\">\n                {detectedYKey} / {detectedXKey}\n              </th>\n              {xValues.map((xVal) => (\n                <th\n                  key={xVal}\n                  className=\"p-2 text-sm font-medium text-foreground border border-border bg-muted/50 min-w-[100px]\"\n                >\n                  {String(xVal)}\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {yValues.map((yVal) => (\n              <tr key={yVal}>\n                <td className=\"p-2 text-sm font-medium text-foreground border border-border bg-muted/50 whitespace-nowrap\">\n                  {String(yVal)}\n                </td>\n                {xValues.map((xVal) => {\n                  const key = `${xVal}-${yVal}`;\n                  const value = valueMap.get(key) || 0;\n                  const bgColor = getColor(value);\n                  const textColor = getTextColor(value);\n                  \n                  return (\n                    <td\n                      key={key}\n                      className={cn(\n                        \"p-3 text-center border border-border transition-all hover:ring-2 hover:ring-primary/50\",\n                        textColor\n                      )}\n                      style={{ backgroundColor: bgColor }}\n                      data-testid={`heatmap-cell-${xVal}-${yVal}`}\n                    >\n                      <div className=\"font-semibold\">{value}</div>\n                    </td>\n                  );\n                })}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n      \n      {/* Legend */}\n      <div className=\"mt-4 flex items-center gap-2\">\n        <span className=\"text-sm text-muted-foreground\">Low</span>\n        <div className=\"flex h-4 rounded overflow-hidden\" style={{ width: '200px' }}>\n          {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((i) => {\n            const value = minValue + ((maxValue - minValue) * i / 9);\n            return (\n              <div\n                key={i}\n                style={{ \n                  backgroundColor: getColor(value),\n                  flex: 1\n                }}\n              />\n            );\n          })}\n        </div>\n        <span className=\"text-sm text-muted-foreground\">High</span>\n        <span className=\"ml-2 text-sm text-muted-foreground\">\n          ({minValue} - {maxValue})\n        </span>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5039},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/chart-config/BigNumberConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\n\ninterface BigNumberConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n  chartType?: string;\n}\n\nexport function BigNumberConfig({ config, onChange, columns = [], chartType }: BigNumberConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metric\">Metric Column</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.metric || \"\"}\n            onValueChange={(value) => updateConfig(\"metric\", value)}\n          >\n            <SelectTrigger id=\"metric\" data-testid=\"select-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"metric\"\n            placeholder=\"Select a dataset first\"\n            value={config.metric || \"\"}\n            onChange={(e) => updateConfig(\"metric\", e.target.value)}\n            data-testid=\"input-metric\"\n            disabled\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Column to aggregate (e.g., revenue, price, count)\n        </p>\n      </div>\n\n      {chartType === \"big_number_trendline\" && (\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"timeColumn\">Trend Column (Time/Date)</Label>\n          {columns.length > 0 ? (\n            <Select\n              value={config.timeColumn || \"\"}\n              onValueChange={(value) => updateConfig(\"timeColumn\", value)}\n            >\n              <SelectTrigger id=\"timeColumn\" data-testid=\"select-trend\">\n                <SelectValue placeholder=\"Select a time column\" />\n              </SelectTrigger>\n              <SelectContent>\n                {columns.filter(col => col && col.trim()).map((col) => (\n                  <SelectItem key={col} value={col}>\n                    {col}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          ) : (\n            <Input\n              id=\"timeColumn\"\n              placeholder=\"Select a dataset first\"\n              value={config.timeColumn || \"\"}\n              onChange={(e) => updateConfig(\"timeColumn\", e.target.value)}\n              data-testid=\"input-trend\"\n              disabled\n            />\n          )}\n          <p className=\"text-xs text-muted-foreground\">\n            Column with date/time values for the trendline\n          </p>\n        </div>\n      )}\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"format\">Format</Label>\n        <Select\n          value={config.format || \"number\"}\n          onValueChange={(value) => updateConfig(\"format\", value)}\n        >\n          <SelectTrigger id=\"format\" data-testid=\"select-format\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"number\">Number</SelectItem>\n            <SelectItem value=\"currency\">Currency</SelectItem>\n            <SelectItem value=\"percentage\">Percentage</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {config.format === \"currency\" && (\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"currency\">Currency</Label>\n          <Select\n            value={config.currency || \"USD\"}\n            onValueChange={(value) => updateConfig(\"currency\", value)}\n          >\n            <SelectTrigger id=\"currency\" data-testid=\"select-currency\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"USD\">USD ($)</SelectItem>\n              <SelectItem value=\"EUR\">EUR (‚Ç¨)</SelectItem>\n              <SelectItem value=\"GBP\">GBP (¬£)</SelectItem>\n              <SelectItem value=\"JPY\">JPY (¬•)</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      )}\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"decimals\">Decimal Places</Label>\n        <Input\n          id=\"decimals\"\n          type=\"number\"\n          min=\"0\"\n          max=\"4\"\n          value={config.decimals || \"0\"}\n          onChange={(e) => updateConfig(\"decimals\", e.target.value)}\n          data-testid=\"input-decimals\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"prefix\">Prefix (Optional)</Label>\n        <Input\n          id=\"prefix\"\n          placeholder=\"e.g., $, Total:\"\n          value={config.prefix || \"\"}\n          onChange={(e) => updateConfig(\"prefix\", e.target.value)}\n          data-testid=\"input-prefix\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"suffix\">Suffix (Optional)</Label>\n        <Input\n          id=\"suffix\"\n          placeholder=\"e.g., %, items\"\n          value={config.suffix || \"\"}\n          onChange={(e) => updateConfig(\"suffix\", e.target.value)}\n          data-testid=\"input-suffix\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"fontColor\">Font Color</Label>\n        <div className=\"flex gap-2\">\n          <Input\n            id=\"fontColor\"\n            type=\"color\"\n            value={config.fontColor || \"#1f2937\"}\n            onChange={(e) => updateConfig(\"fontColor\", e.target.value)}\n            className=\"w-20 h-10\"\n            data-testid=\"input-font-color\"\n          />\n          <Input\n            type=\"text\"\n            value={config.fontColor || \"#1f2937\"}\n            onChange={(e) => updateConfig(\"fontColor\", e.target.value)}\n            placeholder=\"#1f2937\"\n            className=\"flex-1\"\n            data-testid=\"input-font-color-text\"\n          />\n        </div>\n        <p className=\"text-xs text-muted-foreground\">\n          Color for the KPI value (default: dark gray for visibility on white backgrounds)\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6328},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/dashboard/kpi-card.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { MoreVertical } from \"lucide-react\";\nimport { KPI } from \"@/lib/api\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { BigNumber } from \"@/components/kpi/big-number\";\nimport { BigNumberTrendline } from \"@/components/kpi/big-number-trendline\";\nimport { MultiValueCard } from \"@/components/kpi/multi-value-card\";\n\ninterface KpiCardProps {\n  kpi: KPI;\n  onEdit?: (kpi: KPI) => void;\n  onDelete?: (id: string) => void;\n}\n\nexport default function KpiCard({ kpi, onEdit, onDelete }: KpiCardProps) {\n  const formatValue = (val: string): string => {\n    const numVal = parseFloat(val);\n    if (isNaN(numVal)) return val;\n    \n    const format = kpi.format || 'number';\n    const decimalPlaces = kpi.decimalPlaces ?? 0;\n    \n    switch (format) {\n      case 'currency':\n        return numVal.toFixed(decimalPlaces);\n      case 'percentage':\n        return numVal.toFixed(decimalPlaces);\n      case 'number':\n      default:\n        return numVal.toFixed(decimalPlaces);\n    }\n  };\n\n  const visualType = kpi.visualType || 'big-number';\n  const format = (kpi.format || 'number') as 'number' | 'currency' | 'percentage';\n  \n  const formattedValue = formatValue(kpi.value);\n  const prefix = kpi.prefix || '';\n  const suffix = kpi.suffix || '';\n\n  // Parse multi-value data if present\n  const parseMultiValue = (): Array<{label: string, value: string}> | null => {\n    try {\n      // Try splitting by newlines first for line-by-line values\n      const lines = kpi.value.split(/\\n/).map(l => l.trim()).filter(l => l);\n      \n      // Check for newline-separated labeled values\n      if (lines.length > 1 && lines.length <= 5) {\n        const hasLabels = lines.every(line => line.includes(':'));\n        if (hasLabels) {\n          return lines.map(line => {\n            const colonIndex = line.indexOf(':');\n            return {\n              label: line.substring(0, colonIndex).trim(),\n              value: line.substring(colonIndex + 1).trim()\n            };\n          });\n        } else {\n          return lines.map((line, i) => ({\n            label: `Value ${i + 1}`,\n            value: line\n          }));\n        }\n      }\n      \n      // Parse comma-separated labeled values using smarter detection\n      // Only treat as a new label if: word characters (including spaces) followed by colon\n      const segments: Array<{label: string, value: string}> = [];\n      const labelPattern = /([A-Za-z][\\w\\s]*?):\\s*/g;\n      let match;\n      const matches: Array<{label: string, start: number, end: number}> = [];\n      \n      // Find all potential label positions\n      while ((match = labelPattern.exec(kpi.value)) !== null) {\n        matches.push({\n          label: match[1].trim(),\n          start: match.index,\n          end: labelPattern.lastIndex\n        });\n      }\n      \n      // Extract values between labels\n      if (matches.length > 1) {\n        matches.forEach((m, i) => {\n          const nextMatch = matches[i + 1];\n          let valueEnd = nextMatch ? nextMatch.start : kpi.value.length;\n          \n          // Trim trailing comma if present\n          let valueText = kpi.value.substring(m.end, valueEnd).trim();\n          if (valueText.endsWith(',')) {\n            valueText = valueText.slice(0, -1).trim();\n          }\n          \n          segments.push({\n            label: m.label,\n            value: valueText\n          });\n        });\n        \n        if (segments.length > 1) {\n          return segments;\n        }\n      }\n    } catch (e) {\n      console.error('Error parsing multi-value:', e);\n    }\n    return null;\n  };\n\n  const multiValues = visualType === 'multi-value' ? parseMultiValue() : null;\n\n  const cardContent = (\n    <div className=\"relative group\">\n      {(onEdit || onDelete) && (\n        <div className=\"absolute top-2 right-2 z-10\">\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button \n                variant=\"ghost\" \n                size=\"sm\"\n                className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\n                data-testid={`button-kpi-menu-${kpi.id}`}\n              >\n                <MoreVertical className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              {onEdit && (\n                <DropdownMenuItem onClick={() => onEdit(kpi)} data-testid={`button-edit-kpi-${kpi.id}`}>\n                  Edit KPI\n                </DropdownMenuItem>\n              )}\n              {onDelete && (\n                <DropdownMenuItem \n                  onClick={() => onDelete(kpi.id)}\n                  className=\"text-destructive\"\n                  data-testid={`button-delete-kpi-${kpi.id}`}\n                >\n                  Delete KPI\n                </DropdownMenuItem>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      )}\n      \n      {visualType === 'multi-value' && multiValues ? (\n        <MultiValueCard\n          title={kpi.question}\n          values={multiValues.map(v => {\n            const numVal = parseFloat(v.value);\n            const isNumeric = !isNaN(numVal);\n            \n            return {\n              label: v.label,\n              value: isNumeric ? formatValue(v.value) : v.value,\n              prefix: isNumeric ? prefix : '',\n              suffix: isNumeric ? suffix : '',\n              highlight: false\n            };\n          })}\n        />\n      ) : visualType === 'big-number-trendline' ? (\n        <BigNumberTrendline\n          title={kpi.question}\n          value={formattedValue}\n          trendData={[]} \n          prefix={prefix}\n          suffix={suffix}\n          format={format}\n          showComparison={!!kpi.changePercent}\n        />\n      ) : (\n        <BigNumber\n          title={kpi.question}\n          value={formattedValue}\n          prefix={prefix}\n          suffix={suffix}\n          format={format}\n          showComparison={false}\n        />\n      )}\n    </div>\n  );\n\n  return cardContent;\n}\n","size_bytes":6110},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"server/services/code-executor.ts":{"content":"/**\n * Code Executor Service\n * \n * Safely executes generated Python code on real data.\n * Uses isolated execution environment to prevent security issues.\n */\n\nimport { spawn } from 'child_process';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { randomUUID } from 'crypto';\n\nexport interface ExecutionRequest {\n  code: string;\n  data: any[];\n  timeout?: number;\n}\n\nexport interface ExecutionResult {\n  success: boolean;\n  result?: any;\n  error?: string;\n  stdout?: string;\n  stderr?: string;\n}\n\n/**\n * Execute Python code safely with data\n */\nexport async function executePythonCode(request: ExecutionRequest): Promise<ExecutionResult> {\n  const { code, data, timeout = 30000 } = request;\n  \n  const tempDir = path.join(process.cwd(), 'temp_executions');\n  if (!fs.existsSync(tempDir)) {\n    fs.mkdirSync(tempDir, { recursive: true });\n  }\n  \n  const executionId = randomUUID();\n  const dataFile = path.join(tempDir, `data_${executionId}.json`);\n  const codeFile = path.join(tempDir, `code_${executionId}.py`);\n  const resultFile = path.join(tempDir, `result_${executionId}.json`);\n  \n  try {\n    // Write data to temporary JSON file\n    fs.writeFileSync(dataFile, JSON.stringify(data));\n    \n    // Create Python script that loads data and executes code\n    const pythonScript = `\nimport json\nimport pandas as pd\nimport numpy as np\nimport sys\nfrom datetime import datetime\n\n# Load data\nwith open('${dataFile}', 'r') as f:\n    data_json = json.load(f)\n\n# Convert to DataFrame\ndf = pd.DataFrame(data_json)\n\n# Execute user code\ntry:\n    ${code}\n    \n    # Convert result to JSON-serializable format\n    if 'result' in locals():\n        if isinstance(result, pd.DataFrame):\n            result_data = result.to_dict('records')\n        elif isinstance(result, pd.Series):\n            result_data = result.to_dict()\n        elif isinstance(result, np.ndarray):\n            result_data = result.tolist()\n        elif isinstance(result, (np.integer, np.floating)):\n            result_data = float(result)\n        else:\n            result_data = result\n        \n        # Write result\n        with open('${resultFile}', 'w') as f:\n            json.dump({\n                'success': True,\n                'result': result_data\n            }, f)\n    else:\n        with open('${resultFile}', 'w') as f:\n            json.dump({\n                'success': False,\n                'error': 'No result variable found in code'\n            }, f)\n            \nexcept Exception as e:\n    with open('${resultFile}', 'w') as f:\n        json.dump({\n            'success': False,\n            'error': str(e)\n        }, f)\n`;\n    \n    fs.writeFileSync(codeFile, pythonScript);\n    \n    // Execute Python script\n    const result = await new Promise<ExecutionResult>((resolve, reject) => {\n      const python = spawn('python3', [codeFile], {\n        timeout,\n        cwd: tempDir\n      });\n      \n      let stdout = '';\n      let stderr = '';\n      \n      python.stdout.on('data', (data) => {\n        stdout += data.toString();\n      });\n      \n      python.stderr.on('data', (data) => {\n        stderr += data.toString();\n      });\n      \n      python.on('close', (code) => {\n        if (code !== 0) {\n          resolve({\n            success: false,\n            error: `Python execution failed with code ${code}`,\n            stdout,\n            stderr\n          });\n          return;\n        }\n        \n        // Read result file\n        if (fs.existsSync(resultFile)) {\n          const resultData = JSON.parse(fs.readFileSync(resultFile, 'utf8'));\n          resolve({\n            ...resultData,\n            stdout,\n            stderr\n          });\n        } else {\n          resolve({\n            success: false,\n            error: 'No result file generated',\n            stdout,\n            stderr\n          });\n        }\n      });\n      \n      python.on('error', (err) => {\n        resolve({\n          success: false,\n          error: `Failed to start Python: ${err.message}`,\n          stdout,\n          stderr\n        });\n      });\n    });\n    \n    return result;\n    \n  } catch (error) {\n    return {\n      success: false,\n      error: `Execution error: ${error instanceof Error ? error.message : String(error)}`\n    };\n  } finally {\n    // Cleanup temporary files\n    try {\n      if (fs.existsSync(dataFile)) fs.unlinkSync(dataFile);\n      if (fs.existsSync(codeFile)) fs.unlinkSync(codeFile);\n      if (fs.existsSync(resultFile)) fs.unlinkSync(resultFile);\n    } catch (cleanupError) {\n      console.error('Cleanup error:', cleanupError);\n    }\n  }\n}\n\n/**\n * Check if Python is available\n */\nexport async function checkPythonAvailability(): Promise<boolean> {\n  return new Promise((resolve) => {\n    const python = spawn('python3', ['--version']);\n    \n    python.on('close', (code) => {\n      resolve(code === 0);\n    });\n    \n    python.on('error', () => {\n      resolve(false);\n    });\n  });\n}\n","size_bytes":4898},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/chart-config/TreemapConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface TreemapConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function TreemapConfig({ config, onChange, columns = [] }: TreemapConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"category\">Category</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.category || \"\"}\n            onValueChange={(value) => updateConfig(\"category\", value)}\n          >\n            <SelectTrigger id=\"category\" data-testid=\"select-category\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"category\"\n            placeholder=\"Select a dataset first\"\n            value={config.category || \"\"}\n            onChange={(e) => updateConfig(\"category\", e.target.value)}\n            data-testid=\"input-category\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"subcategory\">Subcategory (Optional)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.subcategory || \"\"}\n            onValueChange={(value) => updateConfig(\"subcategory\", value)}\n          >\n            <SelectTrigger id=\"subcategory\" data-testid=\"select-subcategory\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"\">None</SelectItem>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"subcategory\"\n            placeholder=\"Select a dataset first\"\n            value={config.subcategory || \"\"}\n            onChange={(e) => updateConfig(\"subcategory\", e.target.value)}\n            data-testid=\"input-subcategory\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metric\">Size Metric</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.metric || \"\"}\n            onValueChange={(value) => updateConfig(\"metric\", value)}\n          >\n            <SelectTrigger id=\"metric\" data-testid=\"select-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"metric\"\n            placeholder=\"Select a dataset first\"\n            value={config.metric || \"\"}\n            onChange={(e) => updateConfig(\"metric\", e.target.value)}\n            data-testid=\"input-metric\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"colorMetric\">Color Metric (Optional)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.colorMetric || \"\"}\n            onValueChange={(value) => updateConfig(\"colorMetric\", value)}\n          >\n            <SelectTrigger id=\"colorMetric\" data-testid=\"select-color-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"\">None</SelectItem>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"colorMetric\"\n            placeholder=\"Select a dataset first\"\n            value={config.colorMetric || \"\"}\n            onChange={(e) => updateConfig(\"colorMetric\", e.target.value)}\n            data-testid=\"input-color-metric\"\n            disabled\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":4819},"client/src/components/icons/chart-icons.tsx":{"content":"import { SVGProps } from \"react\";\n\nexport function BigNumberIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <defs>\n        <linearGradient id=\"bigNumberGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" style={{ stopColor: '#3b82f6', stopOpacity: 1 }} />\n          <stop offset=\"100%\" style={{ stopColor: '#8b5cf6', stopOpacity: 1 }} />\n        </linearGradient>\n      </defs>\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" stroke=\"url(#bigNumberGradient)\" fill=\"url(#bigNumberGradient)\" fillOpacity=\"0.1\" />\n      <text x=\"12\" y=\"16\" fontSize=\"12\" fontWeight=\"bold\" textAnchor=\"middle\" fill=\"url(#bigNumberGradient)\" stroke=\"none\">1</text>\n    </svg>\n  );\n}\n\nexport function TrendlineIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <defs>\n        <linearGradient id=\"trendlineGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" style={{ stopColor: '#06b6d4', stopOpacity: 1 }} />\n          <stop offset=\"100%\" style={{ stopColor: '#3b82f6', stopOpacity: 1 }} />\n        </linearGradient>\n      </defs>\n      <rect x=\"2\" y=\"2\" width=\"20\" height=\"20\" rx=\"2\" stroke=\"url(#trendlineGradient)\" fill=\"url(#trendlineGradient)\" fillOpacity=\"0.05\" />\n      <text x=\"12\" y=\"11\" fontSize=\"10\" fontWeight=\"bold\" textAnchor=\"middle\" fill=\"url(#trendlineGradient)\" stroke=\"none\">42</text>\n      <polyline points=\"4,16 8,14 12,15 16,12 20,13\" strokeWidth=\"1.5\" stroke=\"#10b981\" />\n    </svg>\n  );\n}\n\nexport function GaugeIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <path d=\"M12 2a10 10 0 0 1 7.07 17.07\" stroke=\"#8b5cf6\" />\n      <path d=\"M12 2a10 10 0 0 0-7.07 17.07\" stroke=\"#a78bfa\" />\n      <path d=\"M12 12l4 4\" stroke=\"#ec4899\" strokeWidth=\"2\" />\n      <circle cx=\"12\" cy=\"12\" r=\"1\" fill=\"#ec4899\" />\n    </svg>\n  );\n}\n\nexport function BarChartIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"8\" width=\"4\" height=\"13\" rx=\"1\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"10\" y=\"4\" width=\"4\" height=\"17\" rx=\"1\" fill=\"#8b5cf6\" stroke=\"#7c3aed\" />\n      <rect x=\"17\" y=\"11\" width=\"4\" height=\"10\" rx=\"1\" fill=\"#06b6d4\" stroke=\"#0891b2\" />\n    </svg>\n  );\n}\n\nexport function StackedBarIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"14\" width=\"4\" height=\"7\" rx=\"1\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"3\" y=\"8\" width=\"4\" height=\"6\" rx=\"1\" fill=\"#8b5cf6\" stroke=\"#7c3aed\" />\n      <rect x=\"10\" y=\"11\" width=\"4\" height=\"10\" rx=\"1\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"10\" y=\"4\" width=\"4\" height=\"7\" rx=\"1\" fill=\"#8b5cf6\" stroke=\"#7c3aed\" />\n      <rect x=\"17\" y=\"16\" width=\"4\" height=\"5\" rx=\"1\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"17\" y=\"11\" width=\"4\" height=\"5\" rx=\"1\" fill=\"#8b5cf6\" stroke=\"#7c3aed\" />\n    </svg>\n  );\n}\n\nexport function GroupedBarIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"10\" width=\"3\" height=\"11\" rx=\"0.5\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"7\" y=\"13\" width=\"3\" height=\"8\" rx=\"0.5\" fill=\"#8b5cf6\" stroke=\"#7c3aed\" />\n      <rect x=\"11\" y=\"6\" width=\"3\" height=\"15\" rx=\"0.5\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"15\" y=\"9\" width=\"3\" height=\"12\" rx=\"0.5\" fill=\"#8b5cf6\" stroke=\"#7c3aed\" />\n      <rect x=\"19\" y=\"12\" width=\"2\" height=\"9\" rx=\"0.5\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n    </svg>\n  );\n}\n\nexport function LineChartIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <polyline points=\"3,17 7,11 12,14 16,8 21,11\" stroke=\"#10b981\" strokeWidth=\"2\" />\n      <circle cx=\"3\" cy=\"17\" r=\"1.5\" fill=\"#10b981\" />\n      <circle cx=\"7\" cy=\"11\" r=\"1.5\" fill=\"#10b981\" />\n      <circle cx=\"12\" cy=\"14\" r=\"1.5\" fill=\"#10b981\" />\n      <circle cx=\"16\" cy=\"8\" r=\"1.5\" fill=\"#10b981\" />\n      <circle cx=\"21\" cy=\"11\" r=\"1.5\" fill=\"#10b981\" />\n    </svg>\n  );\n}\n\nexport function MultiLineIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <polyline points=\"3,15 7,9 12,12 16,6 21,9\" stroke=\"#10b981\" strokeWidth=\"2\" />\n      <polyline points=\"3,19 7,16 12,17 16,13 21,15\" stroke=\"#06b6d4\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport function AreaChartIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <defs>\n        <linearGradient id=\"areaGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n          <stop offset=\"0%\" style={{ stopColor: '#a78bfa', stopOpacity: 0.4 }} />\n          <stop offset=\"100%\" style={{ stopColor: '#a78bfa', stopOpacity: 0.05 }} />\n        </linearGradient>\n      </defs>\n      <path d=\"M3,21 L3,15 L7,9 L12,12 L16,6 L21,9 L21,21 Z\" fill=\"url(#areaGradient)\" />\n      <polyline points=\"3,15 7,9 12,12 16,6 21,9\" stroke=\"#8b5cf6\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport function PieChartIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#f59e0b\" fill=\"#fef3c7\" fillOpacity=\"0.2\" />\n      <path d=\"M12 3 L12 12 L18 18\" fill=\"#f59e0b\" fillOpacity=\"0.5\" />\n      <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"12\" stroke=\"#f59e0b\" strokeWidth=\"2\" />\n      <line x1=\"12\" y1=\"12\" x2=\"18\" y2=\"18\" stroke=\"#f59e0b\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport function DonutChartIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#f59e0b\" strokeWidth=\"2\" fill=\"none\" />\n      <circle cx=\"12\" cy=\"12\" r=\"5\" fill=\"none\" stroke=\"#fef3c7\" strokeWidth=\"9\" opacity=\"0.3\" />\n      <path d=\"M12 3 A 9 9 0 0 1 21 12\" fill=\"none\" stroke=\"#f59e0b\" strokeWidth=\"4\" />\n      <path d=\"M21 12 A 9 9 0 0 1 12 21\" fill=\"none\" stroke=\"#fb923c\" strokeWidth=\"4\" />\n    </svg>\n  );\n}\n\nexport function ScatterPlotIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <circle cx=\"5\" cy=\"18\" r=\"1.5\" fill=\"#ec4899\" />\n      <circle cx=\"8\" cy=\"12\" r=\"1.5\" fill=\"#f472b6\" />\n      <circle cx=\"11\" cy=\"16\" r=\"1.5\" fill=\"#ec4899\" />\n      <circle cx=\"14\" cy=\"9\" r=\"1.5\" fill=\"#f472b6\" />\n      <circle cx=\"17\" cy=\"14\" r=\"1.5\" fill=\"#ec4899\" />\n      <circle cx=\"20\" cy=\"7\" r=\"1.5\" fill=\"#f472b6\" />\n      <circle cx=\"7\" cy=\"8\" r=\"1.5\" fill=\"#ec4899\" />\n      <circle cx=\"18\" cy=\"19\" r=\"1.5\" fill=\"#f472b6\" />\n    </svg>\n  );\n}\n\nexport function BubbleChartIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <circle cx=\"6\" cy=\"16\" r=\"3\" fill=\"#ec4899\" fillOpacity=\"0.4\" stroke=\"#ec4899\" />\n      <circle cx=\"12\" cy=\"8\" r=\"5\" fill=\"#f472b6\" fillOpacity=\"0.3\" stroke=\"#f472b6\" />\n      <circle cx=\"18\" cy=\"15\" r=\"4\" fill=\"#ec4899\" fillOpacity=\"0.4\" stroke=\"#ec4899\" />\n    </svg>\n  );\n}\n\nexport function HeatmapIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"1\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"3\" width=\"4\" height=\"4\" fill=\"#ef4444\" stroke=\"#dc2626\" />\n      <rect x=\"8\" y=\"3\" width=\"4\" height=\"4\" fill=\"#f97316\" stroke=\"#ea580c\" />\n      <rect x=\"13\" y=\"3\" width=\"4\" height=\"4\" fill=\"#f59e0b\" stroke=\"#d97706\" />\n      <rect x=\"18\" y=\"3\" width=\"4\" height=\"4\" fill=\"#fbbf24\" stroke=\"#f59e0b\" />\n      <rect x=\"3\" y=\"8\" width=\"4\" height=\"4\" fill=\"#f97316\" stroke=\"#ea580c\" />\n      <rect x=\"8\" y=\"8\" width=\"4\" height=\"4\" fill=\"#ef4444\" stroke=\"#dc2626\" />\n      <rect x=\"13\" y=\"8\" width=\"4\" height=\"4\" fill=\"#f59e0b\" stroke=\"#d97706\" />\n      <rect x=\"18\" y=\"8\" width=\"4\" height=\"4\" fill=\"#fbbf24\" stroke=\"#f59e0b\" />\n      <rect x=\"3\" y=\"13\" width=\"4\" height=\"4\" fill=\"#f59e0b\" stroke=\"#d97706\" />\n      <rect x=\"8\" y=\"13\" width=\"4\" height=\"4\" fill=\"#f97316\" stroke=\"#ea580c\" />\n      <rect x=\"13\" y=\"13\" width=\"4\" height=\"4\" fill=\"#ef4444\" stroke=\"#dc2626\" />\n      <rect x=\"18\" y=\"13\" width=\"4\" height=\"4\" fill=\"#f59e0b\" stroke=\"#d97706\" />\n    </svg>\n  );\n}\n\nexport function TableIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" stroke=\"#64748b\" fill=\"#f1f5f9\" fillOpacity=\"0.3\" />\n      <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\" stroke=\"#64748b\" />\n      <line x1=\"3\" y1=\"15\" x2=\"21\" y2=\"15\" stroke=\"#64748b\" />\n      <line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\" stroke=\"#64748b\" />\n      <line x1=\"15\" y1=\"3\" x2=\"15\" y2=\"21\" stroke=\"#64748b\" />\n    </svg>\n  );\n}\n\nexport function FunnelIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <path d=\"M4,4 L20,4 L17,10 L7,10 Z\" fill=\"#06b6d4\" stroke=\"#0891b2\" />\n      <path d=\"M7,10 L17,10 L15,16 L9,16 Z\" fill=\"#0891b2\" stroke=\"#0e7490\" />\n      <path d=\"M9,16 L15,16 L13,20 L11,20 Z\" fill=\"#0e7490\" stroke=\"#155e75\" />\n    </svg>\n  );\n}\n\nexport function SankeyIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <path d=\"M3,6 Q12,6 12,12 Q12,18 21,18\" strokeWidth=\"4\" fill=\"none\" stroke=\"#a78bfa\" />\n      <path d=\"M3,12 Q12,12 12,12 Q12,12 21,12\" strokeWidth=\"3\" fill=\"none\" stroke=\"#8b5cf6\" />\n      <path d=\"M3,18 Q12,18 12,12 Q12,6 21,6\" strokeWidth=\"4\" fill=\"none\" stroke=\"#c4b5fd\" />\n    </svg>\n  );\n}\n\nexport function TreemapIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"1\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"3\" width=\"10\" height=\"18\" fill=\"#10b981\" stroke=\"#059669\" />\n      <rect x=\"14\" y=\"3\" width=\"7\" height=\"9\" fill=\"#14b8a6\" stroke=\"#0d9488\" />\n      <rect x=\"14\" y=\"13\" width=\"7\" height=\"8\" fill=\"#06b6d4\" stroke=\"#0891b2\" />\n    </svg>\n  );\n}\n\nexport function RadarIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <defs>\n        <linearGradient id=\"radarGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" style={{ stopColor: '#3b82f6', stopOpacity: 0.3 }} />\n          <stop offset=\"100%\" style={{ stopColor: '#8b5cf6', stopOpacity: 0.3 }} />\n        </linearGradient>\n      </defs>\n      <polygon points=\"12,3 21,8 18,17 6,17 3,8\" fill=\"url(#radarGradient)\" stroke=\"#3b82f6\" />\n      <polygon points=\"12,6 18,9 16,15 8,15 6,9\" fill=\"#8b5cf6\" fillOpacity=\"0.4\" stroke=\"#8b5cf6\" />\n      <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"12\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n      <line x1=\"12\" y1=\"12\" x2=\"21\" y2=\"8\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n      <line x1=\"12\" y1=\"12\" x2=\"18\" y2=\"17\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n      <line x1=\"12\" y1=\"12\" x2=\"6\" y2=\"17\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n      <line x1=\"12\" y1=\"12\" x2=\"3\" y2=\"8\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n    </svg>\n  );\n}\n\nexport function MapIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <polygon points=\"3,6 9,3 15,6 21,3 21,18 15,21 9,18 3,21\" fill=\"#d1fae5\" fillOpacity=\"0.3\" stroke=\"#10b981\" />\n      <line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"18\" stroke=\"#059669\" />\n      <line x1=\"15\" y1=\"6\" x2=\"15\" y2=\"21\" stroke=\"#059669\" />\n    </svg>\n  );\n}\n\nexport function WaterfallIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"15\" width=\"3\" height=\"6\" fill=\"#10b981\" stroke=\"#059669\" />\n      <rect x=\"7\" y=\"10\" width=\"3\" height=\"5\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"11\" y=\"5\" width=\"3\" height=\"5\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"15\" y=\"8\" width=\"3\" height=\"8\" fill=\"#ef4444\" stroke=\"#dc2626\" />\n      <rect x=\"19\" y=\"5\" width=\"3\" height=\"16\" fill=\"#10b981\" stroke=\"#059669\" />\n      <line x1=\"6\" y1=\"15\" x2=\"7\" y2=\"10\" strokeDasharray=\"2,2\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n      <line x1=\"10\" y1=\"10\" x2=\"11\" y2=\"5\" strokeDasharray=\"2,2\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n      <line x1=\"14\" y1=\"5\" x2=\"15\" y2=\"8\" strokeDasharray=\"2,2\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n      <line x1=\"18\" y1=\"8\" x2=\"19\" y2=\"5\" strokeDasharray=\"2,2\" stroke=\"#94a3b8\" opacity=\"0.5\" />\n    </svg>\n  );\n}\n\nexport function MultiValueCardIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <defs>\n        <linearGradient id=\"multiValueGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" style={{ stopColor: '#8b5cf6', stopOpacity: 1 }} />\n          <stop offset=\"100%\" style={{ stopColor: '#ec4899', stopOpacity: 1 }} />\n        </linearGradient>\n      </defs>\n      <rect x=\"2\" y=\"2\" width=\"20\" height=\"20\" rx=\"2\" stroke=\"url(#multiValueGradient)\" fill=\"url(#multiValueGradient)\" fillOpacity=\"0.05\" />\n      <line x1=\"2\" y1=\"9\" x2=\"22\" y2=\"9\" strokeWidth=\"1\" stroke=\"url(#multiValueGradient)\" />\n      <line x1=\"2\" y1=\"15\" x2=\"22\" y2=\"15\" strokeWidth=\"1\" stroke=\"url(#multiValueGradient)\" />\n      <circle cx=\"7\" cy=\"5.5\" r=\"1\" fill=\"#8b5cf6\" />\n      <circle cx=\"7\" cy=\"12\" r=\"1\" fill=\"#a78bfa\" />\n      <circle cx=\"7\" cy=\"18.5\" r=\"1\" fill=\"#ec4899\" />\n    </svg>\n  );\n}\n\nexport function BoxPlotIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <line x1=\"12\" y1=\"4\" x2=\"12\" y2=\"7\" stroke=\"#06b6d4\" />\n      <rect x=\"8\" y=\"7\" width=\"8\" height=\"10\" fill=\"#06b6d4\" fillOpacity=\"0.2\" stroke=\"#0891b2\" />\n      <line x1=\"6\" y1=\"12\" x2=\"18\" y2=\"12\" strokeWidth=\"2\" stroke=\"#0e7490\" />\n      <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"20\" stroke=\"#06b6d4\" />\n      <line x1=\"6\" y1=\"4\" x2=\"18\" y2=\"4\" stroke=\"#06b6d4\" />\n      <line x1=\"6\" y1=\"20\" x2=\"18\" y2=\"20\" stroke=\"#06b6d4\" />\n    </svg>\n  );\n}\n\nexport function HistogramIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <rect x=\"3\" y=\"16\" width=\"3\" height=\"5\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n      <rect x=\"7\" y=\"12\" width=\"3\" height=\"9\" fill=\"#60a5fa\" stroke=\"#3b82f6\" />\n      <rect x=\"11\" y=\"6\" width=\"3\" height=\"15\" fill=\"#93c5fd\" stroke=\"#60a5fa\" />\n      <rect x=\"15\" y=\"9\" width=\"3\" height=\"12\" fill=\"#60a5fa\" stroke=\"#3b82f6\" />\n      <rect x=\"19\" y=\"14\" width=\"3\" height=\"7\" fill=\"#3b82f6\" stroke=\"#2563eb\" />\n    </svg>\n  );\n}\n\nexport function SunburstIcon(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" {...props}>\n      <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"#f59e0b\" />\n      <circle cx=\"12\" cy=\"12\" r=\"6\" fill=\"#fbbf24\" fillOpacity=\"0.3\" stroke=\"#f59e0b\" />\n      <path d=\"M12 2 A 10 10 0 0 1 22 12 L12 12 Z\" fill=\"#fb923c\" fillOpacity=\"0.4\" />\n      <path d=\"M22 12 A 10 10 0 0 1 12 22 L12 12 Z\" fill=\"#f59e0b\" fillOpacity=\"0.3\" />\n      <path d=\"M12 22 A 10 10 0 0 1 2 12 L12 12 Z\" fill=\"#fbbf24\" fillOpacity=\"0.5\" />\n    </svg>\n  );\n}\n","size_bytes":17241},"client/src/pages/home-page.tsx":{"content":"import { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport Sidebar from \"@/components/layout/sidebar\";\nimport TopBar from \"@/components/layout/top-bar\";\nimport DashboardPage from \"./dashboard-page\";\nimport DashboardViewPage from \"./dashboard-view-page\";\nimport AssistantPage from \"./assistant-page\";\nimport WarehousePage from \"./warehouse-page\";\nimport ChartsPage from \"./charts-page\";\nimport DatasetsPage from \"./datasets-page\";\nimport ChartBuilderPage from \"./chart-builder-page\";\n\ntype Page = \"dashboard\" | \"assistant\" | \"warehouse\" | \"charts\" | \"datasets\";\n\nexport default function HomePage() {\n  const [currentPage, setCurrentPage] = useState<Page>(\"dashboard\");\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const [viewingDashboardId, setViewingDashboardId] = useState<string | null>(null);\n  const [buildingChartType, setBuildingChartType] = useState<string | null>(null);\n\n  const handleNavigateToDashboard = (dashboardId: string) => {\n    setViewingDashboardId(dashboardId);\n  };\n\n  const handleBackToDashboards = () => {\n    setViewingDashboardId(null);\n  };\n\n  const handleNavigateToChartBuilder = (chartType: string) => {\n    setBuildingChartType(chartType);\n  };\n\n  const handleBackToCharts = () => {\n    setBuildingChartType(null);\n  };\n\n  const renderPage = () => {\n    if (currentPage === \"dashboard\") {\n      if (viewingDashboardId) {\n        return (\n          <DashboardViewPage \n            dashboardId={viewingDashboardId} \n            onBack={handleBackToDashboards}\n          />\n        );\n      }\n      return <DashboardPage onNavigateToDashboard={handleNavigateToDashboard} />;\n    }\n\n    if (currentPage === \"charts\") {\n      if (buildingChartType) {\n        return (\n          <ChartBuilderPage \n            chartType={buildingChartType}\n            onBack={handleBackToCharts}\n          />\n        );\n      }\n      return <ChartsPage onNavigateToBuilder={handleNavigateToChartBuilder} />;\n    }\n\n    switch (currentPage) {\n      case \"assistant\":\n        return <AssistantPage />;\n      case \"warehouse\":\n        return <WarehousePage />;\n      case \"datasets\":\n        return <DatasetsPage />;\n      default:\n        return <DashboardPage onNavigateToDashboard={handleNavigateToDashboard} />;\n    }\n  };\n\n  return (\n    <div className=\"flex min-h-screen bg-background\">\n      <Sidebar \n        currentPage={currentPage} \n        onPageChange={(page) => {\n          setCurrentPage(page as Page);\n          setViewingDashboardId(null); // Reset dashboard view when changing pages\n          setBuildingChartType(null); // Reset chart builder when changing pages\n        }}\n        isOpen={sidebarOpen}\n        onToggle={() => setSidebarOpen(!sidebarOpen)}\n      />\n      \n      <main className={`flex-1 overflow-auto transition-all duration-300 ${sidebarOpen ? 'ml-16' : 'ml-0'} lg:ml-16`}>\n        <TopBar \n          currentPage={currentPage}\n          onSidebarToggle={() => setSidebarOpen(!sidebarOpen)}\n        />\n        \n        <div className=\"min-h-[calc(100vh-80px)]\">\n          {renderPage()}\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":3101},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/dashboard/chart-renderer.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Loader2, AlertCircle } from \"lucide-react\";\nimport {\n  LineChart,\n  Line,\n  BarChart,\n  Bar,\n  PieChart,\n  Pie,\n  Cell,\n  ScatterChart,\n  Scatter,\n  AreaChart,\n  Area,\n  RadarChart,\n  Radar,\n  PolarGrid,\n  PolarAngleAxis,\n  PolarRadiusAxis,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n} from \"recharts\";\nimport { BigNumber } from \"@/components/kpi/big-number\";\nimport { BigNumberTrendline } from \"@/components/kpi/big-number-trendline\";\nimport { GaugeChart } from \"@/components/kpi/gauge-chart\";\nimport { Heatmap } from \"@/components/charts/heatmap\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport type { Chart } from \"@shared/schema\";\n\ninterface ChartRendererProps {\n  chartId?: string;\n  chart?: Chart;\n  data?: any[];\n  isPreview?: boolean;\n}\n\nconst COLORS = [\n  \"#3b82f6\", // Blue\n  \"#10b981\", // Green\n  \"#f59e0b\", // Amber\n  \"#ef4444\", // Red\n  \"#8b5cf6\", // Purple\n  \"#ec4899\", // Pink\n  \"#06b6d4\", // Cyan\n  \"#84cc16\", // Lime\n];\n\nexport function ChartRenderer({ chartId, chart: chartProp, data: dataProp, isPreview = false }: ChartRendererProps) {\n  // Fetch chart data only if not in preview mode\n  const { data: chart, isLoading, error } = useQuery<Chart>({\n    queryKey: [\"/api/charts\", chartId],\n    queryFn: async () => {\n      const response = await fetch(`/api/charts/${chartId}`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch chart\");\n      return response.json();\n    },\n    enabled: !isPreview && !!chartId,\n  });\n\n  // Fetch chart data (from data sources) only if not in preview mode\n  const { data: chartData, isLoading: dataLoading } = useQuery({\n    queryKey: [\"/api/charts\", chartId, \"data\"],\n    queryFn: async () => {\n      const response = await fetch(`/api/charts/${chartId}/data`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) return [];\n      const result = await response.json();\n      return result.data || [];\n    },\n    enabled: !isPreview && !!chart,\n  });\n\n  // Use preview data or fetched data\n  const activeChart = isPreview ? chartProp : chart;\n  const activeData = isPreview ? (dataProp || []) : (chartData || []);\n\n  if (!isPreview && (isLoading || dataLoading)) {\n    return (\n      <div className=\"flex items-center justify-center h-full min-h-[200px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  if (!isPreview && (error || !activeChart)) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full min-h-[200px] text-muted-foreground\">\n        <AlertCircle className=\"h-8 w-8 mb-2\" />\n        <p>Failed to load chart</p>\n      </div>\n    );\n  }\n\n  if (!activeChart) {\n    return null;\n  }\n\n  const renderChart = () => {\n    const data = activeData || [];\n    const config = (activeChart.config || {}) as Record<string, any>;\n\n    if (!data || data.length === 0) {\n      return (\n        <div className=\"flex items-center justify-center h-full min-h-[200px] text-muted-foreground\">\n          <p>No data available</p>\n        </div>\n      );\n    }\n\n    switch (activeChart.type) {\n      // KPI Charts\n      case \"big_number\":\n        const metric = config.metric;\n        if (!metric) {\n          return (\n            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n              <p>Metric column not configured</p>\n            </div>\n          );\n        }\n        const value = data[0]?.[metric] || 0;\n        return (\n          <BigNumber\n            title={activeChart.title}\n            value={value}\n            prefix={config.prefix}\n            suffix={config.suffix}\n            format={config.format || \"number\"}\n            fontColor={config.fontColor}\n          />\n        );\n\n      case \"big_number_trendline\":\n        const metricTrend = config.metric;\n        const timeColumn = config.timeColumn;\n        if (!metricTrend || !timeColumn) {\n          return (\n            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n              <p>Metric and time column not configured</p>\n            </div>\n          );\n        }\n        const trendData = data.map((d: any) => ({\n          value: d[metricTrend] || 0,\n          date: d[timeColumn],\n        }));\n        const currentValue = data[data.length - 1]?.[metricTrend] || 0;\n        return (\n          <BigNumberTrendline\n            title={activeChart.title}\n            value={currentValue}\n            trendData={trendData}\n            prefix={config.prefix}\n            suffix={config.suffix}\n            format={config.format || \"number\"}\n            fontColor={config.fontColor}\n          />\n        );\n\n      case \"gauge\":\n        const gaugeMetric = config.metric;\n        const gaugeValue = data[0]?.[gaugeMetric] || 0;\n        return (\n          <GaugeChart\n            title={activeChart.title}\n            value={gaugeValue}\n            target={config.maxValue || 100}\n            min={config.minValue || 0}\n            max={config.maxValue || 100}\n          />\n        );\n\n      // Bar Charts with customization options\n      case \"bar\":\n      case \"stacked_bar\":\n      case \"grouped_bar\":\n      case \"horizontal_bar\":\n        if (!config.xAxis || !config.yAxis) {\n          return (\n            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n              <p>X-Axis and Y-Axis columns not configured</p>\n            </div>\n          );\n        }\n        \n        const isHorizontal = config.orientation === \"horizontal\" || activeChart.type === \"horizontal_bar\";\n        const labelDisplay = config.labelDisplay || \"hover\";\n        const valueFormat = config.valueFormat || \"value\";\n        \n        // Calculate total for percentage display\n        const total = data.reduce((sum: number, item: any) => sum + (Number(item[config.yAxis]) || 0), 0);\n        \n        // Format label based on valueFormat\n        const formatLabel = (value: number) => {\n          if (valueFormat === \"percentage\") {\n            return `${((value / total) * 100).toFixed(1)}%`;\n          } else if (valueFormat === \"both\") {\n            return `${value} (${((value / total) * 100).toFixed(1)}%)`;\n          }\n          return value;\n        };\n        \n        return (\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <BarChart \n              data={data} \n              layout={isHorizontal ? \"vertical\" : \"horizontal\"}\n            >\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n              {isHorizontal ? (\n                <>\n                  <XAxis type=\"number\" stroke=\"#6b7280\" fontSize={12} />\n                  <YAxis \n                    type=\"category\" \n                    dataKey={config.xAxis} \n                    stroke=\"#6b7280\" \n                    fontSize={11}\n                    width={100}\n                    tick={{ fill: \"#374151\" }}\n                  />\n                </>\n              ) : (\n                <>\n                  <XAxis \n                    dataKey={config.xAxis} \n                    stroke=\"#6b7280\" \n                    fontSize={11}\n                    angle={-45}\n                    textAnchor=\"end\"\n                    height={80}\n                    tick={{ fill: \"#374151\" }}\n                  />\n                  <YAxis stroke=\"#6b7280\" fontSize={12} />\n                </>\n              )}\n              <Tooltip\n                contentStyle={{\n                  backgroundColor: \"#ffffff\",\n                  border: \"1px solid #e5e7eb\",\n                  borderRadius: \"6px\",\n                }}\n                formatter={(value: number) => formatLabel(value)}\n              />\n              <Legend />\n              <Bar\n                dataKey={config.yAxis}\n                fill={COLORS[0]}\n                radius={isHorizontal ? [0, 4, 4, 0] : [4, 4, 0, 0]}\n                label={labelDisplay === \"always\" || labelDisplay === \"inside\" ? {\n                  position: labelDisplay === \"inside\" ? \"inside\" : \"top\",\n                  fill: labelDisplay === \"inside\" ? \"#ffffff\" : \"#374151\",\n                  fontSize: 11,\n                  formatter: formatLabel\n                } : false}\n              />\n            </BarChart>\n          </ResponsiveContainer>\n        );\n\n      // Line Charts\n      case \"line\":\n      case \"multi_line\":\n      case \"smooth_line\":\n      case \"stepped_line\":\n        if (!config.xAxis || !config.yAxis) {\n          return (\n            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n              <p>X-Axis and Y-Axis columns not configured</p>\n            </div>\n          );\n        }\n        return (\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <LineChart data={data}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n              <XAxis dataKey={config.xAxis} stroke=\"#6b7280\" fontSize={12} />\n              <YAxis stroke=\"#6b7280\" fontSize={12} />\n              <Tooltip\n                contentStyle={{\n                  backgroundColor: \"#ffffff\",\n                  border: \"1px solid #e5e7eb\",\n                  borderRadius: \"6px\",\n                }}\n              />\n              <Legend />\n              <Line\n                type=\"monotone\"\n                dataKey={config.yAxis}\n                stroke={COLORS[0]}\n                strokeWidth={2}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        );\n\n      case \"area\":\n      case \"stacked_area\":\n        if (!config.xAxis || !config.yAxis) {\n          return (\n            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n              <p>X-Axis and Y-Axis columns not configured</p>\n            </div>\n          );\n        }\n        return (\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <AreaChart data={data}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n              <XAxis dataKey={config.xAxis} stroke=\"#6b7280\" fontSize={12} />\n              <YAxis stroke=\"#6b7280\" fontSize={12} />\n              <Tooltip\n                contentStyle={{\n                  backgroundColor: \"#ffffff\",\n                  border: \"1px solid #e5e7eb\",\n                  borderRadius: \"6px\",\n                }}\n              />\n              <Legend />\n              <Area\n                type=\"monotone\"\n                dataKey={config.yAxis}\n                stroke={COLORS[0]}\n                fill={COLORS[0]}\n                strokeWidth={2}\n              />\n            </AreaChart>\n          </ResponsiveContainer>\n        );\n\n      // Pie Charts\n      case \"pie\":\n      case \"donut\":\n        if (!config.category || !config.value) {\n          return (\n            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n              <p>Category and value columns not configured</p>\n            </div>\n          );\n        }\n        return (\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <PieChart>\n              <Pie\n                data={data}\n                dataKey={config.value}\n                nameKey={config.category}\n                cx=\"50%\"\n                cy=\"50%\"\n                outerRadius={activeChart.type === \"donut\" ? 80 : 100}\n                innerRadius={activeChart.type === \"donut\" ? 50 : 0}\n                label\n              >\n                {data.map((_: any, index: number) => (\n                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                ))}\n              </Pie>\n              <Tooltip />\n              <Legend />\n            </PieChart>\n          </ResponsiveContainer>\n        );\n\n      // Scatter Charts\n      case \"scatter\":\n      case \"bubble\":\n        return (\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <ScatterChart>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n              <XAxis dataKey={config.xAxis} stroke=\"#6b7280\" fontSize={12} />\n              <YAxis dataKey={config.yAxis} stroke=\"#6b7280\" fontSize={12} />\n              <Tooltip cursor={{ strokeDasharray: \"3 3\" }} />\n              <Legend />\n              <Scatter name={activeChart.title} data={data} fill={COLORS[0]} />\n            </ScatterChart>\n          </ResponsiveContainer>\n        );\n\n      // Heatmap\n      case \"heatmap\":\n        return (\n          <Heatmap\n            data={data}\n            xKey={config.xAxis}\n            yKey={config.yAxis}\n            valueKey={config.metric}\n          />\n        );\n\n      // Radar Chart\n      case \"radar\":\n        return (\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <RadarChart data={data}>\n              <PolarGrid />\n              <PolarAngleAxis dataKey={config.dimensions?.[0]} />\n              <PolarRadiusAxis />\n              <Radar\n                name={activeChart.title}\n                dataKey={config.metrics?.[0]}\n                stroke={COLORS[0]}\n                fill={COLORS[0]}\n                fillOpacity={0.6}\n              />\n              <Tooltip />\n            </RadarChart>\n          </ResponsiveContainer>\n        );\n\n      // Table\n      case \"table\":\n      case \"pivot_table\":\n        const columns = config.columns || Object.keys(data[0] || {});\n        return (\n          <div className=\"overflow-auto max-h-full\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  {columns.map((col: string) => (\n                    <TableHead key={col}>{col}</TableHead>\n                  ))}\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {data.slice(0, 50).map((row: any, idx: number) => (\n                  <TableRow key={idx}>\n                    {columns.map((col: string) => (\n                      <TableCell key={col}>{row[col]}</TableCell>\n                    ))}\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        );\n\n      default:\n        return (\n          <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n            <p>Chart type \"{activeChart.type}\" not yet supported</p>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"w-full h-full bg-white dark:bg-white rounded-lg p-4\">\n      {renderChart()}\n    </div>\n  );\n}\n","size_bytes":14568},"client/src/lib/protected-route.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { Loader2 } from \"lucide-react\";\nimport { Redirect, Route } from \"wouter\";\n\nexport function ProtectedRoute({\n  path,\n  component: Component,\n}: {\n  path: string;\n  component: React.ComponentType<any>;\n}) {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <Route path={path}>\n        <div className=\"flex items-center justify-center min-h-screen bg-background\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </Route>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Route path={path}>\n        <Redirect to=\"/auth\" />\n      </Route>\n    );\n  }\n\n  return <Route path={path} component={Component} />;\n}\n","size_bytes":722},"server/services/schema-analyzer.ts":{"content":"import { DataSource } from \"@/lib/api\";\n\nexport interface ColumnInfo {\n  name: string;\n  type: string;\n  nullable?: boolean;\n}\n\nexport interface TableSchema {\n  dataSourceId: string;\n  tableName: string;\n  schemaName?: string;\n  columns: ColumnInfo[];\n}\n\nexport interface TableRelationship {\n  leftTable: string;\n  leftColumn: string;\n  rightTable: string;\n  rightColumn: string;\n  confidence: number; // 0-1 score\n  type: 'primary-foreign' | 'name-match' | 'pattern';\n}\n\nexport class SchemaAnalyzer {\n  /**\n   * Detect relationships between multiple table schemas\n   */\n  static detectRelationships(schemas: TableSchema[]): TableRelationship[] {\n    const relationships: TableRelationship[] = [];\n\n    // Compare each pair of tables\n    for (let i = 0; i < schemas.length; i++) {\n      for (let j = i + 1; j < schemas.length; j++) {\n        const table1 = schemas[i];\n        const table2 = schemas[j];\n        \n        // Find potential relationships\n        const rels = this.findTableRelationships(table1, table2);\n        relationships.push(...rels);\n      }\n    }\n\n    // Sort by confidence and remove duplicates\n    return this.deduplicateRelationships(relationships);\n  }\n\n  /**\n   * Find relationships between two tables\n   */\n  private static findTableRelationships(\n    table1: TableSchema,\n    table2: TableSchema\n  ): TableRelationship[] {\n    const relationships: TableRelationship[] = [];\n\n    // Strategy 1: Look for foreign key patterns\n    // e.g., \"product_id\" in one table might relate to \"id\" in \"products\" table\n    for (const col1 of table1.columns) {\n      const normalizedCol1 = col1.name.toLowerCase();\n      \n      // Check if column name suggests it's a foreign key (ends with _id)\n      if (normalizedCol1.endsWith('_id')) {\n        const baseTableName = normalizedCol1.replace(/_id$/, '');\n        const table2Name = this.getTableBaseName(table2.tableName);\n        \n        // Check if table2 name matches the base name\n        if (table2Name.includes(baseTableName) || baseTableName.includes(table2Name)) {\n          // Look for \"id\" column in table2\n          const idColumn = table2.columns.find(c => c.name.toLowerCase() === 'id');\n          if (idColumn) {\n            relationships.push({\n              leftTable: this.getFullTableName(table1),\n              leftColumn: col1.name,\n              rightTable: this.getFullTableName(table2),\n              rightColumn: idColumn.name,\n              confidence: 0.9,\n              type: 'primary-foreign'\n            });\n          }\n        }\n      }\n    }\n\n    // Strategy 2: Exact column name matches (excluding common names)\n    const commonColumns = new Set(['id', 'name', 'created_at', 'updated_at', 'status', 'type']);\n    for (const col1 of table1.columns) {\n      const normalizedCol1 = col1.name.toLowerCase();\n      if (commonColumns.has(normalizedCol1)) continue;\n      \n      for (const col2 of table2.columns) {\n        const normalizedCol2 = col2.name.toLowerCase();\n        if (normalizedCol1 === normalizedCol2) {\n          relationships.push({\n            leftTable: this.getFullTableName(table1),\n            leftColumn: col1.name,\n            rightTable: this.getFullTableName(table2),\n            rightColumn: col2.name,\n            confidence: 0.7,\n            type: 'name-match'\n          });\n        }\n      }\n    }\n\n    // Strategy 3: Pattern-based matching\n    // e.g., \"category_id\" relates to \"id\" if one table is named \"categories\"\n    for (const col1 of table1.columns) {\n      const normalizedCol1 = col1.name.toLowerCase();\n      if (!normalizedCol1.includes('_id')) continue;\n      \n      for (const col2 of table2.columns) {\n        const normalizedCol2 = col2.name.toLowerCase();\n        \n        // Extract the base name from col1 (e.g., \"category\" from \"category_id\")\n        const parts1 = normalizedCol1.split('_');\n        parts1.pop(); // Remove 'id'\n        const baseName1 = parts1.join('_');\n        \n        // Check if col2 or table2 name contains this base\n        const table2Name = this.getTableBaseName(table2.tableName);\n        if ((normalizedCol2 === 'id' || normalizedCol2 === baseName1) &&\n            (table2Name.includes(baseName1) || baseName1.includes(table2Name))) {\n          relationships.push({\n            leftTable: this.getFullTableName(table1),\n            leftColumn: col1.name,\n            rightTable: this.getFullTableName(table2),\n            rightColumn: col2.name,\n            confidence: 0.8,\n            type: 'pattern'\n          });\n        }\n      }\n    }\n\n    return relationships;\n  }\n\n  /**\n   * Remove duplicate relationships, keeping highest confidence\n   */\n  private static deduplicateRelationships(relationships: TableRelationship[]): TableRelationship[] {\n    const seen = new Map<string, TableRelationship>();\n    \n    for (const rel of relationships) {\n      const key = `${rel.leftTable}.${rel.leftColumn}-${rel.rightTable}.${rel.rightColumn}`;\n      const reverseKey = `${rel.rightTable}.${rel.rightColumn}-${rel.leftTable}.${rel.leftColumn}`;\n      \n      const existing = seen.get(key) || seen.get(reverseKey);\n      if (!existing || rel.confidence > existing.confidence) {\n        seen.set(key, rel);\n        seen.delete(reverseKey);\n      }\n    }\n    \n    return Array.from(seen.values()).sort((a, b) => b.confidence - a.confidence);\n  }\n\n  /**\n   * Get full table name with schema\n   */\n  private static getFullTableName(schema: TableSchema): string {\n    return schema.schemaName ? `${schema.schemaName}.${schema.tableName}` : schema.tableName;\n  }\n\n  /**\n   * Get base table name (without schema, lowercase)\n   */\n  private static getTableBaseName(tableName: string): string {\n    const parts = tableName.split('.');\n    const name = parts[parts.length - 1];\n    return name.toLowerCase();\n  }\n\n  /**\n   * Generate SQL JOIN clauses from relationships\n   */\n  static generateJoinClauses(relationships: TableRelationship[], primaryTable: string): string[] {\n    const joins: string[] = [];\n    const joinedTables = new Set<string>([primaryTable]);\n    const pendingRelationships = [...relationships];\n\n    // Build joins incrementally, starting from primary table\n    while (pendingRelationships.length > 0) {\n      const nextRel = pendingRelationships.find(rel => \n        joinedTables.has(rel.leftTable) && !joinedTables.has(rel.rightTable)\n      ) || pendingRelationships.find(rel =>\n        joinedTables.has(rel.rightTable) && !joinedTables.has(rel.leftTable)\n      );\n\n      if (!nextRel) break; // No more joinable tables\n\n      // Determine which table to join\n      if (joinedTables.has(nextRel.leftTable)) {\n        joins.push(`LEFT JOIN ${nextRel.rightTable} ON ${nextRel.leftTable}.${nextRel.leftColumn} = ${nextRel.rightTable}.${nextRel.rightColumn}`);\n        joinedTables.add(nextRel.rightTable);\n      } else {\n        joins.push(`LEFT JOIN ${nextRel.leftTable} ON ${nextRel.rightTable}.${nextRel.rightColumn} = ${nextRel.leftTable}.${nextRel.leftColumn}`);\n        joinedTables.add(nextRel.leftTable);\n      }\n\n      // Remove processed relationship\n      const index = pendingRelationships.indexOf(nextRel);\n      pendingRelationships.splice(index, 1);\n    }\n\n    return joins;\n  }\n\n  /**\n   * Create a description of relationships for AI context\n   */\n  static describeRelationships(relationships: TableRelationship[]): string {\n    if (relationships.length === 0) {\n      return \"No relationships detected between tables.\";\n    }\n\n    const descriptions = relationships.map(rel => \n      `- ${rel.leftTable}.${rel.leftColumn} relates to ${rel.rightTable}.${rel.rightColumn} (confidence: ${Math.round(rel.confidence * 100)}%)`\n    );\n\n    return `Detected Relationships:\\n${descriptions.join('\\n')}`;\n  }\n}\n","size_bytes":7701},"client/src/pages/kpi-dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { BigNumber } from \"@/components/kpi/big-number\";\nimport { BigNumberTrendline } from \"@/components/kpi/big-number-trendline\";\nimport { GaugeChart } from \"@/components/kpi/gauge-chart\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus, RefreshCw } from \"lucide-react\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface KPI {\n  id: string;\n  question: string;\n  value: string;\n  unit?: string;\n  changePercent?: string;\n  createdAt: string;\n}\n\nexport default function KPIDashboard() {\n  const { data: kpis, isLoading } = useQuery<KPI[]>({\n    queryKey: ['/api/kpis'],\n  });\n\n  // Generate sample trend data for demonstration\n  const generateTrendData = (baseValue: number) => {\n    const data = [];\n    for (let i = 6; i >= 0; i--) {\n      data.push({\n        value: baseValue * (0.8 + Math.random() * 0.4),\n        date: new Date(Date.now() - i * 24 * 60 * 60 * 1000).toLocaleDateString()\n      });\n    }\n    return data;\n  };\n\n  const handleRefresh = () => {\n    queryClient.invalidateQueries({ queryKey: ['/api/kpis'] });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"flex items-center justify-center h-64\">\n            <p className=\"text-muted-foreground\">Loading KPIs...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">KPI Dashboard</h1>\n            <p className=\"text-muted-foreground mt-1\">\n              Apache Superset-style key performance indicators\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleRefresh}\n              data-testid=\"button-refresh-kpis\"\n            >\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Refresh\n            </Button>\n            <Button size=\"sm\" data-testid=\"button-create-kpi\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create KPI\n            </Button>\n          </div>\n        </div>\n\n        {/* KPIs Grid */}\n        {!kpis || kpis.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground mb-4\">\n              No KPIs created yet. Ask a question in the chat to create your first KPI.\n            </p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {kpis.map((kpi, index) => {\n              const numericValue = parseFloat(kpi.value) || 0;\n              const changePercent = parseFloat(kpi.changePercent || '0');\n              const previousValue = numericValue / (1 + changePercent / 100);\n              \n              // Rotate through different KPI visualization types for demonstration\n              const visualizationType = index % 3;\n              \n              if (visualizationType === 0) {\n                // Big Number\n                return (\n                  <BigNumber\n                    key={kpi.id}\n                    title={kpi.question}\n                    value={numericValue}\n                    suffix={kpi.unit ? ` ${kpi.unit}` : ''}\n                    previousValue={previousValue}\n                    showComparison={!!kpi.changePercent}\n                    comparisonType=\"percentage\"\n                    colorThresholds={{\n                      good: numericValue * 0.9,\n                      warning: numericValue * 0.7,\n                      bad: numericValue * 0.5\n                    }}\n                  />\n                );\n              } else if (visualizationType === 1) {\n                // Big Number with Trendline\n                return (\n                  <BigNumberTrendline\n                    key={kpi.id}\n                    title={kpi.question}\n                    value={numericValue}\n                    trendData={generateTrendData(numericValue)}\n                    suffix={kpi.unit ? ` ${kpi.unit}` : ''}\n                    showComparison={!!kpi.changePercent}\n                    comparisonPeriod=\"vs. last 7 days\"\n                  />\n                );\n              } else {\n                // Gauge Chart\n                const target = numericValue * 1.2; // Target is 120% of current value\n                return (\n                  <GaugeChart\n                    key={kpi.id}\n                    title={kpi.question}\n                    value={numericValue}\n                    target={target}\n                    unit={kpi.unit || ''}\n                    showPercentage={true}\n                    thresholds={{\n                      good: 80,\n                      warning: 50\n                    }}\n                  />\n                );\n              }\n            })}\n          </div>\n        )}\n\n        {/* Example KPIs Section */}\n        <div className=\"mt-12 space-y-6\">\n          <h2 className=\"text-2xl font-bold\">Example KPI Visualizations</h2>\n          <p className=\"text-muted-foreground\">\n            These are examples of the different KPI types available in Apache Superset style\n          </p>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {/* Big Number Example */}\n            <BigNumber\n              title=\"Total Revenue\"\n              value={1250000}\n              format=\"currency\"\n              previousValue={1100000}\n              showComparison={true}\n              comparisonType=\"percentage\"\n              subheader=\"vs. last month\"\n              colorThresholds={{\n                good: 1200000,\n                warning: 1000000,\n                bad: 900000\n              }}\n            />\n            \n            {/* Big Number with Trendline Example */}\n            <BigNumberTrendline\n              title=\"Active Users\"\n              value={45823}\n              trendData={[\n                { value: 42000, date: '2024-01-01' },\n                { value: 43200, date: '2024-01-02' },\n                { value: 44100, date: '2024-01-03' },\n                { value: 44800, date: '2024-01-04' },\n                { value: 45200, date: '2024-01-05' },\n                { value: 45500, date: '2024-01-06' },\n                { value: 45823, date: '2024-01-07' },\n              ]}\n              format=\"number\"\n              showComparison={true}\n              comparisonPeriod=\"vs. last week\"\n              trendColor=\"#10b981\"\n            />\n            \n            {/* Gauge Chart Example */}\n            <GaugeChart\n              title=\"Sales Target Progress\"\n              value={850000}\n              target={1000000}\n              unit=\" USD\"\n              showPercentage={true}\n              thresholds={{\n                good: 80,\n                warning: 50\n              }}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7130},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/dashboard/chart-type-selection-modal.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Search, Sparkles, Trophy, Brain, MoreHorizontal, Box } from \"lucide-react\";\nimport {\n  BigNumberIcon,\n  TrendlineIcon,\n  GaugeIcon,\n  BarChartIcon,\n  StackedBarIcon,\n  GroupedBarIcon,\n  LineChartIcon,\n  MultiLineIcon,\n  AreaChartIcon,\n  PieChartIcon,\n  DonutChartIcon,\n  ScatterPlotIcon,\n  BubbleChartIcon,\n  HeatmapIcon,\n  TableIcon,\n  FunnelIcon,\n  SankeyIcon,\n  TreemapIcon,\n  RadarIcon,\n  MapIcon,\n  WaterfallIcon,\n  BoxPlotIcon,\n  HistogramIcon,\n  SunburstIcon,\n  MultiValueCardIcon,\n} from \"@/components/icons/chart-icons\";\nimport {\n  CHART_CATALOG,\n  getCategories,\n  searchCharts,\n  getChartsByCategory,\n  type ChartCategory,\n  type ChartType,\n} from \"@/lib/chart-catalog\";\n\nconst categoryIcons: Record<string, any> = {\n  Popular: Sparkles,\n  KPI: GaugeIcon,\n  Distribution: BarChartIcon,\n  Evolution: LineChartIcon,\n  Correlation: ScatterPlotIcon,\n  \"Part of a Whole\": PieChartIcon,\n  Ranking: Trophy,\n  Map: MapIcon,\n  Flow: FunnelIcon,\n  Table: TableIcon,\n  \"Advanced-Analytics\": Brain,\n  Other: MoreHorizontal,\n};\n\nconst chartTypeIcons: Record<string, any> = {\n  big_number: BigNumberIcon,\n  big_number_trendline: TrendlineIcon,\n  gauge: GaugeIcon,\n  bar: BarChartIcon,\n  stacked_bar: StackedBarIcon,\n  grouped_bar: GroupedBarIcon,\n  line: LineChartIcon,\n  multi_line: MultiLineIcon,\n  smooth_line: LineChartIcon,\n  stepped_line: LineChartIcon,\n  area: AreaChartIcon,\n  stacked_area: AreaChartIcon,\n  pie: PieChartIcon,\n  donut: DonutChartIcon,\n  scatter: ScatterPlotIcon,\n  bubble: BubbleChartIcon,\n  heatmap: HeatmapIcon,\n  calendar_heatmap: HeatmapIcon,\n  boxplot: BoxPlotIcon,\n  histogram: HistogramIcon,\n  table: TableIcon,\n  pivot_table: TableIcon,\n  country_map: MapIcon,\n  geojson_map: MapIcon,\n  funnel: FunnelIcon,\n  sankey: SankeyIcon,\n  treemap: TreemapIcon,\n  sunburst: SunburstIcon,\n  waterfall: WaterfallIcon,\n  radar: RadarIcon,\n  multi_value_card: MultiValueCardIcon,\n};\n\ninterface ChartTypeSelectionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelectChartType: (chartType: ChartType) => void;\n}\n\nexport function ChartTypeSelectionModal({\n  isOpen,\n  onClose,\n  onSelectChartType,\n}: ChartTypeSelectionModalProps) {\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"All charts\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const categories = useMemo(() => getCategories(), []);\n\n  const categoryCounts = useMemo(() => {\n    const counts: Record<string, number> = { \"All charts\": CHART_CATALOG.length };\n    categories.forEach((cat) => {\n      counts[cat] = getChartsByCategory(cat).length;\n    });\n    return counts;\n  }, [categories]);\n\n  const filteredCharts = useMemo(() => {\n    let charts = CHART_CATALOG;\n\n    if (selectedCategory !== \"All charts\") {\n      charts = getChartsByCategory(selectedCategory as ChartCategory);\n    }\n\n    if (searchQuery.trim()) {\n      charts = searchCharts(searchQuery).filter((chart) => {\n        if (selectedCategory === \"All charts\") return true;\n        return chart.category.includes(selectedCategory as ChartCategory);\n      });\n    }\n\n    return charts;\n  }, [selectedCategory, searchQuery]);\n\n  const getChartIcon = (chartId: string) => {\n    return chartTypeIcons[chartId] || BarChartIcon;\n  };\n\n  const handleChartClick = (chart: ChartType) => {\n    onSelectChartType(chart);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] p-0\" data-testid=\"dialog-chart-type-selection\">\n        <div className=\"flex h-[80vh]\">\n          {/* Left Sidebar */}\n          <div className=\"w-64 border-r border-border bg-card\">\n            <ScrollArea className=\"h-full\">\n              <div className=\"p-4 space-y-4\">\n                <div>\n                  <h3 className=\"font-semibold mb-2\">Categories</h3>\n                  <Button\n                    variant={selectedCategory === \"All charts\" ? \"default\" : \"ghost\"}\n                    className=\"w-full justify-start\"\n                    onClick={() => setSelectedCategory(\"All charts\")}\n                    data-testid=\"button-category-all-charts\"\n                  >\n                    <Box className=\"mr-2 h-4 w-4\" />\n                    All charts\n                    <span className=\"ml-auto text-xs\">{categoryCounts[\"All charts\"]}</span>\n                  </Button>\n                </div>\n\n                <div className=\"space-y-1\">\n                  {categories.map((category) => {\n                    const Icon = categoryIcons[category] || MoreHorizontal;\n                    return (\n                      <Button\n                        key={category}\n                        variant={selectedCategory === category ? \"default\" : \"ghost\"}\n                        className=\"w-full justify-start\"\n                        onClick={() => setSelectedCategory(category)}\n                        data-testid={`button-category-${category.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                      >\n                        <Icon className=\"mr-2 h-4 w-4\" />\n                        {category}\n                        <span className=\"ml-auto text-xs\">{categoryCounts[category]}</span>\n                      </Button>\n                    );\n                  })}\n                </div>\n              </div>\n            </ScrollArea>\n          </div>\n\n          {/* Main Content */}\n          <div className=\"flex-1 flex flex-col\">\n            <DialogHeader className=\"px-6 py-4 border-b\">\n              <DialogTitle>Choose a Chart Type</DialogTitle>\n              <DialogDescription>\n                Select a visualization type for your data\n              </DialogDescription>\n            </DialogHeader>\n\n            {/* Search Bar */}\n            <div className=\"px-6 py-4 border-b\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search chart types...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-charts\"\n                />\n              </div>\n            </div>\n\n            {/* Charts Grid */}\n            <ScrollArea className=\"flex-1 p-6\">\n              {filteredCharts.length > 0 ? (\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n                  {filteredCharts.map((chart) => {\n                    const ChartIcon = getChartIcon(chart.id);\n                    return (\n                      <Card\n                        key={chart.id}\n                        className=\"cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-105\"\n                        onClick={() => handleChartClick(chart)}\n                        data-testid={`chart-type-card-${chart.id}`}\n                      >\n                        <CardContent className=\"p-4 text-center\">\n                          <div className=\"flex justify-center mb-3\">\n                            <ChartIcon className=\"h-12 w-12\" />\n                          </div>\n                          <h3 className=\"font-semibold text-sm mb-1\">{chart.name}</h3>\n                          <p className=\"text-xs text-muted-foreground line-clamp-2\">\n                            {chart.description}\n                          </p>\n                          <div className=\"flex flex-wrap gap-1 justify-center mt-2\">\n                            {chart.category.slice(0, 2).map((cat) => (\n                              <Badge key={cat} variant=\"secondary\" className=\"text-xs\">\n                                {cat}\n                              </Badge>\n                            ))}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"flex flex-col items-center justify-center h-64 text-muted-foreground\">\n                  <Search className=\"h-12 w-12 mb-4\" />\n                  <p>No charts found matching your search</p>\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":8698},"client/src/components/dashboard/chart-configuration-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Database, X, Loader2, ArrowLeft } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { ChartType } from \"@/lib/chart-catalog\";\nimport type { DataSource } from \"@shared/schema\";\nimport { BigNumberConfig } from \"@/components/chart-config/BigNumberConfig\";\nimport { BarChartConfig } from \"@/components/chart-config/BarChartConfig\";\nimport { LineChartConfig } from \"@/components/chart-config/LineChartConfig\";\nimport { PieChartConfig } from \"@/components/chart-config/PieChartConfig\";\nimport { ScatterChartConfig } from \"@/components/chart-config/ScatterChartConfig\";\nimport { HeatmapConfig } from \"@/components/chart-config/HeatmapConfig\";\nimport { TableConfig } from \"@/components/chart-config/TableConfig\";\nimport { FunnelConfig } from \"@/components/chart-config/FunnelConfig\";\nimport { TreemapConfig } from \"@/components/chart-config/TreemapConfig\";\nimport { RadarConfig } from \"@/components/chart-config/RadarConfig\";\nimport { MapConfig } from \"@/components/chart-config/MapConfig\";\nimport { WaterfallConfig } from \"@/components/chart-config/WaterfallConfig\";\nimport { SankeyConfig } from \"@/components/chart-config/SankeyConfig\";\nimport { HistogramConfig } from \"@/components/chart-config/HistogramConfig\";\nimport { MultiValueConfig } from \"@/components/chart-config/MultiValueConfig\";\nimport { ChartRenderer } from \"./chart-renderer\";\n\ninterface ChartConfigurationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  chartType: ChartType;\n  dashboardId: string;\n  onBack: () => void;\n}\n\n// Helper function to aggregate preview data\nfunction aggregatePreviewData(rawData: any[], config: Record<string, any>, chartType: string): any[] {\n  if (!rawData || rawData.length === 0) return [];\n\n  // For bar/line charts with aggregation\n  if (['bar', 'stacked_bar', 'grouped_bar', 'line', 'multi_line', 'area', 'stacked_area'].includes(chartType)) {\n    const { xAxis, yAxis, aggregation = 'sum', limit, sortOrder = 'desc' } = config;\n    \n    if (!xAxis || !yAxis) return rawData;\n\n    // Group by xAxis and aggregate yAxis\n    const grouped: Record<string, number> = {};\n    const counts: Record<string, number> = {};\n\n    rawData.forEach((row) => {\n      const key = String(row[xAxis] || 'Unknown');\n      const value = parseFloat(row[yAxis]) || 0;\n\n      if (!grouped[key]) {\n        grouped[key] = 0;\n        counts[key] = 0;\n      }\n\n      switch (aggregation) {\n        case 'sum':\n          grouped[key] += value;\n          break;\n        case 'avg':\n          grouped[key] += value;\n          counts[key] += 1;\n          break;\n        case 'count':\n          grouped[key] += 1;\n          break;\n        case 'min':\n          grouped[key] = grouped[key] === 0 ? value : Math.min(grouped[key], value);\n          break;\n        case 'max':\n          grouped[key] = Math.max(grouped[key], value);\n          break;\n        default:\n          grouped[key] += value;\n      }\n    });\n\n    // Convert to array and apply avg calculation if needed\n    let aggregated = Object.entries(grouped).map(([key, value]) => ({\n      [xAxis]: key,\n      [yAxis]: aggregation === 'avg' && counts[key] > 0 ? value / counts[key] : value,\n    }));\n\n    // Sort\n    aggregated.sort((a, b) => {\n      const aVal = Number(a[yAxis]) || 0;\n      const bVal = Number(b[yAxis]) || 0;\n      const diff = bVal - aVal;\n      return sortOrder === 'desc' ? diff : -diff;\n    });\n\n    // Apply limit\n    if (limit && parseInt(limit) > 0) {\n      aggregated = aggregated.slice(0, parseInt(limit));\n    }\n\n    return aggregated;\n  }\n\n  // For pie/donut charts\n  if (['pie', 'donut'].includes(chartType)) {\n    const { category, value, limit, sortOrder = 'desc' } = config;\n    \n    if (!category || !value) return rawData;\n\n    // Group by category and sum values\n    const grouped: Record<string, number> = {};\n\n    rawData.forEach((row) => {\n      const key = String(row[category] || 'Unknown');\n      const val = parseFloat(row[value]) || 0;\n      grouped[key] = (grouped[key] || 0) + val;\n    });\n\n    // Convert to array\n    let aggregated = Object.entries(grouped).map(([key, val]) => ({\n      [category]: key,\n      [value]: val,\n    }));\n\n    // Sort\n    aggregated.sort((a, b) => {\n      const aVal = Number(a[value]) || 0;\n      const bVal = Number(b[value]) || 0;\n      const diff = bVal - aVal;\n      return sortOrder === 'desc' ? diff : -diff;\n    });\n\n    // Apply limit\n    if (limit && parseInt(limit) > 0) {\n      aggregated = aggregated.slice(0, parseInt(limit));\n    }\n\n    return aggregated;\n  }\n\n  return rawData;\n}\n\nexport function ChartConfigurationModal({\n  isOpen,\n  onClose,\n  chartType,\n  dashboardId,\n  onBack,\n}: ChartConfigurationModalProps) {\n  const { toast } = useToast();\n  const [title, setTitle] = useState(`New ${chartType.name}`);\n  const [selectedDatasets, setSelectedDatasets] = useState<string[]>([]);\n  const [config, setConfig] = useState<Record<string, any>>({});\n  const [availableColumns, setAvailableColumns] = useState<string[]>([]);\n  const [previewData, setPreviewData] = useState<any[]>([]);\n\n  // Fetch all available datasets\n  const { data: dataSources = [], isLoading: dataSourcesLoading } = useQuery<DataSource[]>({\n    queryKey: [\"/api/data-sources\"],\n    enabled: isOpen,\n  });\n\n  // Fetch columns and preview data from selected datasets\n  useEffect(() => {\n    const fetchColumnsAndPreview = async () => {\n      if (selectedDatasets.length === 0) {\n        setAvailableColumns([]);\n        setPreviewData([]);\n        return;\n      }\n\n      try {\n        const [columnSets, previewSets] = await Promise.all([\n          Promise.all(\n            selectedDatasets.map(async (datasetId) => {\n              const response = await fetch(`/api/data-sources/${datasetId}/columns`, {\n                credentials: \"include\",\n              });\n              if (response.ok) {\n                const data = await response.json();\n                const columns = data.columns || [];\n                return columns.map((col: any) => typeof col === 'string' ? col : col.name);\n              }\n              return [];\n            })\n          ),\n          Promise.all(\n            selectedDatasets.map(async (datasetId) => {\n              const response = await fetch(`/api/data-sources/${datasetId}/preview?limit=50`, {\n                credentials: \"include\",\n              });\n              if (response.ok) {\n                const data = await response.json();\n                return data.data || [];\n              }\n              return [];\n            })\n          )\n        ]);\n\n        const allColumns = Array.from(new Set(columnSets.flat()));\n        setAvailableColumns(allColumns);\n        \n        // Use preview data from first selected dataset\n        setPreviewData(previewSets[0] || []);\n      } catch (error) {\n        console.error(\"Failed to fetch columns and preview:\", error);\n        setAvailableColumns([]);\n        setPreviewData([]);\n      }\n    };\n\n    fetchColumnsAndPreview();\n  }, [selectedDatasets]);\n\n  // Initialize config with defaults\n  useEffect(() => {\n    const getDefaultConfig = () => {\n      const baseConfig: Record<string, any> = {};\n      \n      // Add common defaults based on chart type\n      if (['bar', 'stacked_bar', 'grouped_bar'].includes(chartType.id)) {\n        return { xAxis: \"\", yAxis: \"\", aggregation: \"sum\", limit: \"\", sortOrder: \"desc\" };\n      } else if (['line', 'multi_line', 'area', 'stacked_area'].includes(chartType.id)) {\n        return { xAxis: \"\", yAxis: \"\", groupBy: \"\", lineStyle: \"linear\", showDataPoints: false };\n      } else if (['pie', 'donut'].includes(chartType.id)) {\n        return { category: \"\", value: \"\", limit: \"\", donutMode: chartType.id === \"donut\" };\n      } else if (['big_number', 'big_number_trendline', 'gauge'].includes(chartType.id)) {\n        return { metric: \"\", format: \"number\", decimals: \"0\" };\n      } else if (['table', 'pivot_table'].includes(chartType.id)) {\n        return { columns: [], orderBy: \"\", limit: \"\" };\n      }\n      \n      return baseConfig;\n    };\n\n    setConfig(getDefaultConfig());\n  }, [chartType.id]);\n\n  const createChartMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return apiRequest(\"POST\", \"/api/charts\", data);\n    },\n    onSuccess: async (response) => {\n      const chartData = await response.json();\n      \n      // Link chart to dashboard\n      await apiRequest(\"POST\", `/api/dashboards/${dashboardId}/charts`, {\n        chartId: chartData.id,\n        x: 0,\n        y: 0,\n        w: 6,\n        h: 4,\n      });\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\", dashboardId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\", dashboardId, \"charts\"] });\n      \n      toast({\n        title: \"Success\",\n        description: \"Chart created successfully\",\n      });\n      \n      onClose();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create chart\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const validateChartConfig = (): { valid: boolean; error?: string } => {\n    const type = chartType.id;\n    \n    // Validate based on chart type\n    if (['big_number', 'gauge'].includes(type)) {\n      if (!config.metric) {\n        return { valid: false, error: \"Metric column is required for this chart type\" };\n      }\n    } else if (['big_number_trendline'].includes(type)) {\n      if (!config.metric || !config.timeColumn) {\n        return { valid: false, error: \"Both metric and time column are required for trendline\" };\n      }\n    } else if (['bar', 'stacked_bar', 'grouped_bar', 'horizontal_bar'].includes(type)) {\n      if (!config.xAxis || !config.yAxis) {\n        return { valid: false, error: \"Both X-Axis and Y-Axis columns are required\" };\n      }\n    } else if (['line', 'multi_line', 'smooth_line', 'stepped_line', 'area', 'stacked_area'].includes(type)) {\n      if (!config.xAxis || !config.yAxis) {\n        return { valid: false, error: \"Both X-Axis and Y-Axis columns are required\" };\n      }\n    } else if (['pie', 'donut'].includes(type)) {\n      if (!config.category || !config.value) {\n        return { valid: false, error: \"Both category and value columns are required\" };\n      }\n    } else if (['scatter', 'bubble'].includes(type)) {\n      if (!config.xAxis || !config.yAxis) {\n        return { valid: false, error: \"Both X-Axis and Y-Axis columns are required\" };\n      }\n    } else if (['heatmap', 'calendar_heatmap'].includes(type)) {\n      if (!config.xAxis || !config.yAxis || !config.metric) {\n        return { valid: false, error: \"X-Axis, Y-Axis, and metric columns are required\" };\n      }\n    } else if (['table', 'pivot_table'].includes(type)) {\n      if (!Array.isArray(config.columns) || config.columns.length === 0) {\n        return { valid: false, error: \"At least one column must be selected\" };\n      }\n    } else if (['funnel'].includes(type)) {\n      if (!config.stage || !config.metric) {\n        return { valid: false, error: \"Stage and metric columns are required\" };\n      }\n    } else if (['treemap', 'sunburst'].includes(type)) {\n      if (!Array.isArray(config.dimensions) || config.dimensions.length === 0 || !config.metric) {\n        return { valid: false, error: \"At least one dimension and a metric column are required\" };\n      }\n    } else if (['radar'].includes(type)) {\n      if (!Array.isArray(config.dimensions) || config.dimensions.length === 0 || \n          !Array.isArray(config.metrics) || config.metrics.length === 0) {\n        return { valid: false, error: \"At least one dimension and one metric are required\" };\n      }\n    } else if (['multi_value_card'].includes(type)) {\n      if (!Array.isArray(config.metrics) || config.metrics.length === 0) {\n        return { valid: false, error: \"At least one metric must be selected\" };\n      }\n    } else if (['sankey'].includes(type)) {\n      if (!config.source || !config.target || !config.value) {\n        return { valid: false, error: \"Source, target, and value columns are required\" };\n      }\n    } else if (['waterfall'].includes(type)) {\n      if (!config.category || !config.value) {\n        return { valid: false, error: \"Category and value columns are required\" };\n      }\n    } else if (['boxplot', 'histogram'].includes(type)) {\n      if (!config.metric) {\n        return { valid: false, error: \"Metric column is required\" };\n      }\n    } else if (['country_map', 'geojson_map'].includes(type)) {\n      if (!config.location || !config.metric) {\n        return { valid: false, error: \"Location and metric columns are required\" };\n      }\n    }\n    \n    return { valid: true };\n  };\n\n  const handleSave = () => {\n    if (!title.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Chart title is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (selectedDatasets.length === 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please select at least one dataset\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const validation = validateChartConfig();\n    if (!validation.valid) {\n      toast({\n        title: \"Configuration Error\",\n        description: validation.error,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createChartMutation.mutate({\n      title,\n      type: chartType.id,\n      config,\n      dataSourceIds: selectedDatasets,\n      query: null,\n    });\n  };\n\n  const toggleDataset = (datasetId: string) => {\n    setSelectedDatasets(prev =>\n      prev.includes(datasetId)\n        ? prev.filter(id => id !== datasetId)\n        : [...prev, datasetId]\n    );\n  };\n\n  const removeDataset = (datasetId: string) => {\n    setSelectedDatasets(prev => prev.filter(id => id !== datasetId));\n  };\n\n  const renderChartConfig = () => {\n    const commonProps = {\n      config,\n      onChange: setConfig,\n      columns: availableColumns,\n    };\n\n    switch (chartType.id) {\n      case \"big_number\":\n      case \"big_number_trendline\":\n      case \"gauge\":\n      case \"multi_value_card\":\n        return chartType.id === \"multi_value_card\" ? (\n          <MultiValueConfig {...commonProps} />\n        ) : (\n          <BigNumberConfig {...commonProps} chartType={chartType.id} />\n        );\n      \n      case \"bar\":\n      case \"stacked_bar\":\n      case \"grouped_bar\":\n      case \"horizontal_bar\":\n        return <BarChartConfig {...commonProps} />;\n      \n      case \"line\":\n      case \"multi_line\":\n      case \"smooth_line\":\n      case \"stepped_line\":\n      case \"area\":\n      case \"stacked_area\":\n        return <LineChartConfig {...commonProps} />;\n      \n      case \"pie\":\n      case \"donut\":\n        return <PieChartConfig {...commonProps} />;\n      \n      case \"scatter\":\n      case \"bubble\":\n        return <ScatterChartConfig {...commonProps} />;\n      \n      case \"heatmap\":\n      case \"calendar_heatmap\":\n        return <HeatmapConfig {...commonProps} />;\n      \n      case \"table\":\n      case \"pivot_table\":\n        return <TableConfig {...commonProps} />;\n      \n      case \"funnel\":\n        return <FunnelConfig {...commonProps} />;\n      \n      case \"treemap\":\n      case \"sunburst\":\n        return <TreemapConfig {...commonProps} />;\n      \n      case \"radar\":\n        return <RadarConfig {...commonProps} />;\n      \n      case \"country_map\":\n      case \"geojson_map\":\n        return <MapConfig {...commonProps} />;\n      \n      case \"waterfall\":\n        return <WaterfallConfig {...commonProps} />;\n      \n      case \"sankey\":\n        return <SankeyConfig {...commonProps} />;\n      \n      case \"boxplot\":\n      case \"histogram\":\n        return <HistogramConfig {...commonProps} />;\n      \n      default:\n        return (\n          <div className=\"text-center text-muted-foreground py-8\">\n            Configuration for {chartType.name} will be available soon\n          </div>\n        );\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-7xl max-h-[90vh] p-0\" data-testid=\"dialog-chart-configuration\">\n        <div className=\"flex flex-col h-[85vh]\">\n          <DialogHeader className=\"px-6 py-4 border-b\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={onBack}\n                data-testid=\"button-back-to-chart-types\"\n              >\n                <ArrowLeft className=\"h-4 w-4\" />\n              </Button>\n              <div className=\"flex-1\">\n                <DialogTitle>Configure {chartType.name}</DialogTitle>\n                <DialogDescription>{chartType.description}</DialogDescription>\n              </div>\n            </div>\n          </DialogHeader>\n\n          <div className=\"flex flex-1 overflow-hidden\">\n            {/* Configuration Panel - Left Side */}\n            <ScrollArea className=\"flex-1 border-r p-6\">\n            <div className=\"space-y-6\">\n              {/* Chart Title */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"chart-title\">Chart Title</Label>\n                <Input\n                  id=\"chart-title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"Enter chart title\"\n                  data-testid=\"input-chart-title\"\n                />\n              </div>\n\n              <Separator />\n\n              {/* Dataset Selection */}\n              <div className=\"space-y-3\">\n                <Label className=\"flex items-center gap-2\">\n                  <Database className=\"h-4 w-4\" />\n                  Select Dataset(s)\n                </Label>\n                \n                {dataSourcesLoading ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : dataSources.length > 0 ? (\n                  <>\n                    <Select onValueChange={toggleDataset}>\n                      <SelectTrigger data-testid=\"select-dataset\">\n                        <SelectValue placeholder=\"Choose a dataset\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {dataSources.map((ds) => (\n                          <SelectItem \n                            key={ds.id} \n                            value={ds.id}\n                            disabled={selectedDatasets.includes(ds.id)}\n                          >\n                            {ds.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n\n                    {selectedDatasets.length > 0 && (\n                      <div className=\"flex flex-wrap gap-2\">\n                        {selectedDatasets.map((dsId) => {\n                          const ds = dataSources.find(d => d.id === dsId);\n                          return (\n                            <Badge key={dsId} variant=\"secondary\" className=\"gap-1\">\n                              {ds?.name || dsId}\n                              <X\n                                className=\"h-3 w-3 cursor-pointer hover:text-destructive\"\n                                onClick={() => removeDataset(dsId)}\n                                data-testid={`button-remove-dataset-${dsId}`}\n                              />\n                            </Badge>\n                          );\n                        })}\n                      </div>\n                    )}\n                  </>\n                ) : (\n                  <div className=\"text-center text-muted-foreground py-8 border-2 border-dashed rounded-lg\">\n                    <Database className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                    <p>No datasets available</p>\n                    <p className=\"text-sm\">Upload data or connect a database first</p>\n                  </div>\n                )}\n              </div>\n\n              <Separator />\n\n              {/* Chart-specific Configuration */}\n              {selectedDatasets.length > 0 && (\n                <div className=\"space-y-3\">\n                  <Label>Chart Configuration</Label>\n                  {renderChartConfig()}\n                </div>\n              )}\n            </div>\n            </ScrollArea>\n\n            {/* Preview Panel - Right Side */}\n            <div className=\"w-1/2 p-6 bg-muted/30 flex flex-col\">\n              <h3 className=\"text-sm font-semibold mb-4\">Live Preview</h3>\n              <div className=\"flex-1 border rounded-lg bg-background p-4\">\n                {selectedDatasets.length === 0 ? (\n                  <div className=\"h-full flex items-center justify-center\">\n                    <p className=\"text-muted-foreground text-sm\">Select a dataset to see preview</p>\n                  </div>\n                ) : !config.xAxis && !config.yAxis && !config.metric && !config.category ? (\n                  <div className=\"h-full flex items-center justify-center\">\n                    <p className=\"text-muted-foreground text-sm\">Configure chart columns to see preview</p>\n                  </div>\n                ) : previewData.length === 0 ? (\n                  <div className=\"h-full flex items-center justify-center\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : (\n                  <ChartRenderer\n                    chart={{\n                      id: \"preview\",\n                      createdAt: null,\n                      updatedAt: null,\n                      title: title,\n                      type: chartType.id,\n                      config: config,\n                      dataSourceIds: selectedDatasets,\n                      userId: \"\",\n                      query: null\n                    }}\n                    data={aggregatePreviewData(previewData, config, chartType.id)}\n                    isPreview={true}\n                  />\n                )}\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter className=\"px-6 py-4 border-t\">\n            <Button\n              variant=\"outline\"\n              onClick={onClose}\n              data-testid=\"button-cancel-chart\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSave}\n              disabled={createChartMutation.isPending || selectedDatasets.length === 0}\n              data-testid=\"button-save-chart\"\n            >\n              {createChartMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Creating...\n                </>\n              ) : (\n                \"Create Chart\"\n              )}\n            </Button>\n          </DialogFooter>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":23511},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/chart-config/ScatterChartConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface ScatterChartConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function ScatterChartConfig({ config, onChange, columns = [] }: ScatterChartConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"xAxis\">X-Axis</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.xAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"xAxis\", value)}\n          >\n            <SelectTrigger id=\"xAxis\" data-testid=\"select-xaxis\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"xAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.xAxis || \"\"}\n            onChange={(e) => updateConfig(\"xAxis\", e.target.value)}\n            data-testid=\"input-xaxis\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"yAxis\">Y-Axis</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.yAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"yAxis\", value)}\n          >\n            <SelectTrigger id=\"yAxis\" data-testid=\"select-yaxis\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"yAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.yAxis || \"\"}\n            onChange={(e) => updateConfig(\"yAxis\", e.target.value)}\n            data-testid=\"input-yaxis\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"size\">Size (Optional)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.size || \"\"}\n            onValueChange={(value) => updateConfig(\"size\", value)}\n          >\n            <SelectTrigger id=\"size\" data-testid=\"select-size\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"\">None</SelectItem>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"size\"\n            placeholder=\"Select a dataset first\"\n            value={config.size || \"\"}\n            onChange={(e) => updateConfig(\"size\", e.target.value)}\n            data-testid=\"input-size\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"color\">Color By (Optional)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.color || \"\"}\n            onValueChange={(value) => updateConfig(\"color\", value)}\n          >\n            <SelectTrigger id=\"color\" data-testid=\"select-color\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"\">None</SelectItem>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"color\"\n            placeholder=\"Select a dataset first\"\n            value={config.color || \"\"}\n            onChange={(e) => updateConfig(\"color\", e.target.value)}\n            data-testid=\"input-color\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"limit\">Point Limit</Label>\n        <Input\n          id=\"limit\"\n          type=\"number\"\n          placeholder=\"e.g., 1000\"\n          value={config.limit || \"\"}\n          onChange={(e) => updateConfig(\"limit\", e.target.value)}\n          data-testid=\"input-limit\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":5005},"attached_assets/content-1758806126063.md":{"content":"","size_bytes":0},"server/services/ai-query-service.ts":{"content":"/**\n * AI Query Service\n * \n * Handles multi-table queries with automatic relationship detection and JOIN generation\n */\n\nimport path from 'path';\nimport fs from 'fs';\nimport { storage } from '../storage';\nimport { parseCSVFile } from '../ai';\nimport { analyzeDataWithPrivacy } from '../ai-privacy';\nimport { generateSQLQuery } from './sql-generator';\nimport { SchemaAnalyzer, type TableSchema, type TableRelationship } from './schema-analyzer';\nimport { DatabaseConnectorService } from './database-connectors';\n\ninterface AiQueryRequest {\n  question: string;\n  dataSourceIds: string[];\n  userId: string;\n  isVoiceQuery?: boolean;\n}\n\ninterface AiQueryResponse {\n  answer: string;\n  chartData?: any;\n  chartType?: string;\n  kpiValue?: string;\n  unit?: string;\n  sqlQuery?: string;\n  relationships?: TableRelationship[];\n  metadata?: any;\n}\n\nexport class AiQueryService {\n  /**\n   * Process AI query with automatic multi-table joining\n   */\n  static async processQuery(request: AiQueryRequest): Promise<AiQueryResponse> {\n    const { question, dataSourceIds, userId } = request;\n\n    // Load and validate all data sources\n    const dataSources = await this.loadDataSources(dataSourceIds, userId);\n\n    if (dataSources.length === 0) {\n      throw new Error('No valid data sources found');\n    }\n\n    // Handle CSV files (single source only)\n    const csvSource = dataSources.find(ds => ds.filename);\n    if (csvSource) {\n      return await this.processCsvQuery(question, csvSource);\n    }\n\n    // Handle database table queries\n    const tableSources = dataSources.filter(ds => (ds.metadata as any)?.isTableDataset);\n    \n    if (tableSources.length === 0) {\n      throw new Error('No table datasets found');\n    }\n\n    if (tableSources.length === 1) {\n      // Single table query\n      return await this.processSingleTableQuery(question, tableSources[0]);\n    } else {\n      // Multi-table query with auto-join\n      return await this.processMultiTableQuery(question, tableSources);\n    }\n  }\n\n  /**\n   * Load and authorize data sources\n   */\n  private static async loadDataSources(dataSourceIds: string[], userId: string): Promise<any[]> {\n    const sources = await Promise.all(\n      dataSourceIds.map(async (id) => {\n        const ds = await storage.getDataSource(id);\n        if (ds && ds.userId === userId) {\n          return ds;\n        }\n        return null;\n      })\n    );\n\n    return sources.filter(ds => ds !== null);\n  }\n\n  /**\n   * Process CSV file query using Python sandbox\n   */\n  private static async processCsvQuery(question: string, dataSource: any): Promise<AiQueryResponse> {\n    const filePath = path.join(process.cwd(), 'uploads', dataSource.filename);\n    \n    if (!fs.existsSync(filePath)) {\n      throw new Error('CSV file not found');\n    }\n\n    const csvData = await parseCSVFile(filePath);\n\n    // Use Python sandbox for advanced analysis\n    const { analyzeDataWithPythonSandbox } = await import('../ai-privacy');\n    \n    const analysis = await analyzeDataWithPythonSandbox({\n      question,\n      csvData,\n      dataSourceMetadata: {\n        name: dataSource.name,\n        type: dataSource.type\n      }\n    });\n\n    return {\n      answer: analysis.answer,\n      chartData: analysis.chartData,\n      chartType: analysis.chartType,\n      kpiValue: analysis.kpiValue,\n      unit: analysis.unit\n    };\n  }\n\n  /**\n   * Process single table database query\n   */\n  private static async processSingleTableQuery(question: string, dataSource: any): Promise<AiQueryResponse> {\n    const metadata = dataSource.metadata as any;\n    \n    const connectionConfig = {\n      host: metadata.host,\n      port: metadata.port,\n      database: metadata.database,\n      username: metadata.username,\n      password: metadata.password\n    };\n\n    // Get schema information\n    const tableName = `${metadata.schemaName}.${metadata.tableName}`;\n    const sampleQuery = metadata.connectionType === 'sqlserver' \n      ? `SELECT TOP 10 * FROM ${tableName}`\n      : `SELECT * FROM ${tableName} LIMIT 10`;\n\n    const sampleResult = await DatabaseConnectorService.executeQuery(\n      metadata.connectionType || dataSource.type,\n      connectionConfig,\n      sampleQuery\n    );\n\n    // Extract column information\n    const columns = this.extractColumns(sampleResult);\n\n    // Generate SQL query\n    const sqlGeneration = await generateSQLQuery({\n      question,\n      tableName: metadata.tableName,\n      schemaName: metadata.schemaName,\n      columns,\n      databaseType: metadata.connectionType || dataSource.type\n    });\n\n    console.log('Generated SQL query:', sqlGeneration.sql);\n\n    // Execute the generated SQL\n    const queryResult = await DatabaseConnectorService.executeQuery(\n      metadata.connectionType || dataSource.type,\n      connectionConfig,\n      sqlGeneration.sql\n    );\n\n    // Convert results to CSV format for analysis\n    const csvData = this.convertResultsToCsvFormat(queryResult);\n\n    // Analyze results\n    const analysis = await analyzeDataWithPrivacy({\n      question,\n      csvData,\n      dataSourceMetadata: {\n        name: dataSource.name,\n        type: dataSource.type,\n        tableName: metadata.tableName,\n        schemaName: metadata.schemaName\n      }\n    });\n\n    return {\n      answer: analysis.answer,\n      chartData: analysis.chartData,\n      chartType: analysis.chartType,\n      kpiValue: analysis.kpiValue,\n      unit: analysis.unit,\n      sqlQuery: sqlGeneration.sql,\n      metadata: {\n        sqlResults: queryResult ? { rowCount: queryResult.rowCount } : null\n      }\n    };\n  }\n\n  /**\n   * Process multi-table query with auto-joining\n   */\n  private static async processMultiTableQuery(question: string, dataSources: any[]): Promise<AiQueryResponse> {\n    // Gather schema information for all tables\n    const schemas: TableSchema[] = [];\n    const connectionConfigs = new Map<string, any>();\n\n    for (const dataSource of dataSources) {\n      const metadata = dataSource.metadata as any;\n      \n      const connectionConfig = {\n        host: metadata.host,\n        port: metadata.port,\n        database: metadata.database,\n        username: metadata.username,\n        password: metadata.password\n      };\n\n      connectionConfigs.set(dataSource.id, {\n        config: connectionConfig,\n        type: metadata.connectionType || dataSource.type\n      });\n\n      // Get schema information\n      const tableName = `${metadata.schemaName}.${metadata.tableName}`;\n      const sampleQuery = metadata.connectionType === 'sqlserver' \n        ? `SELECT TOP 10 * FROM ${tableName}`\n        : `SELECT * FROM ${tableName} LIMIT 10`;\n\n      const sampleResult = await DatabaseConnectorService.executeQuery(\n        metadata.connectionType || dataSource.type,\n        connectionConfig,\n        sampleQuery\n      );\n\n      const columns = this.extractColumns(sampleResult);\n\n      schemas.push({\n        dataSourceId: dataSource.id,\n        tableName: metadata.tableName,\n        schemaName: metadata.schemaName,\n        columns\n      });\n    }\n\n    // Detect relationships between tables\n    const relationships = SchemaAnalyzer.detectRelationships(schemas);\n\n    console.log('Detected relationships:', JSON.stringify(relationships, null, 2));\n\n    // Generate SQL with JOINs\n    const sqlWithJoins = await this.generateMultiTableSQL(question, schemas, relationships, dataSources);\n\n    console.log('Generated multi-table SQL:', sqlWithJoins);\n\n    // Execute on the first data source's connection (all tables should be in same database)\n    const firstSource = dataSources[0];\n    const firstMetadata = firstSource.metadata as any;\n    const connInfo = connectionConfigs.get(firstSource.id)!;\n\n    const queryResult = await DatabaseConnectorService.executeQuery(\n      connInfo.type,\n      connInfo.config,\n      sqlWithJoins\n    );\n\n    // Convert results\n    const csvData = this.convertResultsToCsvFormat(queryResult);\n\n    // Analyze results\n    const analysis = await analyzeDataWithPrivacy({\n      question,\n      csvData,\n      dataSourceMetadata: {\n        name: dataSources.map(ds => ds.name).join(', '),\n        type: 'multi-table',\n        tables: dataSources.map(ds => (ds.metadata as any).tableName)\n      }\n    });\n\n    return {\n      answer: analysis.answer,\n      chartData: analysis.chartData,\n      chartType: analysis.chartType,\n      kpiValue: analysis.kpiValue,\n      unit: analysis.unit,\n      sqlQuery: sqlWithJoins,\n      relationships,\n      metadata: {\n        sqlResults: queryResult ? { rowCount: queryResult.rowCount } : null,\n        tablesUsed: dataSources.map(ds => ({\n          name: (ds.metadata as any).tableName,\n          schema: (ds.metadata as any).schemaName\n        }))\n      }\n    };\n  }\n\n  /**\n   * Generate SQL query for multiple tables with JOINs\n   */\n  private static async generateMultiTableSQL(\n    question: string,\n    schemas: TableSchema[],\n    relationships: TableRelationship[],\n    dataSources: any[]\n  ): Promise<string> {\n    // Build schema description for all tables\n    const schemaDescriptions = schemas.map(schema => {\n      const fullTableName = schema.schemaName ? `${schema.schemaName}.${schema.tableName}` : schema.tableName;\n      const columnList = schema.columns.map(col => `  - ${col.name} (${col.type})`).join('\\n');\n      return `Table: ${fullTableName}\\nColumns:\\n${columnList}`;\n    }).join('\\n\\n');\n\n    // Build relationship descriptions\n    const relationshipDescriptions = relationships.map(rel => \n      `${rel.leftTable}.${rel.leftColumn} = ${rel.rightTable}.${rel.rightColumn} (confidence: ${rel.confidence})`\n    ).join('\\n');\n\n    const firstMetadata = dataSources[0].metadata as any;\n    const databaseType = firstMetadata.connectionType || dataSources[0].type;\n\n    // Use OpenAI to generate SQL with JOINs\n    const OpenAI = (await import('openai')).default;\n    const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\n    const systemPrompt = `You are an expert SQL query generator. Generate SQL queries that JOIN multiple tables based on detected relationships.\n\nIMPORTANT RULES:\n1. Generate ONLY valid SQL for ${databaseType} databases\n2. Use the detected relationships to JOIN tables\n3. Select relevant columns from all tables that answer the question\n4. Use proper table aliases for clarity\n5. Return ONLY executable SQL - no explanations in the SQL itself\n6. For SQL Server, use TOP N instead of LIMIT N\n7. Handle NULL values appropriately\n\nReturn your response in JSON format:\n{\n  \"sql\": \"The complete SQL query with JOINs\",\n  \"explanation\": \"Brief explanation of the query and joins used\"\n}`;\n\n    const userPrompt = `${schemaDescriptions}\n\nDetected Relationships:\n${relationshipDescriptions}\n\nUser Question: ${question}\n\nGenerate a SQL query that JOINs the necessary tables to answer this question. Use the detected relationships to join tables correctly.`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt }\n      ],\n      response_format: { type: \"json_object\" },\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    return result.sql || \"\";\n  }\n\n  /**\n   * Extract columns from query result\n   */\n  private static extractColumns(sampleResult: any): Array<{ name: string; type: string }> {\n    const columns: Array<{ name: string; type: string }> = [];\n\n    if (sampleResult.rows && sampleResult.rows.length > 0 && sampleResult.columns) {\n      const sampleRow = sampleResult.rows[0];\n      sampleResult.columns.forEach((colName: string, idx: number) => {\n        const value = sampleRow[idx];\n        let type = 'string';\n\n        if (value === null || value === undefined) {\n          type = 'unknown';\n        } else if (typeof value === 'number') {\n          type = Number.isInteger(value) ? 'integer' : 'float';\n        } else if (value instanceof Date) {\n          type = 'date';\n        } else if (typeof value === 'boolean') {\n          type = 'boolean';\n        }\n\n        columns.push({ name: colName, type });\n      });\n    }\n\n    return columns;\n  }\n\n  /**\n   * Convert database results to CSV format\n   */\n  private static convertResultsToCsvFormat(queryResult: any): any[] {\n    if (!queryResult.rows || !queryResult.columns) {\n      return [];\n    }\n\n    return queryResult.rows.map((row: any[]) => {\n      const obj: any = {};\n      queryResult.columns.forEach((col: string, idx: number) => {\n        obj[col] = row[idx];\n      });\n      return obj;\n    });\n  }\n}\n","size_bytes":12505},"client/src/components/chart-config/FunnelConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface FunnelConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function FunnelConfig({ config, onChange, columns = [] }: FunnelConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"stage\">Stage Column</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.stage || \"\"}\n            onValueChange={(value) => updateConfig(\"stage\", value)}\n          >\n            <SelectTrigger id=\"stage\" data-testid=\"select-stage\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"stage\"\n            placeholder=\"Select a dataset first\"\n            value={config.stage || \"\"}\n            onChange={(e) => updateConfig(\"stage\", e.target.value)}\n            data-testid=\"input-stage\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"metric\">Value Metric</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.metric || \"\"}\n            onValueChange={(value) => updateConfig(\"metric\", value)}\n          >\n            <SelectTrigger id=\"metric\" data-testid=\"select-metric\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"metric\"\n            placeholder=\"Select a dataset first\"\n            value={config.metric || \"\"}\n            onChange={(e) => updateConfig(\"metric\", e.target.value)}\n            data-testid=\"input-metric\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"orientation\">Orientation</Label>\n        <Select\n          value={config.orientation || \"vertical\"}\n          onValueChange={(value) => updateConfig(\"orientation\", value)}\n        >\n          <SelectTrigger id=\"orientation\" data-testid=\"select-orientation\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"vertical\">Vertical</SelectItem>\n            <SelectItem value=\"horizontal\">Horizontal</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"labelPosition\">Label Position</Label>\n        <Select\n          value={config.labelPosition || \"inside\"}\n          onValueChange={(value) => updateConfig(\"labelPosition\", value)}\n        >\n          <SelectTrigger id=\"labelPosition\" data-testid=\"select-label-position\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"inside\">Inside</SelectItem>\n            <SelectItem value=\"outside\">Outside</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3755},"server/services/ai-code-generator.ts":{"content":"/**\n * AI Code Generator Service\n * \n * Uses OpenAI to generate Python/analysis code based on masked data schemas.\n * This code is then executed locally on real data to preserve privacy.\n */\n\nimport OpenAI from \"openai\";\nimport { DataSchema, createPrivacySafeDataSummary } from \"./data-masking\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY \n});\n\nexport interface CodeGenerationRequest {\n  question: string;\n  dataSchema: DataSchema;\n  dummyDataSummary: string;\n}\n\nexport interface CodeGenerationResponse {\n  code: string;\n  explanation: string;\n  outputType: 'value' | 'dataframe' | 'chart';\n  chartConfig?: any;\n}\n\n/**\n * Generate Python analysis code using OpenAI\n */\nexport async function generateAnalysisCode(request: CodeGenerationRequest): Promise<CodeGenerationResponse> {\n  const { question, dummyDataSummary } = request;\n  \n  const systemPrompt = `You are an expert data analyst and Python developer. Your task is to generate Python code that analyzes data based on the user's question.\n\nIMPORTANT PRIVACY RULE: You will receive DUMMY DATA for context, not real data. Generate code that works with the data structure shown in the dummy data.\n\nYour code should:\n1. Work with a pandas DataFrame named 'df' (this will contain the real data at runtime)\n2. Perform the requested analysis\n3. Return results in a specific format\n4. Be safe and efficient\n\nReturn your response in JSON format with:\n- \"code\": The Python code as a string\n- \"explanation\": Brief explanation of what the code does\n- \"outputType\": One of \"value\" (single number/string), \"dataframe\" (table), or \"chart\" (visualization)\n- \"chartConfig\": If outputType is \"chart\", include configuration for the chart (type, x_axis, y_axis, etc.)`;\n\n  const userPrompt = `${dummyDataSummary}\n\nUser Question: ${question}\n\nGenerate Python code that:\n1. Analyzes the data to answer the question\n2. Stores the result in a variable called 'result'\n3. For numeric results, return a single value\n4. For tabular results, return a DataFrame\n5. For visualizations, include chart configuration\n\nRemember: The sample data above is DUMMY DATA. Write code that works with the structure, not the specific values.`;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 4096\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    return {\n      code: result.code || \"\",\n      explanation: result.explanation || \"Analysis code generated\",\n      outputType: result.outputType || \"value\",\n      chartConfig: result.chartConfig\n    };\n  } catch (error) {\n    console.error(\"Code generation error:\", error);\n    throw new Error(`Failed to generate analysis code: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\n/**\n * Generate chart configuration JSON (Superset-style)\n */\nexport async function generateChartConfig(\n  question: string,\n  dataSchema: DataSchema,\n  analysisResult: any\n): Promise<any> {\n  const systemPrompt = `You are an expert in data visualization. Generate a chart configuration in Apache Superset style (JSON format) based on the user's request and data.\n\nReturn JSON with:\n- \"chartType\": \"bar\", \"line\", \"pie\", \"area\", or \"scatter\"\n- \"title\": Chart title\n- \"xAxis\": { \"field\": \"column_name\", \"label\": \"X Axis Label\" }\n- \"yAxis\": { \"field\": \"column_name\", \"label\": \"Y Axis Label\" }\n- \"data\": The processed data array\n- \"options\": Additional chart options (colors, legend, etc.)`;\n\n  const columns = dataSchema.columns.map(c => c.name).join(', ');\n  const userPrompt = `Data columns: ${columns}\n\nUser Question: ${question}\n\nAnalysis Result: ${JSON.stringify(analysisResult).substring(0, 500)}\n\nGenerate a chart configuration that best visualizes this data to answer the user's question.`;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 2048\n    });\n\n    return JSON.parse(response.choices[0].message.content || \"{}\");\n  } catch (error) {\n    console.error(\"Chart config generation error:\", error);\n    return null;\n  }\n}\n\n/**\n * Generate natural language answer from analysis results\n */\nexport async function generateNaturalLanguageAnswer(\n  question: string,\n  analysisResult: any,\n  chartConfig?: any\n): Promise<string> {\n  const systemPrompt = `You are a helpful business intelligence assistant. Provide clear, concise answers based on data analysis results.`;\n\n  const resultSummary = typeof analysisResult === 'object' \n    ? JSON.stringify(analysisResult).substring(0, 1000)\n    : String(analysisResult);\n\n  const userPrompt = `User Question: ${question}\n\nAnalysis Result: ${resultSummary}\n\nProvide a clear, conversational answer to the user's question based on these results. Be specific and include key numbers or insights.`;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt }\n      ],\n      max_completion_tokens: 512\n    });\n\n    return response.choices[0].message.content || \"I've analyzed the data for you.\";\n  } catch (error) {\n    console.error(\"Answer generation error:\", error);\n    return \"I've completed the analysis based on your data.\";\n  }\n}\n","size_bytes":6167},"replit.md":{"content":"# Overview\n\nThis is a full-stack business intelligence application called NEX Sight that enables users to analyze data through AI-powered conversations and visualizations. The application combines data warehousing capabilities with natural language processing to make business intelligence accessible through chat interfaces and voice interactions.\n\nThe system allows users to upload datasets (primarily CSV files), ask questions about their data in natural language or voice, and receive intelligent responses with charts, KPIs, and insights. It features a modern dashboard with data source management, chart creation, and an AI assistant that can interpret business questions and generate appropriate visualizations.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Frontend Architecture\n- **Framework**: React with TypeScript, built using Vite\n- **UI Library**: Shadcn/ui components with Radix UI primitives\n- **Styling**: Tailwind CSS with a dark theme design system\n- **State Management**: TanStack Query (React Query) for server state management\n- **Routing**: Wouter for lightweight client-side routing\n- **Authentication**: Custom hook-based auth system with protected routes\n\n## Backend Architecture\n- **Runtime**: Node.js with Express.js\n- **Language**: TypeScript with ES modules\n- **Database ORM**: Drizzle ORM with PostgreSQL dialect\n- **AI Integration**: OpenAI API for natural language processing and data analysis\n- **File Handling**: Multer for CSV file uploads with local storage\n- **Authentication**: Passport.js with local strategy and session-based auth\n- **Semantic Layer**: Production-grade BI semantic layer with metrics/dimensions abstraction (matching Apache Superset, Domo, Power BI)\n- **Query Caching**: Redis-backed query result caching with intelligent invalidation and TTL management\n\n## Data Storage Solutions\n- **Primary Database**: PostgreSQL (configured for Neon serverless)\n- **Session Storage**: PostgreSQL with connect-pg-simple\n- **File Storage**: Local filesystem for uploaded CSV files\n- **Database Migrations**: Drizzle Kit for schema management\n\n## Authentication and Authorization\n- **Strategy**: Session-based authentication using Passport.js\n- **Password Security**: Scrypt for password hashing with salt\n- **Session Management**: Express sessions with PostgreSQL store\n- **Protected Routes**: Custom ProtectedRoute component with auth context\n\n## External Service Integrations\n- **AI Services**: OpenAI GPT API for data analysis and natural language processing\n- **Database Hosting**: Neon PostgreSQL serverless database\n- **Development Tools**: Replit-specific plugins for development environment\n- **Chart Libraries**: Recharts for data visualizations (line, bar, pie charts)\n\n## Key Design Patterns\n- **Monorepo Structure**: Shared schema and types between client and server\n- **Component Architecture**: Modular UI components with clear separation of concerns\n- **API Layer**: RESTful endpoints with consistent error handling and response formatting\n- **Data Flow**: React Query for caching and synchronization with optimistic updates\n- **Voice Integration**: Browser-based speech recognition and synthesis capabilities\n- **File Processing**: Secure file upload with type validation and processing pipelines\n\nThe application follows a modern full-stack architecture with emphasis on type safety, user experience, and AI-powered data insights. The codebase is structured for scalability with clear separation between data access, business logic, and presentation layers.","size_bytes":3577},"client/src/components/kpi/big-number.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown, Minus } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface BigNumberProps {\n  title: string;\n  value: string | number;\n  prefix?: string;\n  suffix?: string;\n  subheader?: string;\n  previousValue?: string | number;\n  showComparison?: boolean;\n  comparisonType?: 'percentage' | 'absolute';\n  colorThresholds?: {\n    good?: number;\n    warning?: number;\n    bad?: number;\n  };\n  format?: 'number' | 'currency' | 'percentage';\n  showTrend?: boolean;\n  fontColor?: string;\n}\n\nexport function BigNumber({\n  title,\n  value,\n  prefix = '',\n  suffix = '',\n  subheader,\n  previousValue,\n  showComparison = false,\n  comparisonType = 'percentage',\n  colorThresholds,\n  format = 'number',\n  showTrend = true,\n  fontColor = '#1f2937',\n}: BigNumberProps) {\n  \n  const formatValue = (val: string | number): string => {\n    const numVal = typeof val === 'string' ? parseFloat(val) : val;\n    \n    if (isNaN(numVal)) return String(val);\n    \n    switch (format) {\n      case 'currency':\n        return `$${numVal.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 })}`;\n      case 'percentage':\n        return `${numVal.toFixed(1)}%`;\n      case 'number':\n      default:\n        if (numVal >= 1000000) {\n          return `${(numVal / 1000000).toFixed(1)}M`;\n        }\n        if (numVal >= 1000) {\n          return `${(numVal / 1000).toFixed(1)}K`;\n        }\n        return numVal.toLocaleString();\n    }\n  };\n\n  const calculateChange = (): { value: number; display: string; trend: 'up' | 'down' | 'neutral' } => {\n    if (!previousValue) return { value: 0, display: '0', trend: 'neutral' };\n    \n    const current = typeof value === 'string' ? parseFloat(value) : value;\n    const previous = typeof previousValue === 'string' ? parseFloat(previousValue) : previousValue;\n    \n    if (isNaN(current) || isNaN(previous) || previous === 0) {\n      return { value: 0, display: '0', trend: 'neutral' };\n    }\n    \n    const diff = current - previous;\n    \n    if (comparisonType === 'percentage') {\n      const percentChange = (diff / previous) * 100;\n      return {\n        value: percentChange,\n        display: `${percentChange >= 0 ? '+' : ''}${percentChange.toFixed(1)}%`,\n        trend: percentChange > 0 ? 'up' : percentChange < 0 ? 'down' : 'neutral'\n      };\n    } else {\n      return {\n        value: diff,\n        display: `${diff >= 0 ? '+' : ''}${formatValue(diff)}`,\n        trend: diff > 0 ? 'up' : diff < 0 ? 'down' : 'neutral'\n      };\n    }\n  };\n\n  const getColorClass = (): string => {\n    if (!colorThresholds) return 'text-foreground';\n    \n    const numVal = typeof value === 'string' ? parseFloat(value) : value;\n    \n    if (isNaN(numVal)) return 'text-foreground';\n    \n    if (colorThresholds.good && numVal >= colorThresholds.good) {\n      return 'text-green-600 dark:text-green-400';\n    }\n    if (colorThresholds.bad && numVal <= colorThresholds.bad) {\n      return 'text-red-600 dark:text-red-400';\n    }\n    if (colorThresholds.warning) {\n      return 'text-amber-600 dark:text-amber-400';\n    }\n    \n    return 'text-foreground';\n  };\n\n  const change = showComparison ? calculateChange() : null;\n  const colorClass = getColorClass();\n\n  return (\n    <Card className=\"w-full bg-white dark:bg-white\" data-testid=\"kpi-big-number\">\n      <CardHeader className=\"pb-1\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-1 p-4 pt-0\">\n        <div \n          className=\"text-4xl font-bold\" \n          style={{ color: colorThresholds ? undefined : fontColor }}\n          data-testid=\"kpi-value\"\n        >\n          <span className={colorThresholds ? colorClass : undefined}>\n            {prefix}{formatValue(value)}{suffix}\n          </span>\n        </div>\n        \n        {(subheader || showComparison) && (\n          <div className=\"flex items-center gap-2 text-sm\">\n            {showComparison && change && showTrend && (\n              <div className={cn(\n                \"flex items-center gap-1\",\n                change.trend === 'up' ? 'text-green-600 dark:text-green-400' :\n                change.trend === 'down' ? 'text-red-600 dark:text-red-400' :\n                'text-muted-foreground'\n              )} data-testid=\"kpi-comparison\">\n                {change.trend === 'up' && <TrendingUp className=\"h-4 w-4\" />}\n                {change.trend === 'down' && <TrendingDown className=\"h-4 w-4\" />}\n                {change.trend === 'neutral' && <Minus className=\"h-4 w-4\" />}\n                <span>{change.display}</span>\n              </div>\n            )}\n            {subheader && (\n              <span className=\"text-muted-foreground\" data-testid=\"kpi-subheader\">\n                {subheader}\n              </span>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4989},"client/src/components/chart-config/LineChartConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\n\ninterface LineChartConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function LineChartConfig({ config, onChange, columns = [] }: LineChartConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"xAxis\">X-Axis (Time/Category)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.xAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"xAxis\", value)}\n          >\n            <SelectTrigger id=\"xAxis\" data-testid=\"select-x-axis\">\n              <SelectValue placeholder=\"Select time/category column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"xAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.xAxis || \"\"}\n            disabled\n            data-testid=\"input-x-axis\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Column for time series or categories\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"yAxis\">Y-Axis (Value)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.yAxis || \"\"}\n            onValueChange={(value) => updateConfig(\"yAxis\", value)}\n          >\n            <SelectTrigger id=\"yAxis\" data-testid=\"select-y-axis\">\n              <SelectValue placeholder=\"Select value column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"yAxis\"\n            placeholder=\"Select a dataset first\"\n            value={config.yAxis || \"\"}\n            disabled\n            data-testid=\"input-y-axis\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Metric to plot over time\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"groupBy\">Group By (Optional)</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.groupBy || \"\"}\n            onValueChange={(value) => updateConfig(\"groupBy\", value)}\n          >\n            <SelectTrigger id=\"groupBy\" data-testid=\"select-group-by\">\n              <SelectValue placeholder=\"Select group column (optional)\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"\">None</SelectItem>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"groupBy\"\n            placeholder=\"Select a dataset first\"\n            value={config.groupBy || \"\"}\n            disabled\n            data-testid=\"input-group-by\"\n          />\n        )}\n        <p className=\"text-xs text-muted-foreground\">\n          Create multiple lines by grouping\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"lineStyle\">Line Style</Label>\n        <Select\n          value={config.lineStyle || \"linear\"}\n          onValueChange={(value) => updateConfig(\"lineStyle\", value)}\n        >\n          <SelectTrigger id=\"lineStyle\" data-testid=\"select-line-style\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"linear\">Linear</SelectItem>\n            <SelectItem value=\"smooth\">Smooth</SelectItem>\n            <SelectItem value=\"step\">Step</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-0.5\">\n          <Label htmlFor=\"showDataPoints\">Show Data Points</Label>\n          <p className=\"text-xs text-muted-foreground\">\n            Display markers at each data point\n          </p>\n        </div>\n        <Switch\n          id=\"showDataPoints\"\n          checked={config.showDataPoints || false}\n          onCheckedChange={(checked) => updateConfig(\"showDataPoints\", checked)}\n          data-testid=\"switch-show-data-points\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-0.5\">\n          <Label htmlFor=\"showArea\">Fill Area</Label>\n          <p className=\"text-xs text-muted-foreground\">\n            Fill area under the line\n          </p>\n        </div>\n        <Switch\n          id=\"showArea\"\n          checked={config.showArea || false}\n          onCheckedChange={(checked) => updateConfig(\"showArea\", checked)}\n          data-testid=\"switch-show-area\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"labelDisplay\">Label Display</Label>\n        <Select\n          value={config.labelDisplay || \"hover\"}\n          onValueChange={(value) => updateConfig(\"labelDisplay\", value)}\n        >\n          <SelectTrigger id=\"labelDisplay\" data-testid=\"select-label-display\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"none\">Hidden</SelectItem>\n            <SelectItem value=\"hover\">Show on Hover</SelectItem>\n            <SelectItem value=\"always\">Always Visible</SelectItem>\n          </SelectContent>\n        </Select>\n        <p className=\"text-xs text-muted-foreground\">\n          How to display data labels\n        </p>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"valueFormat\">Value Format</Label>\n        <Select\n          value={config.valueFormat || \"value\"}\n          onValueChange={(value) => updateConfig(\"valueFormat\", value)}\n        >\n          <SelectTrigger id=\"valueFormat\" data-testid=\"select-value-format\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"value\">Actual Values</SelectItem>\n            <SelectItem value=\"abbreviated\">Abbreviated (K, M, B)</SelectItem>\n          </SelectContent>\n        </Select>\n        <p className=\"text-xs text-muted-foreground\">\n          How to format displayed values\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6990},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/pages/dashboard-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, LayoutDashboard, Eye, MoreHorizontal, Edit, Trash2 } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Dashboard } from \"@shared/schema\";\nimport { motion } from \"framer-motion\";\n\ninterface DashboardWithCount extends Dashboard {\n  kpiCount: number;\n}\n\ninterface DashboardPageProps {\n  onNavigateToDashboard?: (dashboardId: string) => void;\n}\n\nexport default function DashboardPage({ onNavigateToDashboard }: DashboardPageProps) {\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [editingDashboard, setEditingDashboard] = useState<Dashboard | null>(null);\n  const [newDashboardName, setNewDashboardName] = useState(\"\");\n  const [newDashboardDescription, setNewDashboardDescription] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: dashboards = [], isLoading } = useQuery<DashboardWithCount[]>({\n    queryKey: [\"/api/dashboards\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { name: string; description?: string }) => {\n      return apiRequest(\"POST\", \"/api/dashboards\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\"] });\n      setCreateDialogOpen(false);\n      setNewDashboardName(\"\");\n      setNewDashboardDescription(\"\");\n      toast({\n        title: \"Success\",\n        description: \"Dashboard created successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create dashboard\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Dashboard> }) => {\n      return apiRequest(\"PUT\", `/api/dashboards/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\"] });\n      setEditingDashboard(null);\n      setNewDashboardName(\"\");\n      setNewDashboardDescription(\"\");\n      toast({\n        title: \"Success\",\n        description: \"Dashboard updated successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update dashboard\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/dashboards/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboards\"] });\n      toast({\n        title: \"Success\",\n        description: \"Dashboard deleted successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete dashboard\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreateDashboard = () => {\n    if (!newDashboardName.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Dashboard name is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createMutation.mutate({\n      name: newDashboardName,\n      description: newDashboardDescription || undefined,\n    });\n  };\n\n  const handleUpdateDashboard = () => {\n    if (!editingDashboard || !newDashboardName.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Dashboard name is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    updateMutation.mutate({\n      id: editingDashboard.id,\n      data: {\n        name: newDashboardName,\n        description: newDashboardDescription || null,\n      },\n    });\n  };\n\n  const openEditDialog = (dashboard: Dashboard) => {\n    setEditingDashboard(dashboard);\n    setNewDashboardName(dashboard.name);\n    setNewDashboardDescription(dashboard.description || \"\");\n  };\n\n  const formatTimeAgo = (dateString: string | Date) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    \n    if (diffMins < 1) return \"just now\";\n    if (diffMins < 60) return `${diffMins}m ago`;\n    const diffHours = Math.floor(diffMins / 60);\n    if (diffHours < 24) return `${diffHours}h ago`;\n    const diffDays = Math.floor(diffHours / 24);\n    return `${diffDays}d ago`;\n  };\n\n  return (\n    <motion.div \n      className=\"p-6 space-y-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.5 }}\n    >\n      {/* Header */}\n      <motion.div \n        className=\"flex items-center justify-between\"\n        initial={{ opacity: 0, y: -10 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.1, duration: 0.4 }}\n      >\n        <div>\n          <h2 className=\"text-2xl font-bold\">Dashboards</h2>\n          <p className=\"text-muted-foreground\">\n            Create and manage your custom dashboards\n          </p>\n        </div>\n        <Dialog \n          open={createDialogOpen || editingDashboard !== null} \n          onOpenChange={(open) => {\n            if (!open) {\n              setCreateDialogOpen(false);\n              setEditingDashboard(null);\n              setNewDashboardName(\"\");\n              setNewDashboardDescription(\"\");\n            } else {\n              setCreateDialogOpen(true);\n            }\n          }}\n        >\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-create-dashboard\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Create Dashboard\n            </Button>\n          </DialogTrigger>\n          <DialogContent data-testid=\"dialog-create-dashboard\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingDashboard ? \"Edit Dashboard\" : \"Create New Dashboard\"}\n              </DialogTitle>\n              <DialogDescription>\n                {editingDashboard \n                  ? \"Update your dashboard details\" \n                  : \"Add a new dashboard to organize your KPIs\"}\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"dashboard-name\">Dashboard Name</Label>\n                <Input\n                  id=\"dashboard-name\"\n                  data-testid=\"input-dashboard-name\"\n                  placeholder=\"e.g., Sales Overview\"\n                  value={newDashboardName}\n                  onChange={(e) => setNewDashboardName(e.target.value)}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"dashboard-description\">Description (Optional)</Label>\n                <Textarea\n                  id=\"dashboard-description\"\n                  data-testid=\"input-dashboard-description\"\n                  placeholder=\"Describe what this dashboard tracks...\"\n                  value={newDashboardDescription}\n                  onChange={(e) => setNewDashboardDescription(e.target.value)}\n                  rows={3}\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setCreateDialogOpen(false);\n                  setEditingDashboard(null);\n                  setNewDashboardName(\"\");\n                  setNewDashboardDescription(\"\");\n                }}\n                data-testid=\"button-cancel-dashboard\"\n              >\n                Cancel\n              </Button>\n              <Button\n                onClick={editingDashboard ? handleUpdateDashboard : handleCreateDashboard}\n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-dashboard\"\n              >\n                {editingDashboard ? \"Update\" : \"Create\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </motion.div>\n\n      {/* Dashboards Grid */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {Array.from({ length: 3 }).map((_, i) => (\n            <Card key={i}>\n              <CardHeader>\n                <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                <Skeleton className=\"h-4 w-full\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-32 w-full mb-4\" />\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-4 w-1/2\" />\n                  <Skeleton className=\"h-4 w-2/3\" />\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : dashboards.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {dashboards.map((dashboard, index) => (\n            <motion.div\n              key={dashboard.id}\n              initial={{ opacity: 0, y: 30 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.1 * index, duration: 0.4 }}\n            >\n              <Card \n                className=\"group cursor-pointer hover:shadow-lg transition-all duration-300 hover:scale-105\"\n                onClick={() => onNavigateToDashboard?.(dashboard.id)}\n                data-testid={`dashboard-card-${dashboard.id}`}\n              >\n              <CardHeader className=\"pb-2\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <CardTitle className=\"text-lg mb-1\">{dashboard.name}</CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {dashboard.description || \"No description\"}\n                    </p>\n                  </div>\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\" \n                        className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\n                        onClick={(e) => e.stopPropagation()}\n                        data-testid={`button-dashboard-options-${dashboard.id}`}\n                      >\n                        <MoreHorizontal className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuItem\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          openEditDialog(dashboard);\n                        }}\n                        data-testid={`button-edit-dashboard-${dashboard.id}`}\n                      >\n                        <Edit className=\"mr-2 h-4 w-4\" />\n                        Edit\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          if (confirm(\"Are you sure you want to delete this dashboard?\")) {\n                            deleteMutation.mutate(dashboard.id);\n                          }\n                        }}\n                        className=\"text-destructive\"\n                        data-testid={`button-delete-dashboard-${dashboard.id}`}\n                      >\n                        <Trash2 className=\"mr-2 h-4 w-4\" />\n                        Delete\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </CardHeader>\n              <CardContent>\n                {/* Dashboard preview area */}\n                <div className=\"w-full h-32 bg-gradient-to-br from-primary/10 to-secondary/10 rounded-lg mb-4 flex items-center justify-center border-2 border-dashed border-border\">\n                  <div className=\"text-center\">\n                    <LayoutDashboard className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n                    <p className=\"text-sm text-muted-foreground\">\n                      {dashboard.kpiCount} {dashboard.kpiCount === 1 ? \"KPI\" : \"KPIs\"}\n                    </p>\n                  </div>\n                </div>\n                \n                <div className=\"text-xs text-muted-foreground space-y-1\">\n                  <p>Created: {dashboard.createdAt ? formatTimeAgo(dashboard.createdAt) : 'N/A'}</p>\n                  <p>Updated: {dashboard.updatedAt ? formatTimeAgo(dashboard.updatedAt) : 'N/A'}</p>\n                </div>\n              </CardContent>\n              </Card>\n            </motion.div>\n          ))}\n        </div>\n      ) : (\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ delay: 0.2, duration: 0.4 }}\n        >\n          <Card className=\"p-12 text-center\">\n            <div className=\"text-muted-foreground\">\n              <LayoutDashboard className=\"mx-auto h-12 w-12 mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">No Dashboards Yet</h3>\n              <p className=\"mb-4\">Create your first dashboard to start organizing your KPIs</p>\n              <Button onClick={() => setCreateDialogOpen(true)} data-testid=\"button-create-first-dashboard\">\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Create Dashboard\n              </Button>\n            </div>\n          </Card>\n        </motion.div>\n      )}\n    </motion.div>\n  );\n}\n","size_bytes":14174},"server/ai-privacy.ts":{"content":"/**\n * Privacy-Preserving AI Analysis Service\n * \n * This service NEVER sends real data to OpenAI.\n * Only schema/dummy data is shared to generate analysis guidance.\n */\n\nimport OpenAI from \"openai\";\nimport { extractDataSchema, createPrivacySafeDataSummary } from \"./services/data-masking\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY\n});\n\ninterface DataAnalysisRequest {\n  question: string;\n  csvData?: any[];\n  dataSourceMetadata?: any;\n}\n\ninterface DataAnalysisResponse {\n  answer: string;\n  chartData?: any;\n  chartType?: string;\n  kpiValue?: string;\n  unit?: string;\n}\n\n/**\n * Analyze data with privacy protection\n */\nexport async function analyzeDataWithPrivacy(request: DataAnalysisRequest): Promise<DataAnalysisResponse> {\n  try {\n    const { question, csvData, dataSourceMetadata } = request;\n\n    let context = `You are a business intelligence analyst. Answer the user's question with the actual result value.\n\nUser Question: ${question}`;\n\n    let analysisResult: any = null;\n    let dataSchema: any = null;\n\n    if (csvData && csvData.length > 0) {\n      // Extract schema (NO REAL DATA)\n      dataSchema = extractDataSchema(csvData);\n      \n      // Perform actual analysis locally on real data\n      analysisResult = performLocalAnalysis(question, csvData, dataSchema);\n      \n      console.log('Analysis Result:', JSON.stringify(analysisResult, null, 2));\n      \n      // CRITICAL: Do NOT send real analysis results to OpenAI\n      // But we DO need to tell the AI what the answer is so it can format it properly\n      if (analysisResult) {\n        if (analysisResult.isMultiColumn && analysisResult.allColumns) {\n          // For multi-column results (e.g., product name + amount), provide ALL columns\n          const columnDetails = Object.entries(analysisResult.allColumns)\n            .map(([key, value]) => `${key}: ${value}`)\n            .join(', ');\n          context += `\\n\\nAnalysis Complete: Query returned the following result - ${columnDetails}`;\n          context += `\\n\\nIMPORTANT: Include ALL these values in your natural language answer, not just the numeric value.`;\n        } else if (analysisResult.kpiValue) {\n          // For SQL results and aggregations, provide the actual answer\n          context += `\\n\\nAnalysis Complete: The answer is ${analysisResult.kpiValue}${analysisResult.unit ? ' ' + analysisResult.unit : ''}.`;\n        } else if (analysisResult.trendData) {\n          context += `\\n\\nAnalysis type: Time series trend data available.`;\n        } else if (analysisResult.groupedData) {\n          context += `\\n\\nAnalysis type: Categorical breakdown available.`;\n        } else {\n          context += `\\n\\nAnalysis type: Summary with ${analysisResult.totalRecords || csvData.length} records.`;\n        }\n      }\n    }\n\n    // Detect if user is asking for visualization\n    const questionLower = question.toLowerCase();\n    const isVisualizationRequest = \n      questionLower.includes('chart') || \n      questionLower.includes('graph') || \n      questionLower.includes('visualize') || \n      questionLower.includes('show me') ||\n      questionLower.includes('plot') ||\n      questionLower.includes('trend') ||\n      questionLower.includes('breakdown') ||\n      questionLower.includes('distribution') ||\n      questionLower.includes('compare');\n    \n    // Check if data is suitable for charting (multiple rows or grouped data)\n    const hasMultipleDataPoints = \n      (Array.isArray(analysisResult) && analysisResult.length > 1) ||\n      analysisResult?.groupedData ||\n      analysisResult?.trendData;\n    \n    const shouldSuggestChart = isVisualizationRequest || hasMultipleDataPoints;\n\n    if (shouldSuggestChart) {\n      context += `\\n\\nProvide response in JSON:\n{\n  \"answer\": \"Natural language answer stating the actual result value. Be direct and clear.\",\n  \"chartType\": \"Suggested chart type: bar, line, pie, heatmap, table, or null\"\n}\n\nChart type selection guidelines:\n- Use \"heatmap\" for 2D data comparisons (e.g., country+state, category+subcategory)\n- Use \"bar\" for simple category comparisons\n- Use \"line\" for trends over time\n- Use \"pie\" for proportional/percentage breakdowns\n- Use \"table\" for detailed data viewing\n- Use null if the result is a single value with no comparative data`;\n    } else {\n      context += `\\n\\nProvide response in JSON:\n{\n  \"answer\": \"Natural language answer stating the actual result value. Be direct and clear.\",\n  \"chartType\": null\n}\n\nIMPORTANT: The chartType field must be the JSON null value (not a string), since this is a simple answer with no visualization needed.`;\n    }\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        { role: \"system\", content: \"You are an expert BI analyst. Provide clear, direct answers with actual values in JSON format.\" },\n        { role: \"user\", content: context }\n      ],\n      response_format: { type: \"json_object\" },\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    // Prepare chart data\n    let chartData = null;\n    if (result.chartType && analysisResult) {\n      chartData = prepareChartData(result.chartType, analysisResult, dataSchema);\n      console.log('Prepared chart data:', JSON.stringify(chartData, null, 2));\n    }\n    \n    // If analysisResult is an array (grouped data), prepare it for charting\n    if (Array.isArray(analysisResult) && analysisResult.length > 0 && result.chartType) {\n      chartData = prepareChartData(result.chartType, analysisResult, dataSchema);\n      console.log('Prepared chart data from array:', JSON.stringify(chartData, null, 2));\n    }\n    \n    return {\n      answer: result.answer || \"I've analyzed your data.\",\n      chartData,\n      chartType: result.chartType,\n      kpiValue: analysisResult?.kpiValue,\n      unit: analysisResult?.unit\n    };\n\n  } catch (error) {\n    console.error(\"Privacy-preserving AI analysis error:\", error);\n    return {\n      answer: \"Sorry, I encountered an error while analyzing your data.\"\n    };\n  }\n}\n\n/**\n * Local analysis on real data (NEVER sent to OpenAI)\n */\nfunction performLocalAnalysis(question: string, data: any[], schema: any): any {\n  const q = question.toLowerCase();\n  \n  console.log('performLocalAnalysis - data.length:', data.length, 'first row keys:', data[0] ? Object.keys(data[0]) : 'no data');\n  \n  // PRIORITY: Check for grouped data FIRST (before keyword matching)\n  // If data has multiple rows with a string column and a numeric column (likely GROUP BY result)\n  if (data.length > 1 && data[0] && Object.keys(data[0]).length >= 2) {\n    const keys = Object.keys(data[0]);\n    const stringKey = keys.find(k => typeof data[0][k] === 'string');\n    const numKey = keys.find(k => typeof data[0][k] === 'number');\n    \n    console.log('Checking grouped data:', { \n      dataLength: data.length, \n      keys, \n      stringKey, \n      numKey,\n      firstRowTypes: keys.map(k => ({ [k]: typeof data[0][k] }))\n    });\n    \n    if (stringKey && numKey) {\n      // This is grouped data from SQL - return it directly for charting\n      console.log('‚úÖ Detected grouped data for charting - returning array');\n      return data; // Return array directly for chart preparation\n    } else {\n      console.log('‚ùå Not grouped data - missing string or number key');\n    }\n  } else {\n    console.log('‚ùå Not grouped data - length or keys check failed');\n  }\n  \n  // If data is a single row with a single column (likely an aggregation result from SQL)\n  if (data.length === 1 && Object.keys(data[0]).length === 1) {\n    const key = Object.keys(data[0])[0];\n    const value = data[0][key];\n    return { \n      kpiValue: value?.toString() || '0', \n      unit: key,\n      isSQLResult: true \n    };\n  }\n  \n  // If data is a single row with multiple columns (e.g., product name + amount)\n  if (data.length === 1 && Object.keys(data[0]).length >= 2) {\n    const keys = Object.keys(data[0]);\n    const values: Record<string, any> = {};\n    let numericKey: string | null = null;\n    let numericValue: any = null;\n    \n    // Extract all column values and find the numeric one for KPI\n    keys.forEach(key => {\n      const value = data[0][key];\n      values[key] = value;\n      \n      // Find the numeric column for KPI display\n      if ((typeof value === 'number' || !isNaN(Number(value))) && numericKey === null) {\n        numericKey = key;\n        numericValue = value;\n      }\n    });\n    \n    console.log('‚úÖ Single row multi-column result detected:', values);\n    \n    return {\n      kpiValue: numericValue?.toString() || '',\n      unit: numericKey || '',\n      allColumns: values,  // Include ALL column values\n      isSQLResult: true,\n      isMultiColumn: true\n    };\n  }\n  \n  if (q.includes('total') || q.includes('sum')) return calculateSum(data, schema);\n  if (q.includes('average') || q.includes('mean')) return calculateAverage(data, schema);\n  if (q.includes('count') || q.includes('how many') || q.includes('distinct')) return { kpiValue: data.length.toString(), unit: 'records' };\n  if (q.includes('max') || q.includes('highest')) return calculateMax(data, schema);\n  if (q.includes('min') || q.includes('lowest')) return calculateMin(data, schema);\n  if (q.includes('trend') || q.includes('over time')) return calculateTrend(data, schema);\n  if (q.includes('group') || q.includes('by')) return calculateGroupBy(data, schema);\n  \n  return { totalRecords: data.length };\n}\n\nfunction calculateSum(data: any[], schema: any): any {\n  const numCol = schema.columns.find((c: any) => c.type === 'integer' || c.type === 'float');\n  if (!numCol) return null;\n  \n  const sum = data.reduce((acc, row) => acc + (parseFloat(row[numCol.name]) || 0), 0);\n  return { kpiValue: sum.toFixed(2), unit: numCol.name, sum, column: numCol.name };\n}\n\nfunction calculateAverage(data: any[], schema: any): any {\n  const numCol = schema.columns.find((c: any) => c.type === 'integer' || c.type === 'float');\n  if (!numCol) return null;\n  \n  const sum = data.reduce((acc, row) => acc + (parseFloat(row[numCol.name]) || 0), 0);\n  const avg = sum / data.length;\n  return { kpiValue: avg.toFixed(2), unit: numCol.name, average: avg, column: numCol.name };\n}\n\nfunction calculateMax(data: any[], schema: any): any {\n  const numCol = schema.columns.find((c: any) => c.type === 'integer' || c.type === 'float');\n  if (!numCol) return null;\n  \n  const max = Math.max(...data.map(row => parseFloat(row[numCol.name]) || 0));\n  return { kpiValue: max.toString(), unit: numCol.name };\n}\n\nfunction calculateMin(data: any[], schema: any): any {\n  const numCol = schema.columns.find((c: any) => c.type === 'integer' || c.type === 'float');\n  if (!numCol) return null;\n  \n  const min = Math.min(...data.map(row => parseFloat(row[numCol.name]) || 0));\n  return { kpiValue: min.toString(), unit: numCol.name };\n}\n\nfunction calculateTrend(data: any[], schema: any): any {\n  const dateCol = schema.columns.find((c: any) => c.type === 'date');\n  const numCol = schema.columns.find((c: any) => c.type === 'integer' || c.type === 'float');\n  \n  if (!dateCol || !numCol) return null;\n  \n  const trendData = data.map(row => ({\n    date: row[dateCol.name],\n    value: parseFloat(row[numCol.name]) || 0\n  }));\n  \n  return { trendData, dateColumn: dateCol.name, valueColumn: numCol.name };\n}\n\nfunction calculateGroupBy(data: any[], schema: any): any {\n  const catCol = schema.columns.find((c: any) => c.type === 'string');\n  const numCol = schema.columns.find((c: any) => c.type === 'integer' || c.type === 'float');\n  \n  if (!catCol || !numCol) return null;\n  \n  const grouped: any = {};\n  data.forEach(row => {\n    const cat = row[catCol.name];\n    if (!grouped[cat]) grouped[cat] = 0;\n    grouped[cat] += parseFloat(row[numCol.name]) || 0;\n  });\n  \n  return { groupedData: grouped, categoryColumn: catCol.name, valueColumn: numCol.name };\n}\n\n/**\n * Prepare chart data in the format expected by the frontend\n * Returns array with { name, value } structure for Recharts\n */\nfunction prepareChartData(chartType: string, analysisResult: any, schema: any): any[] {\n  // For trend/time series data\n  if (analysisResult.trendData) {\n    return analysisResult.trendData.map((d: any) => ({\n      name: d.date || d[analysisResult.dateColumn],\n      value: d.value || d[analysisResult.valueColumn]\n    }));\n  }\n  \n  // For grouped/categorical data\n  if (analysisResult.groupedData) {\n    return Object.entries(analysisResult.groupedData).map(([key, val]) => ({\n      name: key,\n      value: val as number\n    }));\n  }\n  \n  // Try to detect chart data from any row-based result\n  if (Array.isArray(analysisResult) && analysisResult.length > 0) {\n    const firstRow = analysisResult[0];\n    const keys = Object.keys(firstRow);\n    \n    // Find name/category field (string) and value field (number)\n    const nameField = keys.find(k => typeof firstRow[k] === 'string') || keys[0];\n    const valueField = keys.find(k => typeof firstRow[k] === 'number') || keys[1];\n    \n    return analysisResult.map(row => ({\n      name: row[nameField],\n      value: parseFloat(row[valueField]) || 0\n    }));\n  }\n  \n  return [];\n}\n\n/**\n * Analyze data using Python sandbox for advanced analysis\n */\nexport async function analyzeDataWithPythonSandbox(request: DataAnalysisRequest): Promise<DataAnalysisResponse> {\n  try {\n    const { question, csvData, dataSourceMetadata } = request;\n\n    if (!csvData || csvData.length === 0) {\n      return {\n        answer: \"No data available for analysis.\"\n      };\n    }\n\n    // Step 1: Extract schema (NO REAL DATA sent to OpenAI)\n    const dataSchema = extractDataSchema(csvData);\n    const dummyDataSummary = createPrivacySafeDataSummary(csvData);\n    \n    // Step 2: Generate Python analysis code using OpenAI (with dummy data only)\n    const { generateAnalysisCode } = await import('./services/ai-code-generator');\n    \n    const codeGeneration = await generateAnalysisCode({\n      question,\n      dataSchema,\n      dummyDataSummary\n    });\n\n    console.log('Generated Python code:', codeGeneration.code);\n    console.log('Expected output type:', codeGeneration.outputType);\n\n    // Step 3: Execute Python code on REAL data (locally, never sent to OpenAI)\n    const { executePythonCode } = await import('./services/code-executor');\n    \n    const executionResult = await executePythonCode({\n      code: codeGeneration.code,\n      data: csvData,\n      timeout: 30000\n    });\n\n    console.log('Python execution result:', executionResult);\n\n    if (!executionResult.success) {\n      // Fallback to simple analysis if Python fails\n      console.log('Python execution failed, falling back to simple analysis');\n      return analyzeDataWithPrivacy(request);\n    }\n\n    // Step 4: Format the result with OpenAI\n    const resultSummary = typeof executionResult.result === 'object' \n      ? JSON.stringify(executionResult.result).substring(0, 500)\n      : String(executionResult.result);\n\n    let context = `You are a business intelligence analyst. The data analysis has been completed.\n\nUser Question: ${question}\n\nAnalysis Result: ${resultSummary}\n\nProvide a clear, natural language answer based on this result.`;\n\n    // Detect if visualization is needed\n    const questionLower = question.toLowerCase();\n    const isVisualizationRequest = \n      questionLower.includes('chart') || \n      questionLower.includes('graph') || \n      questionLower.includes('visualize') || \n      questionLower.includes('show me') ||\n      questionLower.includes('plot') ||\n      questionLower.includes('trend') ||\n      questionLower.includes('breakdown') ||\n      questionLower.includes('distribution') ||\n      questionLower.includes('compare');\n\n    const hasMultipleDataPoints = \n      Array.isArray(executionResult.result) && executionResult.result.length > 1;\n\n    if (isVisualizationRequest || hasMultipleDataPoints || codeGeneration.outputType === 'chart') {\n      context += `\\n\\nProvide response in JSON:\n{\n  \"answer\": \"Natural language answer with the actual result value\",\n  \"chartType\": \"bar, line, pie, table, or null based on the data\"\n}`;\n    } else {\n      context += `\\n\\nProvide response in JSON:\n{\n  \"answer\": \"Natural language answer with the actual result value\",\n  \"chartType\": null\n}`;\n    }\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        { role: \"system\", content: \"You are an expert BI analyst. Provide clear answers in JSON format.\" },\n        { role: \"user\", content: context }\n      ],\n      response_format: { type: \"json_object\" },\n    });\n\n    const aiResult = JSON.parse(response.choices[0].message.content || \"{}\");\n\n    // Prepare chart data if needed\n    let chartData = null;\n    let kpiValue = null;\n    let unit = null;\n\n    if (Array.isArray(executionResult.result) && executionResult.result.length > 0) {\n      // Multi-row result - prepare for charting\n      if (aiResult.chartType) {\n        chartData = prepareChartData(aiResult.chartType, executionResult.result, dataSchema);\n      }\n    } else if (typeof executionResult.result === 'number' || typeof executionResult.result === 'string') {\n      // Single value result - KPI\n      kpiValue = String(executionResult.result);\n      \n      // Try to extract unit from the question\n      if (questionLower.includes('total') || questionLower.includes('sum')) {\n        unit = 'total';\n      } else if (questionLower.includes('average') || questionLower.includes('mean')) {\n        unit = 'average';\n      } else if (questionLower.includes('count')) {\n        unit = 'count';\n      }\n    }\n\n    return {\n      answer: aiResult.answer || \"Analysis completed successfully.\",\n      chartData,\n      chartType: aiResult.chartType || undefined,\n      kpiValue: kpiValue || undefined,\n      unit: unit || undefined\n    };\n\n  } catch (error) {\n    console.error(\"Python sandbox analysis error:\", error);\n    // Fallback to simple analysis\n    return analyzeDataWithPrivacy(request);\n  }\n}\n","size_bytes":18175},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"attached_assets/superset_config_1758734323878.py":{"content":"# Allow your Next.js app to frame Superset (dev)\r\nTALISMAN_ENABLED = False\r\nTALISMAN_CONFIG = {\r\n    # Drop X-Frame-Options (modern browsers use CSP frame-ancestors)\r\n    \"frame_options\": None,\r\n    \"content_security_policy\": {\r\n        # IMPORTANT: list every parent origin that will embed Superset\r\n        \"frame-ancestors\": [\r\n            \"'self'\",\r\n            \"http://localhost:3000\",\r\n            \"http://127.0.0.1:3000\",\r\n        ],\r\n        # (optional) sane defaults\r\n        \"default-src\": [\"'self'\", \"blob:\", \"data:\"],\r\n        \"img-src\": [\"'self'\", \"data:\", \"blob:\"],\r\n        \"object-src\": [\"'none'\"],\r\n        \"base-uri\": [\"'self'\"],\r\n    },\r\n}\r\n\r\n# If your Next.js frontend calls Superset APIs directly from the browser\r\nENABLE_CORS = False\r\nCORS_OPTIONS = {\r\n    \"supports_credentials\": True,\r\n    \"allow_headers\": [\"*\"],\r\n    \"methods\": [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\r\n    \"origins\": [\"http://localhost:3000\", \"http://127.0.0.1:3000\"],\r\n}\r\n\r\n\r\n# Allow your Next.js app to frame Superset\r\nOVERRIDE_HTTP_HEADERS = {\r\n    \"X-Frame-Options\": \"ALLOWALL\",\r\n    \"Content-Security-Policy\": \"frame-ancestors 'self' http://localhost:3000 http://127.0.0.1:3000;\"\r\n}\r\n\r\n# Keep embed features on\r\nFEATURE_FLAGS = {\"EMBEDDED_SUPERSET\": True}\r\n\r\n\r\n# Dev cookie defaults are fine; if you go cross-site + HTTPS later add:\r\n# SESSION_COOKIE_SAMESITE = \"None\"\r\n# SESSION_COOKIE_SECURE = True\r\n","size_bytes":1406},"server/services/database-connectors.ts":{"content":"import { DatabaseConnectorType, DatabaseConnectionConfig, ConnectionTestResult } from \"@shared/schema\";\nimport crypto from 'crypto';\nimport sql from 'mssql';\n\n/**\n * Database Connector Service - Inspired by Apache Superset's BaseEngineSpec\n * Provides connection management, testing, and query execution for various databases\n */\n\nexport interface DatabaseConnectorSpec {\n  name: string;\n  displayName: string;\n  description: string;\n  icon: string;\n  category: 'relational' | 'warehouse' | 'nosql' | 'timeseries' | 'file' | 'api';\n  requiresHost: boolean;\n  requiresPort: boolean;\n  requiresDatabase: boolean;\n  requiresCredentials: boolean;\n  defaultPort?: number;\n  connectionStringTemplate: string;\n  npmPackages: string[];\n  testQuery: string;\n  schemaQuery?: string;\n  tablesQuery?: string;\n  supportsSchema: boolean;\n  supportsSSL: boolean;\n  timeGrainExpressions?: Record<string, string>;\n}\n\n// Database connector specifications (similar to Apache Superset)\nexport const DATABASE_CONNECTORS: Record<string, DatabaseConnectorSpec> = {\n  [DatabaseConnectorType.MYSQL]: {\n    name: 'mysql',\n    displayName: 'MySQL',\n    description: 'Popular open-source relational database',\n    icon: 'database',\n    category: 'relational',\n    requiresHost: true,\n    requiresPort: true,\n    requiresDatabase: true,\n    requiresCredentials: true,\n    defaultPort: 3306,\n    connectionStringTemplate: 'mysql://{username}:{password}@{host}:{port}/{database}',\n    npmPackages: ['mysql2'],\n    testQuery: 'SELECT 1 as test',\n    schemaQuery: 'SHOW DATABASES',\n    tablesQuery: 'SHOW TABLES FROM {database}',\n    supportsSchema: true,\n    supportsSSL: true,\n    timeGrainExpressions: {\n      'PT1S': 'DATE_FORMAT({col}, \"%Y-%m-%d %H:%i:%S\")',\n      'PT1M': 'DATE_FORMAT({col}, \"%Y-%m-%d %H:%i:00\")',\n      'PT1H': 'DATE_FORMAT({col}, \"%Y-%m-%d %H:00:00\")',\n      'P1D': 'DATE_FORMAT({col}, \"%Y-%m-%d\")',\n      'P1W': 'DATE_FORMAT(DATE_SUB({col}, INTERVAL WEEKDAY({col}) DAY), \"%Y-%m-%d\")',\n      'P1M': 'DATE_FORMAT({col}, \"%Y-%m-01\")',\n      'P1Y': 'DATE_FORMAT({col}, \"%Y-01-01\")',\n    }\n  },\n\n  [DatabaseConnectorType.POSTGRESQL]: {\n    name: 'postgresql',\n    displayName: 'PostgreSQL',\n    description: 'Advanced open-source relational database',\n    icon: 'database',\n    category: 'relational',\n    requiresHost: true,\n    requiresPort: true,\n    requiresDatabase: true,\n    requiresCredentials: true,\n    defaultPort: 5432,\n    connectionStringTemplate: 'postgresql://{username}:{password}@{host}:{port}/{database}',\n    npmPackages: ['pg', '@types/pg'],\n    testQuery: 'SELECT 1 as test',\n    schemaQuery: 'SELECT schema_name FROM information_schema.schemata WHERE schema_name NOT IN (\\'information_schema\\', \\'pg_catalog\\', \\'pg_toast\\')',\n    tablesQuery: 'SELECT table_name FROM information_schema.tables WHERE table_schema = \\'{schema}\\'',\n    supportsSchema: true,\n    supportsSSL: true,\n    timeGrainExpressions: {\n      'PT1S': 'DATE_TRUNC(\\'second\\', {col})',\n      'PT1M': 'DATE_TRUNC(\\'minute\\', {col})',\n      'PT1H': 'DATE_TRUNC(\\'hour\\', {col})',\n      'P1D': 'DATE_TRUNC(\\'day\\', {col})',\n      'P1W': 'DATE_TRUNC(\\'week\\', {col})',\n      'P1M': 'DATE_TRUNC(\\'month\\', {col})',\n      'P3M': 'DATE_TRUNC(\\'quarter\\', {col})',\n      'P1Y': 'DATE_TRUNC(\\'year\\', {col})',\n    }\n  },\n\n  [DatabaseConnectorType.SQLSERVER]: {\n    name: 'sqlserver',\n    displayName: 'Microsoft SQL Server',\n    description: 'Microsoft\\'s enterprise database platform',\n    icon: 'server',\n    category: 'relational',\n    requiresHost: true,\n    requiresPort: true,\n    requiresDatabase: true,\n    requiresCredentials: true,\n    defaultPort: 1433,\n    connectionStringTemplate: 'mssql://{username}:{password}@{host}:{port}/{database}',\n    npmPackages: ['mssql'],\n    testQuery: 'SELECT 1 as test',\n    schemaQuery: 'SELECT name FROM sys.databases WHERE database_id > 4',\n    tablesQuery: 'SELECT table_name FROM information_schema.tables WHERE table_schema = \\'{schema}\\'',\n    supportsSchema: true,\n    supportsSSL: true,\n    timeGrainExpressions: {\n      'PT1S': 'FORMAT({col}, \\'yyyy-MM-dd HH:mm:ss\\')',\n      'PT1M': 'FORMAT(DATEADD(minute, DATEDIFF(minute, 0, {col}), 0), \\'yyyy-MM-dd HH:mm:00\\')',\n      'PT1H': 'FORMAT(DATEADD(hour, DATEDIFF(hour, 0, {col}), 0), \\'yyyy-MM-dd HH:00:00\\')',\n      'P1D': 'FORMAT({col}, \\'yyyy-MM-dd\\')',\n      'P1W': 'FORMAT(DATEADD(week, DATEDIFF(week, 0, {col}), 0), \\'yyyy-MM-dd\\')',\n      'P1M': 'FORMAT(DATEFROMPARTS(YEAR({col}), MONTH({col}), 1), \\'yyyy-MM-01\\')',\n      'P1Y': 'FORMAT(DATEFROMPARTS(YEAR({col}), 1, 1), \\'yyyy-01-01\\')',\n    }\n  },\n\n  [DatabaseConnectorType.ORACLE]: {\n    name: 'oracle',\n    displayName: 'Oracle Database',\n    description: 'Enterprise-grade relational database',\n    icon: 'database',\n    category: 'relational',\n    requiresHost: true,\n    requiresPort: true,\n    requiresDatabase: true,\n    requiresCredentials: true,\n    defaultPort: 1521,\n    connectionStringTemplate: 'oracle://{username}:{password}@{host}:{port}/{database}',\n    npmPackages: ['oracledb'],\n    testQuery: 'SELECT 1 FROM DUAL',\n    supportsSchema: true,\n    supportsSSL: true,\n    timeGrainExpressions: {\n      'PT1S': 'TO_CHAR({col}, \\'YYYY-MM-DD HH24:MI:SS\\')',\n      'PT1M': 'TO_CHAR(TRUNC({col}, \\'MI\\'), \\'YYYY-MM-DD HH24:MI:00\\')',\n      'PT1H': 'TO_CHAR(TRUNC({col}, \\'HH\\'), \\'YYYY-MM-DD HH24:00:00\\')',\n      'P1D': 'TO_CHAR(TRUNC({col}), \\'YYYY-MM-DD\\')',\n      'P1W': 'TO_CHAR(TRUNC({col}, \\'IW\\'), \\'YYYY-MM-DD\\')',\n      'P1M': 'TO_CHAR(TRUNC({col}, \\'MM\\'), \\'YYYY-MM-01\\')',\n      'P1Y': 'TO_CHAR(TRUNC({col}, \\'YYYY\\'), \\'YYYY-01-01\\')',\n    }\n  },\n\n  [DatabaseConnectorType.BIGQUERY]: {\n    name: 'bigquery',\n    displayName: 'Google BigQuery',\n    description: 'Serverless data warehouse by Google',\n    icon: 'cloud',\n    category: 'warehouse',\n    requiresHost: false,\n    requiresPort: false,\n    requiresDatabase: false,\n    requiresCredentials: true,\n    connectionStringTemplate: 'bigquery://{projectId}',\n    npmPackages: ['@google-cloud/bigquery'],\n    testQuery: 'SELECT 1 as test',\n    supportsSchema: true,\n    supportsSSL: true,\n    timeGrainExpressions: {\n      'PT1S': 'DATETIME_TRUNC({col}, SECOND)',\n      'PT1M': 'DATETIME_TRUNC({col}, MINUTE)',\n      'PT1H': 'DATETIME_TRUNC({col}, HOUR)',\n      'P1D': 'DATE_TRUNC({col}, DAY)',\n      'P1W': 'DATE_TRUNC({col}, WEEK)',\n      'P1M': 'DATE_TRUNC({col}, MONTH)',\n      'P3M': 'DATE_TRUNC({col}, QUARTER)',\n      'P1Y': 'DATE_TRUNC({col}, YEAR)',\n    }\n  },\n\n  [DatabaseConnectorType.SNOWFLAKE]: {\n    name: 'snowflake',\n    displayName: 'Snowflake',\n    description: 'Cloud-native data warehouse',\n    icon: 'snowflake',\n    category: 'warehouse',\n    requiresHost: true,\n    requiresPort: false,\n    requiresDatabase: true,\n    requiresCredentials: true,\n    connectionStringTemplate: 'snowflake://{username}:{password}@{account}.{region}/{database}?warehouse={warehouse}&role={role}',\n    npmPackages: ['snowflake-sdk'],\n    testQuery: 'SELECT 1 as test',\n    supportsSchema: true,\n    supportsSSL: true,\n    timeGrainExpressions: {\n      'PT1S': 'DATE_TRUNC(\\'second\\', {col})',\n      'PT1M': 'DATE_TRUNC(\\'minute\\', {col})',\n      'PT1H': 'DATE_TRUNC(\\'hour\\', {col})',\n      'P1D': 'DATE_TRUNC(\\'day\\', {col})',\n      'P1W': 'DATE_TRUNC(\\'week\\', {col})',\n      'P1M': 'DATE_TRUNC(\\'month\\', {col})',\n      'P3M': 'DATE_TRUNC(\\'quarter\\', {col})',\n      'P1Y': 'DATE_TRUNC(\\'year\\', {col})',\n    }\n  },\n\n  [DatabaseConnectorType.CLICKHOUSE]: {\n    name: 'clickhouse',\n    displayName: 'ClickHouse',\n    description: 'Fast columnar database for analytics',\n    icon: 'zap',\n    category: 'warehouse',\n    requiresHost: true,\n    requiresPort: true,\n    requiresDatabase: true,\n    requiresCredentials: true,\n    defaultPort: 9000,\n    connectionStringTemplate: 'clickhouse://{username}:{password}@{host}:{port}/{database}',\n    npmPackages: ['@clickhouse/client'],\n    testQuery: 'SELECT 1 as test',\n    supportsSchema: true,\n    supportsSSL: true,\n    timeGrainExpressions: {\n      'PT1S': 'toStartOfSecond({col})',\n      'PT1M': 'toStartOfMinute({col})',\n      'PT1H': 'toStartOfHour({col})',\n      'P1D': 'toStartOfDay({col})',\n      'P1W': 'toMonday({col})',\n      'P1M': 'toStartOfMonth({col})',\n      'P3M': 'toStartOfQuarter({col})',\n      'P1Y': 'toStartOfYear({col})',\n    }\n  },\n\n  [DatabaseConnectorType.MONGODB]: {\n    name: 'mongodb',\n    displayName: 'MongoDB (via Drill)',\n    description: 'Document database via Apache Drill',\n    icon: 'database',\n    category: 'nosql',\n    requiresHost: true,\n    requiresPort: true,\n    requiresDatabase: false,\n    requiresCredentials: false,\n    defaultPort: 8047,\n    connectionStringTemplate: 'drill+sadrill://{drillHost}:{drillPort}',\n    npmPackages: ['drill-sqlalchemy-proxy'],\n    testQuery: 'SELECT 1 as test FROM (VALUES(1))',\n    supportsSchema: false,\n    supportsSSL: false,\n  },\n\n  [DatabaseConnectorType.SQLITE]: {\n    name: 'sqlite',\n    displayName: 'SQLite',\n    description: 'Lightweight file-based database',\n    icon: 'file-database',\n    category: 'relational',\n    requiresHost: false,\n    requiresPort: false,\n    requiresDatabase: false,\n    requiresCredentials: false,\n    connectionStringTemplate: 'sqlite:///{filePath}',\n    npmPackages: ['sqlite3'],\n    testQuery: 'SELECT 1 as test',\n    supportsSchema: false,\n    supportsSSL: false,\n  },\n\n  [DatabaseConnectorType.CSV]: {\n    name: 'csv',\n    displayName: 'CSV File',\n    description: 'Comma-separated values file',\n    icon: 'file-text',\n    category: 'file',\n    requiresHost: false,\n    requiresPort: false,\n    requiresDatabase: false,\n    requiresCredentials: false,\n    connectionStringTemplate: 'file://{filePath}',\n    npmPackages: ['csv-parser'],\n    testQuery: '',\n    supportsSchema: false,\n    supportsSSL: false,\n  },\n};\n\n/**\n * Database Connection Service\n */\nexport class DatabaseConnectorService {\n  private static readonly ENCRYPTION_KEY = process.env.DATABASE_ENCRYPTION_KEY || 'default-key-change-in-production';\n\n  /**\n   * Get all available database connectors\n   */\n  static getAvailableConnectors(): DatabaseConnectorSpec[] {\n    return Object.values(DATABASE_CONNECTORS);\n  }\n\n  /**\n   * Get connector specification by type\n   */\n  static getConnector(type: string): DatabaseConnectorSpec | null {\n    return DATABASE_CONNECTORS[type] || null;\n  }\n\n  /**\n   * Build connection string from configuration\n   */\n  static buildConnectionString(type: string, config: DatabaseConnectionConfig): string {\n    const connector = this.getConnector(type);\n    if (!connector) {\n      throw new Error(`Unknown database connector type: ${type}`);\n    }\n\n    let connectionString = connector.connectionStringTemplate;\n\n    // Replace template variables\n    const replacements: Record<string, string> = {\n      username: config.username || '',\n      password: config.password || '',\n      host: config.host || '',\n      port: (config.port || connector.defaultPort || '').toString(),\n      database: config.database || '',\n      projectId: config.projectId || '',\n      account: config.account || '',\n      region: config.region || '',\n      warehouse: config.warehouse || '',\n      role: config.role || '',\n      drillHost: config.drillHost || config.host || '',\n      drillPort: (config.drillPort || 8047).toString(),\n      filePath: config.filePath || '',\n    };\n\n    Object.entries(replacements).forEach(([key, value]) => {\n      connectionString = connectionString.replace(new RegExp(`{${key}}`, 'g'), encodeURIComponent(value));\n    });\n\n    // Add SSL options if supported\n    if (connector.supportsSSL && config.sslMode) {\n      const separator = connectionString.includes('?') ? '&' : '?';\n      connectionString += `${separator}sslmode=${config.sslMode}`;\n    }\n\n    // Add additional options\n    if (config.options && Object.keys(config.options).length > 0) {\n      const separator = connectionString.includes('?') ? '&' : '?';\n      const optionString = Object.entries(config.options)\n        .map(([key, value]) => `${key}=${encodeURIComponent(value)}`)\n        .join('&');\n      connectionString += `${separator}${optionString}`;\n    }\n\n    return connectionString;\n  }\n\n  /**\n   * Encrypt connection configuration for storage\n   */\n  static encryptConfig(config: DatabaseConnectionConfig): string {\n    const cipher = crypto.createCipher('aes-256-cbc', this.ENCRYPTION_KEY);\n    let encrypted = cipher.update(JSON.stringify(config), 'utf8', 'hex');\n    encrypted += cipher.final('hex');\n    return encrypted;\n  }\n\n  /**\n   * Decrypt connection configuration from storage\n   */\n  static decryptConfig(encryptedConfig: string): DatabaseConnectionConfig {\n    try {\n      const decipher = crypto.createDecipher('aes-256-cbc', this.ENCRYPTION_KEY);\n      let decrypted = decipher.update(encryptedConfig, 'hex', 'utf8');\n      decrypted += decipher.final('utf8');\n      return JSON.parse(decrypted);\n    } catch (error) {\n      throw new Error('Failed to decrypt connection configuration');\n    }\n  }\n\n  /**\n   * Test database connection\n   */\n  static async testConnection(type: string, config: DatabaseConnectionConfig): Promise<ConnectionTestResult> {\n    const startTime = Date.now();\n    const connector = this.getConnector(type);\n    \n    if (!connector) {\n      return {\n        success: false,\n        message: `Unknown database connector type: ${type}`,\n      };\n    }\n\n    try {\n      // For file-based sources, check file existence\n      if (connector.category === 'file') {\n        // This would check file existence in a real implementation\n        return {\n          success: true,\n          message: 'File connection successful',\n          latency: Date.now() - startTime,\n        };\n      }\n\n      // For now, simulate connection testing\n      // In a real implementation, this would use the appropriate database drivers\n      await new Promise(resolve => setTimeout(resolve, 100)); // Simulate network delay\n\n      // Mock successful connection\n      const latency = Date.now() - startTime;\n      \n      return {\n        success: true,\n        message: `Successfully connected to ${connector.displayName}`,\n        latency,\n        metadata: {\n          serverVersion: 'Mock Server v1.0',\n          schemas: ['public', 'information_schema'],\n        },\n      };\n      \n    } catch (error) {\n      return {\n        success: false,\n        message: `Connection failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        latency: Date.now() - startTime,\n      };\n    }\n  }\n\n  /**\n   * Execute query on database connection\n   */\n  static async executeQuery(type: string, config: DatabaseConnectionConfig, query: string): Promise<any> {\n    const connector = this.getConnector(type);\n    \n    if (!connector) {\n      throw new Error(`Unknown database connector type: ${type}`);\n    }\n\n    console.log(`Executing query on ${type}: ${query}`);\n\n    try {\n      switch (type) {\n        case 'mysql':\n          return await this.executeMySQLQuery(config, query);\n        case 'postgresql':\n          return await this.executePostgreSQLQuery(config, query);\n        case 'sqlserver':\n          return await this.executeSQLServerQuery(config, query);\n        case 'oracle':\n          return await this.executeOracleQuery(config, query);\n        case 'sqlite':\n          return await this.executeSQLiteQuery(config, query);\n        default:\n          throw new Error(`Query execution not implemented for ${type}`);\n      }\n    } catch (error) {\n      console.error(`Query execution error for ${type}:`, error);\n      throw new Error(`Failed to execute query: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Execute MySQL query\n   */\n  private static async executeMySQLQuery(config: DatabaseConnectionConfig, query: string): Promise<any> {\n    const mysql = await import('mysql2/promise');\n    let connection: any = null;\n    \n    try {\n      connection = await mysql.createConnection({\n        host: config.host,\n        port: parseInt(String(config.port || '3306')),\n        user: config.username,\n        password: config.password,\n        database: config.database,\n        connectTimeout: 10000,\n      });\n\n      const [results] = await connection.execute(query);\n      \n      return {\n        columns: Array.isArray(results) && results.length > 0 ? Object.keys(results[0]) : [],\n        rows: Array.isArray(results) ? results.map(row => Object.values(row)) : [],\n        rowCount: Array.isArray(results) ? results.length : 0\n      };\n    } finally {\n      if (connection) {\n        await connection.end();\n      }\n    }\n  }\n\n  /**\n   * Execute PostgreSQL query\n   */\n  private static async executePostgreSQLQuery(config: DatabaseConnectionConfig, query: string): Promise<any> {\n    const { Client } = await import('pg');\n    const client = new Client({\n      host: config.host,\n      port: parseInt(String(config.port || '5432')),\n      user: config.username,\n      password: config.password,\n      database: config.database,\n      connectionTimeoutMillis: 10000,\n    });\n\n    try {\n      await client.connect();\n      const result = await client.query(query);\n      \n      return {\n        columns: result.fields ? result.fields.map(field => field.name) : [],\n        rows: result.rows ? result.rows.map(row => Object.values(row)) : [],\n        rowCount: result.rowCount || result.rows?.length || 0\n      };\n    } finally {\n      await client.end();\n    }\n  }\n\n  /**\n   * Transform LIMIT syntax to SQL Server TOP syntax\n   * Handles simple SELECT queries and CTEs\n   */\n  private static transformLimitToTop(query: string): string {\n    // Match LIMIT with optional OFFSET at end (ignore trailing comments/whitespace)\n    const limitOffsetPattern = /\\s+LIMIT\\s+(\\d+)(?:\\s+OFFSET\\s+(\\d+))?(?:\\s*(?:--[^\\n]*)?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*;?\\s*)?$/i;\n    const match = query.match(limitOffsetPattern);\n    \n    if (!match) return query;\n    \n    const limit = match[1];\n    const offset = match[2];\n    \n    // Remove LIMIT clause and trailing comments\n    const queryWithoutLimit = query.replace(limitOffsetPattern, '');\n    \n    // If OFFSET is present, use OFFSET-FETCH syntax (requires ORDER BY)\n    if (offset) {\n      if (queryWithoutLimit.match(/\\s+ORDER\\s+BY\\s+/i)) {\n        return queryWithoutLimit + ` OFFSET ${offset} ROWS FETCH NEXT ${limit} ROWS ONLY`;\n      } else {\n        throw new Error('SQL Server requires ORDER BY clause when using OFFSET. Please add ORDER BY to your query.');\n      }\n    }\n    \n    // Try to find and transform SELECT statement\n    // Case 1: Query starts with WITH (CTE)\n    if (/^\\s*(?:--[^\\n]*\\n|\\/\\*[\\s\\S]*?\\*\\/)*\\s*WITH\\s+/i.test(queryWithoutLimit)) {\n      // Find the main SELECT after CTE (look for closing paren followed by SELECT)\n      const ctePattern = /(\\))\\s*SELECT(\\s+(?:DISTINCT|ALL))?\\s+/i;\n      const cteMatch = queryWithoutLimit.match(ctePattern);\n      if (cteMatch) {\n        const modifier = cteMatch[2] || '';\n        return queryWithoutLimit.replace(ctePattern, `${cteMatch[1]} SELECT${modifier} TOP ${limit} `);\n      }\n    }\n    \n    // Case 2: Simple SELECT query\n    const simpleSelectPattern = /^(?:\\s*(?:--[^\\n]*\\n|\\/\\*[\\s\\S]*?\\*\\/)*\\s*)*SELECT(\\s+(?:DISTINCT|ALL))?\\s+/i;\n    const selectMatch = queryWithoutLimit.match(simpleSelectPattern);\n    \n    if (selectMatch) {\n      const modifier = selectMatch[1] || '';\n      return queryWithoutLimit.replace(simpleSelectPattern, `SELECT${modifier} TOP ${limit} `);\n    }\n    \n    // Case 3: Too complex - throw error\n    throw new Error('This query uses LIMIT with complex SQL features. Please rewrite it using SQL Server syntax (TOP instead of LIMIT, or OFFSET-FETCH for pagination).');\n  }\n\n  /**\n   * Execute SQL Server query\n   */\n  private static async executeSQLServerQuery(config: DatabaseConnectionConfig, query: string): Promise<any> {\n    const sql = await import('mssql');\n    let pool: any = null;\n\n    try {\n      const sqlConfig: any = {\n        server: config.host || '',\n        port: parseInt(String(config.port || '1433')),\n        database: config.database || '',\n        user: config.username || '',\n        password: config.password || '',\n        options: {\n          encrypt: true,\n          trustServerCertificate: false,\n          connectTimeout: 30000,\n          requestTimeout: 15000,\n          enableArithAbort: true,\n        },\n      };\n\n      // Transform LIMIT to TOP for SQL Server\n      const transformedQuery = this.transformLimitToTop(query);\n\n      // Properly instantiate ConnectionPool from mssql\n      const { ConnectionPool } = sql.default || sql;\n      pool = new ConnectionPool(sqlConfig);\n      await pool.connect();\n      \n      const result = await pool.request().query(transformedQuery);\n      \n      return {\n        columns: result.recordset.columns ? Object.keys(result.recordset.columns) : [],\n        rows: result.recordset ? result.recordset.map((row: any) => Object.values(row)) : [],\n        rowCount: result.rowsAffected ? result.rowsAffected[0] : result.recordset?.length || 0\n      };\n    } finally {\n      if (pool) {\n        await pool.close();\n      }\n    }\n  }\n\n  /**\n   * Execute Oracle query (placeholder - returns mock data)\n   */\n  private static async executeOracleQuery(config: DatabaseConnectionConfig, query: string): Promise<any> {\n    // Oracle implementation would go here\n    console.log('Oracle query execution not implemented, returning mock data');\n    return {\n      columns: ['ID', 'NAME', 'VALUE'],\n      rows: [\n        [1, 'Oracle Sample', 100],\n        [2, 'Oracle Test', 200]\n      ],\n      rowCount: 2\n    };\n  }\n\n  /**\n   * Execute SQLite query (placeholder - returns mock data)\n   */\n  private static async executeSQLiteQuery(config: DatabaseConnectionConfig, query: string): Promise<any> {\n    // SQLite implementation would go here\n    console.log('SQLite query execution not implemented, returning mock data');\n    return {\n      columns: ['ID', 'DATA'],\n      rows: [\n        [1, 'SQLite Sample'],\n        [2, 'SQLite Test']\n      ],\n      rowCount: 2\n    };\n  }\n\n  /**\n   * Get database schema information\n   */\n  static async getSchemaInfo(type: string, config: DatabaseConnectionConfig): Promise<{\n    schemas: string[];\n    tables: Array<{\n      name: string;\n      schema: string;\n      type: 'table' | 'view';\n      rowCount?: number;\n      columns: Array<{\n        name: string;\n        type: string;\n        nullable: boolean;\n        isPrimaryKey: boolean;\n        defaultValue?: string;\n      }>;\n    }>;\n  }> {\n    const connector = this.getConnector(type);\n    \n    if (!connector) {\n      throw new Error(`Unknown database connector type: ${type}`);\n    }\n\n    try {\n      // Generate tables and schema information based on database type\n      switch (type) {\n        case 'mysql':\n          return await this.getMySQLSchema(config);\n        case 'postgresql':\n          return await this.getPostgreSQLSchema(config);\n        case 'sqlserver':\n          return await this.getSQLServerSchema(config);\n        case 'oracle':\n          return await this.getOracleSchema(config);\n        case 'sqlite':\n          return await this.getSQLiteSchema(config);\n        default:\n          // For other databases, return mock data for now\n          return {\n            schemas: ['public'],\n            tables: [\n              {\n                name: 'sample_table_1',\n                schema: 'public',\n                type: 'table',\n                rowCount: 1000,\n                columns: [\n                  { name: 'id', type: 'integer', nullable: false, isPrimaryKey: true },\n                  { name: 'name', type: 'varchar', nullable: true, isPrimaryKey: false },\n                  { name: 'created_at', type: 'timestamp', nullable: true, isPrimaryKey: false }\n                ]\n              },\n              {\n                name: 'sample_table_2',\n                schema: 'public',\n                type: 'table',\n                rowCount: 500,\n                columns: [\n                  { name: 'id', type: 'integer', nullable: false, isPrimaryKey: true },\n                  { name: 'value', type: 'decimal', nullable: true, isPrimaryKey: false }\n                ]\n              }\n            ]\n          };\n      }\n    } catch (error) {\n      console.error('Schema introspection error:', error);\n      throw new Error(`Failed to retrieve schema: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  private static async getMySQLSchema(config: DatabaseConnectionConfig): Promise<any> {\n    // Mock MySQL schema - in real implementation, would use mysql2 driver\n    return {\n      schemas: [config.database || 'default'],\n      tables: [\n        {\n          name: 'customers',\n          schema: config.database,\n          type: 'table' as const,\n          rowCount: 2500,\n          columns: [\n            { name: 'customer_id', type: 'int', nullable: false, isPrimaryKey: true },\n            { name: 'first_name', type: 'varchar(50)', nullable: false, isPrimaryKey: false },\n            { name: 'last_name', type: 'varchar(50)', nullable: false, isPrimaryKey: false },\n            { name: 'email', type: 'varchar(100)', nullable: true, isPrimaryKey: false },\n            { name: 'created_at', type: 'datetime', nullable: true, isPrimaryKey: false }\n          ]\n        },\n        {\n          name: 'orders',\n          schema: config.database,\n          type: 'table' as const,\n          rowCount: 15000,\n          columns: [\n            { name: 'order_id', type: 'int', nullable: false, isPrimaryKey: true },\n            { name: 'customer_id', type: 'int', nullable: false, isPrimaryKey: false },\n            { name: 'order_date', type: 'datetime', nullable: false, isPrimaryKey: false },\n            { name: 'total_amount', type: 'decimal(10,2)', nullable: false, isPrimaryKey: false },\n            { name: 'status', type: 'varchar(20)', nullable: false, isPrimaryKey: false }\n          ]\n        },\n        {\n          name: 'products',\n          schema: config.database,\n          type: 'table' as const,\n          rowCount: 800,\n          columns: [\n            { name: 'product_id', type: 'int', nullable: false, isPrimaryKey: true },\n            { name: 'product_name', type: 'varchar(255)', nullable: false, isPrimaryKey: false },\n            { name: 'price', type: 'decimal(10,2)', nullable: false, isPrimaryKey: false },\n            { name: 'category', type: 'varchar(50)', nullable: true, isPrimaryKey: false }\n          ]\n        }\n      ]\n    };\n  }\n\n  private static async getPostgreSQLSchema(config: DatabaseConnectionConfig): Promise<any> {\n    // Mock PostgreSQL schema - in real implementation, would use pg driver\n    return {\n      schemas: ['public', 'analytics'],\n      tables: [\n        {\n          name: 'users',\n          schema: 'public',\n          type: 'table' as const,\n          rowCount: 1200,\n          columns: [\n            { name: 'id', type: 'serial', nullable: false, isPrimaryKey: true },\n            { name: 'username', type: 'varchar(255)', nullable: false, isPrimaryKey: false },\n            { name: 'email', type: 'varchar(255)', nullable: false, isPrimaryKey: false },\n            { name: 'created_at', type: 'timestamp', nullable: true, isPrimaryKey: false }\n          ]\n        },\n        {\n          name: 'products',\n          schema: 'public',\n          type: 'table' as const,\n          rowCount: 800,\n          columns: [\n            { name: 'id', type: 'serial', nullable: false, isPrimaryKey: true },\n            { name: 'name', type: 'varchar(255)', nullable: false, isPrimaryKey: false },\n            { name: 'price', type: 'numeric(10,2)', nullable: false, isPrimaryKey: false },\n            { name: 'description', type: 'text', nullable: true, isPrimaryKey: false }\n          ]\n        },\n        {\n          name: 'sales_summary',\n          schema: 'analytics',\n          type: 'view' as const,\n          columns: [\n            { name: 'month', type: 'date', nullable: false, isPrimaryKey: false },\n            { name: 'total_sales', type: 'numeric', nullable: true, isPrimaryKey: false },\n            { name: 'order_count', type: 'integer', nullable: true, isPrimaryKey: false }\n          ]\n        }\n      ]\n    };\n  }\n\n  private static async getSQLServerSchema(config: DatabaseConnectionConfig): Promise<any> {\n    let pool: sql.ConnectionPool | null = null;\n    \n    try {\n      // Create connection configuration with Azure SQL Database optimizations\n      const sqlConfig: sql.config = {\n        server: config.host || '',\n        port: config.port || 1433,\n        database: config.database || '',\n        user: config.username || '',\n        password: config.password || '',\n        options: {\n          encrypt: true, // Use encryption for Azure SQL Database\n          trustServerCertificate: false, // Don't trust self-signed certificates\n          connectTimeout: 30000, // 30 seconds - longer for Azure SQL DB\n          requestTimeout: 15000, // 15 seconds - longer for complex queries\n          enableArithAbort: true, // Required for Azure SQL Database\n        },\n      };\n\n      console.log(`Attempting to connect to SQL Server: ${config.host}:${config.port}/${config.database}`);\n      \n      // Create connection pool\n      pool = new sql.ConnectionPool(sqlConfig);\n      await pool.connect();\n      \n      console.log('Successfully connected to SQL Server for schema introspection');\n      \n      // Try simplified schema query first\n      return await this.getSimplifiedSQLServerSchema(pool);\n      \n    } catch (error) {\n      console.error('Full SQL Server schema introspection failed, trying fallback:', error);\n      \n      // Close any existing connection\n      if (pool) {\n        try {\n          await pool.close();\n        } catch (closeError) {\n          console.error('Error closing failed connection:', closeError);\n        }\n        pool = null;\n      }\n      \n      // Try fallback with simpler connection approach\n      return await this.getFallbackSQLServerSchema(config);\n    } finally {\n      // Always close the connection\n      if (pool) {\n        try {\n          await pool.close();\n        } catch (closeError) {\n          console.error('Error closing SQL Server connection:', closeError);\n        }\n      }\n    }\n  }\n\n  private static async getSimplifiedSQLServerSchema(pool: sql.ConnectionPool): Promise<any> {\n\n    // Get schemas - start with simple query\n    const schemasResult = await pool.request().query(`\n      SELECT DISTINCT SCHEMA_NAME\n      FROM INFORMATION_SCHEMA.SCHEMATA \n      WHERE SCHEMA_NAME NOT IN ('sys', 'INFORMATION_SCHEMA', 'guest')\n      ORDER BY SCHEMA_NAME\n    `);\n    \n    const schemas = schemasResult.recordset.map((row: any) => row.SCHEMA_NAME);\n    \n    // Get tables - simplified query for better compatibility\n    const tablesResult = await pool.request().query(`\n      SELECT \n        TABLE_SCHEMA,\n        TABLE_NAME,\n        TABLE_TYPE\n      FROM INFORMATION_SCHEMA.TABLES\n      WHERE TABLE_TYPE IN ('BASE TABLE', 'VIEW')\n        AND TABLE_SCHEMA NOT IN ('sys', 'INFORMATION_SCHEMA')\n      ORDER BY TABLE_SCHEMA, TABLE_NAME\n    `);\n    \n    // Get basic column information\n    const columnsResult = await pool.request().query(`\n      SELECT \n        TABLE_SCHEMA,\n        TABLE_NAME,\n        COLUMN_NAME,\n        DATA_TYPE,\n        IS_NULLABLE\n      FROM INFORMATION_SCHEMA.COLUMNS\n      WHERE TABLE_SCHEMA NOT IN ('sys', 'INFORMATION_SCHEMA')\n      ORDER BY TABLE_SCHEMA, TABLE_NAME, ORDINAL_POSITION\n    `);\n    \n    // Group columns by table\n    const tableColumns: Record<string, any[]> = {};\n    for (const col of columnsResult.recordset) {\n      const tableKey = `${col.TABLE_SCHEMA}.${col.TABLE_NAME}`;\n      if (!tableColumns[tableKey]) {\n        tableColumns[tableKey] = [];\n      }\n      \n      tableColumns[tableKey].push({\n        name: col.COLUMN_NAME,\n        type: col.DATA_TYPE,\n        nullable: col.IS_NULLABLE === 'YES',\n        isPrimaryKey: false, // Simplified - don't fetch PK info for now\n        defaultValue: null\n      });\n    }\n    \n    // Build tables array\n    const tables = tablesResult.recordset.map((table: any) => {\n      const tableKey = `${table.TABLE_SCHEMA}.${table.TABLE_NAME}`;\n      return {\n        name: table.TABLE_NAME,\n        schema: table.TABLE_SCHEMA,\n        type: table.TABLE_TYPE === 'BASE TABLE' ? 'table' as const : 'view' as const,\n        rowCount: 0, // Don't fetch row counts in simplified mode\n        columns: tableColumns[tableKey] || []\n      };\n    });\n    \n    return {\n      schemas,\n      tables\n    };\n  }\n\n  private static async getFallbackSQLServerSchema(config: DatabaseConnectionConfig): Promise<any> {\n    // Provide basic fallback schema if connection fails\n    console.log('Using fallback schema for SQL Server');\n    return {\n      schemas: ['dbo'],\n      tables: [\n        {\n          name: 'connection_failed',\n          schema: 'dbo',\n          type: 'table' as const,\n          rowCount: 0,\n          columns: [\n            { \n              name: 'error_message', \n              type: 'varchar', \n              nullable: true, \n              isPrimaryKey: false,\n              defaultValue: 'Schema introspection failed - check firewall settings'\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  private static async getOracleSchema(config: DatabaseConnectionConfig): Promise<any> {\n    // Mock Oracle schema\n    return {\n      schemas: [config.username?.toUpperCase() || 'SCHEMA'],\n      tables: [\n        {\n          name: 'CUSTOMERS',\n          schema: config.username?.toUpperCase() || 'SCHEMA',\n          type: 'table' as const,\n          rowCount: 3000,\n          columns: [\n            { name: 'CUSTOMER_ID', type: 'NUMBER', nullable: false, isPrimaryKey: true },\n            { name: 'CUSTOMER_NAME', type: 'VARCHAR2(100)', nullable: false, isPrimaryKey: false },\n            { name: 'EMAIL', type: 'VARCHAR2(255)', nullable: true, isPrimaryKey: false }\n          ]\n        }\n      ]\n    };\n  }\n\n  private static async getSQLiteSchema(config: DatabaseConnectionConfig): Promise<any> {\n    // Mock SQLite schema\n    return {\n      schemas: ['main'],\n      tables: [\n        {\n          name: 'local_data',\n          schema: 'main',\n          type: 'table' as const,\n          rowCount: 100,\n          columns: [\n            { name: 'id', type: 'INTEGER', nullable: false, isPrimaryKey: true },\n            { name: 'data', type: 'TEXT', nullable: true, isPrimaryKey: false }\n          ]\n        }\n      ]\n    };\n  }\n}","size_bytes":34431},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"server/services/semantic-layer.ts":{"content":"import { sql } from 'drizzle-orm';\n\n// Metric types matching BI industry standards\nexport type AggregationType = 'sum' | 'avg' | 'count' | 'min' | 'max' | 'count_distinct';\n\nexport interface Metric {\n  name: string;\n  field: string;\n  aggregation: AggregationType;\n  format?: 'number' | 'currency' | 'percentage';\n}\n\nexport interface Dimension {\n  name: string;\n  field: string;\n  type: 'string' | 'number' | 'date' | 'boolean';\n}\n\nexport interface SemanticDataset {\n  id: string;\n  name: string;\n  connectionType: string;\n  tableName: string;\n  schemaName?: string;\n  metrics: Metric[];\n  dimensions: Dimension[];\n}\n\nexport interface QuerySpec {\n  dataset: SemanticDataset;\n  metrics: string[];\n  dimensions: string[];\n  filters?: Array<{\n    field: string;\n    operator: 'eq' | 'ne' | 'gt' | 'lt' | 'gte' | 'lte' | 'in' | 'like';\n    value: any;\n  }>;\n  limit?: number;\n  offset?: number;\n  sortBy?: string;\n  sortOrder?: 'asc' | 'desc';\n}\n\nexport class SemanticLayer {\n  /**\n   * Translate chart configuration to semantic query\n   * This is the key method that abstracts business logic from SQL\n   */\n  static translateChartConfig(\n    chartType: string,\n    config: Record<string, any>,\n    dataset: SemanticDataset\n  ): QuerySpec {\n    const querySpec: QuerySpec = {\n      dataset,\n      metrics: [],\n      dimensions: [],\n      limit: config.limit ? parseInt(config.limit) : 100,\n      sortOrder: config.sortOrder || 'desc'\n    };\n\n    switch (chartType) {\n      // Bar charts\n      case 'bar':\n      case 'stacked_bar':\n      case 'grouped_bar':\n      case 'horizontal_bar':\n        if (config.xAxis || config.dimension) querySpec.dimensions.push(config.xAxis || config.dimension);\n        if (config.yAxis || config.metric) {\n          querySpec.metrics.push(config.yAxis || config.metric);\n          querySpec.sortBy = config.yAxis || config.metric;\n        }\n        if (config.metrics && Array.isArray(config.metrics)) {\n          querySpec.metrics.push(...config.metrics);\n        }\n        if (config.groupBy) querySpec.dimensions.push(config.groupBy);\n        break;\n\n      // Line/Area charts\n      case 'line':\n      case 'area':\n      case 'multi_line':\n      case 'stacked_area':\n      case 'smooth_line':\n      case 'stepped_line':\n      case 'big_number_trendline':\n        if (config.xAxis || config.timeColumn) querySpec.dimensions.push(config.xAxis || config.timeColumn);\n        if (config.yAxis || config.metric) querySpec.metrics.push(config.yAxis || config.metric);\n        if (config.metrics && Array.isArray(config.metrics)) {\n          querySpec.metrics.push(...config.metrics);\n        }\n        if (config.groupBy) querySpec.dimensions.push(config.groupBy);\n        break;\n\n      // Pie/Donut charts\n      case 'pie':\n      case 'donut':\n        if (config.category || config.dimension) querySpec.dimensions.push(config.category || config.dimension);\n        if (config.value || config.metric) {\n          querySpec.metrics.push(config.value || config.metric);\n          querySpec.sortBy = config.value || config.metric;\n        }\n        break;\n\n      // KPI charts\n      case 'big_number':\n      case 'gauge':\n      case 'multi_value_card':\n        if (config.metric) querySpec.metrics.push(config.metric);\n        if (config.values && Array.isArray(config.values)) {\n          querySpec.metrics.push(...config.values);\n        }\n        querySpec.limit = 1;\n        break;\n\n      // Scatter/Bubble\n      case 'scatter':\n      case 'bubble':\n        if (config.xAxis) querySpec.metrics.push(config.xAxis);\n        if (config.yAxis) querySpec.metrics.push(config.yAxis);\n        if (config.size) querySpec.metrics.push(config.size);\n        if (config.color || config.groupBy) querySpec.dimensions.push(config.color || config.groupBy);\n        break;\n\n      // Heatmaps\n      case 'heatmap':\n      case 'calendar_heatmap':\n        if (config.xAxis || config.dateColumn) querySpec.dimensions.push(config.xAxis || config.dateColumn);\n        if (config.yAxis) querySpec.dimensions.push(config.yAxis);\n        if (config.metric) querySpec.metrics.push(config.metric);\n        break;\n\n      // Distribution\n      case 'boxplot':\n        if (config.dimension) querySpec.dimensions.push(config.dimension);\n        if (config.metric) querySpec.metrics.push(config.metric);\n        break;\n\n      case 'histogram':\n        if (config.metric) querySpec.metrics.push(config.metric);\n        break;\n\n      // Flow charts\n      case 'funnel':\n      case 'waterfall':\n      case 'treemap':\n        if (config.dimension) querySpec.dimensions.push(config.dimension);\n        if (config.metric) querySpec.metrics.push(config.metric);\n        if (config.groupBy) querySpec.dimensions.push(config.groupBy);\n        break;\n\n      case 'sankey':\n        if (config.source) querySpec.dimensions.push(config.source);\n        if (config.target) querySpec.dimensions.push(config.target);\n        if (config.value) querySpec.metrics.push(config.value);\n        break;\n\n      // Hierarchical\n      case 'sunburst':\n        if (config.hierarchy && Array.isArray(config.hierarchy)) {\n          querySpec.dimensions.push(...config.hierarchy);\n        }\n        if (config.metric) querySpec.metrics.push(config.metric);\n        break;\n\n      // Multi-dimensional\n      case 'radar':\n        if (config.dimensions && Array.isArray(config.dimensions)) {\n          querySpec.dimensions.push(...config.dimensions);\n        }\n        if (config.metrics && Array.isArray(config.metrics)) {\n          querySpec.metrics.push(...config.metrics);\n        }\n        break;\n\n      // Table/Pivot\n      case 'table':\n      case 'pivot_table':\n        if (config.columns) {\n          const cols = typeof config.columns === 'string' \n            ? config.columns.split(',').map((c: string) => c.trim())\n            : config.columns;\n          querySpec.dimensions.push(...cols);\n        }\n        if (config.rows && Array.isArray(config.rows)) {\n          querySpec.dimensions.push(...config.rows);\n        }\n        if (config.metrics && Array.isArray(config.metrics)) {\n          querySpec.metrics.push(...config.metrics);\n        }\n        querySpec.limit = config.limit ? parseInt(config.limit) : 50;\n        break;\n\n      // Map charts\n      case 'country_map':\n      case 'geojson_map':\n        if (config.countryColumn || config.geojsonColumn) {\n          querySpec.dimensions.push(config.countryColumn || config.geojsonColumn);\n        }\n        if (config.metric) querySpec.metrics.push(config.metric);\n        break;\n\n      default:\n        // Generic fallback\n        if (config.xAxis) querySpec.dimensions.push(config.xAxis);\n        if (config.yAxis) querySpec.metrics.push(config.yAxis);\n    }\n\n    // Remove duplicates and filter out undefined\n    querySpec.dimensions = Array.from(new Set(querySpec.dimensions.filter(Boolean)));\n    querySpec.metrics = Array.from(new Set(querySpec.metrics.filter(Boolean)));\n\n    return querySpec;\n  }\n\n  /**\n   * Build SQL query from semantic query spec\n   * Generates type-safe, optimized SQL with proper aggregations\n   */\n  static buildQuery(spec: QuerySpec, connectionType: string): string {\n    const { dataset, metrics, dimensions, filters, limit, offset, sortBy, sortOrder } = spec;\n    \n    // Build SELECT clause\n    const selectParts: string[] = [];\n    \n    // Add dimensions\n    dimensions.forEach(dim => {\n      selectParts.push(this.sanitizeIdentifier(dim));\n    });\n\n    // Add metrics with aggregations\n    metrics.forEach(metric => {\n      const aggregation = spec.dataset.metrics.find(m => m.field === metric)?.aggregation || 'sum';\n      selectParts.push(`${aggregation.toUpperCase()}(${this.sanitizeIdentifier(metric)}) as ${this.sanitizeIdentifier(metric)}`);\n    });\n\n    // If no specific columns, select all\n    if (selectParts.length === 0) {\n      selectParts.push('*');\n    }\n\n    // Build table name\n    const tableName = dataset.schemaName \n      ? `${this.sanitizeIdentifier(dataset.schemaName)}.${this.sanitizeIdentifier(dataset.tableName)}`\n      : this.sanitizeIdentifier(dataset.tableName);\n\n    // Start building query\n    let query = `SELECT ${selectParts.join(', ')} FROM ${tableName}`;\n\n    // Add WHERE clause\n    if (filters && filters.length > 0) {\n      const whereClauses = filters.map(f => {\n        const field = this.sanitizeIdentifier(f.field);\n        switch (f.operator) {\n          case 'eq': return `${field} = ${this.sanitizeValue(f.value)}`;\n          case 'ne': return `${field} != ${this.sanitizeValue(f.value)}`;\n          case 'gt': return `${field} > ${this.sanitizeValue(f.value)}`;\n          case 'lt': return `${field} < ${this.sanitizeValue(f.value)}`;\n          case 'gte': return `${field} >= ${this.sanitizeValue(f.value)}`;\n          case 'lte': return `${field} <= ${this.sanitizeValue(f.value)}`;\n          case 'in': return `${field} IN (${f.value.map((v: any) => this.sanitizeValue(v)).join(', ')})`;\n          case 'like': return `${field} LIKE ${this.sanitizeValue(`%${f.value}%`)}`;\n          default: return `${field} = ${this.sanitizeValue(f.value)}`;\n        }\n      });\n      query += ` WHERE ${whereClauses.join(' AND ')}`;\n    }\n\n    // Add GROUP BY if we have dimensions and metrics\n    if (dimensions.length > 0 && metrics.length > 0) {\n      query += ` GROUP BY ${dimensions.map(d => this.sanitizeIdentifier(d)).join(', ')}`;\n    }\n\n    // Add ORDER BY\n    if (sortBy) {\n      query += ` ORDER BY ${this.sanitizeIdentifier(sortBy)} ${sortOrder?.toUpperCase() || 'DESC'}`;\n    }\n\n    // Add LIMIT based on connection type\n    if (limit) {\n      if (connectionType === 'mssql' || connectionType === 'sqlserver') {\n        // For SQL Server, use TOP at the beginning\n        query = query.replace('SELECT', `SELECT TOP ${limit}`);\n      } else {\n        // For MySQL, PostgreSQL, etc.\n        query += ` LIMIT ${limit}`;\n      }\n    }\n\n    // Add OFFSET\n    if (offset) {\n      query += ` OFFSET ${offset}`;\n    }\n\n    return query;\n  }\n\n  /**\n   * Sanitize SQL identifiers to prevent injection\n   */\n  private static sanitizeIdentifier(identifier: string): string {\n    return identifier.replace(/[^a-zA-Z0-9_.]/g, '');\n  }\n\n  /**\n   * Sanitize values for SQL\n   */\n  private static sanitizeValue(value: any): string {\n    if (typeof value === 'string') {\n      return `'${value.replace(/'/g, \"''\")}'`;\n    }\n    if (typeof value === 'number') {\n      return value.toString();\n    }\n    if (value === null || value === undefined) {\n      return 'NULL';\n    }\n    return `'${String(value)}'`;\n  }\n\n  /**\n   * Create semantic dataset from data source metadata\n   * This auto-discovers metrics and dimensions from schema\n   */\n  static createDatasetFromMetadata(\n    dataSource: any\n  ): SemanticDataset {\n    const metadata = dataSource.metadata as any;\n    const metrics: Metric[] = [];\n    const dimensions: Dimension[] = [];\n\n    // Auto-detect metrics and dimensions from schema\n    if (metadata.schema && Array.isArray(metadata.schema)) {\n      metadata.schema.forEach((col: any) => {\n        const colName = col.name || col.column_name;\n        const colType = col.type || col.data_type || '';\n\n        // Numeric columns are potential metrics\n        if (this.isNumericType(colType)) {\n          metrics.push({\n            name: colName,\n            field: colName,\n            aggregation: 'sum',\n            format: 'number'\n          });\n        }\n\n        // All columns are dimensions\n        dimensions.push({\n          name: colName,\n          field: colName,\n          type: this.mapColumnType(colType)\n        });\n      });\n    } else if (metadata.columns && Array.isArray(metadata.columns)) {\n      // For CSV files\n      metadata.columns.forEach((col: any) => {\n        // Handle both string columns and object columns\n        const colName = typeof col === 'string' ? col : (col.name || col.column_name || String(col));\n        \n        // Assume numeric-looking columns are metrics\n        dimensions.push({\n          name: colName,\n          field: colName,\n          type: 'string'\n        });\n        \n        // Add as metric if it looks numeric (only if colName is a string)\n        if (typeof colName === 'string') {\n          const lowerCol = colName.toLowerCase();\n          if (lowerCol.includes('total') || \n              lowerCol.includes('amount') ||\n              lowerCol.includes('price') ||\n              lowerCol.includes('quantity')) {\n            metrics.push({\n              name: colName,\n              field: colName,\n              aggregation: 'sum',\n              format: 'number'\n            });\n          }\n        }\n      });\n    }\n\n    return {\n      id: dataSource.id,\n      name: dataSource.name,\n      connectionType: metadata.connectionType || dataSource.type,\n      tableName: metadata.tableName || '',\n      schemaName: metadata.schemaName,\n      metrics,\n      dimensions\n    };\n  }\n\n  private static isNumericType(type: string): boolean {\n    const numericTypes = ['int', 'integer', 'bigint', 'decimal', 'numeric', 'float', 'double', 'real', 'money'];\n    return numericTypes.some(t => type.toLowerCase().includes(t));\n  }\n\n  private static mapColumnType(sqlType: string): 'string' | 'number' | 'date' | 'boolean' {\n    const type = sqlType.toLowerCase();\n    if (this.isNumericType(type)) return 'number';\n    if (type.includes('date') || type.includes('time')) return 'date';\n    if (type.includes('bool')) return 'boolean';\n    return 'string';\n  }\n}\n","size_bytes":13426},"client/src/components/kpi/multi-value-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\n\ninterface ValueItem {\n  label: string;\n  value: string | number;\n  prefix?: string;\n  suffix?: string;\n  highlight?: boolean;\n}\n\ninterface MultiValueCardProps {\n  title: string;\n  values: ValueItem[];\n}\n\nexport function MultiValueCard({ title, values }: MultiValueCardProps) {\n  return (\n    <Card className=\"w-full\" data-testid=\"kpi-multi-value-card\">\n      <CardHeader className=\"pb-1\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-2 p-4 pt-0\">\n        {values.map((item, index) => (\n          <div key={index}>\n            {index > 0 && <Separator className=\"mb-3\" />}\n            <div className=\"space-y-1\">\n              <div className=\"text-xs text-muted-foreground\">\n                {item.label}\n              </div>\n              <div \n                className={`text-2xl font-bold ${item.highlight ? 'text-primary' : ''}`}\n                data-testid={`value-${index}`}\n              >\n                {item.prefix}{item.value}{item.suffix}\n              </div>\n            </div>\n          </div>\n        ))}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1323},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { \n  pgTable, \n  text, \n  varchar, \n  timestamp, \n  integer, \n  jsonb,\n  index \n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Data sources table\nexport const dataSources = pgTable(\"data_sources\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  name: text(\"name\").notNull(),\n  type: text(\"type\").notNull(), // Database connector types: see DatabaseConnectorType\n  filename: text(\"filename\"), // For file-based sources\n  size: integer(\"size\"),\n  rowCount: integer(\"row_count\"),\n  columnCount: integer(\"column_count\"),\n  status: text(\"status\").notNull().default('processing'), // 'processing', 'ready', 'error', 'connected'\n  connectionConfig: jsonb(\"connection_config\"), // Store encrypted connection details\n  metadata: jsonb(\"metadata\"), // Additional metadata like schema info, file paths, etc.\n  connectionId: varchar(\"connection_id\").references(() => connections.id), // Reference to parent connection for table datasets\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  lastSyncedAt: timestamp(\"last_synced_at\"),\n});\n\n// Database connections table - stores unique database connections\nexport const connections = pgTable(\"connections\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  name: text(\"name\").notNull(), // User-friendly connection name\n  type: text(\"type\").notNull(), // Database connector type (mysql, postgresql, sqlserver, etc.)\n  status: text(\"status\").notNull().default('connected'), // 'connected', 'disconnected', 'error'\n  connectionConfig: jsonb(\"connection_config\").notNull(), // Store encrypted connection details\n  metadata: jsonb(\"metadata\"), // Additional metadata like available schemas, last tested, etc.\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  lastTestedAt: timestamp(\"last_tested_at\"),\n});\n\n// AI queries table\nexport const aiQueries = pgTable(\"ai_queries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  question: text(\"question\").notNull(),\n  answer: text(\"answer\").notNull(),\n  isVoiceQuery: varchar(\"is_voice_query\").default('false'),\n  dataSourceId: varchar(\"data_source_id\").references(() => dataSources.id),\n  metadata: jsonb(\"metadata\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Dashboards table\nexport const dashboards = pgTable(\"dashboards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// KPIs table\nexport const kpis = pgTable(\"kpis\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  dashboardId: varchar(\"dashboard_id\").references(() => dashboards.id),\n  question: text(\"question\").notNull(),\n  value: text(\"value\").notNull(),\n  unit: text(\"unit\"),\n  changePercent: text(\"change_percent\"),\n  visualType: text(\"visual_type\").default('big-number'), // 'big-number' | 'big-number-trendline'\n  format: text(\"format\").default('number'), // 'number' | 'currency' | 'percentage'\n  decimalPlaces: integer(\"decimal_places\").default(0),\n  currencyCode: text(\"currency_code\").default('USD'),\n  prefix: text(\"prefix\"),\n  suffix: text(\"suffix\"),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Charts table\nexport const charts = pgTable(\"charts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  title: text(\"title\").notNull(),\n  type: text(\"type\").notNull(), // 'line', 'bar', 'pie', etc.\n  config: jsonb(\"config\").notNull(), // Chart-specific configuration (columns, aggregations, colors, etc.)\n  query: text(\"query\"), // Optional: SQL query used to generate the chart data\n  dataSourceIds: text(\"data_source_ids\").array(), // Support multiple data sources for joins\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Dashboard Charts junction table - for positioning charts on dashboards\nexport const dashboardCharts = pgTable(\"dashboard_charts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  dashboardId: varchar(\"dashboard_id\").notNull().references(() => dashboards.id),\n  chartId: varchar(\"chart_id\").notNull().references(() => charts.id),\n  x: integer(\"x\").notNull().default(0), // Grid X position\n  y: integer(\"y\").notNull().default(0), // Grid Y position\n  w: integer(\"w\").notNull().default(4), // Grid width (columns)\n  h: integer(\"h\").notNull().default(3), // Grid height (rows)\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Views table - for SQL Engine created views\nexport const views = pgTable(\"views\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  sqlQuery: text(\"sql_query\").notNull(),\n  dataSourceId: varchar(\"data_source_id\").references(() => dataSources.id),\n  resultData: jsonb(\"result_data\"), // Cache query results\n  columns: jsonb(\"columns\"), // Column metadata for the view\n  rowCount: integer(\"row_count\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  lastExecuted: timestamp(\"last_executed\"),\n});\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  email: true,\n  password: true,\n  name: true,\n});\n\nexport const insertDataSourceSchema = createInsertSchema(dataSources).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAiQuerySchema = createInsertSchema(aiQueries).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertKpiSchema = createInsertSchema(kpis).omit({\n  id: true,\n  createdAt: true,\n  lastUpdated: true,\n});\n\nexport const insertChartSchema = createInsertSchema(charts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDashboardChartSchema = createInsertSchema(dashboardCharts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertViewSchema = createInsertSchema(views).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  lastExecuted: true,\n});\n\nexport const insertConnectionSchema = createInsertSchema(connections).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  lastTestedAt: true,\n});\n\nexport const insertDashboardSchema = createInsertSchema(dashboards).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Database connector types (similar to Apache Superset)\nexport const DatabaseConnectorType = {\n  // Relational Databases\n  MYSQL: 'mysql',\n  POSTGRESQL: 'postgresql', \n  SQLSERVER: 'sqlserver',\n  ORACLE: 'oracle',\n  SQLITE: 'sqlite',\n  \n  // Cloud Data Warehouses\n  BIGQUERY: 'bigquery',\n  SNOWFLAKE: 'snowflake',\n  REDSHIFT: 'redshift',\n  DATABRICKS: 'databricks',\n  AZURE_SYNAPSE: 'azure_synapse',\n  \n  // Columnar & OLAP\n  CLICKHOUSE: 'clickhouse',\n  VERTICA: 'vertica',\n  DRUID: 'druid',\n  \n  // Big Data & Analytics\n  PRESTO: 'presto',\n  TRINO: 'trino',\n  SPARK: 'spark',\n  HIVE: 'hive',\n  \n  // Document & NoSQL (via proxy)\n  MONGODB: 'mongodb', // via Apache Drill\n  ELASTICSEARCH: 'elasticsearch',\n  \n  // Time Series\n  INFLUXDB: 'influxdb',\n  \n  // File-based\n  CSV: 'csv',\n  EXCEL: 'excel',\n  JSON: 'json',\n  \n  // APIs\n  REST_API: 'rest_api',\n  GRAPHQL: 'graphql',\n} as const;\n\nexport type DatabaseConnectorTypeValues = typeof DatabaseConnectorType[keyof typeof DatabaseConnectorType];\n\n// Database connection configuration interface\nexport interface DatabaseConnectionConfig {\n  host?: string;\n  port?: number;\n  database?: string;\n  username?: string;\n  password?: string;\n  \n  // SSL/TLS Configuration\n  sslMode?: 'require' | 'prefer' | 'allow' | 'disable';\n  sslCert?: string;\n  sslKey?: string;\n  sslRootCert?: string;\n  \n  // Cloud-specific configs\n  projectId?: string; // BigQuery\n  keyFile?: string; // BigQuery Service Account\n  account?: string; // Snowflake\n  region?: string; // AWS, etc.\n  warehouse?: string; // Snowflake\n  role?: string; // Snowflake, Redshift\n  \n  // MongoDB specific (via Drill)\n  drillHost?: string;\n  drillPort?: number;\n  \n  // Connection options\n  options?: Record<string, any>;\n  \n  // File upload configs\n  filePath?: string;\n  \n  // API configs\n  baseUrl?: string;\n  apiKey?: string;\n  headers?: Record<string, string>;\n}\n\n// Connection test result\nexport interface ConnectionTestResult {\n  success: boolean;\n  message: string;\n  latency?: number;\n  metadata?: {\n    serverVersion?: string;\n    schemas?: string[];\n    tables?: Array<{ schema: string; table: string; }>;\n  };\n}\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type DataSource = typeof dataSources.$inferSelect;\nexport type InsertDataSource = z.infer<typeof insertDataSourceSchema>;\n\n// Table dataset metadata type for type safety\nexport interface TableDatasetMetadata {\n  isTableDataset: true;\n  connectorType: string;\n  connectionName: string;\n  tableName: string;\n  schemaName: string;\n  tableType: 'table' | 'view';\n  columns: Array<{\n    name: string;\n    type: string;\n    nullable: boolean;\n    isPrimaryKey: boolean;\n    defaultValue?: string;\n  }>;\n  parentConnection: string;\n}\n\n// Standard dataset metadata type  \nexport interface StandardDatasetMetadata {\n  isTableDataset?: false;\n  connectorType?: string;\n  columns?: string[];\n  sampleData?: any[];\n  [key: string]: any;\n}\nexport type AiQuery = typeof aiQueries.$inferSelect;\nexport type InsertAiQuery = z.infer<typeof insertAiQuerySchema>;\nexport type KPI = typeof kpis.$inferSelect;\nexport type InsertKPI = z.infer<typeof insertKpiSchema>;\nexport type Chart = typeof charts.$inferSelect;\nexport type InsertChart = z.infer<typeof insertChartSchema>;\nexport type DashboardChart = typeof dashboardCharts.$inferSelect;\nexport type InsertDashboardChart = z.infer<typeof insertDashboardChartSchema>;\nexport type View = typeof views.$inferSelect;\nexport type InsertView = z.infer<typeof insertViewSchema>;\nexport type Connection = typeof connections.$inferSelect;\nexport type InsertConnection = z.infer<typeof insertConnectionSchema>;\nexport type Dashboard = typeof dashboards.$inferSelect;\nexport type InsertDashboard = z.infer<typeof insertDashboardSchema>;\n","size_bytes":11525},"client/src/components/layout/top-bar.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport VoiceButton from \"@/components/voice/voice-button\";\nimport VoiceStatus from \"@/components/voice/voice-status\";\nimport { Menu, Search, Bell } from \"lucide-react\";\n\ninterface TopBarProps {\n  currentPage: string;\n  onSidebarToggle: () => void;\n}\n\nconst pageLabels: Record<string, string> = {\n  dashboard: \"Dashboard Overview\",\n  warehouse: \"NEX Connect\", \n  assistant: \"NEX AI\",\n  charts: \"NEX VIZ\",\n  datasets: \"NEX House\"\n};\n\nexport default function TopBar({ currentPage, onSidebarToggle }: TopBarProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isRecording, setIsRecording] = useState(false);\n  const [isTranscribing, setIsTranscribing] = useState(false);\n\n  const handleVoiceClick = () => {\n    // This will be implemented by the parent component or voice service\n    setIsRecording(!isRecording);\n  };\n\n  const handleSearchSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (searchQuery.trim()) {\n      // Redirect to assistant page with the query\n      // This would typically be handled by the parent component\n      console.log(\"Search query:\", searchQuery);\n    }\n  };\n\n  return (\n    <header className=\"sticky top-0 z-40 border-b border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60\">\n      <div className=\"px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onSidebarToggle}\n              className=\"lg:hidden\"\n              data-testid=\"button-sidebar-toggle\"\n            >\n              <Menu className=\"h-5 w-5\" />\n            </Button>\n            <h2 className=\"text-lg font-semibold\">\n              {pageLabels[currentPage] || \"NEX Sight\"}\n            </h2>\n          </div>\n          \n          {/* Voice/Text prompt interface - Hidden on dashboard and assistant page */}\n          <div className=\"flex items-center gap-4\">\n            {currentPage !== \"dashboard\" && currentPage !== \"assistant\" && (\n              <>\n                {/* Voice Input Button */}\n                <VoiceButton\n                  isRecording={isRecording}\n                  isTranscribing={isTranscribing}\n                  onClick={handleVoiceClick}\n                />\n                \n                {/* Text Prompt Input */}\n                <form onSubmit={handleSearchSubmit} className=\"relative flex-1 max-w-md\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Ask anything about your data...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"pl-10 bg-input border-border focus:ring-2 focus:ring-primary focus:border-transparent\"\n                      data-testid=\"input-global-search\"\n                    />\n                  </div>\n                </form>\n              </>\n            )}\n            \n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              data-testid=\"button-notifications\"\n            >\n              <Bell className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </div>\n        \n        {/* Voice Status Component - Hidden on dashboard and assistant page */}\n        {currentPage !== \"dashboard\" && currentPage !== \"assistant\" && (\n          <VoiceStatus \n            isRecording={isRecording}\n            isTranscribing={isTranscribing}\n            onStop={handleVoiceClick}\n          />\n        )}\n      </div>\n    </header>\n  );\n}\n","size_bytes":3885},"client/src/components/connectors/connector-modal.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Database, \n  Server, \n  Globe, \n  FolderOpen,\n  TestTube,\n  Loader2,\n  CheckCircle,\n  XCircle,\n  Eye,\n  EyeOff\n} from \"lucide-react\";\n\ninterface ConnectorModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConnectorAdded: () => void;\n}\n\ninterface ConnectionConfig {\n  name: string;\n  type: string;\n  host?: string;\n  port?: string;\n  database?: string;\n  username?: string;\n  password?: string;\n  url?: string;\n  apiKey?: string;\n  authType?: string;\n  headers?: string;\n  sftpPath?: string;\n}\n\nexport default function ConnectorModal({ isOpen, onClose, onConnectorAdded }: ConnectorModalProps) {\n  const [activeTab, setActiveTab] = useState(\"database\");\n  const [config, setConfig] = useState<ConnectionConfig>({\n    name: \"\",\n    type: \"\",\n  });\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState<\"idle\" | \"testing\" | \"success\" | \"error\">(\"idle\");\n  const [showPassword, setShowPassword] = useState(false);\n  const { toast } = useToast();\n\n  const databaseTypes = [\n    { value: \"mysql\", label: \"MySQL\", port: \"3306\" },\n    { value: \"postgresql\", label: \"PostgreSQL\", port: \"5432\" },\n    { value: \"sqlserver\", label: \"SQL Server\", port: \"1433\" },\n    { value: \"sqlite\", label: \"SQLite\", port: \"\" },\n    { value: \"mongodb\", label: \"MongoDB\", port: \"27017\" },\n    { value: \"redis\", label: \"Redis\", port: \"6379\" },\n  ];\n\n  const apiTypes = [\n    { value: \"rest\", label: \"REST API\" },\n    { value: \"graphql\", label: \"GraphQL API\" },\n    { value: \"webhook\", label: \"Webhook\" },\n  ];\n\n  const authTypes = [\n    { value: \"none\", label: \"No Authentication\" },\n    { value: \"apikey\", label: \"API Key\" },\n    { value: \"bearer\", label: \"Bearer Token\" },\n    { value: \"basic\", label: \"Basic Auth\" },\n  ];\n\n  const handleTestConnection = async () => {\n    if (!config.name || !config.type) {\n      toast({\n        title: \"Missing configuration\",\n        description: \"Please fill in the required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsConnecting(true);\n    setConnectionStatus(\"testing\");\n\n    try {\n      const response = await fetch(\"/api/connectors/test\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(config),\n        credentials: \"include\",\n      });\n\n      if (response.ok) {\n        setConnectionStatus(\"success\");\n        toast({\n          title: \"Connection successful\",\n          description: \"Successfully connected to the data source\",\n        });\n      } else {\n        const error = await response.text();\n        setConnectionStatus(\"error\");\n        toast({\n          title: \"Connection failed\",\n          description: error || \"Failed to connect to the data source\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      setConnectionStatus(\"error\");\n      toast({\n        title: \"Connection failed\",\n        description: \"Network error occurred while testing connection\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsConnecting(false);\n    }\n  };\n\n  const handleSaveConnector = async () => {\n    if (connectionStatus !== \"success\") {\n      toast({\n        title: \"Test connection first\",\n        description: \"Please test the connection before saving\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const response = await fetch(\"/api/connectors\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(config),\n        credentials: \"include\",\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Connector saved\",\n          description: \"Data source connector has been added successfully\",\n        });\n        onConnectorAdded();\n        onClose();\n        // Reset form\n        setConfig({ name: \"\", type: \"\" });\n        setConnectionStatus(\"idle\");\n      } else {\n        const error = await response.text();\n        toast({\n          title: \"Save failed\",\n          description: error || \"Failed to save the connector\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Save failed\",\n        description: \"Network error occurred while saving connector\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const updateConfig = (field: string, value: string) => {\n    setConfig(prev => ({ ...prev, [field]: value }));\n    setConnectionStatus(\"idle\");\n  };\n\n  const renderDatabaseTab = () => (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"db-name\">Connection Name *</Label>\n          <Input\n            id=\"db-name\"\n            placeholder=\"My Database Connection\"\n            value={config.name}\n            onChange={(e) => updateConfig(\"name\", e.target.value)}\n            data-testid=\"input-connection-name\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"db-type\">Database Type *</Label>\n          <Select value={config.type} onValueChange={(value) => {\n            updateConfig(\"type\", value);\n            const dbType = databaseTypes.find(t => t.value === value);\n            if (dbType?.port) updateConfig(\"port\", dbType.port);\n          }}>\n            <SelectTrigger data-testid=\"select-database-type\">\n              <SelectValue placeholder=\"Select database type\" />\n            </SelectTrigger>\n            <SelectContent>\n              {databaseTypes.map(type => (\n                <SelectItem key={type.value} value={type.value}>\n                  {type.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {config.type !== \"sqlite\" && (\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <Label htmlFor=\"db-host\">Host *</Label>\n            <Input\n              id=\"db-host\"\n              placeholder=\"localhost\"\n              value={config.host || \"\"}\n              onChange={(e) => updateConfig(\"host\", e.target.value)}\n              data-testid=\"input-host\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"db-port\">Port</Label>\n            <Input\n              id=\"db-port\"\n              placeholder=\"3306\"\n              value={config.port || \"\"}\n              onChange={(e) => updateConfig(\"port\", e.target.value)}\n              data-testid=\"input-port\"\n            />\n          </div>\n        </div>\n      )}\n\n      <div>\n        <Label htmlFor=\"db-database\">Database Name</Label>\n        <Input\n          id=\"db-database\"\n          placeholder=\"mydb\"\n          value={config.database || \"\"}\n          onChange={(e) => updateConfig(\"database\", e.target.value)}\n          data-testid=\"input-database\"\n        />\n      </div>\n\n      {config.type !== \"sqlite\" && (\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <Label htmlFor=\"db-username\">Username</Label>\n            <Input\n              id=\"db-username\"\n              placeholder=\"admin\"\n              value={config.username || \"\"}\n              onChange={(e) => updateConfig(\"username\", e.target.value)}\n              data-testid=\"input-username\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"db-password\">Password</Label>\n            <div className=\"relative\">\n              <Input\n                id=\"db-password\"\n                type={showPassword ? \"text\" : \"password\"}\n                placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                value={config.password || \"\"}\n                onChange={(e) => updateConfig(\"password\", e.target.value)}\n                data-testid=\"input-password\"\n              />\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                onClick={() => setShowPassword(!showPassword)}\n                data-testid=\"button-toggle-password\"\n              >\n                {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {config.type === \"sqlite\" && (\n        <div>\n          <Label htmlFor=\"sqlite-path\">SQLite File Path *</Label>\n          <Input\n            id=\"sqlite-path\"\n            placeholder=\"/path/to/database.db\"\n            value={config.database || \"\"}\n            onChange={(e) => updateConfig(\"database\", e.target.value)}\n            data-testid=\"input-sqlite-path\"\n          />\n        </div>\n      )}\n    </div>\n  );\n\n  const renderApiTab = () => (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"api-name\">Connection Name *</Label>\n          <Input\n            id=\"api-name\"\n            placeholder=\"My API Connection\"\n            value={config.name}\n            onChange={(e) => updateConfig(\"name\", e.target.value)}\n            data-testid=\"input-api-name\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"api-type\">API Type *</Label>\n          <Select value={config.type} onValueChange={(value) => updateConfig(\"type\", value)}>\n            <SelectTrigger data-testid=\"select-api-type\">\n              <SelectValue placeholder=\"Select API type\" />\n            </SelectTrigger>\n            <SelectContent>\n              {apiTypes.map(type => (\n                <SelectItem key={type.value} value={type.value}>\n                  {type.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div>\n        <Label htmlFor=\"api-url\">API URL *</Label>\n        <Input\n          id=\"api-url\"\n          placeholder=\"https://api.example.com/v1\"\n          value={config.url || \"\"}\n          onChange={(e) => updateConfig(\"url\", e.target.value)}\n          data-testid=\"input-api-url\"\n        />\n      </div>\n\n      <div>\n        <Label htmlFor=\"auth-type\">Authentication</Label>\n        <Select value={config.authType || \"none\"} onValueChange={(value) => updateConfig(\"authType\", value)}>\n          <SelectTrigger data-testid=\"select-auth-type\">\n            <SelectValue placeholder=\"Select authentication type\" />\n          </SelectTrigger>\n          <SelectContent>\n            {authTypes.map(type => (\n              <SelectItem key={type.value} value={type.value}>\n                {type.label}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {config.authType === \"apikey\" && (\n        <div>\n          <Label htmlFor=\"api-key\">API Key</Label>\n          <Input\n            id=\"api-key\"\n            placeholder=\"your-api-key\"\n            value={config.apiKey || \"\"}\n            onChange={(e) => updateConfig(\"apiKey\", e.target.value)}\n            data-testid=\"input-api-key\"\n          />\n        </div>\n      )}\n\n      {config.authType === \"bearer\" && (\n        <div>\n          <Label htmlFor=\"bearer-token\">Bearer Token</Label>\n          <Input\n            id=\"bearer-token\"\n            placeholder=\"your-bearer-token\"\n            value={config.apiKey || \"\"}\n            onChange={(e) => updateConfig(\"apiKey\", e.target.value)}\n            data-testid=\"input-bearer-token\"\n          />\n        </div>\n      )}\n\n      {config.authType === \"basic\" && (\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <Label htmlFor=\"basic-username\">Username</Label>\n            <Input\n              id=\"basic-username\"\n              placeholder=\"username\"\n              value={config.username || \"\"}\n              onChange={(e) => updateConfig(\"username\", e.target.value)}\n              data-testid=\"input-basic-username\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"basic-password\">Password</Label>\n            <Input\n              id=\"basic-password\"\n              type=\"password\"\n              placeholder=\"password\"\n              value={config.password || \"\"}\n              onChange={(e) => updateConfig(\"password\", e.target.value)}\n              data-testid=\"input-basic-password\"\n            />\n          </div>\n        </div>\n      )}\n\n      <div>\n        <Label htmlFor=\"headers\">Custom Headers (JSON format)</Label>\n        <Textarea\n          id=\"headers\"\n          placeholder='{\"X-Custom-Header\": \"value\"}'\n          value={config.headers || \"\"}\n          onChange={(e) => updateConfig(\"headers\", e.target.value)}\n          rows={3}\n          data-testid=\"textarea-headers\"\n        />\n      </div>\n    </div>\n  );\n\n  const renderSftpTab = () => (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"sftp-name\">Connection Name *</Label>\n          <Input\n            id=\"sftp-name\"\n            placeholder=\"My SFTP Connection\"\n            value={config.name}\n            onChange={(e) => updateConfig(\"name\", e.target.value)}\n            data-testid=\"input-sftp-name\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"sftp-host\">SFTP Host *</Label>\n          <Input\n            id=\"sftp-host\"\n            placeholder=\"sftp.example.com\"\n            value={config.host || \"\"}\n            onChange={(e) => updateConfig(\"host\", e.target.value)}\n            data-testid=\"input-sftp-host\"\n          />\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"sftp-port\">Port</Label>\n          <Input\n            id=\"sftp-port\"\n            placeholder=\"22\"\n            value={config.port || \"22\"}\n            onChange={(e) => updateConfig(\"port\", e.target.value)}\n            data-testid=\"input-sftp-port\"\n          />\n        </div>\n        <div>\n          <Label htmlFor=\"sftp-username\">Username *</Label>\n          <Input\n            id=\"sftp-username\"\n            placeholder=\"user\"\n            value={config.username || \"\"}\n            onChange={(e) => updateConfig(\"username\", e.target.value)}\n            data-testid=\"input-sftp-username\"\n          />\n        </div>\n      </div>\n\n      <div>\n        <Label htmlFor=\"sftp-password\">Password</Label>\n        <div className=\"relative\">\n          <Input\n            id=\"sftp-password\"\n            type={showPassword ? \"text\" : \"password\"}\n            placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n            value={config.password || \"\"}\n            onChange={(e) => updateConfig(\"password\", e.target.value)}\n            data-testid=\"input-sftp-password\"\n          />\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n            onClick={() => setShowPassword(!showPassword)}\n            data-testid=\"button-toggle-sftp-password\"\n          >\n            {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n          </Button>\n        </div>\n      </div>\n\n      <div>\n        <Label htmlFor=\"sftp-path\">Remote Path</Label>\n        <Input\n          id=\"sftp-path\"\n          placeholder=\"/home/user/data/\"\n          value={config.sftpPath || \"\"}\n          onChange={(e) => updateConfig(\"sftpPath\", e.target.value)}\n          data-testid=\"input-sftp-path\"\n        />\n      </div>\n\n      <div className=\"p-4 border rounded-md bg-muted/50\">\n        <p className=\"text-sm text-muted-foreground\">\n          <strong>Supported file types:</strong> CSV, Excel (.xlsx, .xls)\n        </p>\n        <p className=\"text-sm text-muted-foreground mt-2\">\n          Files will be automatically discovered in the specified remote path and subdirectories.\n        </p>\n      </div>\n    </div>\n  );\n\n  const getConnectionStatusIcon = () => {\n    switch (connectionStatus) {\n      case \"testing\":\n        return <Loader2 className=\"h-4 w-4 animate-spin\" />;\n      case \"success\":\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n      case \"error\":\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      default:\n        return <TestTube className=\"h-4 w-4\" />;\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-connector-modal\">\n        <DialogHeader>\n          <DialogTitle>Connect Data Source</DialogTitle>\n        </DialogHeader>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"database\" data-testid=\"tab-database\">\n              <Database className=\"mr-2 h-4 w-4\" />\n              Databases\n            </TabsTrigger>\n            <TabsTrigger value=\"api\" data-testid=\"tab-api\">\n              <Globe className=\"mr-2 h-4 w-4\" />\n              APIs\n            </TabsTrigger>\n            <TabsTrigger value=\"sftp\" data-testid=\"tab-sftp\">\n              <Server className=\"mr-2 h-4 w-4\" />\n              SFTP\n            </TabsTrigger>\n          </TabsList>\n\n          <div className=\"mt-6\">\n            <TabsContent value=\"database\">\n              {renderDatabaseTab()}\n            </TabsContent>\n            <TabsContent value=\"api\">\n              {renderApiTab()}\n            </TabsContent>\n            <TabsContent value=\"sftp\">\n              {config.type = \"sftp\"}\n              {renderSftpTab()}\n            </TabsContent>\n          </div>\n        </Tabs>\n\n        <div className=\"flex items-center justify-between mt-6 pt-4 border-t\">\n          <div className=\"flex items-center gap-2\">\n            {connectionStatus !== \"idle\" && (\n              <Badge variant={connectionStatus === \"success\" ? \"default\" : connectionStatus === \"error\" ? \"destructive\" : \"secondary\"}>\n                {getConnectionStatusIcon()}\n                <span className=\"ml-1\">\n                  {connectionStatus === \"testing\" && \"Testing...\"}\n                  {connectionStatus === \"success\" && \"Connected\"}\n                  {connectionStatus === \"error\" && \"Failed\"}\n                </span>\n              </Badge>\n            )}\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={handleTestConnection}\n              disabled={isConnecting}\n              data-testid=\"button-test-connection\"\n            >\n              {getConnectionStatusIcon()}\n              <span className=\"ml-2\">Test Connection</span>\n            </Button>\n            <Button\n              onClick={handleSaveConnector}\n              disabled={connectionStatus !== \"success\"}\n              data-testid=\"button-save-connector\"\n            >\n              <FolderOpen className=\"mr-2 h-4 w-4\" />\n              Add Connection\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":19410},"client/src/pages/warehouse-page.tsx":{"content":"import { useState } from \"react\";\nimport DatabaseConnectorForm from \"@/components/database-connector-form\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getDataSources, uploadDataSource, deleteDataSource, getConnections, getConnectionTables, type Connection } from \"@/lib/api\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Database, \n  FileText, \n  Trash2, \n  Plus,\n  Edit2,\n  Settings,\n  ChevronDown,\n  ChevronRight,\n  AlertCircle\n} from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport TableSelectionModal from \"@/components/table-selection-modal\";\n\nexport default function WarehousePage() {\n  const [isConnectorModalOpen, setIsConnectorModalOpen] = useState(false);\n  const [isCreatingConnection, setIsCreatingConnection] = useState(false);\n  const [isTableSelectionOpen, setIsTableSelectionOpen] = useState(false);\n  const [editingConnection, setEditingConnection] = useState<Connection | null>(null);\n  const [pendingConnection, setPendingConnection] = useState<{\n    id?: string;\n    name: string;\n    type: string;\n    config: any;\n  } | null>(null);\n  const [expandedConnections, setExpandedConnections] = useState<Set<string>>(new Set());\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: dataSources = [], isLoading: dataSourcesLoading } = useQuery({\n    queryKey: [\"/api/data-sources\"],\n    queryFn: () => getDataSources(),\n  });\n\n  const { data: connections = [], isLoading: connectionsLoading } = useQuery({\n    queryKey: [\"/api/connections\"],\n    queryFn: () => getConnections(),\n  });\n\n\n  const uploadMutation = useMutation({\n    mutationFn: uploadDataSource,\n    onSuccess: () => {\n      toast({\n        title: \"Upload successful\",\n        description: \"Your data has been uploaded and processed.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/data-sources\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Upload failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: deleteDataSource,\n    onSuccess: () => {\n      toast({\n        title: \"Data source deleted\",\n        description: \"The data source has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/data-sources\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Delete failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDatabaseConnectionSubmit = (name: string, type: string, config: any) => {\n    // Store the connection details and show table selection modal\n    setPendingConnection({ \n      id: editingConnection?.id, \n      name, \n      type, \n      config \n    });\n    setIsConnectorModalOpen(false);\n    setIsTableSelectionOpen(true);\n  };\n\n  const handleTablesSelected = async (selectedTables: string[], deselectedTableIds?: number[]) => {\n    try {\n      // If editing and there are deselected tables, delete them first\n      if (editingConnection && deselectedTableIds && deselectedTableIds.length > 0) {\n        await Promise.all(deselectedTableIds.map(id => deleteMutation.mutateAsync(id)));\n      }\n\n      toast({\n        title: editingConnection ? \"Connection updated\" : \"Tables imported successfully\",\n        description: `${selectedTables.length} table(s) have been added to your datasets.`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/data-sources\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/connections\"] });\n      setIsTableSelectionOpen(false);\n      setPendingConnection(null);\n      setEditingConnection(null);\n    } catch (error) {\n      toast({\n        title: \"Error updating connection\",\n        description: \"Failed to update connection. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleTableSelectionClose = () => {\n    setIsTableSelectionOpen(false);\n    setPendingConnection(null);\n    setEditingConnection(null);\n  };\n\n  const handleEditConnection = (connection: Connection) => {\n    setEditingConnection(connection);\n    setIsConnectorModalOpen(true);\n  };\n\n  const formatFileSize = (bytes: number | undefined) => {\n    if (!bytes) return \"‚Äî\";\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(1024));\n    return Math.round((bytes / Math.pow(1024, i)) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const toggleConnectionExpanded = (connectionId: string) => {\n    const newExpanded = new Set(expandedConnections);\n    if (newExpanded.has(connectionId)) {\n      newExpanded.delete(connectionId);\n    } else {\n      newExpanded.add(connectionId);\n    }\n    setExpandedConnections(newExpanded);\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'connected':\n      case 'ready':\n        return 'bg-green-500/20 text-green-400 border-green-500/30';\n      case 'disconnected':\n      case 'error':\n        return 'bg-red-500/20 text-red-400 border-red-500/30';\n      default:\n        return 'bg-gray-500/20 text-gray-400 border-gray-500/30';\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">NEX Connect</h2>\n          <p className=\"text-muted-foreground\">\n            Manage your data sources and connections\n          </p>\n        </div>\n        <Button \n          className=\"bg-primary hover:bg-primary/90\" \n          onClick={() => {\n            setEditingConnection(null);\n            setIsConnectorModalOpen(true);\n          }}\n          data-testid=\"button-connect-source\"\n        >\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Connect Source\n        </Button>\n      </div>\n\n      {/* Database Connections Section */}\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center gap-2\">\n          <Database className=\"h-5 w-5\" />\n          <h3 className=\"text-lg font-semibold\">Database Connections</h3>\n          {connections.length > 0 && (\n            <Badge variant=\"secondary\">{connections.length}</Badge>\n          )}\n        </div>\n\n        {connectionsLoading ? (\n          <div className=\"space-y-4\">\n            {Array.from({ length: 2 }).map((_, i) => (\n              <Skeleton key={i} className=\"h-24 w-full\" />\n            ))}\n          </div>\n        ) : connections.length > 0 ? (\n          <div className=\"space-y-3\">\n            {connections.map((connection) => (\n              <ConnectionCard\n                key={connection.id}\n                connection={connection}\n                dataSources={dataSources}\n                isExpanded={expandedConnections.has(connection.id)}\n                onToggleExpand={() => toggleConnectionExpanded(connection.id)}\n                onEdit={() => handleEditConnection(connection)}\n                onDelete={(tableId: string) => deleteMutation.mutate(tableId)}\n                getStatusColor={getStatusColor}\n              />\n            ))}\n          </div>\n        ) : (\n          <Card className=\"p-8 text-center\">\n            <Database className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground\">No database connections yet</p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Click \"Connect Source\" to add your first connection\n            </p>\n          </Card>\n        )}\n      </div>\n\n      <Dialog open={isConnectorModalOpen} onOpenChange={setIsConnectorModalOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingConnection ? 'Edit Connection' : 'Connect Data Source'}\n            </DialogTitle>\n          </DialogHeader>\n          <DatabaseConnectorForm\n            onSubmit={handleDatabaseConnectionSubmit}\n            onFileUpload={(file, name) => {\n              uploadMutation.mutate(file);\n              setIsConnectorModalOpen(false);\n            }}\n            isLoading={isCreatingConnection || uploadMutation.isPending}\n          />\n        </DialogContent>\n      </Dialog>\n\n      {/* Table Selection Modal */}\n      {pendingConnection && (\n        <TableSelectionModal\n          isOpen={isTableSelectionOpen}\n          onClose={handleTableSelectionClose}\n          connectionName={pendingConnection.name}\n          databaseType={pendingConnection.type}\n          connectionConfig={pendingConnection.config}\n          onTablesSelected={handleTablesSelected}\n          connectionId={pendingConnection.id}\n        />\n      )}\n    </div>\n  );\n}\n\n// Connection Card Component\ninterface ConnectionCardProps {\n  connection: Connection;\n  dataSources: any[];\n  isExpanded: boolean;\n  onToggleExpand: () => void;\n  onEdit: () => void;\n  onDelete: (tableId: string) => void;\n  getStatusColor: (status: string) => string;\n}\n\nfunction ConnectionCard({ \n  connection, \n  dataSources, \n  isExpanded, \n  onToggleExpand, \n  onEdit,\n  onDelete,\n  getStatusColor \n}: ConnectionCardProps) {\n  // Get tables for this connection\n  const connectionTables = dataSources.filter(\n    ds => ds.connectionId === connection.id\n  );\n\n  return (\n    <Card className=\"hover:bg-muted/50 transition-colors\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3 flex-1\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onToggleExpand}\n              data-testid={`button-expand-${connection.id}`}\n            >\n              {isExpanded ? (\n                <ChevronDown className=\"h-4 w-4\" />\n              ) : (\n                <ChevronRight className=\"h-4 w-4\" />\n              )}\n            </Button>\n            \n            <div className=\"p-2 rounded-lg bg-primary/20\">\n              <Database className=\"h-5 w-5 text-primary\" />\n            </div>\n            \n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <h4 className=\"font-semibold\" data-testid={`text-connection-name-${connection.id}`}>\n                  {connection.name}\n                </h4>\n                <Badge variant=\"outline\" className=\"capitalize text-xs\">\n                  {connection.type}\n                </Badge>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                {connectionTables.length} table(s) imported\n              </p>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <Badge className={getStatusColor(connection.status)}>\n              {connection.status}\n            </Badge>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onEdit}\n              data-testid={`button-edit-${connection.id}`}\n            >\n              <Edit2 className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        {isExpanded && (\n          <div className=\"mt-4 ml-9 space-y-2\">\n            {connectionTables.length === 0 ? (\n              <div className=\"text-sm text-muted-foreground py-4 text-center\">\n                No tables imported from this connection\n              </div>\n            ) : (\n              connectionTables.map((table) => (\n                <div \n                  key={table.id} \n                  className=\"flex items-center justify-between p-2 rounded border bg-background\"\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"font-medium text-sm\" data-testid={`text-table-name-${table.id}`}>\n                      {table.name}\n                    </span>\n                    {table.rowCount && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {table.rowCount.toLocaleString()} rows\n                      </Badge>\n                    )}\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => onDelete(table.id)}\n                    data-testid={`button-delete-table-${table.id}`}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              ))\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":12886},"client/src/components/chart-config/SankeyConfig.tsx":{"content":"import { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface SankeyConfigProps {\n  config: Record<string, any>;\n  onChange: (config: Record<string, any>) => void;\n  columns?: string[];\n}\n\nexport function SankeyConfig({ config, onChange, columns = [] }: SankeyConfigProps) {\n  const updateConfig = (key: string, value: any) => {\n    onChange({ ...config, [key]: value });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"source\">Source Column</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.source || \"\"}\n            onValueChange={(value) => updateConfig(\"source\", value)}\n          >\n            <SelectTrigger id=\"source\" data-testid=\"select-source\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"source\"\n            placeholder=\"Select a dataset first\"\n            value={config.source || \"\"}\n            onChange={(e) => updateConfig(\"source\", e.target.value)}\n            data-testid=\"input-source\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"target\">Target Column</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.target || \"\"}\n            onValueChange={(value) => updateConfig(\"target\", value)}\n          >\n            <SelectTrigger id=\"target\" data-testid=\"select-target\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"target\"\n            placeholder=\"Select a dataset first\"\n            value={config.target || \"\"}\n            onChange={(e) => updateConfig(\"target\", e.target.value)}\n            data-testid=\"input-target\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"value\">Value Metric</Label>\n        {columns.length > 0 ? (\n          <Select\n            value={config.value || \"\"}\n            onValueChange={(value) => updateConfig(\"value\", value)}\n          >\n            <SelectTrigger id=\"value\" data-testid=\"select-value\">\n              <SelectValue placeholder=\"Select a column\" />\n            </SelectTrigger>\n            <SelectContent>\n              {columns.filter(col => col && col.trim()).map((col) => (\n                <SelectItem key={col} value={col}>\n                  {col}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        ) : (\n          <Input\n            id=\"value\"\n            placeholder=\"Select a dataset first\"\n            value={config.value || \"\"}\n            onChange={(e) => updateConfig(\"value\", e.target.value)}\n            data-testid=\"input-value\"\n            disabled\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"nodeAlign\">Node Alignment</Label>\n        <Input\n          id=\"nodeAlign\"\n          placeholder=\"left, right, center, justify\"\n          value={config.nodeAlign || \"justify\"}\n          onChange={(e) => updateConfig(\"nodeAlign\", e.target.value)}\n          data-testid=\"input-node-align\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":3949},"server/connectors.ts":{"content":"import mysql from \"mysql2/promise\";\nimport { Client as PgClient } from \"pg\";\nimport { Connection as SqlServerConnection } from \"tedious\";\nimport type { ConnectionConfiguration as SqlServerConfig } from \"tedious\";\nimport sqlite3 from \"sqlite3\";\nimport { MongoClient } from \"mongodb\";\nimport { createClient as createRedisClient } from \"redis\";\nimport Client from \"ssh2-sftp-client\";\nimport * as XLSX from \"node-xlsx\";\nimport { z } from \"zod\";\n\n// Connection configuration schemas\nexport const DatabaseConnectionSchema = z.object({\n  name: z.string().min(1),\n  type: z.enum([\"mysql\", \"postgresql\", \"sqlserver\", \"sqlite\", \"mongodb\", \"redis\"]),\n  host: z.string().optional(),\n  port: z.string().optional(),\n  database: z.string().optional(),\n  username: z.string().optional(),\n  password: z.string().optional(),\n});\n\nexport const ApiConnectionSchema = z.object({\n  name: z.string().min(1),\n  type: z.enum([\"rest\", \"graphql\", \"webhook\"]),\n  url: z.string().url(),\n  authType: z.enum([\"none\", \"apikey\", \"bearer\", \"basic\"]).optional(),\n  apiKey: z.string().optional(),\n  username: z.string().optional(),\n  password: z.string().optional(),\n  headers: z.string().optional(),\n});\n\nexport const SftpConnectionSchema = z.object({\n  name: z.string().min(1),\n  type: z.literal(\"sftp\"),\n  host: z.string().min(1),\n  port: z.string().default(\"22\"),\n  username: z.string().min(1),\n  password: z.string().optional(),\n  sftpPath: z.string().optional(),\n});\n\nexport type DatabaseConnection = z.infer<typeof DatabaseConnectionSchema>;\nexport type ApiConnection = z.infer<typeof ApiConnectionSchema>;\nexport type SftpConnection = z.infer<typeof SftpConnectionSchema>;\nexport type ConnectionConfig = DatabaseConnection | ApiConnection | SftpConnection;\n\n// Database connection testers\nexport async function testMySqlConnection(config: DatabaseConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  try {\n    const connection = await mysql.createConnection({\n      host: config.host,\n      port: parseInt(config.port || \"3306\"),\n      user: config.username,\n      password: config.password,\n      database: config.database,\n      connectTimeout: 5000,\n    });\n\n    // Test the connection\n    await connection.ping();\n    \n    // Get database metadata\n    const [rows] = await connection.execute(\n      \"SELECT TABLE_NAME, TABLE_ROWS FROM information_schema.TABLES WHERE TABLE_SCHEMA = ?\",\n      [config.database]\n    );\n    \n    await connection.end();\n    \n    return {\n      success: true,\n      metadata: {\n        tables: rows,\n        engine: \"MySQL\",\n        version: \"5.7+\",\n      }\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message || \"MySQL connection failed\"\n    };\n  }\n}\n\nexport async function testPostgreSqlConnection(config: DatabaseConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  const client = new PgClient({\n    host: config.host,\n    port: parseInt(config.port || \"5432\"),\n    user: config.username,\n    password: config.password,\n    database: config.database,\n    connectionTimeoutMillis: 5000,\n  });\n\n  try {\n    await client.connect();\n    \n    // Test query and get metadata (PostgreSQL compatible)\n    const result = await client.query(`\n      SELECT tablename as table_name, schemaname as table_schema\n      FROM pg_tables \n      WHERE schemaname = 'public'\n    `);\n    \n    const version = await client.query(\"SELECT version()\");\n    \n    await client.end();\n    \n    return {\n      success: true,\n      metadata: {\n        tables: result.rows,\n        engine: \"PostgreSQL\",\n        version: version.rows[0]?.version?.split(\" \")[1] || \"Unknown\",\n      }\n    };\n  } catch (error: any) {\n    await client.end().catch(() => {});\n    return {\n      success: false,\n      error: error.message || \"PostgreSQL connection failed\"\n    };\n  }\n}\n\nexport async function testSqlServerConnection(config: DatabaseConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  return new Promise((resolve) => {\n    const sqlConfig: SqlServerConfig = {\n      server: config.host!,\n      options: {\n        port: parseInt(config.port || \"1433\"),\n        database: config.database,\n        trustServerCertificate: true,\n        connectTimeout: 5000,\n        requestTimeout: 5000,\n      },\n      authentication: {\n        type: \"default\",\n        options: {\n          userName: config.username!,\n          password: config.password!,\n        }\n      }\n    };\n\n    const connection = new SqlServerConnection(sqlConfig);\n    \n    connection.on(\"connect\", async () => {\n      try {\n        // Connection successful - get metadata would require additional queries\n        connection.close();\n        resolve({\n          success: true,\n          metadata: {\n            engine: \"SQL Server\",\n            database: config.database,\n          }\n        });\n      } catch (error: any) {\n        connection.close();\n        resolve({\n          success: false,\n          error: error.message || \"SQL Server metadata query failed\"\n        });\n      }\n    });\n\n    connection.on(\"error\", (error: any) => {\n      resolve({\n        success: false,\n        error: error.message || \"SQL Server connection failed\"\n      });\n    });\n\n    connection.connect();\n  });\n}\n\nexport async function testMongoConnection(config: DatabaseConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  try {\n    // Build MongoDB URI conditionally based on available credentials\n    let uri;\n    const port = config.port || \"27017\";\n    \n    if (config.username && config.password) {\n      // With authentication\n      uri = `mongodb://${config.username}:${config.password}@${config.host}:${port}`;\n      if (config.database) {\n        uri += `/${config.database}`;\n      }\n    } else {\n      // Without authentication\n      uri = `mongodb://${config.host}:${port}`;\n      if (config.database) {\n        uri += `/${config.database}`;\n      }\n    }\n    \n    const client = new MongoClient(uri, {\n      serverSelectionTimeoutMS: 5000,\n      connectTimeoutMS: 5000,\n    });\n\n    await client.connect();\n    \n    // Get database metadata\n    const db = client.db(config.database);\n    const collections = await db.listCollections().toArray();\n    const stats = await db.stats();\n    \n    await client.close();\n    \n    return {\n      success: true,\n      metadata: {\n        collections: collections.map(c => c.name),\n        engine: \"MongoDB\",\n        storageSize: stats.storageSize,\n        dataSize: stats.dataSize,\n      }\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message || \"MongoDB connection failed\"\n    };\n  }\n}\n\nexport async function testRedisConnection(config: DatabaseConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  try {\n    const client = createRedisClient({\n      socket: {\n        host: config.host,\n        port: parseInt(config.port || \"6379\"),\n        connectTimeout: 5000,\n      },\n      password: config.password,\n      username: config.username,\n    });\n\n    await client.connect();\n    \n    // Test with ping and get some info\n    await client.ping();\n    const info = await client.info();\n    \n    await client.disconnect();\n    \n    return {\n      success: true,\n      metadata: {\n        engine: \"Redis\",\n        info: info.split(\"\\r\\n\").slice(0, 10).join(\"\\n\"), // First few lines of info\n      }\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message || \"Redis connection failed\"\n    };\n  }\n}\n\nexport async function testSqliteConnection(config: DatabaseConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  return new Promise((resolve) => {\n    const db = new sqlite3.Database(config.database!, (err) => {\n      if (err) {\n        resolve({\n          success: false,\n          error: err.message || \"SQLite connection failed\"\n        });\n        return;\n      }\n\n      // Get table information\n      db.all(\"SELECT name FROM sqlite_master WHERE type='table'\", [], (err, rows) => {\n        db.close();\n        \n        if (err) {\n          resolve({\n            success: false,\n            error: err.message || \"SQLite query failed\"\n          });\n          return;\n        }\n\n        resolve({\n          success: true,\n          metadata: {\n            tables: rows,\n            engine: \"SQLite\",\n            file: config.database,\n          }\n        });\n      });\n    });\n  });\n}\n\n// API connection tester\nexport async function testApiConnection(config: ApiConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  try {\n    const headers: Record<string, string> = {\n      \"Content-Type\": \"application/json\",\n    };\n\n    // Add authentication headers\n    if (config.authType === \"apikey\" && config.apiKey) {\n      headers[\"X-API-Key\"] = config.apiKey;\n    } else if (config.authType === \"bearer\" && config.apiKey) {\n      headers[\"Authorization\"] = `Bearer ${config.apiKey}`;\n    } else if (config.authType === \"basic\" && config.username && config.password) {\n      const credentials = Buffer.from(`${config.username}:${config.password}`).toString(\"base64\");\n      headers[\"Authorization\"] = `Basic ${credentials}`;\n    }\n\n    // Add custom headers\n    if (config.headers) {\n      try {\n        const customHeaders = JSON.parse(config.headers);\n        Object.assign(headers, customHeaders);\n      } catch (error) {\n        return {\n          success: false,\n          error: \"Invalid JSON format in custom headers\"\n        };\n      }\n    }\n\n    const response = await fetch(config.url, {\n      method: \"GET\",\n      headers,\n      signal: AbortSignal.timeout(5000), // 5 second timeout\n    });\n\n    const contentType = response.headers.get(\"content-type\") || \"\";\n    let responseData: any;\n\n    try {\n      if (contentType.includes(\"application/json\")) {\n        responseData = await response.json();\n      } else {\n        responseData = await response.text();\n      }\n    } catch (error) {\n      responseData = \"Unable to parse response\";\n    }\n\n    return {\n      success: response.ok,\n      metadata: {\n        status: response.status,\n        statusText: response.statusText,\n        contentType,\n        headers: Object.fromEntries(response.headers.entries()),\n        sampleData: typeof responseData === \"string\" ? responseData.substring(0, 500) : responseData,\n      },\n      error: !response.ok ? `HTTP ${response.status}: ${response.statusText}` : undefined,\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message || \"API connection failed\"\n    };\n  }\n}\n\n// SFTP connection tester\nexport async function testSftpConnection(config: SftpConnection): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  const sftp = new Client();\n  \n  try {\n    await sftp.connect({\n      host: config.host,\n      port: parseInt(config.port || \"22\"),\n      username: config.username,\n      password: config.password,\n      readyTimeout: 5000,\n    });\n\n    // List files in the specified path or root\n    const remotePath = config.sftpPath || \"/\";\n    const fileList = await sftp.list(remotePath);\n    \n    // Filter for supported file types\n    const supportedFiles = fileList.filter((file) => {\n      const name = file.name.toLowerCase();\n      return name.endsWith(\".csv\") || name.endsWith(\".xlsx\") || name.endsWith(\".xls\");\n    });\n\n    await sftp.end();\n\n    return {\n      success: true,\n      metadata: {\n        path: remotePath,\n        totalFiles: fileList.length,\n        supportedFiles: supportedFiles.length,\n        sampleFiles: supportedFiles.slice(0, 10).map(f => ({\n          name: f.name,\n          size: f.size,\n          modifiedTime: f.modifyTime,\n        })),\n      }\n    };\n  } catch (error: any) {\n    await sftp.end().catch(() => {});\n    return {\n      success: false,\n      error: error.message || \"SFTP connection failed\"\n    };\n  }\n}\n\n// Main connection tester\nexport async function testConnection(config: ConnectionConfig): Promise<{ success: boolean; error?: string; metadata?: any }> {\n  switch (config.type) {\n    case \"mysql\":\n      return testMySqlConnection(config as DatabaseConnection);\n    case \"postgresql\":\n      return testPostgreSqlConnection(config as DatabaseConnection);\n    case \"sqlserver\":\n      return testSqlServerConnection(config as DatabaseConnection);\n    case \"mongodb\":\n      return testMongoConnection(config as DatabaseConnection);\n    case \"redis\":\n      return testRedisConnection(config as DatabaseConnection);\n    case \"sqlite\":\n      return testSqliteConnection(config as DatabaseConnection);\n    case \"rest\":\n    case \"graphql\":\n    case \"webhook\":\n      return testApiConnection(config as ApiConnection);\n    case \"sftp\":\n      return testSftpConnection(config as SftpConnection);\n    default:\n      return {\n        success: false,\n        error: `Unsupported connection type: ${(config as any).type}`\n      };\n  }\n}\n\n// Helper to encrypt/decrypt sensitive data (basic implementation)\nexport function encryptConnectionConfig(config: ConnectionConfig): any {\n  // In a real implementation, you'd use proper encryption\n  // For now, we'll just store it as-is but remove sensitive fields from logs\n  const sanitized = { ...config };\n  if ('password' in sanitized) {\n    // Keep password for functionality but flag it as sensitive\n    (sanitized as any).password = sanitized.password;\n  }\n  return sanitized;\n}\n\nexport function sanitizeConnectionConfig(config: ConnectionConfig): any {\n  const sanitized = { ...config };\n  if ('password' in sanitized) {\n    (sanitized as any).password = sanitized.password ? \"***\" : undefined;\n  }\n  if ('apiKey' in sanitized) {\n    (sanitized as any).apiKey = sanitized.apiKey ? \"***\" : undefined;\n  }\n  return sanitized;\n}","size_bytes":13728},"server/ai.ts":{"content":"import OpenAI from \"openai\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\nimport csv from \"csv-parser\";\nimport { extractDataSchema, createPrivacySafeDataSummary, generateDummyData } from \"./services/data-masking\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY\n});\n\ninterface DataAnalysisRequest {\n  question: string;\n  csvData?: any[];\n  dataSourceMetadata?: any;\n}\n\ninterface DataAnalysisResponse {\n  answer: string;\n  chartData?: any;\n  chartType?: string;\n  kpiValue?: string;\n  unit?: string;\n}\n\nexport async function analyzeDataWithAI(request: DataAnalysisRequest): Promise<DataAnalysisResponse> {\n  try {\n    const { question, csvData, dataSourceMetadata } = request;\n\n    // Prepare context for AI\n    let context = `You are a business intelligence assistant analyzing data. Answer the user's question about their data.\n\nUser Question: ${question}`;\n\n    if (csvData && csvData.length > 0) {\n      const sampleData = csvData.slice(0, 5); // First 5 rows as sample\n      const columns = Object.keys(csvData[0]);\n      \n      context += `\\n\\nData Context:\n- Total rows: ${csvData.length}\n- Columns: ${columns.join(', ')}\n- Sample data: ${JSON.stringify(sampleData, null, 2)}`;\n    }\n\n    if (dataSourceMetadata) {\n      context += `\\n\\nData Source Info: ${JSON.stringify(dataSourceMetadata, null, 2)}`;\n    }\n\n    context += `\\n\\nProvide your response in JSON format with the following structure:\n{\n  \"answer\": \"Clear, concise answer to the question\",\n  \"chartData\": \"If applicable, provide chart data structure\",\n  \"chartType\": \"If applicable: line, bar, pie, or table\",\n  \"kpiValue\": \"If this is a KPI question, provide the numeric value\",\n  \"unit\": \"If applicable, the unit of measurement\"\n}`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are an expert business intelligence analyst. Analyze data and provide insights in JSON format.\"\n        },\n        {\n          role: \"user\",\n          content: context\n        }\n      ],\n      response_format: { type: \"json_object\" },\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    return {\n      answer: result.answer || \"I couldn't analyze this data.\",\n      chartData: result.chartData,\n      chartType: result.chartType,\n      kpiValue: result.kpiValue,\n      unit: result.unit\n    };\n\n  } catch (error) {\n    console.error(\"AI analysis error:\", error);\n    return {\n      answer: \"Sorry, I encountered an error while analyzing your data. Please try again.\"\n    };\n  }\n}\n\nexport async function transcribeAudio(audioBuffer: Buffer): Promise<string> {\n  try {\n    // Save audio buffer to temporary file\n    const tempPath = path.join(process.cwd(), 'temp', `audio-${Date.now()}.wav`);\n    \n    // Ensure temp directory exists\n    const tempDir = path.dirname(tempPath);\n    if (!fs.existsSync(tempDir)) {\n      fs.mkdirSync(tempDir, { recursive: true });\n    }\n    \n    fs.writeFileSync(tempPath, audioBuffer);\n    \n    const transcription = await openai.audio.transcriptions.create({\n      file: fs.createReadStream(tempPath),\n      model: \"whisper-1\",\n    });\n\n    // Clean up temp file\n    fs.unlinkSync(tempPath);\n\n    return transcription.text;\n  } catch (error) {\n    console.error(\"Audio transcription error:\", error);\n    throw new Error(\"Failed to transcribe audio\");\n  }\n}\n\nexport async function parseCSVFile(filePath: string): Promise<any[]> {\n  return new Promise((resolve, reject) => {\n    const results: any[] = [];\n    \n    fs.createReadStream(filePath)\n      .pipe(csv())\n      .on('data', (data) => results.push(data))\n      .on('end', () => resolve(results))\n      .on('error', reject);\n  });\n}\n\nexport function generateKPIFromQuestion(question: string, answer: string): { value: string; unit?: string } {\n  // Extract numeric values and units from the answer\n  const numberMatch = answer.match(/‚Çπ?[\\d,]+\\.?\\d*/);\n  const percentMatch = answer.match(/\\d+\\.?\\d*%/);\n  \n  if (numberMatch) {\n    return {\n      value: numberMatch[0],\n      unit: answer.includes('‚Çπ') ? 'INR' : undefined\n    };\n  }\n  \n  if (percentMatch) {\n    return {\n      value: percentMatch[0],\n      unit: '%'\n    };\n  }\n  \n  // For other types of answers, try to extract the main value\n  const words = answer.split(' ');\n  for (const word of words) {\n    if (/^\\d+/.test(word)) {\n      return { value: word };\n    }\n  }\n  \n  return { value: answer.slice(0, 50) }; // Fallback to first 50 chars\n}\n","size_bytes":4796},"client/src/pages/auth-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Brain, BarChart3, Database, Mic } from \"lucide-react\";\nimport nexSightLogo from \"@assets/nexsight_1758799902588.png\";\n\nexport default function AuthPage() {\n  const { user, loginMutation, registerMutation } = useAuth();\n  const [, setLocation] = useLocation();\n  const [loginForm, setLoginForm] = useState({ email: \"\", password: \"\" });\n  const [registerForm, setRegisterForm] = useState({\n    username: \"\",\n    email: \"\",\n    password: \"\",\n    name: \"\",\n  });\n\n  // Redirect if already logged in\n  useEffect(() => {\n    if (user) {\n      setLocation(\"/\");\n    }\n  }, [user, setLocation]);\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate(loginForm);\n  };\n\n  const handleRegister = (e: React.FormEvent) => {\n    e.preventDefault();\n    registerMutation.mutate(registerForm);\n  };\n\n  if (user) {\n    return null; // Prevent flash while redirecting\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex\">\n      {/* Left side - Forms */}\n      <div className=\"flex-1 flex items-center justify-center p-8\">\n        <div className=\"w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <div className=\"w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 overflow-hidden\">\n              <img \n                src={nexSightLogo} \n                alt=\"NEX Sight Logo\" \n                className=\"w-full h-full object-contain\"\n              />\n            </div>\n            <h1 className=\"text-3xl font-bold\">Welcome to NEX Sight</h1>\n            <p className=\"text-muted-foreground mt-2\">\n              Next-generation voice-powered business intelligence\n            </p>\n          </div>\n\n          <Tabs defaultValue=\"login\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"login\">Sign In</TabsTrigger>\n              <TabsTrigger value=\"register\">Sign Up</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"login\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Sign In</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <form onSubmit={handleLogin} className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"login-email\">Email</Label>\n                      <Input\n                        id=\"login-email\"\n                        type=\"email\"\n                        placeholder=\"Enter your email\"\n                        value={loginForm.email}\n                        onChange={(e) =>\n                          setLoginForm({ ...loginForm, email: e.target.value })\n                        }\n                        required\n                        data-testid=\"input-login-email\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"login-password\">Password</Label>\n                      <Input\n                        id=\"login-password\"\n                        type=\"password\"\n                        placeholder=\"Enter your password\"\n                        value={loginForm.password}\n                        onChange={(e) =>\n                          setLoginForm({\n                            ...loginForm,\n                            password: e.target.value,\n                          })\n                        }\n                        required\n                        data-testid=\"input-login-password\"\n                      />\n                    </div>\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90\"\n                      disabled={loginMutation.isPending}\n                      data-testid=\"button-login\"\n                    >\n                      {loginMutation.isPending ? \"Signing In...\" : \"Sign In\"}\n                    </Button>\n                  </form>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"register\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Sign Up</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <form onSubmit={handleRegister} className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"register-username\">Username</Label>\n                      <Input\n                        id=\"register-username\"\n                        type=\"text\"\n                        placeholder=\"Choose a username\"\n                        value={registerForm.username}\n                        onChange={(e) =>\n                          setRegisterForm({\n                            ...registerForm,\n                            username: e.target.value,\n                          })\n                        }\n                        required\n                        data-testid=\"input-register-username\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"register-name\">Full Name</Label>\n                      <Input\n                        id=\"register-name\"\n                        type=\"text\"\n                        placeholder=\"Enter your full name\"\n                        value={registerForm.name}\n                        onChange={(e) =>\n                          setRegisterForm({\n                            ...registerForm,\n                            name: e.target.value,\n                          })\n                        }\n                        data-testid=\"input-register-name\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"register-email\">Email</Label>\n                      <Input\n                        id=\"register-email\"\n                        type=\"email\"\n                        placeholder=\"Enter your email\"\n                        value={registerForm.email}\n                        onChange={(e) =>\n                          setRegisterForm({\n                            ...registerForm,\n                            email: e.target.value,\n                          })\n                        }\n                        required\n                        data-testid=\"input-register-email\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"register-password\">Password</Label>\n                      <Input\n                        id=\"register-password\"\n                        type=\"password\"\n                        placeholder=\"Create a password\"\n                        value={registerForm.password}\n                        onChange={(e) =>\n                          setRegisterForm({\n                            ...registerForm,\n                            password: e.target.value,\n                          })\n                        }\n                        required\n                        data-testid=\"input-register-password\"\n                      />\n                    </div>\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90\"\n                      disabled={registerMutation.isPending}\n                      data-testid=\"button-register\"\n                    >\n                      {registerMutation.isPending ? \"Creating Account...\" : \"Sign Up\"}\n                    </Button>\n                  </form>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n\n      {/* Right side - Hero section */}\n      <div className=\"flex-1 bg-gradient-to-br from-primary/20 via-secondary/20 to-accent/20 flex items-center justify-center p-8\">\n        <div className=\"text-center max-w-lg\">\n          <h2 className=\"text-4xl font-bold mb-6\">\n            Intelligence Meets Voice\n          </h2>\n          <p className=\"text-lg text-muted-foreground mb-8\">\n            Transform your data into insights with AI-powered analytics.\n            Simply ask questions using your voice or text, and get instant,\n            actionable business intelligence.\n          </p>\n          \n          <div className=\"grid grid-cols-2 gap-6\">\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center mx-auto mb-3\">\n                <Mic className=\"text-primary\" />\n              </div>\n              <h3 className=\"font-semibold mb-2\">Voice Queries</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Ask questions naturally using your voice\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 rounded-xl bg-secondary/20 flex items-center justify-center mx-auto mb-3\">\n                <BarChart3 className=\"text-secondary\" />\n              </div>\n              <h3 className=\"font-semibold mb-2\">Smart Charts</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Auto-generate visualizations from your data\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center mx-auto mb-3\">\n                <Database className=\"text-accent\" />\n              </div>\n              <h3 className=\"font-semibold mb-2\">Data Warehouse</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Connect and manage multiple data sources\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center mx-auto mb-3\">\n                <Brain className=\"text-primary\" />\n              </div>\n              <h3 className=\"font-semibold mb-2\">AI Insights</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Get intelligent answers to complex questions\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":10652},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/kpi/big-number-trendline.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\nimport { LineChart, Line, ResponsiveContainer } from \"recharts\";\nimport { cn } from \"@/lib/utils\";\n\ninterface TrendData {\n  value: number;\n  date?: string;\n}\n\ninterface BigNumberTrendlineProps {\n  title: string;\n  value: string | number;\n  trendData: TrendData[];\n  prefix?: string;\n  suffix?: string;\n  subheader?: string;\n  showComparison?: boolean;\n  comparisonPeriod?: string;\n  format?: 'number' | 'currency' | 'percentage';\n  trendColor?: string;\n  fontColor?: string;\n}\n\nexport function BigNumberTrendline({\n  title,\n  value,\n  trendData,\n  prefix = '',\n  suffix = '',\n  subheader,\n  showComparison = true,\n  comparisonPeriod = 'vs. previous period',\n  format = 'number',\n  trendColor = '#3b82f6',\n  fontColor = '#1f2937',\n}: BigNumberTrendlineProps) {\n  \n  const formatValue = (val: string | number): string => {\n    const numVal = typeof val === 'string' ? parseFloat(val) : val;\n    \n    if (isNaN(numVal)) return String(val);\n    \n    switch (format) {\n      case 'currency':\n        return `$${numVal.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 })}`;\n      case 'percentage':\n        return `${numVal.toFixed(1)}%`;\n      case 'number':\n      default:\n        if (numVal >= 1000000) {\n          return `${(numVal / 1000000).toFixed(1)}M`;\n        }\n        if (numVal >= 1000) {\n          return `${(numVal / 1000).toFixed(1)}K`;\n        }\n        return numVal.toLocaleString();\n    }\n  };\n\n  const calculateTrend = (): { percentChange: number; trend: 'up' | 'down' | 'neutral' } => {\n    if (!trendData || trendData.length < 2) {\n      return { percentChange: 0, trend: 'neutral' };\n    }\n\n    const latest = trendData[trendData.length - 1].value;\n    const previous = trendData[trendData.length - 2].value;\n    \n    if (previous === 0) return { percentChange: 0, trend: 'neutral' };\n    \n    const percentChange = ((latest - previous) / previous) * 100;\n    \n    return {\n      percentChange,\n      trend: percentChange > 0 ? 'up' : percentChange < 0 ? 'down' : 'neutral'\n    };\n  };\n\n  const trend = calculateTrend();\n\n  return (\n    <Card className=\"w-full bg-white dark:bg-white\" data-testid=\"kpi-big-number-trendline\">\n      <CardHeader className=\"pb-1\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-2 p-4 pt-0\">\n        <div className=\"text-4xl font-bold\" style={{ color: fontColor }} data-testid=\"kpi-trendline-value\">\n          {prefix}{formatValue(value)}{suffix}\n        </div>\n        \n        {/* Sparkline Chart */}\n        {trendData && trendData.length > 0 && (\n          <div className=\"h-16 -mx-2\" data-testid=\"kpi-sparkline\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <LineChart data={trendData}>\n                <Line\n                  type=\"monotone\"\n                  dataKey=\"value\"\n                  stroke={trendColor}\n                  strokeWidth={2}\n                  dot={false}\n                  isAnimationActive={false}\n                />\n              </LineChart>\n            </ResponsiveContainer>\n          </div>\n        )}\n        \n        {/* Comparison */}\n        {showComparison && (\n          <div className=\"flex items-center justify-between text-sm\">\n            <div className={cn(\n              \"flex items-center gap-1 font-medium\",\n              trend.trend === 'up' ? 'text-green-600 dark:text-green-400' :\n              trend.trend === 'down' ? 'text-red-600 dark:text-red-400' :\n              'text-muted-foreground'\n            )} data-testid=\"kpi-trendline-comparison\">\n              {trend.trend === 'up' && <TrendingUp className=\"h-4 w-4\" />}\n              {trend.trend === 'down' && <TrendingDown className=\"h-4 w-4\" />}\n              <span>{trend.percentChange >= 0 ? '+' : ''}{trend.percentChange.toFixed(1)}%</span>\n            </div>\n            {subheader && (\n              <span className=\"text-muted-foreground\">{subheader}</span>\n            )}\n            {!subheader && (\n              <span className=\"text-muted-foreground\">{comparisonPeriod}</span>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4346},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/kpi/gauge-chart.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\n\ninterface GaugeChartProps {\n  title: string;\n  value: number;\n  target: number;\n  min?: number;\n  max?: number;\n  unit?: string;\n  showPercentage?: boolean;\n  thresholds?: {\n    good: number; // percentage of target\n    warning: number; // percentage of target\n  };\n}\n\nexport function GaugeChart({\n  title,\n  value,\n  target,\n  min = 0,\n  max,\n  unit = '',\n  showPercentage = true,\n  thresholds = { good: 80, warning: 50 },\n}: GaugeChartProps) {\n  \n  const maxValue = max || target * 1.2; // Default max is 120% of target\n  const percentage = Math.min((value / target) * 100, 100);\n  const progressAngle = (percentage / 100) * 180; // Semi-circle (180 degrees)\n  \n  const getColor = (): string => {\n    if (percentage >= thresholds.good) {\n      return '#10b981'; // Green\n    } else if (percentage >= thresholds.warning) {\n      return '#f59e0b'; // Amber\n    } else {\n      return '#ef4444'; // Red\n    }\n  };\n\n  const color = getColor();\n  \n  // SVG path for gauge arc\n  const radius = 80;\n  const strokeWidth = 12;\n  const center = 100;\n  const circumference = Math.PI * radius;\n  \n  const backgroundArc = `\n    M ${center - radius} ${center}\n    A ${radius} ${radius} 0 0 1 ${center + radius} ${center}\n  `;\n  \n  const progressArcLength = (progressAngle / 180) * circumference;\n  \n  return (\n    <Card className=\"w-full bg-white dark:bg-white\" data-testid=\"kpi-gauge-chart\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"flex flex-col items-center space-y-4\">\n        {/* SVG Gauge */}\n        <div className=\"relative\" style={{ width: 200, height: 120 }}>\n          <svg width=\"200\" height=\"120\" viewBox=\"0 0 200 120\">\n            {/* Background arc */}\n            <path\n              d={backgroundArc}\n              fill=\"none\"\n              stroke=\"#e5e7eb\"\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n            />\n            \n            {/* Progress arc */}\n            <path\n              d={backgroundArc}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n              strokeDasharray={`${progressArcLength} ${circumference}`}\n              style={{ transition: 'stroke-dasharray 0.3s ease' }}\n            />\n            \n            {/* Center value */}\n            <text\n              x=\"100\"\n              y=\"85\"\n              textAnchor=\"middle\"\n              className=\"text-3xl font-bold fill-current\"\n              data-testid=\"gauge-value\"\n            >\n              {value.toLocaleString()}{unit}\n            </text>\n            \n            {showPercentage && (\n              <text\n                x=\"100\"\n                y=\"105\"\n                textAnchor=\"middle\"\n                className=\"text-sm fill-muted-foreground\"\n                data-testid=\"gauge-percentage\"\n              >\n                {percentage.toFixed(0)}% of target\n              </text>\n            )}\n          </svg>\n        </div>\n        \n        {/* Target information */}\n        <div className=\"flex items-center justify-between w-full text-sm\">\n          <div className=\"text-muted-foreground\">\n            <span className=\"font-medium\">Target:</span> {target.toLocaleString()}{unit}\n          </div>\n          <div className={cn(\n            \"font-medium\",\n            percentage >= thresholds.good ? 'text-green-600 dark:text-green-400' :\n            percentage >= thresholds.warning ? 'text-amber-600 dark:text-amber-400' :\n            'text-red-600 dark:text-red-400'\n          )} data-testid=\"gauge-status\">\n            {percentage >= thresholds.good ? 'On Track' :\n             percentage >= thresholds.warning ? 'At Risk' :\n             'Below Target'}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4023},"client/src/components/layout/sidebar.tsx":{"content":"import { useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { \n  BarChart3, \n  Database, \n  Bot, \n  Table,\n  Plug,\n  Settings,\n  LogOut,\n  Pin,\n  PinOff\n} from \"lucide-react\";\nimport nexSightLogo from \"@assets/nexsight_1758799902588.png\";\n\ninterface SidebarProps {\n  currentPage: string;\n  onPageChange: (page: string) => void;\n  isOpen: boolean;\n  onToggle: () => void;\n}\n\nconst navigation = [\n  {\n    id: \"dashboard\",\n    name: \"Dashboard\",\n    icon: BarChart3,\n    description: \"Overview & KPIs\"\n  },\n  {\n    id: \"warehouse\",\n    name: \"NEX Connect\", \n    icon: Plug,\n    description: \"Data sources\"\n  },\n  {\n    id: \"assistant\",\n    name: \"NEX AI\",\n    icon: Bot,\n    description: \"Chat with your data\"\n  },\n  {\n    id: \"charts\",\n    name: \"NEX VIZ\",\n    icon: BarChart3,\n    description: \"Visualizations\"\n  },\n  {\n    id: \"datasets\",\n    name: \"NEX House\",\n    icon: Database,\n    description: \"Data & Views\"\n  }\n];\n\nexport default function Sidebar({ currentPage, onPageChange, isOpen, onToggle }: SidebarProps) {\n  const { user, logoutMutation } = useAuth();\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  const [isPinned, setIsPinned] = useState(false);\n  const [isHovered, setIsHovered] = useState(false);\n  \n  const shouldShowExpanded = isPinned || isHovered;\n  const sidebarWidth = shouldShowExpanded ? 'w-64' : 'w-16';\n\n  const getUserInitials = (name?: string | null, email?: string | null) => {\n    if (name) {\n      return name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();\n    }\n    if (email) {\n      return email.slice(0, 2).toUpperCase();\n    }\n    return 'U';\n  };\n\n  return (\n    <>\n      {/* Mobile overlay */}\n      {isOpen && (\n        <div \n          className=\"fixed inset-0 z-40 bg-black/50 lg:hidden\"\n          onClick={onToggle}\n        />\n      )}\n      \n      {/* Sidebar */}\n      <aside \n        className={cn(\n          \"fixed left-0 top-0 z-50 h-full bg-card border-r border-border transition-all duration-300 lg:translate-x-0\",\n          sidebarWidth,\n          isOpen ? \"translate-x-0\" : \"-translate-x-full\"\n        )}\n        onMouseEnter={() => setIsHovered(true)}\n        onMouseLeave={() => setIsHovered(false)}\n      >\n        <div className=\"flex flex-col h-full\">\n          {/* Header */}\n          <div className={cn(\"border-b border-border transition-all duration-300\", shouldShowExpanded ? \"p-6\" : \"p-3\")}>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden flex-shrink-0\">\n                <img \n                  src={nexSightLogo} \n                  alt=\"NEX Sight Logo\" \n                  className=\"w-full h-full object-contain\"\n                />\n              </div>\n              {shouldShowExpanded && (\n                <div className=\"overflow-hidden\">\n                  <h1 className=\"text-xl font-bold whitespace-nowrap\">NEX Sight</h1>\n                  <p className=\"text-xs text-muted-foreground whitespace-nowrap\">Business Intelligence</p>\n                </div>\n              )}\n              {shouldShowExpanded && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setIsPinned(!isPinned)}\n                  className=\"ml-auto opacity-60 hover:opacity-100 transition-opacity\"\n                  data-testid=\"button-pin-sidebar\"\n                >\n                  {isPinned ? <PinOff className=\"h-4 w-4\" /> : <Pin className=\"h-4 w-4\" />}\n                </Button>\n              )}\n            </div>\n          </div>\n\n          {/* Navigation */}\n          <nav className={cn(\"flex-1 space-y-2 transition-all duration-300\", shouldShowExpanded ? \"p-4\" : \"p-2\")}>\n            {navigation.map((item) => {\n              const Icon = item.icon;\n              const isActive = currentPage === item.id;\n              \n              return (\n                <button\n                  key={item.id}\n                  onClick={() => {\n                    onPageChange(item.id);\n                    // Close mobile sidebar after navigation\n                    if (window.innerWidth < 1024) {\n                      onToggle();\n                    }\n                  }}\n                  className={cn(\n                    \"w-full flex items-center rounded-lg text-left transition-all duration-300\",\n                    shouldShowExpanded ? \"gap-3 px-3 py-2\" : \"justify-center p-3\",\n                    isActive \n                      ? \"bg-primary/20 text-primary font-medium\" \n                      : \"text-muted-foreground hover:bg-muted hover:text-foreground\"\n                  )}\n                  data-testid={`nav-${item.id}`}\n                  title={!shouldShowExpanded ? item.name : undefined}\n                >\n                  <Icon className=\"h-5 w-5 flex-shrink-0\" />\n                  {shouldShowExpanded && (\n                    <div className=\"flex-1 min-w-0 overflow-hidden\">\n                      <div className=\"font-medium whitespace-nowrap\">{item.name}</div>\n                      <div className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                        {item.description}\n                      </div>\n                    </div>\n                  )}\n                </button>\n              );\n            })}\n          </nav>\n\n          {/* User section */}\n          <div className={cn(\"border-t border-border transition-all duration-300\", shouldShowExpanded ? \"p-4\" : \"p-2\")}>\n            <div className={cn(\"flex items-center mb-3\", shouldShowExpanded ? \"gap-3\" : \"justify-center\")}>\n              <Avatar className=\"h-8 w-8 flex-shrink-0\">\n                <AvatarFallback className=\"bg-gradient-to-br from-secondary to-accent text-xs\">\n                  {getUserInitials(user?.name, user?.email)}\n                </AvatarFallback>\n              </Avatar>\n              {shouldShowExpanded && (\n                <div className=\"flex-1 min-w-0 overflow-hidden\">\n                  <p className=\"text-sm font-medium truncate\" data-testid=\"text-user-name\">\n                    {user?.name || 'User'}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground truncate\" data-testid=\"text-user-email\">\n                    {user?.email}\n                  </p>\n                </div>\n              )}\n            </div>\n            \n            <div className=\"space-y-1\">\n              <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                className={cn(\n                  \"w-full text-muted-foreground transition-all duration-300\",\n                  shouldShowExpanded ? \"justify-start\" : \"justify-center px-2\"\n                )}\n                data-testid=\"button-settings\"\n                title={!shouldShowExpanded ? \"Settings\" : undefined}\n              >\n                <Settings className={cn(\"h-4 w-4\", shouldShowExpanded && \"mr-2\")} />\n                {shouldShowExpanded && \"Settings\"}\n              </Button>\n              <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                className={cn(\n                  \"w-full text-muted-foreground hover:text-destructive transition-all duration-300\",\n                  shouldShowExpanded ? \"justify-start\" : \"justify-center px-2\"\n                )}\n                onClick={() => logoutMutation.mutate()}\n                disabled={logoutMutation.isPending}\n                data-testid=\"button-logout\"\n                title={!shouldShowExpanded ? (logoutMutation.isPending ? 'Signing out...' : 'Sign out') : undefined}\n              >\n                <LogOut className={cn(\"h-4 w-4\", shouldShowExpanded && \"mr-2\")} />\n                {shouldShowExpanded && (logoutMutation.isPending ? 'Signing out...' : 'Sign out')}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </aside>\n    </>\n  );\n}\n","size_bytes":8022},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/lib/chart-catalog.ts":{"content":"/**\n * Chart Type Catalog\n * Comprehensive catalog of all available chart types, similar to Apache Superset\n */\n\nexport interface ChartType {\n  id: string;\n  name: string;\n  description: string;\n  category: ChartCategory[];\n  tags: string[];\n  thumbnail?: string;\n  isDeprecated?: boolean;\n  requiresPlugin?: boolean;\n  configSchema?: any; // Configuration schema for this chart type\n}\n\nexport type ChartCategory = \n  | 'Popular'\n  | 'KPI'\n  | 'Distribution'\n  | 'Evolution'\n  | 'Correlation'\n  | 'Part of a Whole'\n  | 'Ranking'\n  | 'Map'\n  | 'Flow'\n  | 'Table'\n  | 'Advanced-Analytics'\n  | 'Other';\n\nexport const CHART_CATALOG: ChartType[] = [\n  // KPI / Big Number Charts\n  {\n    id: 'big_number',\n    name: 'Big Number',\n    description: 'Display a single metric value prominently',\n    category: ['KPI', 'Popular'],\n    tags: ['2D', 'metric', 'kpi'],\n    configSchema: {\n      metric: { type: 'column', required: true, numeric: true },\n      comparisonType: { type: 'select', options: ['none', 'value', 'percentage'] },\n      prefix: { type: 'text' },\n      suffix: { type: 'text' },\n      decimals: { type: 'number', default: 2 }\n    }\n  },\n  {\n    id: 'big_number_trendline',\n    name: 'Big Number with Trendline',\n    description: 'Display a metric with a small trend visualization',\n    category: ['KPI', 'Popular', 'Evolution'],\n    tags: ['2D', 'metric', 'trend'],\n    configSchema: {\n      metric: { type: 'column', required: true, numeric: true },\n      timeColumn: { type: 'column', required: true, temporal: true },\n      prefix: { type: 'text' },\n      suffix: { type: 'text' }\n    }\n  },\n  {\n    id: 'gauge',\n    name: 'Gauge Chart',\n    description: 'Display a metric as a gauge with min/max values',\n    category: ['KPI'],\n    tags: ['2D', 'metric'],\n    configSchema: {\n      metric: { type: 'column', required: true, numeric: true },\n      minValue: { type: 'number', default: 0 },\n      maxValue: { type: 'number', default: 100 },\n      thresholds: { type: 'array' }\n    }\n  },\n  {\n    id: 'multi_value_card',\n    name: 'Multi-Value Card',\n    description: 'Display multiple related metrics in a single card',\n    category: ['KPI', 'Popular'],\n    tags: ['2D', 'metric', 'kpi', 'multi-metric'],\n    configSchema: {\n      values: { type: 'columns', required: true, multiple: true },\n      labels: { type: 'array' }\n    }\n  },\n\n  // Bar Charts\n  {\n    id: 'bar',\n    name: 'Bar Chart',\n    description: 'Compare values across categories',\n    category: ['Popular', 'Ranking', 'Distribution'],\n    tags: ['2D', 'comparison'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      orientation: { type: 'select', options: ['vertical', 'horizontal'], default: 'vertical' },\n      sort: { type: 'select', options: ['none', 'ascending', 'descending'] }\n    }\n  },\n  {\n    id: 'stacked_bar',\n    name: 'Stacked Bar Chart',\n    description: 'Compare multiple metrics stacked in bars',\n    category: ['Popular', 'Part of a Whole'],\n    tags: ['2D', 'comparison', 'additive'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metrics: { type: 'columns', required: true, numeric: true, multiple: true },\n      stackType: { type: 'select', options: ['normal', 'percentage'] }\n    }\n  },\n  {\n    id: 'grouped_bar',\n    name: 'Grouped Bar Chart',\n    description: 'Compare multiple metrics side by side',\n    category: ['Ranking', 'Distribution'],\n    tags: ['2D', 'comparison'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metrics: { type: 'columns', required: true, numeric: true, multiple: true },\n      groupBy: { type: 'column' }\n    }\n  },\n\n  // Line Charts\n  {\n    id: 'line',\n    name: 'Line Chart',\n    description: 'Show trends over time',\n    category: ['Popular', 'Evolution'],\n    tags: ['2D', 'trend', 'time-series'],\n    configSchema: {\n      timeColumn: { type: 'column', required: true, temporal: true },\n      metric: { type: 'column', required: true, numeric: true },\n      smoothing: { type: 'boolean', default: false }\n    }\n  },\n  {\n    id: 'multi_line',\n    name: 'Multi-Line Chart',\n    description: 'Compare multiple trends over time',\n    category: ['Evolution', 'Correlation'],\n    tags: ['2D', 'trend', 'time-series'],\n    configSchema: {\n      timeColumn: { type: 'column', required: true, temporal: true },\n      metrics: { type: 'columns', required: true, numeric: true, multiple: true },\n      groupBy: { type: 'column' }\n    }\n  },\n  {\n    id: 'smooth_line',\n    name: 'Smooth Line Chart',\n    description: 'Line chart with smooth curves',\n    category: ['Evolution'],\n    tags: ['2D', 'aesthetic', 'trend'],\n    configSchema: {\n      timeColumn: { type: 'column', required: true, temporal: true },\n      metric: { type: 'column', required: true, numeric: true }\n    }\n  },\n  {\n    id: 'stepped_line',\n    name: 'Stepped Line Chart',\n    description: 'Line chart with stepped transitions',\n    category: ['Evolution'],\n    tags: ['2D', 'trend'],\n    configSchema: {\n      timeColumn: { type: 'column', required: true, temporal: true },\n      metric: { type: 'column', required: true, numeric: true }\n    }\n  },\n\n  // Area Charts\n  {\n    id: 'area',\n    name: 'Area Chart',\n    description: 'Show volume over time with filled area',\n    category: ['Popular', 'Evolution'],\n    tags: ['2D', 'trend', 'additive'],\n    configSchema: {\n      timeColumn: { type: 'column', required: true, temporal: true },\n      metric: { type: 'column', required: true, numeric: true }\n    }\n  },\n  {\n    id: 'stacked_area',\n    name: 'Stacked Area Chart',\n    description: 'Compare multiple metrics with stacked areas',\n    category: ['Evolution', 'Part of a Whole'],\n    tags: ['2D', 'trend', 'additive'],\n    configSchema: {\n      timeColumn: { type: 'column', required: true, temporal: true },\n      metrics: { type: 'columns', required: true, numeric: true, multiple: true },\n      stackType: { type: 'select', options: ['normal', 'percentage'] }\n    }\n  },\n\n  // Pie Charts\n  {\n    id: 'pie',\n    name: 'Pie Chart',\n    description: 'Show proportions of a whole',\n    category: ['Popular', 'Part of a Whole'],\n    tags: ['2D', 'percentage'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      showLabels: { type: 'boolean', default: true },\n      showLegend: { type: 'boolean', default: true }\n    }\n  },\n  {\n    id: 'donut',\n    name: 'Donut Chart',\n    description: 'Pie chart with a hollow center',\n    category: ['Part of a Whole'],\n    tags: ['2D', 'percentage'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      innerRadius: { type: 'number', default: 50 }\n    }\n  },\n\n  // Scatter & Bubble\n  {\n    id: 'scatter',\n    name: 'Scatter Plot',\n    description: 'Show correlation between two variables',\n    category: ['Popular', 'Correlation'],\n    tags: ['2D', 'correlation'],\n    configSchema: {\n      xAxis: { type: 'column', required: true, numeric: true },\n      yAxis: { type: 'column', required: true, numeric: true },\n      groupBy: { type: 'column' }\n    }\n  },\n  {\n    id: 'bubble',\n    name: 'Bubble Chart',\n    description: 'Scatter plot with size representing a third dimension',\n    category: ['Correlation', 'Advanced-Analytics'],\n    tags: ['2D', 'correlation', '3D-data'],\n    configSchema: {\n      xAxis: { type: 'column', required: true, numeric: true },\n      yAxis: { type: 'column', required: true, numeric: true },\n      size: { type: 'column', required: true, numeric: true },\n      groupBy: { type: 'column' }\n    }\n  },\n\n  // Heatmaps\n  {\n    id: 'heatmap',\n    name: 'Heatmap',\n    description: 'Show values as colors in a matrix',\n    category: ['Popular', 'Correlation', 'Distribution'],\n    tags: ['2D', 'correlation', 'dense'],\n    configSchema: {\n      xAxis: { type: 'column', required: true },\n      yAxis: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      colorScheme: { type: 'select', options: ['blue', 'red', 'green', 'rainbow'] }\n    }\n  },\n  {\n    id: 'calendar_heatmap',\n    name: 'Calendar Heatmap',\n    description: 'Display values on a calendar layout',\n    category: ['Evolution', 'Distribution'],\n    tags: ['2D', 'time-series', 'calendar'],\n    configSchema: {\n      dateColumn: { type: 'column', required: true, temporal: true },\n      metric: { type: 'column', required: true, numeric: true }\n    }\n  },\n\n  // Box Plot & Distribution\n  {\n    id: 'boxplot',\n    name: 'Box Plot',\n    description: 'Show distribution statistics',\n    category: ['Distribution', 'Advanced-Analytics'],\n    tags: ['2D', 'statistical'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true }\n    }\n  },\n  {\n    id: 'histogram',\n    name: 'Histogram',\n    description: 'Show frequency distribution',\n    category: ['Distribution'],\n    tags: ['2D', 'statistical'],\n    configSchema: {\n      metric: { type: 'column', required: true, numeric: true },\n      bins: { type: 'number', default: 10 }\n    }\n  },\n\n  // Table\n  {\n    id: 'table',\n    name: 'Table',\n    description: 'Display data in a tabular format',\n    category: ['Table', 'Popular'],\n    tags: ['detailed', 'sortable'],\n    configSchema: {\n      columns: { type: 'columns', required: true, multiple: true },\n      pageSize: { type: 'number', default: 10 },\n      sortable: { type: 'boolean', default: true }\n    }\n  },\n  {\n    id: 'pivot_table',\n    name: 'Pivot Table',\n    description: 'Cross-tabulation with aggregations',\n    category: ['Table', 'Advanced-Analytics'],\n    tags: ['detailed', 'aggregation'],\n    configSchema: {\n      rows: { type: 'columns', required: true, multiple: true },\n      columns: { type: 'columns', required: true, multiple: true },\n      metrics: { type: 'columns', required: true, numeric: true, multiple: true },\n      aggregation: { type: 'select', options: ['sum', 'avg', 'count', 'min', 'max'] }\n    }\n  },\n\n  // Map Charts\n  {\n    id: 'country_map',\n    name: 'Country Map',\n    description: 'Display metrics on a country map',\n    category: ['Map'],\n    tags: ['geographic', '2D'],\n    requiresPlugin: true,\n    configSchema: {\n      countryColumn: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      colorScheme: { type: 'select' }\n    }\n  },\n  {\n    id: 'geojson_map',\n    name: 'GeoJSON Map',\n    description: 'Visualize geographic data with custom boundaries',\n    category: ['Map', 'Advanced-Analytics'],\n    tags: ['geographic', '2D'],\n    requiresPlugin: true,\n    configSchema: {\n      geojsonColumn: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true }\n    }\n  },\n\n  // Other Charts\n  {\n    id: 'funnel',\n    name: 'Funnel Chart',\n    description: 'Show progressive reduction of data',\n    category: ['Flow', 'Ranking'],\n    tags: ['2D', 'funnel'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      sort: { type: 'select', options: ['none', 'ascending', 'descending'] }\n    }\n  },\n  {\n    id: 'sankey',\n    name: 'Sankey Diagram',\n    description: 'Visualize flow between entities',\n    category: ['Flow', 'Advanced-Analytics'],\n    tags: ['flow', 'relationship'],\n    requiresPlugin: true,\n    configSchema: {\n      source: { type: 'column', required: true },\n      target: { type: 'column', required: true },\n      value: { type: 'column', required: true, numeric: true }\n    }\n  },\n  {\n    id: 'treemap',\n    name: 'Treemap',\n    description: 'Display hierarchical data as nested rectangles',\n    category: ['Part of a Whole', 'Ranking'],\n    tags: ['hierarchical', '2D'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      groupBy: { type: 'column' }\n    }\n  },\n  {\n    id: 'sunburst',\n    name: 'Sunburst Chart',\n    description: 'Hierarchical data in concentric circles',\n    category: ['Part of a Whole', 'Advanced-Analytics'],\n    tags: ['hierarchical', '2D'],\n    configSchema: {\n      hierarchy: { type: 'columns', required: true, multiple: true },\n      metric: { type: 'column', required: true, numeric: true }\n    }\n  },\n  {\n    id: 'waterfall',\n    name: 'Waterfall Chart',\n    description: 'Show cumulative effect of sequential values',\n    category: ['Flow', 'Evolution'],\n    tags: ['2D', 'cumulative'],\n    configSchema: {\n      dimension: { type: 'column', required: true },\n      metric: { type: 'column', required: true, numeric: true },\n      showTotal: { type: 'boolean', default: true }\n    }\n  },\n  {\n    id: 'radar',\n    name: 'Radar Chart',\n    description: 'Compare multiple variables on axes from a center point',\n    category: ['Correlation'],\n    tags: ['2D', 'comparison', 'multivariate'],\n    configSchema: {\n      dimensions: { type: 'columns', required: true, multiple: true },\n      metrics: { type: 'columns', required: true, numeric: true, multiple: true }\n    }\n  }\n];\n\n/**\n * Get all unique categories\n */\nexport function getCategories(): ChartCategory[] {\n  const categories = new Set<ChartCategory>();\n  CHART_CATALOG.forEach(chart => {\n    chart.category.forEach(cat => categories.add(cat));\n  });\n  return Array.from(categories).sort();\n}\n\n/**\n * Get all unique tags\n */\nexport function getTags(): string[] {\n  const tags = new Set<string>();\n  CHART_CATALOG.forEach(chart => {\n    chart.tags.forEach(tag => tags.add(tag));\n  });\n  return Array.from(tags).sort();\n}\n\n/**\n * Filter charts by category\n */\nexport function getChartsByCategory(category: ChartCategory): ChartType[] {\n  return CHART_CATALOG.filter(chart => chart.category.includes(category));\n}\n\n/**\n * Filter charts by tag\n */\nexport function getChartsByTag(tag: string): ChartType[] {\n  return CHART_CATALOG.filter(chart => chart.tags.includes(tag));\n}\n\n/**\n * Search charts by name or description\n */\nexport function searchCharts(query: string): ChartType[] {\n  const lowerQuery = query.toLowerCase();\n  return CHART_CATALOG.filter(chart => \n    chart.name.toLowerCase().includes(lowerQuery) ||\n    chart.description.toLowerCase().includes(lowerQuery) ||\n    chart.tags.some(tag => tag.toLowerCase().includes(lowerQuery))\n  );\n}\n\n/**\n * Get chart by ID\n */\nexport function getChartById(id: string): ChartType | undefined {\n  return CHART_CATALOG.find(chart => chart.id === id);\n}\n","size_bytes":14622},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"server/services/data-masking.ts":{"content":"/**\n * Data Masking Service\n * \n * Generates dummy/masked data based on column schemas to preserve privacy.\n * This ensures real data is NEVER sent to external APIs like OpenAI.\n */\n\nexport interface ColumnSchema {\n  name: string;\n  type: string;\n  sampleValues?: any[];\n}\n\nexport interface DataSchema {\n  columns: ColumnSchema[];\n  rowCount: number;\n}\n\n/**\n * Infer column type from sample values\n */\nexport function inferColumnType(values: any[]): string {\n  if (!values || values.length === 0) return 'string';\n  \n  const nonNullValues = values.filter(v => v !== null && v !== undefined && v !== '');\n  if (nonNullValues.length === 0) return 'string';\n  \n  const sample = nonNullValues[0];\n  \n  // Check if it's a number\n  if (typeof sample === 'number' || !isNaN(Number(sample))) {\n    if (Number.isInteger(Number(sample))) {\n      return 'integer';\n    }\n    return 'float';\n  }\n  \n  // Check if it's a date\n  if (sample instanceof Date || !isNaN(Date.parse(sample))) {\n    return 'date';\n  }\n  \n  // Check if it's a boolean\n  if (typeof sample === 'boolean' || sample === 'true' || sample === 'false') {\n    return 'boolean';\n  }\n  \n  return 'string';\n}\n\n/**\n * Extract schema from real data without exposing actual values\n */\nexport function extractDataSchema(data: any[]): DataSchema {\n  if (!data || data.length === 0) {\n    return { columns: [], rowCount: 0 };\n  }\n  \n  const columns: ColumnSchema[] = [];\n  const columnNames = Object.keys(data[0]);\n  \n  for (const colName of columnNames) {\n    const values = data.slice(0, 100).map(row => row[colName]); // Sample first 100 rows\n    const type = inferColumnType(values);\n    \n    // Store sample values only for type inference, not actual data\n    columns.push({\n      name: colName,\n      type,\n      sampleValues: [] // Don't store real values\n    });\n  }\n  \n  return {\n    columns,\n    rowCount: data.length\n  };\n}\n\n/**\n * Generate dummy data based on column type\n */\nexport function generateDummyValue(columnName: string, columnType: string, index: number): any {\n  switch (columnType) {\n    case 'integer':\n      // Generate realistic integers based on column name\n      if (columnName.toLowerCase().includes('id')) return index + 1;\n      if (columnName.toLowerCase().includes('age')) return 20 + (index % 60);\n      if (columnName.toLowerCase().includes('quantity') || columnName.toLowerCase().includes('count')) {\n        return 10 + (index % 100);\n      }\n      if (columnName.toLowerCase().includes('price') || columnName.toLowerCase().includes('amount')) {\n        return 100 + (index % 1000);\n      }\n      return Math.floor(Math.random() * 1000);\n      \n    case 'float':\n      if (columnName.toLowerCase().includes('price') || columnName.toLowerCase().includes('amount')) {\n        return parseFloat((50 + Math.random() * 500).toFixed(2));\n      }\n      if (columnName.toLowerCase().includes('rate') || columnName.toLowerCase().includes('percent')) {\n        return parseFloat((Math.random() * 100).toFixed(2));\n      }\n      return parseFloat((Math.random() * 1000).toFixed(2));\n      \n    case 'date':\n      const baseDate = new Date('2024-01-01');\n      const daysOffset = index % 365;\n      const date = new Date(baseDate.getTime() + daysOffset * 24 * 60 * 60 * 1000);\n      return date.toISOString().split('T')[0];\n      \n    case 'boolean':\n      return index % 2 === 0;\n      \n    case 'string':\n    default:\n      // Generate realistic strings based on column name\n      if (columnName.toLowerCase().includes('name')) {\n        const names = ['John', 'Jane', 'Bob', 'Alice', 'Charlie', 'Diana', 'Eve', 'Frank'];\n        return names[index % names.length];\n      }\n      if (columnName.toLowerCase().includes('email')) {\n        return `user${index}@example.com`;\n      }\n      if (columnName.toLowerCase().includes('city') || columnName.toLowerCase().includes('location')) {\n        const cities = ['New York', 'London', 'Paris', 'Tokyo', 'Sydney', 'Berlin'];\n        return cities[index % cities.length];\n      }\n      if (columnName.toLowerCase().includes('category') || columnName.toLowerCase().includes('type')) {\n        const categories = ['Category A', 'Category B', 'Category C', 'Category D'];\n        return categories[index % categories.length];\n      }\n      if (columnName.toLowerCase().includes('status')) {\n        const statuses = ['Active', 'Pending', 'Completed', 'Cancelled'];\n        return statuses[index % statuses.length];\n      }\n      return `Value_${index}`;\n  }\n}\n\n/**\n * Generate dummy dataset based on schema\n */\nexport function generateDummyData(schema: DataSchema, numRows: number = 10): any[] {\n  const dummyData: any[] = [];\n  \n  for (let i = 0; i < numRows; i++) {\n    const row: any = {};\n    \n    for (const column of schema.columns) {\n      row[column.name] = generateDummyValue(column.name, column.type, i);\n    }\n    \n    dummyData.push(row);\n  }\n  \n  return dummyData;\n}\n\n/**\n * Create a privacy-safe data summary for AI\n */\nexport function createPrivacySafeDataSummary(data: any[]): string {\n  const schema = extractDataSchema(data);\n  const dummyData = generateDummyData(schema, 5); // Only 5 sample rows\n  \n  return `\nData Schema:\n- Total rows: ${schema.rowCount}\n- Columns: ${schema.columns.map(c => `${c.name} (${c.type})`).join(', ')}\n\nSample dummy data (for context only, not real data):\n${JSON.stringify(dummyData, null, 2)}\n\nNOTE: The sample data above is DUMMY DATA generated based on column types. Use it to understand the structure and write analysis code.\n`;\n}\n","size_bytes":5498},"server/services/query-cache.ts":{"content":"import Redis from 'ioredis';\nimport crypto from 'crypto';\n\ninterface CacheConfig {\n  defaultTTL: number; // seconds\n  enabled: boolean;\n}\n\ninterface CacheMetadata {\n  query: string;\n  timestamp: number;\n  dataSourceIds: string[];\n  ttl: number;\n}\n\nexport class QueryCacheService {\n  private redis: Redis | null = null;\n  private config: CacheConfig;\n  private static instance: QueryCacheService;\n\n  private constructor() {\n    this.config = {\n      defaultTTL: parseInt(process.env.QUERY_CACHE_TTL || '300'), // 5 minutes default\n      enabled: process.env.QUERY_CACHE_ENABLED !== 'false'\n    };\n\n    this.initializeRedis();\n  }\n\n  static getInstance(): QueryCacheService {\n    if (!QueryCacheService.instance) {\n      QueryCacheService.instance = new QueryCacheService();\n    }\n    return QueryCacheService.instance;\n  }\n\n  private initializeRedis() {\n    try {\n      // Try to connect to Redis if available (for production)\n      const redisUrl = process.env.REDIS_URL || process.env.REDIS_PRIVATE_URL;\n      \n      if (redisUrl && this.config.enabled) {\n        this.redis = new Redis(redisUrl, {\n          maxRetriesPerRequest: 3,\n          enableReadyCheck: true,\n          retryStrategy: (times) => {\n            if (times > 3) {\n              console.log('Redis connection failed, falling back to in-memory cache');\n              this.redis = null;\n              return null;\n            }\n            return Math.min(times * 100, 3000);\n          }\n        });\n\n        this.redis.on('ready', () => {\n          console.log('‚úÖ Redis cache connected successfully');\n        });\n\n        this.redis.on('error', (err) => {\n          console.log('Redis connection error, using in-memory cache:', err.message);\n          this.redis = null;\n        });\n      } else {\n        console.log('üì¶ Using in-memory cache (Redis not configured)');\n        this.redis = null;\n      }\n    } catch (error) {\n      console.error('Failed to initialize Redis, using in-memory cache:', error);\n      this.redis = null;\n    }\n  }\n\n  /**\n   * Generate cache key from query and parameters\n   */\n  private generateCacheKey(\n    query: string,\n    params: Record<string, any>,\n    dataSourceIds: string[]\n  ): string {\n    const cacheInput = JSON.stringify({\n      query: query.trim(),\n      params,\n      dataSourceIds: dataSourceIds.sort()\n    });\n    \n    const hash = crypto.createHash('sha256').update(cacheInput).digest('hex');\n    return `query:${hash}`;\n  }\n\n  /**\n   * Get cached query result\n   */\n  async get(\n    query: string,\n    params: Record<string, any> = {},\n    dataSourceIds: string[] = []\n  ): Promise<any[] | null> {\n    if (!this.config.enabled) return null;\n\n    const cacheKey = this.generateCacheKey(query, params, dataSourceIds);\n\n    try {\n      if (this.redis) {\n        const cached = await this.redis.get(cacheKey);\n        if (cached) {\n          const data = JSON.parse(cached);\n          console.log(`üéØ Cache HIT for key: ${cacheKey.substring(0, 16)}...`);\n          return data.result;\n        }\n      } else {\n        // Fallback to in-memory cache (simple Map-based)\n        const cached = this.inMemoryCache.get(cacheKey);\n        if (cached && Date.now() - cached.timestamp < cached.ttl * 1000) {\n          console.log(`üéØ Memory cache HIT for key: ${cacheKey.substring(0, 16)}...`);\n          return cached.result;\n        }\n      }\n\n      console.log(`‚ùå Cache MISS for key: ${cacheKey.substring(0, 16)}...`);\n      return null;\n    } catch (error) {\n      console.error('Cache get error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Set cache entry with TTL\n   */\n  async set(\n    query: string,\n    result: any[],\n    params: Record<string, any> = {},\n    dataSourceIds: string[] = [],\n    ttl?: number\n  ): Promise<void> {\n    if (!this.config.enabled) return;\n\n    const cacheKey = this.generateCacheKey(query, params, dataSourceIds);\n    const cacheTTL = ttl || this.config.defaultTTL;\n\n    const metadata: CacheMetadata = {\n      query: query.trim(),\n      timestamp: Date.now(),\n      dataSourceIds,\n      ttl: cacheTTL\n    };\n\n    const cacheValue = {\n      result,\n      metadata\n    };\n\n    try {\n      if (this.redis) {\n        await this.redis.setex(cacheKey, cacheTTL, JSON.stringify(cacheValue));\n        console.log(`üíæ Cached result for ${cacheTTL}s: ${cacheKey.substring(0, 16)}...`);\n      } else {\n        // Fallback to in-memory cache\n        this.inMemoryCache.set(cacheKey, {\n          result,\n          timestamp: Date.now(),\n          ttl: cacheTTL\n        });\n        console.log(`üíæ Memory cached result for ${cacheTTL}s: ${cacheKey.substring(0, 16)}...`);\n        \n        // Clean up old entries periodically\n        this.cleanupInMemoryCache();\n      }\n\n      // Store reverse index: dataSourceId -> cache keys\n      for (const dsId of dataSourceIds) {\n        await this.addToDataSourceIndex(dsId, cacheKey);\n      }\n    } catch (error) {\n      console.error('Cache set error:', error);\n    }\n  }\n\n  /**\n   * Invalidate cache for specific data sources\n   * Called when data is updated/deleted\n   */\n  async invalidateDataSource(dataSourceId: string): Promise<void> {\n    try {\n      if (this.redis) {\n        const indexKey = `ds:${dataSourceId}:keys`;\n        const cacheKeys = await this.redis.smembers(indexKey);\n        \n        if (cacheKeys.length > 0) {\n          await Promise.all(cacheKeys.map(key => this.redis!.del(key)));\n          await this.redis.del(indexKey);\n          console.log(`üóëÔ∏è  Invalidated ${cacheKeys.length} cache entries for data source ${dataSourceId}`);\n        }\n      } else {\n        // In-memory: remove all entries for this data source\n        for (const [key, value] of this.inMemoryCache.entries()) {\n          // Simple check - in production would use proper index\n          this.inMemoryCache.delete(key);\n        }\n        console.log(`üóëÔ∏è  Cleared memory cache for data source ${dataSourceId}`);\n      }\n    } catch (error) {\n      console.error('Cache invalidation error:', error);\n    }\n  }\n\n  /**\n   * Clear all cache\n   */\n  async clear(): Promise<void> {\n    try {\n      if (this.redis) {\n        const keys = await this.redis.keys('query:*');\n        if (keys.length > 0) {\n          await this.redis.del(...keys);\n        }\n        const dsKeys = await this.redis.keys('ds:*');\n        if (dsKeys.length > 0) {\n          await this.redis.del(...dsKeys);\n        }\n        console.log('üóëÔ∏è  Cleared all Redis cache');\n      } else {\n        this.inMemoryCache.clear();\n        console.log('üóëÔ∏è  Cleared all memory cache');\n      }\n    } catch (error) {\n      console.error('Cache clear error:', error);\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  async getStats(): Promise<{\n    enabled: boolean;\n    type: 'redis' | 'memory';\n    entries: number;\n    memoryUsage?: string;\n  }> {\n    try {\n      if (this.redis) {\n        const keys = await this.redis.keys('query:*');\n        const info = await this.redis.info('memory');\n        const memoryMatch = info.match(/used_memory_human:(.+)/);\n        \n        return {\n          enabled: this.config.enabled,\n          type: 'redis',\n          entries: keys.length,\n          memoryUsage: memoryMatch ? memoryMatch[1].trim() : 'unknown'\n        };\n      } else {\n        return {\n          enabled: this.config.enabled,\n          type: 'memory',\n          entries: this.inMemoryCache.size\n        };\n      }\n    } catch (error) {\n      console.error('Cache stats error:', error);\n      return {\n        enabled: this.config.enabled,\n        type: this.redis ? 'redis' : 'memory',\n        entries: 0\n      };\n    }\n  }\n\n  // Helper methods\n  private async addToDataSourceIndex(dataSourceId: string, cacheKey: string): Promise<void> {\n    if (!this.redis) return;\n    \n    try {\n      const indexKey = `ds:${dataSourceId}:keys`;\n      await this.redis.sadd(indexKey, cacheKey);\n      // Set expiry on index too\n      await this.redis.expire(indexKey, this.config.defaultTTL);\n    } catch (error) {\n      console.error('Error adding to data source index:', error);\n    }\n  }\n\n  // In-memory cache fallback\n  private inMemoryCache = new Map<string, {\n    result: any[];\n    timestamp: number;\n    ttl: number;\n  }>();\n\n  private cleanupInMemoryCache() {\n    const now = Date.now();\n    for (const [key, value] of this.inMemoryCache.entries()) {\n      if (now - value.timestamp > value.ttl * 1000) {\n        this.inMemoryCache.delete(key);\n      }\n    }\n\n    // Limit cache size\n    if (this.inMemoryCache.size > 100) {\n      const oldestKeys = Array.from(this.inMemoryCache.entries())\n        .sort((a, b) => a[1].timestamp - b[1].timestamp)\n        .slice(0, 20)\n        .map(([key]) => key);\n      \n      oldestKeys.forEach(key => this.inMemoryCache.delete(key));\n    }\n  }\n\n  /**\n   * Close Redis connection\n   */\n  async disconnect(): Promise<void> {\n    if (this.redis) {\n      await this.redis.quit();\n      this.redis = null;\n    }\n  }\n}\n\n// Export singleton instance\nexport const queryCache = QueryCacheService.getInstance();\n","size_bytes":9022},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/voice/voice-status.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VoiceStatusProps {\n  isRecording: boolean;\n  isTranscribing: boolean;\n  onStop: () => void;\n}\n\nexport default function VoiceStatus({ isRecording, isTranscribing, onStop }: VoiceStatusProps) {\n  if (!isRecording && !isTranscribing) {\n    return null;\n  }\n\n  return (\n    <div className=\"mt-3 p-3 rounded-lg bg-red-500/20 border border-red-500/30\">\n      <div className=\"flex items-center gap-3\">\n        <div className={cn(\n          \"w-3 h-3 rounded-full\",\n          isRecording ? \"bg-red-500 animate-pulse\" : \"bg-yellow-500\"\n        )} />\n        <span className=\"text-sm\">\n          {isRecording ? \"Listening... Speak your question\" : \"Processing your voice...\"}\n        </span>\n        <Button \n          variant=\"ghost\" \n          size=\"sm\"\n          onClick={onStop}\n          className=\"ml-auto text-sm text-muted-foreground hover:text-foreground\"\n          data-testid=\"button-stop-voice\"\n        >\n          Stop\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1064},"attached_assets/page_1758734417087.tsx":{"content":"\"use client\"; \r\n\r\nimport { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport InjectDataModal from \"@/components/warehouse/InjectDataModal\";\r\nimport SourceCapacityWidget from \"@/components/warehouse/SourceCapacityWidget\";\r\nimport JobCreateModal, { Job } from \"@/components/warehouse/JobCreateModal\";\r\nimport TopNav from \"@/components/nav/TopNav\";\r\nimport SourceExplorerDrawer, { SqlDataset } from \"@/components/warehouse/SourceExplorerDrawer\";\r\n\r\ntype Tab = \"datasets\" | \"sources\" | \"jobs\";\r\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE ?? \"http://localhost:8000\";\r\n\r\n/** Limits (wire to backend later) */\r\nconst SOURCE_LIMITS: Record<string, { label: string; limit: number; used?: number }> = {\r\n  csv: { label: \"CSV / Excel\", limit: 100, used: 0 },\r\n  mysql: { label: \"MySQL\", limit: 10, used: 0 },\r\n  azuresql: { label: \"Azure SQL\", limit: 20, used: 0 },\r\n  sqlserver: { label: \"SQL Server\", limit: 20, used: 0 },\r\n  postgresql: { label: \"PostgreSQL\", limit: 20, used: 0 },\r\n  \"aws-rds\": { label: \"AWS RDS\", limit: 10, used: 0 },\r\n  snowflake: { label: \"Snowflake\", limit: 50, used: 0 },\r\n  bigquery: { label: \"BigQuery\", limit: 50, used: 0 },\r\n  adls: { label: \"Azure Data Lake\", limit: 100, used: 0 },\r\n  s3: { label: \"Amazon S3\", limit: 100, used: 0 },\r\n  gcs: { label: \"Google Cloud Storage\", limit: 100, used: 0 },\r\n  sheets: { label: \"Google Sheets\", limit: 50, used: 0 },\r\n  kafka: { label: \"Kafka\", limit: 10, used: 0 },\r\n  eventhub: { label: \"Azure Event Hub\", limit: 10, used: 0 },\r\n  rest: { label: \"REST API\", limit: 100, used: 0 },\r\n  sftp: { label: \"SFTP\", limit: 20, used: 0 },\r\n};\r\n\r\n/** Categories for sources filter */\r\nconst SOURCE_CATEGORIES: Record<string, \"Databases\" | \"Warehouses\" | \"Files\" | \"Streams\" | \"APIs\"> = {\r\n  mysql: \"Databases\",\r\n  azuresql: \"Databases\",\r\n  sqlserver: \"Databases\",\r\n  postgresql: \"Databases\",\r\n  \"aws-rds\": \"Databases\",\r\n  snowflake: \"Warehouses\",\r\n  bigquery: \"Warehouses\",\r\n  adls: \"Files\",\r\n  s3: \"Files\",\r\n  gcs: \"Files\",\r\n  csv: \"Files\",\r\n  sheets: \"Files\",\r\n  kafka: \"Streams\",\r\n  eventhub: \"Streams\",\r\n  rest: \"APIs\",\r\n  sftp: \"APIs\",\r\n};\r\n\r\n/* ---------- small utils ---------- */\r\nfunction formatTimeAgo(iso?: string) {\r\n  if (!iso) return \"‚Äî\";\r\n  const d = new Date(iso);\r\n  const diff = Math.max(0, Date.now() - d.getTime());\r\n  const mins = Math.floor(diff / 60000);\r\n  if (mins < 1) return \"just now\";\r\n  if (mins < 60) return `${mins}m ago`;\r\n  const hours = Math.floor(mins / 60);\r\n  if (hours < 24) return `${hours}h ago`;\r\n  const days = Math.floor(hours / 24);\r\n  return `${days}d ago`;\r\n}\r\n\r\ntype DatasetMeta = { rows?: number; updatedAt?: string };\r\ntype KPI = { id: string; name: string; url: string; createdAt: string };\r\n\r\nexport default function WarehousePage() {\r\n  const [tab, setTab] = useState<Tab>(\"datasets\");\r\n\r\n  // Connect Source modal\r\n  const [openConnect, setOpenConnect] = useState(false);\r\n\r\n  // Datasets (CSV wired)\r\n  const [datasets, setDatasets] = useState<string[]>([]);\r\n  const [loadingList, setLoadingList] = useState(false);\r\n  const [qDatasets, setQDatasets] = useState(\"\");\r\n\r\n  // Per-file metadata (rows, last updated) stored locally\r\n  const [meta, setMeta] = useState<Record<string, DatasetMeta>>({});\r\n\r\n  // Source capacity (CSV used updates from backend)\r\n  const [capacity, setCapacity] = useState(() =>\r\n    Object.entries(SOURCE_LIMITS).map(([id, v]) => ({\r\n      id,\r\n      label: v.label,\r\n      used: v.used ?? 0,\r\n      limit: v.limit,\r\n    }))\r\n  );\r\n\r\n  // Jobs\r\n  const [jobs, setJobs] = useState<Job[]>([]);\r\n  const [openCreateJob, setOpenCreateJob] = useState(false);\r\n\r\n  // Source Explorer (browsing DB connections/schemas/tables)\r\n  const [openExplorer, setOpenExplorer] = useState(false);\r\n  const [explorerEngine, setExplorerEngine] = useState<string>(\"mysql\");\r\n\r\n  // SQL datasets (from connections + Superset sync)\r\n  const [datasetsSql, setDatasetsSql] = useState<SqlDataset[]>([]);\r\n\r\n  // KPIs saved for dashboard (Superset chart URLs)\r\n  const [kpis, setKpis] = useState<KPI[]>([]);\r\n  const [kpiName, setKpiName] = useState(\"\");\r\n  const [kpiUrl, setKpiUrl] = useState(\"\");\r\n\r\n  // Superset embed + sync\r\n  const SUP_DATASET_ADD_URL = \"http://localhost:8088/dataset/add/\";\r\n  const [supersetLoaded, setSupersetLoaded] = useState(false);\r\n  const [supersetHint, setSupersetHint] = useState<string | null>(null);\r\n  const iframeRef = useRef<HTMLIFrameElement | null>(null);\r\n  const pollRef = useRef<NodeJS.Timeout | null>(null);\r\n  const pollStopAtRef = useRef<number>(0);\r\n\r\n  /** Load CSV datasets and update CSV used count */\r\n  async function loadCsvDatasetsAndCapacity() {\r\n    setLoadingList(true);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/list_csv`, { credentials: \"include\" });\r\n      const data = await res.json().catch(() => ({}));\r\n      const files: string[] = res.ok && Array.isArray(data?.files) ? data.files : [];\r\n      setDatasets(files);\r\n      setCapacity((prev) => prev.map((e) => (e.id === \"csv\" ? { ...e, used: files.length } : e)));\r\n    } catch {/* noop */} finally {\r\n      setLoadingList(false);\r\n    }\r\n  }\r\n\r\n  /** Local meta */\r\n  function loadMeta() {\r\n    try {\r\n      const raw = localStorage.getItem(\"nex_dataset_meta\");\r\n      if (raw) setMeta(JSON.parse(raw));\r\n    } catch {}\r\n  }\r\n  function saveMeta(next: Record<string, DatasetMeta>) {\r\n    setMeta(next);\r\n    try {\r\n      localStorage.setItem(\"nex_dataset_meta\", JSON.stringify(next));\r\n    } catch {}\r\n  }\r\n\r\n  /** Jobs */\r\n  function loadJobs() {\r\n    try {\r\n      const raw = localStorage.getItem(\"nex_jobs\");\r\n      if (raw) setJobs(JSON.parse(raw));\r\n    } catch {}\r\n  }\r\n  function saveJobs(next: Job[]) {\r\n    setJobs(next);\r\n    try {\r\n      localStorage.setItem(\"nex_jobs\", JSON.stringify(next));\r\n    } catch {}\r\n  }\r\n\r\n  /** SQL datasets local */\r\n  function loadSqlDatasets() {\r\n    try {\r\n      const raw = localStorage.getItem(\"nex_datasets_sql\");\r\n      if (raw) setDatasetsSql(JSON.parse(raw));\r\n    } catch {}\r\n  }\r\n  function saveSqlDatasets(next: SqlDataset[]) {\r\n    setDatasetsSql(next);\r\n    try {\r\n      localStorage.setItem(\"nex_datasets_sql\", JSON.stringify(next));\r\n    } catch {}\r\n  }\r\n\r\n  /** KPIs local */\r\n  function loadKpis() {\r\n    try {\r\n      const raw = localStorage.getItem(\"nex_dashboard_kpis\");\r\n      if (raw) setKpis(JSON.parse(raw));\r\n    } catch {}\r\n  }\r\n  function saveKpis(next: KPI[]) {\r\n    setKpis(next);\r\n    try {\r\n      localStorage.setItem(\"nex_dashboard_kpis\", JSON.stringify(next));\r\n    } catch {}\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadCsvDatasetsAndCapacity();\r\n    loadMeta();\r\n    loadJobs();\r\n    loadSqlDatasets();\r\n    loadKpis();\r\n  }, []);\r\n\r\n  const filteredCsv = useMemo(() => {\r\n    const s = qDatasets.trim().toLowerCase();\r\n    if (!s) return datasets;\r\n    return datasets.filter((f) => f.toLowerCase().includes(s));\r\n  }, [datasets, qDatasets]);\r\n\r\n  const filteredSql = useMemo(() => {\r\n    const s = qDatasets.trim().toLowerCase();\r\n    if (!s) return datasetsSql;\r\n    return datasetsSql.filter((d) => {\r\n      const name = d.schema ? `${d.connName}.${d.schema}.${d.table}` : `${d.connName}.${d.table}`;\r\n      return (\r\n        name.toLowerCase().includes(s) ||\r\n        (d.engine || \"\").toLowerCase().includes(s) ||\r\n        (d.connName || \"\").toLowerCase().includes(s)\r\n      );\r\n    });\r\n  }, [datasetsSql, qDatasets]);\r\n\r\n  // Derive \"in-use\" connections\r\n  const usedConnections = useMemo(() => {\r\n    const m = new Map<number, { id: number; name: string; engine: string }>();\r\n    for (const d of datasetsSql) {\r\n      if (!m.has(d.connId)) m.set(d.connId, { id: d.connId, name: d.connName, engine: d.engine });\r\n    }\r\n    return Array.from(m.values());\r\n  }, [datasetsSql]);\r\n\r\n  // Jobs metrics\r\n  const totalJobs = jobs.length;\r\n  const activeJobs = jobs.filter((j) => j.active).length;\r\n  const errorJobs = jobs.filter((j) => j.lastRunStatus === \"error\").length;\r\n\r\n  // Info popover state for Sources tab\r\n  const [showInfo, setShowInfo] = useState(false);\r\n  const infoBtnRef = useRef<HTMLButtonElement | null>(null);\r\n  useEffect(() => {\r\n    function onDoc(e: MouseEvent) {\r\n      if (showInfo && infoBtnRef.current && !infoBtnRef.current.contains(e.target as Node)) {\r\n        setShowInfo(false);\r\n      }\r\n    }\r\n    document.addEventListener(\"click\", onDoc);\r\n    return () => document.removeEventListener(\"click\", onDoc);\r\n  }, [showInfo]);\r\n\r\n  /** ---- Superset datasets sync ----\r\n   * Expects a backend endpoint: GET /superset/datasets\r\n   * Return shape example:\r\n   * { result: [{ id, table_name, schema, database: { id, database_name, engine } }, ...] }\r\n   */\r\n  async function syncSupersetDatasets() {\r\n    try {\r\n      const r = await fetch(`${API_BASE}/superset/datasets`, { credentials: \"include\" });\r\n      const data = await r.json().catch(() => ({}));\r\n      const items = Array.isArray(data?.result) ? data.result : [];\r\n\r\n      if (items.length === 0) return;\r\n\r\n      const next = [...datasetsSql];\r\n      const seen = new Set(next.map(d => d.id));\r\n\r\n      for (const it of items) {\r\n        const db = it.database || {};\r\n        const dbId = Number(db.id);\r\n        const schema = it.schema || \"\";\r\n        const table = it.table_name || it.table || it.datasource_name || \"\";\r\n        const connName = db.database_name || \"DB\";\r\n        const engine = db.engine || \"\";\r\n\r\n        if (!dbId || !table) continue;\r\n\r\n        const id = `${dbId}:${schema || \"\"}:${table}`;\r\n        if (!seen.has(id)) {\r\n          next.push({\r\n            id,\r\n            connId: dbId,\r\n            connName,\r\n            engine,\r\n            schema: schema || undefined,\r\n            table,\r\n            addedAt: new Date().toISOString(),\r\n          });\r\n          seen.add(id);\r\n        }\r\n      }\r\n      if (next.length !== datasetsSql.length) {\r\n        saveSqlDatasets(next);\r\n      }\r\n    } catch (e) {\r\n      // noop; show manual hint in UI if needed\r\n    }\r\n  }\r\n\r\n  // When Sources tab becomes active, attempt to embed + start short auto-sync polling\r\n  useEffect(() => {\r\n    if (tab !== \"sources\") {\r\n      setSupersetHint(null);\r\n      setSupersetLoaded(false);\r\n      if (pollRef.current) { clearInterval(pollRef.current); pollRef.current = null; }\r\n      return;\r\n    }\r\n\r\n    // Show hint if iframe didn't load after 3s\r\n    const hintTimer = setTimeout(() => {\r\n      if (!supersetLoaded) {\r\n        setSupersetHint(\r\n          \"If this embed is blank or blocked, allow framing in Superset (X-Frame-Options / CSP) for your Next.js origin.\"\r\n        );\r\n      }\r\n    }, 3000);\r\n\r\n    // Kick off an initial sync and then poll for a short window (e.g., 2 minutes)\r\n    syncSupersetDatasets();\r\n    pollStopAtRef.current = Date.now() + 2 * 60 * 1000; // stop in 2 minutes\r\n    if (pollRef.current) clearInterval(pollRef.current);\r\n    pollRef.current = setInterval(() => {\r\n      if (Date.now() > pollStopAtRef.current) {\r\n        if (pollRef.current) { clearInterval(pollRef.current); pollRef.current = null; }\r\n        return;\r\n      }\r\n      syncSupersetDatasets();\r\n    }, 8000);\r\n\r\n    return () => {\r\n      clearTimeout(hintTimer);\r\n      if (pollRef.current) { clearInterval(pollRef.current); pollRef.current = null; }\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [tab]);\r\n\r\n  return (\r\n    <main className=\"min-h-dvh bg-gray-950 text-white\">\r\n      {/* Global sticky navigation (logo links to Dashboard) */}\r\n      <TopNav variant=\"dashboard\" />\r\n\r\n      {/* Page content */}\r\n      <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\r\n        {/* Title + primary action */}\r\n        <div className=\"flex items-center justify-between gap-3\">\r\n          <h1 className=\"text-2xl font-semibold\">Warehouse</h1>\r\n          <button\r\n            onClick={() => setOpenConnect(true)}\r\n            className=\"rounded-lg bg-indigo-500/90 hover:bg-indigo-500 px-3 py-2 text-sm\"\r\n          >\r\n            Connect Source\r\n          </button>\r\n        </div>\r\n\r\n        {/* Tabs */}\r\n        <div className=\"border-b border-white/10\">\r\n          <div className=\"flex gap-2\">\r\n            {([\"datasets\", \"sources\", \"jobs\"] as const).map((t) => (\r\n              <button\r\n                key={t}\r\n                onClick={() => setTab(t)}\r\n                className={`px-3 py-2 text-sm rounded-lg my-2 ${\r\n                  tab === t ? \"bg-white/15\" : \"hover:bg-white/10 text-white/80\"\r\n                }`}\r\n              >\r\n                {t[0].toUpperCase() + t.slice(1)}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Minimal overview */}\r\n        <section className=\"rounded-2xl border border-white/10 bg-white/5 p-5\">\r\n          <div className=\"text-sm text-white/60\">Overview</div>\r\n          <div className=\"mt-4 grid grid-cols-4 gap-4\">\r\n            <Metric label=\"Datasets\" value={String(filteredCsv.length + filteredSql.length)} />\r\n            <Metric label=\"Last run\" value=\"‚Äî\" />\r\n            <Metric label=\"Errors\" value=\"0\" />\r\n            <Metric label=\"Status\" value=\"OK\" />\r\n          </div>\r\n        </section>\r\n\r\n        {/* ---- DATASETS TAB (CSV + SQL tables) ---- */}\r\n        {tab === \"datasets\" && (\r\n          <section className=\"rounded-2xl border border-white/10 bg-white/5 overflow-hidden\">\r\n            <div className=\"p-4 border-b border-white/10 flex items-center justify-between gap-3\">\r\n              <div className=\"font-semibold\">Datasets</div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <input\r\n                  value={qDatasets}\r\n                  onChange={(e) => setQDatasets(e.target.value)}\r\n                  placeholder=\"Search datasets‚Ä¶\"\r\n                  className=\"rounded-md bg-white/10 border border-white/10 px-2.5 py-1.5 text-sm outline-none\"\r\n                />\r\n                <button\r\n                  onClick={async () => {\r\n                    await loadCsvDatasetsAndCapacity();\r\n                    loadMeta();\r\n                    loadSqlDatasets();\r\n                    // Also pull any fresh Superset datasets\r\n                    await syncSupersetDatasets();\r\n                  }}\r\n                  className=\"rounded-md bg-white/10 hover:bg-white/20 px-3 py-1.5 text-sm\"\r\n                >\r\n                  Refresh\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {loadingList ? (\r\n              <div className=\"p-6 text-sm text-white/60\">Loading‚Ä¶</div>\r\n            ) : filteredCsv.length + filteredSql.length === 0 ? (\r\n              <div className=\"p-6 text-sm text-white/60\">\r\n                No datasets yet. Use <b>Sources</b> to register SQL datasets, or upload a <b>CSV</b>.\r\n              </div>\r\n            ) : (\r\n              <div className=\"divide-y divide-white/10\">\r\n                {/* Columns: Name | Source | Type | Rows | Last Updated */}\r\n                <Row cols={[\"Name\", \"Source\", \"Type\", \"Rows\", \"Last Updated\"]} head />\r\n\r\n                {/* CSV */}\r\n                {filteredCsv.map((fname) => {\r\n                  const m = meta[fname];\r\n                  return (\r\n                    <Row\r\n                      key={`csv:${fname}`}\r\n                      cols={[\r\n                        fname,\r\n                        \"CSV\",\r\n                        \"File\",\r\n                        m?.rows !== undefined ? String(m.rows) : \"‚Äî\",\r\n                        formatTimeAgo(m?.updatedAt),\r\n                      ]}\r\n                    />\r\n                  );\r\n                })}\r\n\r\n                {/* SQL tables */}\r\n                {filteredSql.map((s) => {\r\n                  const displayName = s.schema ? `${s.connName}.${s.schema}.${s.table}` : `${s.connName}.${s.table}`;\r\n                  return (\r\n                    <Row\r\n                      key={`sql:${s.id}`}\r\n                      cols={[\r\n                        displayName,\r\n                        s.connName || s.engine?.toUpperCase() || \"SQL\",\r\n                        \"SQL Table\",\r\n                        s.rows !== undefined ? String(s.rows) : \"‚Äî\",\r\n                        formatTimeAgo(s.addedAt),\r\n                      ]}\r\n                    />\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </section>\r\n        )}\r\n\r\n        {/* ---- SOURCES TAB (embedded Superset Dataset Picker) ---- */}\r\n        {tab === \"sources\" && (\r\n          <section className=\"rounded-2xl border border-white/10 bg-white/5 p-0 overflow-hidden\">\r\n            {/* Header / Actions */}\r\n            <div className=\"p-4 border-b border-white/10 flex items-center justify-between gap-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <h2 className=\"text-lg font-semibold\">Sources</h2>\r\n                <div className=\"relative\">\r\n                  <button\r\n                    ref={infoBtnRef}\r\n                    onClick={(e) => { e.stopPropagation(); setShowInfo((v) => !v); }}\r\n                    className=\"size-6 rounded-full border border-white/20 text-xs text-white/80 hover:bg-white/10\"\r\n                    title=\"Notes\"\r\n                  >\r\n                    i\r\n                  </button>\r\n                  {showInfo && (\r\n                    <div className=\"absolute left-0 top-8 w-96 rounded-lg border border-white/10 bg-gray-900 p-3 text-sm shadow-xl z-10\">\r\n                      <div className=\"text-white/70\">\r\n                        This tab embeds Superset‚Äôs <b>Dataset Picker</b>. Create datasets here. We‚Äôll auto-sync them for 2 minutes,\r\n                        and you can also click <b>Sync from Superset</b> anytime to pull newly created datasets.\r\n                        If the embed is blank, allow framing in Superset (X-Frame-Options / CSP).\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  onClick={() => syncSupersetDatasets()}\r\n                  className=\"rounded-md bg-white/10 hover:bg-white/20 px-3 py-1.5 text-sm\"\r\n                >\r\n                  Sync from Superset\r\n                </button>\r\n                <button\r\n                  onClick={() => setOpenConnect(true)}\r\n                  className=\"rounded-md bg-indigo-500/90 hover:bg-indigo-500 px-3 py-1.5 text-sm\"\r\n                >\r\n                  Connect Source\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Embed area */}\r\n            <div className=\"h-[70vh] relative\">\r\n              {!supersetLoaded && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                  <div className=\"rounded-lg border border-white/10 bg-white/5 px-4 py-2 text-sm text-white/70\">\r\n                    Loading Superset Dataset Picker‚Ä¶\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <iframe\r\n                ref={iframeRef}\r\n                src={SUP_DATASET_ADD_URL}\r\n                className=\"w-full h-full border-0\"\r\n                // The sandbox below is permissive enough for Superset UI; tweak if needed.\r\n                sandbox=\"allow-same-origin allow-forms allow-scripts allow-popups allow-modals allow-downloads\"\r\n                onLoad={() => setSupersetLoaded(true)}\r\n              />\r\n            </div>\r\n\r\n            {/* Embed hint / troubleshooting */}\r\n            {supersetHint && (\r\n              <div className=\"p-3 text-xs text-amber-300 border-t border-white/10 bg-amber-950/20\">\r\n                {supersetHint}\r\n              </div>\r\n            )}\r\n\r\n            {/* In-use connections (derived from saved SQL datasets) */}\r\n            <div className=\"p-4 border-t border-white/10\">\r\n              <div className=\"font-semibold mb-2\">Connections in Use</div>\r\n              {usedConnections.length === 0 ? (\r\n                <div className=\"text-sm text-white/60\">No connections in use yet.</div>\r\n              ) : (\r\n                <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                  {usedConnections.map((c) => (\r\n                    <div key={c.id} className=\"rounded-lg border border-white/10 bg-white/5 p-3\">\r\n                      <div className=\"text-sm font-medium truncate\">{c.name}</div>\r\n                      <div className=\"text-xs text-white/60 mt-1 uppercase\">{c.engine}</div>\r\n                      <div className=\"mt-2\">\r\n                        <button\r\n                          className=\"rounded-md bg-white/10 hover:bg-white/20 px-2 py-1 text-xs\"\r\n                          onClick={() => { setExplorerEngine(c.engine); setOpenExplorer(true); }}\r\n                        >\r\n                          Explore\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Quick add KPI from Superset to Dashboard */}\r\n            <div className=\"p-4 border-t border-white/10\">\r\n              <div className=\"font-semibold mb-2\">Add KPI to Dashboard (from Superset)</div>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"text-xs text-white/60\">\r\n                  In Superset, open a chart and copy its URL (Explore permalink or chart view). Paste it below to add to your Dashboard.\r\n                </div>\r\n                <div className=\"flex flex-col sm:flex-row gap-2\">\r\n                  <input\r\n                    value={kpiName}\r\n                    onChange={(e) => setKpiName(e.target.value)}\r\n                    placeholder=\"KPI name (e.g., Monthly Revenue)\"\r\n                    className=\"flex-1 rounded-md bg-white/10 border border-white/10 px-2.5 py-1.5 text-sm outline-none\"\r\n                  />\r\n                  <input\r\n                    value={kpiUrl}\r\n                    onChange={(e) => setKpiUrl(e.target.value)}\r\n                    placeholder=\"Paste Superset chart URL\"\r\n                    className=\"flex-[2] rounded-md bg-white/10 border border-white/10 px-2.5 py-1.5 text-sm outline-none\"\r\n                  />\r\n                  <button\r\n                    className=\"rounded-md bg-indigo-500/90 hover:bg-indigo-500 px-3 py-1.5 text-sm\"\r\n                    onClick={() => {\r\n                      if (!kpiName.trim() || !kpiUrl.trim()) return;\r\n                      const next: KPI[] = [\r\n                        ...kpis,\r\n                        { id: `${Date.now()}`, name: kpiName.trim(), url: kpiUrl.trim(), createdAt: new Date().toISOString() },\r\n                      ];\r\n                      saveKpis(next);\r\n                      setKpiName(\"\");\r\n                      setKpiUrl(\"\");\r\n                    }}\r\n                  >\r\n                    Save to Dashboard\r\n                  </button>\r\n                </div>\r\n\r\n                {kpis.length > 0 && (\r\n                  <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                    {kpis.map((k) => (\r\n                      <div key={k.id} className=\"rounded-lg border border-white/10 bg-white/5 p-3\">\r\n                        <div className=\"text-sm font-medium\">{k.name}</div>\r\n                        <div className=\"text-xs text-white/60 truncate mt-1\">{k.url}</div>\r\n                        <div className=\"mt-2 flex gap-2\">\r\n                          <a\r\n                            href={k.url}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"rounded-md bg-white/10 hover:bg-white/20 px-2 py-1 text-xs\"\r\n                          >\r\n                            Open\r\n                          </a>\r\n                          <button\r\n                            className=\"rounded-md bg-white/10 hover:bg-white/20 px-2 py-1 text-xs\"\r\n                            onClick={() => {\r\n                              const next = kpis.filter((x) => x.id !== k.id);\r\n                              saveKpis(next);\r\n                            }}\r\n                          >\r\n                            Remove\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </section>\r\n        )}\r\n\r\n        {/* ---- JOBS TAB ---- */}\r\n        {tab === \"jobs\" && (\r\n          <section className=\"rounded-2xl border border-white/10 bg-white/5 overflow-hidden\">\r\n            <div className=\"p-4 border-b border-white/10 flex items-center justify-between\">\r\n              <div className=\"font-semibold\">Jobs</div>\r\n              <button\r\n                onClick={() => setOpenCreateJob(true)}\r\n                className=\"rounded-lg bg-indigo-500/90 hover:bg-indigo-500 px-3 py-2 text-sm\"\r\n                title=\"Create Job\"\r\n              >\r\n                Create Job\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"p-4 grid grid-cols-3 gap-4\">\r\n              <Metric label=\"Total Jobs\" value={String(totalJobs)} />\r\n              <Metric label=\"Active Jobs\" value={String(activeJobs)} />\r\n              <Metric label=\"Errors\" value={String(errorJobs)} />\r\n            </div>\r\n\r\n            <div className=\"divide-y divide-white/10\">\r\n              <Row cols={[\"Name\", \"Source\", \"Type\", \"Schedule\", \"Status\", \"Last Run\"]} head />\r\n              {jobs.length === 0 ? (\r\n                <div className=\"p-6 text-sm text-white/60\">\r\n                  No jobs yet. Use <b>Create Job</b> to keep your data up to date.\r\n                </div>\r\n              ) : (\r\n                jobs.map((j) => (\r\n                  <div key={j.id} className=\"grid\" style={{ gridTemplateColumns: `repeat(6, minmax(0,1fr))` }}>\r\n                    <Cell>{j.name}</Cell>\r\n                    <Cell>{j.sourceName ?? j.sourceType.toUpperCase()}</Cell>\r\n                    <Cell className=\"uppercase\">{j.sourceType}</Cell>\r\n                    <Cell>{j.scheduleHuman ?? j.scheduleCron ?? \"‚Äî\"}</Cell>\r\n                    <Cell>\r\n                      <span className={`px-2 py-0.5 rounded text-xs ${j.active ? \"bg-green-500/20 text-green-300\" : \"bg-white/10 text-white/70\"}`}>\r\n                        {j.active ? \"Active\" : \"Paused\"}\r\n                      </span>\r\n                    </Cell>\r\n                    <Cell>\r\n                      {j.lastRunStatus === \"ok\" && <span className=\"text-green-300 text-sm\">OK</span>}\r\n                      {j.lastRunStatus === \"error\" && <span className=\"text-red-300 text-sm\">Error</span>}\r\n                      {j.lastRunStatus === \"never\" && <span className=\"text-white/60 text-sm\">Never</span>}\r\n                    </Cell>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </div>\r\n          </section>\r\n        )}\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      <InjectDataModal\r\n        open={openConnect}\r\n        onClose={() => setOpenConnect(false)}\r\n        onCsvUploaded={async (p) => {\r\n          const next = { ...meta, [p.filename]: { rows: p.rows, updatedAt: new Date().toISOString() } };\r\n          saveMeta(next);\r\n          await loadCsvDatasetsAndCapacity();\r\n        }}\r\n      />\r\n      <JobCreateModal\r\n        open={openCreateJob}\r\n        onClose={() => setOpenCreateJob(false)}\r\n        onCreate={(job) => {\r\n          const next = [...jobs, job];\r\n          saveJobs(next);\r\n          setOpenCreateJob(false);\r\n        }}\r\n      />\r\n\r\n      {/* Explorer Drawer (optional browsing) */}\r\n      <SourceExplorerDrawer\r\n        open={openExplorer}\r\n        engine={explorerEngine}\r\n        onClose={() => setOpenExplorer(false)}\r\n        onAddDataset={(d) => {\r\n          const exists = datasetsSql.some((x) => x.id === d.id);\r\n          if (!exists) {\r\n            const next = [...datasetsSql, d];\r\n            saveSqlDatasets(next);\r\n          }\r\n          setOpenExplorer(false);\r\n          setTab(\"datasets\");\r\n        }}\r\n      />\r\n    </main>\r\n  );\r\n}\r\n\r\nfunction Metric({ label, value }: { label: string; value: string }) {\r\n  return (\r\n    <div className=\"rounded-xl border border-white/10 bg-white/5 p-4\">\r\n      <div className=\"text-xs text-white/60\">{label}</div>\r\n      <div className=\"text-xl font-semibold mt-1\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Row({ cols, head = false }: { cols: string[]; head?: boolean }) {\r\n  return (\r\n    <div className={`${head ? \"bg-white/5 text-white/70\" : \"\"} grid`} style={{ gridTemplateColumns: `repeat(${cols.length}, minmax(0,1fr))` }}>\r\n      {cols.map((c, i) => (\r\n        <div key={i} className=\"px-4 py-3 text-sm\">{c}</div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\nfunction Cell({ children, className = \"\" }: { children: React.ReactNode; className?: string }) {\r\n  return <div className={`px-4 py-3 text-sm ${className}`}>{children}</div>;\r\n}\r\n","size_bytes":28846},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { storage } from \"./storage\";\nimport { setupAuth, requireAuth } from \"./auth\";\nimport { \n  analyzeDataWithAI, \n  transcribeAudio, \n  parseCSVFile, \n  generateKPIFromQuestion \n} from \"./ai\";\nimport { analyzeDataWithPrivacy } from \"./ai-privacy\";\nimport {\n  testConnection,\n  encryptConnectionConfig,\n  sanitizeConnectionConfig,\n  DatabaseConnectionSchema,\n  ApiConnectionSchema,\n  SftpConnectionSchema\n} from \"./connectors\";\nimport { \n  insertDataSourceSchema, \n  insertAiQuerySchema, \n  insertKpiSchema, \n  insertChartSchema,\n  insertDashboardChartSchema,\n  insertViewSchema,\n  insertDashboardSchema,\n  DatabaseConnectionConfig \n} from \"@shared/schema\";\nimport { DatabaseConnectorService } from './services/database-connectors';\n\n/**\n * Execute a user's SQL query by determining the appropriate database connection\n */\nasync function executeUserSQLQuery(sqlQuery: string, userId: string): Promise<any> {\n  console.log('Executing user SQL query:', sqlQuery);\n\n  // Get all table datasets for this user\n  const dataSources = await storage.getDataSources(userId);\n  const tableDatasets = dataSources.filter((ds: any) => ds.metadata?.isTableDataset);\n\n  if (tableDatasets.length === 0) {\n    throw new Error('No table datasets available for query execution');\n  }\n\n  // For now, use the first table dataset's connection (we can improve this later with query parsing)\n  // In a real implementation, we would parse the SQL to identify which tables are being queried\n  // and select the appropriate connection(s)\n  const firstTableDataset = tableDatasets[0];\n  const metadata = firstTableDataset.metadata as any;\n\n  // Get connection configuration from metadata\n  const connectionConfig = {\n    host: metadata.host,\n    port: metadata.port,\n    database: metadata.database,\n    username: metadata.username,\n    password: metadata.password\n  };\n\n  // Execute query using DatabaseConnectorService\n  const result = await DatabaseConnectorService.executeQuery(\n    metadata.connectionType || firstTableDataset.type,\n    connectionConfig,\n    sqlQuery\n  );\n\n  return result;\n}\n\n// Configure multer for file uploads\nconst upload = multer({\n  storage: multer.diskStorage({\n    destination: (req, file, cb) => {\n      const uploadDir = path.join(process.cwd(), 'uploads');\n      if (!fs.existsSync(uploadDir)) {\n        fs.mkdirSync(uploadDir, { recursive: true });\n      }\n      cb(null, uploadDir);\n    },\n    filename: (req, file, cb) => {\n      const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n      cb(null, `${uniqueSuffix}-${file.originalname}`);\n    }\n  }),\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB limit\n  },\n  fileFilter: (req, file, cb) => {\n    if (file.mimetype === 'text/csv' || \n        file.mimetype === 'application/vnd.ms-excel' ||\n        file.originalname.endsWith('.csv')) {\n      cb(null, true);\n    } else {\n      cb(new Error('Only CSV files are allowed'));\n    }\n  }\n});\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup authentication\n  setupAuth(app);\n\n  // Data source endpoints\n  app.get('/api/data-sources', requireAuth, async (req: any, res) => {\n    try {\n      const dataSources = await storage.getDataSources(req.user.id);\n      res.json(dataSources);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch data sources' });\n    }\n  });\n\n  app.post('/api/data-sources/upload', requireAuth, upload.single('file'), async (req: any, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: 'No file uploaded' });\n      }\n\n      const filePath = req.file.path;\n      \n      // Parse CSV to get metadata\n      const csvData = await parseCSVFile(filePath);\n      const columns = csvData.length > 0 ? Object.keys(csvData[0]) : [];\n\n      const dataSource = await storage.createDataSource({\n        userId: req.user.id,\n        name: req.file.originalname,\n        type: 'csv',\n        filename: req.file.filename,\n        size: req.file.size,\n        rowCount: csvData.length,\n        columnCount: columns.length,\n        status: 'ready',\n        metadata: {\n          columns,\n          sampleData: csvData.slice(0, 3)\n        }\n      });\n\n      res.json(dataSource);\n    } catch (error) {\n      console.error('Upload error:', error);\n      res.status(500).json({ message: 'Failed to upload file' });\n    }\n  });\n\n  app.delete('/api/data-sources/:id', requireAuth, async (req: any, res) => {\n    try {\n      const dataSource = await storage.getDataSource(req.params.id);\n      \n      if (!dataSource || dataSource.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Data source not found' });\n      }\n\n      // Delete physical file if it exists\n      if (dataSource.filename) {\n        const filePath = path.join(process.cwd(), 'uploads', dataSource.filename);\n        if (fs.existsSync(filePath)) {\n          fs.unlinkSync(filePath);\n        }\n      }\n\n      await storage.deleteDataSource(req.params.id);\n      res.json({ message: 'Data source deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete data source' });\n    }\n  });\n\n  app.get('/api/data-sources/:id/columns', requireAuth, async (req: any, res) => {\n    try {\n      const dataSource = await storage.getDataSource(req.params.id);\n      \n      if (!dataSource || dataSource.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Data source not found' });\n      }\n\n      // Extract columns from metadata\n      const metadata = dataSource.metadata as any;\n      let columns: string[] = [];\n\n      if (metadata?.columns) {\n        columns = metadata.columns;\n      } else if (metadata?.schema) {\n        // For database tables, extract column names from schema\n        columns = metadata.schema.map((col: any) => col.name || col.column_name);\n      }\n\n      res.json({ columns });\n    } catch (error) {\n      console.error('Get columns error:', error);\n      res.status(500).json({ message: 'Failed to fetch columns' });\n    }\n  });\n\n  app.get('/api/data-sources/:id/preview', requireAuth, async (req: any, res) => {\n    try {\n      const dataSource = await storage.getDataSource(req.params.id);\n      \n      if (!dataSource || dataSource.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Data source not found' });\n      }\n\n      const limit = Math.min(parseInt(req.query.limit as string) || 50, 100);\n\n      // Use semantic layer - just get raw data without aggregation for preview\n      const { ChartQueryService } = await import('./services/chart-query-service');\n      \n      const data = await ChartQueryService.executeChartQuery({\n        chartId: 'preview',\n        chartType: 'table', // Use table type to get raw data\n        config: { limit: limit.toString() },\n        dataSource,\n        limit\n      });\n\n      res.json({ data });\n    } catch (error) {\n      console.error('Preview data fetch error:', error);\n      res.status(500).json({ message: 'Failed to fetch preview data' });\n    }\n  });\n\n  // Cache management endpoints\n  app.get('/api/cache/stats', requireAuth, async (req: any, res) => {\n    try {\n      const { queryCache } = await import('./services/query-cache');\n      const stats = await queryCache.getStats();\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to get cache stats' });\n    }\n  });\n\n  app.post('/api/cache/clear', requireAuth, async (req: any, res) => {\n    try {\n      const { queryCache } = await import('./services/query-cache');\n      await queryCache.clear();\n      res.json({ message: 'Cache cleared successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to clear cache' });\n    }\n  });\n\n  // Connector endpoints\n  app.post('/api/connectors/test', requireAuth, async (req: any, res) => {\n    try {\n      const config = req.body;\n      \n      // Validate configuration based on type\n      let validatedConfig;\n      try {\n        if (config.type === 'sftp') {\n          validatedConfig = SftpConnectionSchema.parse(config);\n        } else if (['rest', 'graphql', 'webhook'].includes(config.type)) {\n          validatedConfig = ApiConnectionSchema.parse(config);\n        } else {\n          validatedConfig = DatabaseConnectionSchema.parse(config);\n          \n          // Additional validation for database types requiring specific fields\n          const dbType = validatedConfig.type;\n          if (['mysql', 'postgresql', 'sqlserver'].includes(dbType)) {\n            if (!validatedConfig.host) {\n              return res.status(400).json({ message: `Host is required for ${dbType}` });\n            }\n            if (!validatedConfig.username) {\n              return res.status(400).json({ message: `Username is required for ${dbType}` });\n            }\n            if (!validatedConfig.password) {\n              return res.status(400).json({ message: `Password is required for ${dbType}` });\n            }\n            if (['mysql', 'postgresql'].includes(dbType) && !validatedConfig.database) {\n              return res.status(400).json({ message: `Database name is required for ${dbType}` });\n            }\n          } else if (dbType === 'sqlite') {\n            if (!validatedConfig.database) {\n              return res.status(400).json({ message: 'Database file path is required for SQLite' });\n            }\n          } else if (['mongodb', 'redis'].includes(dbType)) {\n            if (!validatedConfig.host) {\n              return res.status(400).json({ message: `Host is required for ${dbType}` });\n            }\n          }\n        }\n      } catch (validationError: any) {\n        return res.status(400).json({ \n          message: 'Invalid configuration',\n          errors: validationError.errors \n        });\n      }\n\n      // Test the connection\n      console.log(`Testing ${validatedConfig.type} connection to ${(validatedConfig as any).host}:${(validatedConfig as any).port || 'default'}`);\n      const result = await testConnection(validatedConfig);\n      \n      if (result.success) {\n        console.log('Connection test successful:', result.metadata);\n        res.json({ \n          success: true, \n          message: 'Connection successful',\n          metadata: result.metadata \n        });\n      } else {\n        console.log('Connection test failed:', result.error);\n        res.status(400).json({ \n          success: false, \n          message: result.error || 'Connection failed' \n        });\n      }\n    } catch (error: any) {\n      console.error('Connection test error:', error);\n      res.status(500).json({ \n        success: false, \n        message: 'Internal server error while testing connection' \n      });\n    }\n  });\n\n  app.post('/api/connectors', requireAuth, async (req: any, res) => {\n    try {\n      const config = req.body;\n      \n      // Validate configuration\n      let validatedConfig;\n      try {\n        if (config.type === 'sftp') {\n          validatedConfig = SftpConnectionSchema.parse(config);\n        } else if (['rest', 'graphql', 'webhook'].includes(config.type)) {\n          validatedConfig = ApiConnectionSchema.parse(config);\n        } else {\n          validatedConfig = DatabaseConnectionSchema.parse(config);\n          \n          // Additional validation for database types requiring specific fields\n          const dbType = validatedConfig.type;\n          if (['mysql', 'postgresql', 'sqlserver'].includes(dbType)) {\n            if (!validatedConfig.host) {\n              return res.status(400).json({ message: `Host is required for ${dbType}` });\n            }\n            if (!validatedConfig.username) {\n              return res.status(400).json({ message: `Username is required for ${dbType}` });\n            }\n            if (!validatedConfig.password) {\n              return res.status(400).json({ message: `Password is required for ${dbType}` });\n            }\n            if (['mysql', 'postgresql'].includes(dbType) && !validatedConfig.database) {\n              return res.status(400).json({ message: `Database name is required for ${dbType}` });\n            }\n          } else if (dbType === 'sqlite') {\n            if (!validatedConfig.database) {\n              return res.status(400).json({ message: 'Database file path is required for SQLite' });\n            }\n          } else if (['mongodb', 'redis'].includes(dbType)) {\n            if (!validatedConfig.host) {\n              return res.status(400).json({ message: `Host is required for ${dbType}` });\n            }\n          }\n        }\n      } catch (validationError: any) {\n        return res.status(400).json({ \n          message: 'Invalid configuration',\n          errors: validationError.errors \n        });\n      }\n\n      // Create data source with connector configuration\n      const dataSource = await storage.createDataSource({\n        userId: req.user.id,\n        name: validatedConfig.name,\n        type: validatedConfig.type,\n        status: 'connected',\n        connectionConfig: encryptConnectionConfig(validatedConfig),\n        metadata: {\n          connectorType: validatedConfig.type,\n          createdVia: 'connector'\n        }\n      });\n\n      // Return sanitized response (no sensitive data)\n      res.json({\n        ...dataSource,\n        connectionConfig: sanitizeConnectionConfig(validatedConfig)\n      });\n    } catch (error: any) {\n      console.error('Connector save error:', error);\n      res.status(500).json({ message: 'Failed to save connector' });\n    }\n  });\n\n  // AI query endpoints\n  app.post('/api/ai/query', requireAuth, async (req: any, res) => {\n    try {\n      const { question, dataSourceIds, dataSourceId, isVoiceQuery } = req.body;\n\n      if (!question) {\n        return res.status(400).json({ message: 'Question is required' });\n      }\n\n      // Handle backward compatibility: convert single dataSourceId to array\n      let sourceIds: string[] = [];\n      if (dataSourceIds && Array.isArray(dataSourceIds)) {\n        sourceIds = dataSourceIds;\n      } else if (dataSourceId) {\n        // Backward compatibility with old API\n        sourceIds = [dataSourceId];\n      }\n\n      // Import and use the AI Query Service\n      const { AiQueryService } = await import('./services/ai-query-service');\n      \n      const result = await AiQueryService.processQuery({\n        question,\n        dataSourceIds: sourceIds,\n        userId: req.user.id,\n        isVoiceQuery\n      });\n\n      // Save the query to history\n      const aiQuery = await storage.createAiQuery({\n        userId: req.user.id,\n        question,\n        answer: result.answer,\n        isVoiceQuery: isVoiceQuery ? 'true' : 'false',\n        dataSourceId: sourceIds.length > 0 ? sourceIds[0] : null,\n        metadata: {\n          chartData: result.chartData,\n          chartType: result.chartType,\n          sqlQuery: result.sqlQuery,\n          relationships: result.relationships,\n          ...(result.metadata || {})\n        }\n      });\n\n      res.json({\n        id: aiQuery.id,\n        question: aiQuery.question,\n        answer: aiQuery.answer,\n        chartData: result.chartData,\n        chartType: result.chartType,\n        kpiValue: result.kpiValue,\n        unit: result.unit,\n        sqlQuery: result.sqlQuery,\n        relationships: result.relationships,\n        createdAt: aiQuery.createdAt\n      });\n\n    } catch (error) {\n      console.error('AI query error:', error);\n      res.status(500).json({ message: 'Failed to process AI query' });\n    }\n  });\n\n  app.post('/api/ai/voice', requireAuth, upload.single('audio'), async (req: any, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: 'No audio file uploaded' });\n      }\n\n      const audioBuffer = fs.readFileSync(req.file.path);\n      const transcription = await transcribeAudio(audioBuffer);\n      \n      // Clean up temp file\n      fs.unlinkSync(req.file.path);\n\n      res.json({ transcription });\n    } catch (error) {\n      console.error('Voice transcription error:', error);\n      res.status(500).json({ message: 'Failed to transcribe audio' });\n    }\n  });\n\n  app.get('/api/ai/queries', requireAuth, async (req: any, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 10;\n      const queries = await storage.getAiQueries(req.user.id, limit);\n      res.json(queries);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch AI queries' });\n    }\n  });\n\n  // KPI endpoints\n  app.get('/api/kpis', requireAuth, async (req: any, res) => {\n    try {\n      const kpis = await storage.getKpis(req.user.id);\n      res.json(kpis);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch KPIs' });\n    }\n  });\n\n  app.post('/api/kpis', requireAuth, async (req: any, res) => {\n    try {\n      const validation = insertKpiSchema.safeParse({\n        ...req.body,\n        userId: req.user.id\n      });\n\n      if (!validation.success) {\n        return res.status(400).json({ message: 'Invalid KPI data' });\n      }\n\n      const kpi = await storage.createKpi(validation.data);\n      res.json(kpi);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to create KPI' });\n    }\n  });\n\n  app.post('/api/kpis/from-query', requireAuth, async (req: any, res) => {\n    try {\n      const { question, answer } = req.body;\n      \n      if (!question || !answer) {\n        return res.status(400).json({ message: 'Question and answer are required' });\n      }\n\n      const kpiData = generateKPIFromQuestion(question, answer);\n      \n      const kpi = await storage.createKpi({\n        userId: req.user.id,\n        question,\n        value: kpiData.value,\n        unit: kpiData.unit || null,\n        changePercent: null\n      });\n\n      res.json(kpi);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to create KPI from query' });\n    }\n  });\n\n  app.put('/api/kpis/:id', requireAuth, async (req: any, res) => {\n    try {\n      const kpi = await storage.getKpis(req.user.id);\n      const targetKpi = kpi.find(k => k.id === req.params.id);\n      \n      if (!targetKpi) {\n        return res.status(404).json({ message: 'KPI not found' });\n      }\n\n      const updated = await storage.updateKpi(req.params.id, req.body);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to update KPI' });\n    }\n  });\n\n  app.delete('/api/kpis/:id', requireAuth, async (req: any, res) => {\n    try {\n      const kpi = await storage.getKpis(req.user.id);\n      const targetKpi = kpi.find(k => k.id === req.params.id);\n      \n      if (!targetKpi) {\n        return res.status(404).json({ message: 'KPI not found' });\n      }\n\n      await storage.deleteKpi(req.params.id);\n      res.json({ message: 'KPI deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete KPI' });\n    }\n  });\n\n  // Dashboard endpoints\n  app.get('/api/dashboards', requireAuth, async (req: any, res) => {\n    try {\n      const dashboards = await storage.getDashboards(req.user.id);\n      \n      // Get KPI counts for each dashboard\n      const dashboardsWithCounts = await Promise.all(dashboards.map(async (dashboard) => {\n        const allKpis = await storage.getKpis(req.user.id);\n        const kpiCount = allKpis.filter(kpi => kpi.dashboardId === dashboard.id).length;\n        return {\n          ...dashboard,\n          kpiCount\n        };\n      }));\n      \n      res.json(dashboardsWithCounts);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch dashboards' });\n    }\n  });\n\n  app.get('/api/dashboards/:id', requireAuth, async (req: any, res) => {\n    try {\n      const dashboard = await storage.getDashboard(req.params.id);\n      \n      if (!dashboard || dashboard.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Dashboard not found' });\n      }\n\n      // Get KPIs for this dashboard\n      const allKpis = await storage.getKpis(req.user.id);\n      const dashboardKpis = allKpis.filter(kpi => kpi.dashboardId === dashboard.id);\n\n      res.json({\n        ...dashboard,\n        kpis: dashboardKpis\n      });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch dashboard' });\n    }\n  });\n\n  app.post('/api/dashboards', requireAuth, async (req: any, res) => {\n    try {\n      const validation = insertDashboardSchema.safeParse({\n        ...req.body,\n        userId: req.user.id\n      });\n\n      if (!validation.success) {\n        return res.status(400).json({ message: 'Invalid dashboard data' });\n      }\n\n      const dashboard = await storage.createDashboard(validation.data);\n      res.json(dashboard);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to create dashboard' });\n    }\n  });\n\n  app.put('/api/dashboards/:id', requireAuth, async (req: any, res) => {\n    try {\n      const dashboard = await storage.getDashboard(req.params.id);\n      \n      if (!dashboard || dashboard.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Dashboard not found' });\n      }\n\n      const updated = await storage.updateDashboard(req.params.id, req.body);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to update dashboard' });\n    }\n  });\n\n  app.delete('/api/dashboards/:id', requireAuth, async (req: any, res) => {\n    try {\n      const dashboard = await storage.getDashboard(req.params.id);\n      \n      if (!dashboard || dashboard.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Dashboard not found' });\n      }\n\n      await storage.deleteDashboard(req.params.id);\n      res.json({ message: 'Dashboard deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete dashboard' });\n    }\n  });\n\n  // Chart endpoints\n  app.get('/api/charts', requireAuth, async (req: any, res) => {\n    try {\n      const charts = await storage.getCharts(req.user.id);\n      res.json(charts);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch charts' });\n    }\n  });\n\n  app.post('/api/charts', requireAuth, async (req: any, res) => {\n    try {\n      const validation = insertChartSchema.safeParse({\n        ...req.body,\n        userId: req.user.id\n      });\n\n      if (!validation.success) {\n        return res.status(400).json({ message: 'Invalid chart data' });\n      }\n\n      const chart = await storage.createChart(validation.data);\n      res.json(chart);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to create chart' });\n    }\n  });\n\n  app.get('/api/charts/:id', requireAuth, async (req: any, res) => {\n    try {\n      const chart = await storage.getChart(req.params.id);\n      \n      if (!chart || chart.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Chart not found' });\n      }\n\n      res.json(chart);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch chart' });\n    }\n  });\n\n  app.get('/api/charts/:id/data', requireAuth, async (req: any, res) => {\n    try {\n      const chart = await storage.getChart(req.params.id);\n      \n      if (!chart || chart.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Chart not found' });\n      }\n\n      const dataSourceIds = chart.dataSourceIds || [];\n      if (dataSourceIds.length === 0) {\n        return res.json({ data: [] });\n      }\n\n      // Fetch data from the first data source (simplified version)\n      // In a full implementation, would support joins across multiple sources\n      const dataSource = await storage.getDataSource(dataSourceIds[0]);\n      if (!dataSource || dataSource.userId !== req.user.id) {\n        return res.json({ data: [] });\n      }\n\n      // Use semantic layer to execute query with caching\n      const { ChartQueryService } = await import('./services/chart-query-service');\n      \n      const data = await ChartQueryService.executeChartQuery({\n        chartId: chart.id,\n        chartType: chart.type,\n        config: chart.config as Record<string, any>,\n        dataSource,\n        limit: Math.min(parseInt(req.query.limit as string) || 100, 1000)\n      });\n\n      res.json({ data });\n    } catch (error) {\n      console.error('Chart data fetch error:', error);\n      res.status(500).json({ message: 'Failed to fetch chart data' });\n    }\n  });\n\n  app.put('/api/charts/:id', requireAuth, async (req: any, res) => {\n    try {\n      const chart = await storage.getChart(req.params.id);\n      \n      if (!chart || chart.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Chart not found' });\n      }\n\n      const updated = await storage.updateChart(req.params.id, req.body);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to update chart' });\n    }\n  });\n\n  app.delete('/api/charts/:id', requireAuth, async (req: any, res) => {\n    try {\n      const chart = await storage.getChart(req.params.id);\n      \n      if (!chart || chart.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Chart not found' });\n      }\n\n      await storage.deleteChart(req.params.id);\n      res.json({ message: 'Chart deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete chart' });\n    }\n  });\n\n  // Dashboard Chart endpoints\n  app.get('/api/dashboards/:dashboardId/charts', requireAuth, async (req: any, res) => {\n    try {\n      const dashboard = await storage.getDashboard(req.params.dashboardId);\n      \n      if (!dashboard || dashboard.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Dashboard not found' });\n      }\n\n      const dashboardCharts = await storage.getDashboardCharts(req.params.dashboardId);\n      \n      const chartsWithDetails = [];\n      \n      for (const dc of dashboardCharts) {\n        const chart = await storage.getChart(dc.chartId);\n        if (!chart || chart.userId !== req.user.id) {\n          await storage.deleteDashboardChart(dc.id);\n          continue;\n        }\n        chartsWithDetails.push({ ...dc, chart });\n      }\n\n      res.json(chartsWithDetails);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch dashboard charts' });\n    }\n  });\n\n  app.post('/api/dashboards/:dashboardId/charts', requireAuth, async (req: any, res) => {\n    try {\n      const dashboard = await storage.getDashboard(req.params.dashboardId);\n      \n      if (!dashboard || dashboard.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Dashboard not found' });\n      }\n\n      const validation = insertDashboardChartSchema.safeParse({\n        ...req.body,\n        dashboardId: req.params.dashboardId\n      });\n\n      if (!validation.success) {\n        return res.status(400).json({ message: 'Invalid dashboard chart data', errors: validation.error.issues });\n      }\n\n      const chart = await storage.getChart(validation.data.chartId);\n      if (!chart || chart.userId !== req.user.id) {\n        return res.status(403).json({ message: 'Chart not found or unauthorized' });\n      }\n\n      const dashboardChart = await storage.createDashboardChart(validation.data);\n      res.json(dashboardChart);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to add chart to dashboard' });\n    }\n  });\n\n  app.put('/api/dashboard-charts/:id', requireAuth, async (req: any, res) => {\n    try {\n      const dashboardChart = await storage.getDashboardChart(req.params.id);\n      \n      if (!dashboardChart) {\n        return res.status(404).json({ message: 'Dashboard chart not found' });\n      }\n\n      const dashboard = await storage.getDashboard(dashboardChart.dashboardId);\n      if (!dashboard || dashboard.userId !== req.user.id) {\n        return res.status(403).json({ message: 'Unauthorized' });\n      }\n\n      const updated = await storage.updateDashboardChart(req.params.id, req.body);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to update dashboard chart' });\n    }\n  });\n\n  app.delete('/api/dashboard-charts/:id', requireAuth, async (req: any, res) => {\n    try {\n      const dashboardChart = await storage.getDashboardChart(req.params.id);\n      \n      if (!dashboardChart) {\n        return res.status(404).json({ message: 'Dashboard chart not found' });\n      }\n\n      const dashboard = await storage.getDashboard(dashboardChart.dashboardId);\n      if (!dashboard || dashboard.userId !== req.user.id) {\n        return res.status(403).json({ message: 'Unauthorized' });\n      }\n\n      await storage.deleteDashboardChart(req.params.id);\n      res.json({ message: 'Chart removed from dashboard successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to remove chart from dashboard' });\n    }\n  });\n\n  // Chart drill-down endpoint - fetches detailed data for a chart\n  app.post('/api/charts/:id/drill-down', requireAuth, async (req: any, res) => {\n    try {\n      const chart = await storage.getChart(req.params.id);\n      \n      if (!chart || chart.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Chart not found' });\n      }\n\n      if (!chart.query) {\n        return res.status(400).json({ message: 'Chart does not have an associated query' });\n      }\n\n      const result = await executeUserSQLQuery(chart.query, req.user.id);\n      \n      res.json({\n        data: result,\n        query: chart.query,\n        chartTitle: chart.title\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: 'Failed to fetch drill-down data', error: error.message });\n    }\n  });\n\n  // Data preview endpoint\n  app.get('/api/data-sources/:id/preview', requireAuth, async (req: any, res) => {\n    try {\n      const dataSource = await storage.getDataSource(req.params.id);\n      \n      if (!dataSource || dataSource.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Data source not found' });\n      }\n\n      const limit = parseInt(req.query.limit as string) || 10;\n      \n      if (dataSource.type === 'csv' && dataSource.filename) {\n        const filePath = path.join(process.cwd(), 'uploads', dataSource.filename);\n        if (fs.existsSync(filePath)) {\n          const csvData = await parseCSVFile(filePath);\n          \n          const previewData = {\n            name: dataSource.name,\n            columns: csvData.length > 0 ? Object.keys(csvData[0]) : [],\n            rows: csvData.slice(0, limit).map(row => Object.values(row)),\n            totalRows: csvData.length,\n            type: dataSource.type\n          };\n          \n          res.json(previewData);\n        } else {\n          res.status(404).json({ message: 'Data file not found' });\n        }\n      } else if (dataSource.metadata && (dataSource.metadata as any).isTableDataset) {\n        // For table datasets, query the actual database\n        try {\n          const metadata = dataSource.metadata as any;\n          const { parentConnection, schemaName, tableName } = metadata;\n          \n          // Build the SQL query with proper schema qualification\n          const qualifiedTableName = schemaName ? `${schemaName}.${tableName}` : tableName;\n          const query = `SELECT TOP ${limit} * FROM ${qualifiedTableName}`;\n          \n          // Get connection configuration from metadata\n          const connectionConfig = {\n            host: metadata.host,\n            port: metadata.port,\n            database: metadata.database,\n            username: metadata.username,\n            password: metadata.password\n          };\n          \n          // Execute query using DatabaseConnectorService\n          const result = await DatabaseConnectorService.executeQuery(\n            metadata.connectionType || dataSource.type, \n            connectionConfig, \n            query\n          );\n          \n          res.json({\n            name: dataSource.name,\n            columns: result.columns || [],\n            rows: result.rows || [],\n            totalRows: result.rowCount || 0,\n            type: dataSource.type,\n            message: `Preview from ${parentConnection} ‚Ä¢ ${schemaName}.${tableName}`\n          });\n          \n        } catch (error) {\n          console.error('Database preview error:', error);\n          // Fallback to mock data if database query fails\n          res.json({\n            name: dataSource.name,\n            columns: ['Error'],\n            rows: [['Failed to connect to database']],\n            totalRows: 0,\n            type: dataSource.type,\n            message: `Connection error: ${error instanceof Error ? error.message : 'Unknown error'}`\n          });\n        }\n      } else {\n        // For other non-CSV data sources, return mock data\n        res.json({\n          name: dataSource.name,\n          columns: ['ID', 'Name', 'Value', 'Status'],\n          rows: [\n            ['1', 'Sample Data', '123.45', 'Active'],\n            ['2', 'Example Row', '67.89', 'Inactive'],\n            ['3', 'Test Entry', '45.67', 'Active'],\n          ],\n          totalRows: 150,\n          type: dataSource.type,\n          message: 'Preview from external data source (simulated)'\n        });\n      }\n    } catch (error) {\n      console.error('Data preview error:', error);\n      res.status(500).json({ message: 'Failed to preview data' });\n    }\n  });\n\n  // View endpoints\n  app.get('/api/views', requireAuth, async (req: any, res) => {\n    try {\n      const views = await storage.getViews(req.user.id);\n      res.json(views);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch views' });\n    }\n  });\n\n  app.post('/api/views', requireAuth, async (req: any, res) => {\n    try {\n      const validation = insertViewSchema.safeParse({\n        ...req.body,\n        userId: req.user.id\n      });\n\n      if (!validation.success) {\n        return res.status(400).json({ message: 'Invalid view data', errors: validation.error.errors });\n      }\n\n      const view = await storage.createView(validation.data);\n      res.json(view);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to create view' });\n    }\n  });\n\n  app.get('/api/views/:id', requireAuth, async (req: any, res) => {\n    try {\n      const view = await storage.getView(req.params.id);\n      \n      if (!view || view.userId !== req.user.id) {\n        return res.status(404).json({ message: 'View not found' });\n      }\n\n      res.json(view);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch view' });\n    }\n  });\n\n  app.put('/api/views/:id', requireAuth, async (req: any, res) => {\n    try {\n      const view = await storage.getView(req.params.id);\n      \n      if (!view || view.userId !== req.user.id) {\n        return res.status(404).json({ message: 'View not found' });\n      }\n\n      const updated = await storage.updateView(req.params.id, {\n        ...req.body,\n        lastExecuted: new Date()\n      });\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to update view' });\n    }\n  });\n\n  app.delete('/api/views/:id', requireAuth, async (req: any, res) => {\n    try {\n      const view = await storage.getView(req.params.id);\n      \n      if (!view || view.userId !== req.user.id) {\n        return res.status(404).json({ message: 'View not found' });\n      }\n\n      await storage.deleteView(req.params.id);\n      res.json({ message: 'View deleted successfully' });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete view' });\n    }\n  });\n\n  // Execute view query endpoint\n  app.post('/api/views/:id/execute', requireAuth, async (req: any, res) => {\n    try {\n      const view = await storage.getView(req.params.id);\n      \n      if (!view || view.userId !== req.user.id) {\n        return res.status(404).json({ message: 'View not found' });\n      }\n\n      const startTime = Date.now();\n      let results;\n\n      try {\n        // Execute the actual SQL query\n        results = await executeUserSQLQuery(view.sqlQuery, req.user.id);\n      } catch (queryError) {\n        console.error('SQL query execution error:', queryError);\n        // Fallback to error result\n        results = {\n          columns: ['Error'],\n          rows: [['Query execution failed: ' + (queryError instanceof Error ? queryError.message : 'Unknown error')]],\n          rowCount: 0\n        };\n      }\n\n      const executionTime = Date.now() - startTime;\n      const finalResults = {\n        ...results,\n        executionTime\n      };\n\n      // Update view with execution metadata\n      await storage.updateView(req.params.id, {\n        lastExecuted: new Date(),\n        resultData: finalResults,\n        rowCount: results.rowCount\n      });\n\n      res.json(finalResults);\n    } catch (error) {\n      console.error('View execution error:', error);\n      res.status(500).json({ message: 'Failed to execute view' });\n    }\n  });\n\n  // Direct SQL execution endpoint for SQL Engine\n  app.post('/api/sql/execute', requireAuth, async (req: any, res) => {\n    try {\n      const { query } = req.body;\n\n      if (!query || typeof query !== 'string') {\n        return res.status(400).json({ message: 'SQL query is required' });\n      }\n\n      const startTime = Date.now();\n      let results;\n\n      try {\n        // Execute the SQL query\n        results = await executeUserSQLQuery(query, req.user.id);\n      } catch (queryError) {\n        console.error('Direct SQL execution error:', queryError);\n        return res.status(400).json({ \n          message: 'Query execution failed',\n          error: queryError instanceof Error ? queryError.message : 'Unknown error'\n        });\n      }\n\n      const executionTime = Date.now() - startTime;\n      const finalResults = {\n        ...results,\n        executionTime\n      };\n\n      res.json(finalResults);\n    } catch (error) {\n      console.error('SQL execution endpoint error:', error);\n      res.status(500).json({ message: 'Failed to execute SQL query' });\n    }\n  });\n\n  // Database connector endpoints\n  app.get('/api/database-connectors', requireAuth, async (req: any, res) => {\n    try {\n      const connectors = DatabaseConnectorService.getAvailableConnectors();\n      res.json(connectors);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch database connectors' });\n    }\n  });\n\n  app.get('/api/database-connectors/:type', requireAuth, async (req: any, res) => {\n    try {\n      const connector = DatabaseConnectorService.getConnector(req.params.type);\n      if (!connector) {\n        return res.status(404).json({ message: 'Connector not found' });\n      }\n      res.json(connector);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch connector details' });\n    }\n  });\n\n  app.post('/api/database-connectors/test', requireAuth, async (req: any, res) => {\n    try {\n      const { type, config } = req.body;\n      \n      if (!type || !config) {\n        return res.status(400).json({ message: 'Type and config are required' });\n      }\n\n      const result = await DatabaseConnectorService.testConnection(type, config);\n      res.json(result);\n    } catch (error) {\n      res.status(500).json({ \n        message: 'Connection test failed', \n        error: error instanceof Error ? error.message : 'Unknown error' \n      });\n    }\n  });\n\n  app.post('/api/database-connectors/schema', requireAuth, async (req: any, res) => {\n    try {\n      const { type, config } = req.body;\n      \n      if (!type || !config) {\n        return res.status(400).json({ message: 'Type and config are required' });\n      }\n\n      const schemaInfo = await DatabaseConnectorService.getSchemaInfo(type, config);\n      res.json(schemaInfo);\n    } catch (error) {\n      res.status(500).json({ \n        message: 'Failed to fetch schema information', \n        error: error instanceof Error ? error.message : 'Unknown error' \n      });\n    }\n  });\n\n  app.post('/api/data-sources/database', requireAuth, async (req: any, res) => {\n    try {\n      const { name, type, config } = req.body;\n      \n      if (!name || !type || !config) {\n        return res.status(400).json({ message: 'Name, type, and config are required' });\n      }\n\n      // Test connection first\n      const testResult = await DatabaseConnectorService.testConnection(type, config);\n      if (!testResult.success) {\n        return res.status(400).json({ \n          message: 'Database connection test failed', \n          error: testResult.message \n        });\n      }\n\n      // Encrypt configuration before storing\n      const encryptedConfig = DatabaseConnectorService.encryptConfig(config);\n      \n      const dataSource = await storage.createDataSource({\n        userId: req.user.id,\n        name,\n        type,\n        status: 'connected',\n        connectionConfig: encryptedConfig,\n        metadata: {\n          connector: DatabaseConnectorService.getConnector(type),\n          connectionTest: testResult,\n        },\n      });\n\n      res.json(dataSource);\n    } catch (error) {\n      res.status(500).json({ \n        message: 'Failed to create database connection', \n        error: error instanceof Error ? error.message : 'Unknown error' \n      });\n    }\n  });\n\n  // Create data source from specific database table\n  app.post('/api/data-sources/table', requireAuth, async (req: any, res) => {\n    try {\n      const { \n        connectionName, \n        databaseType, \n        connectionConfig, \n        tableName, \n        schemaName, \n        tableMetadata \n      } = req.body;\n      \n      if (!connectionName || !databaseType || !connectionConfig || !tableName || !schemaName) {\n        return res.status(400).json({ \n          message: 'Connection name, database type, config, table name, and schema name are required' \n        });\n      }\n\n      // Check if connection already exists for this user and name\n      let connection = await storage.getConnectionByNameAndUser(req.user.id, connectionName);\n      \n      if (!connection) {\n        // Create new connection if it doesn't exist\n        const encryptedConfig = DatabaseConnectorService.encryptConfig(connectionConfig);\n        \n        connection = await storage.createConnection({\n          userId: req.user.id,\n          name: connectionName,\n          type: databaseType,\n          status: 'connected',\n          connectionConfig: encryptedConfig,\n          metadata: {\n            host: connectionConfig.host,\n            port: connectionConfig.port,\n            database: connectionConfig.database,\n            username: connectionConfig.username,\n            // Don't store password in metadata\n            lastTested: new Date().toISOString(),\n          }\n        });\n      }\n\n      // Create a data source for this specific table, referencing the connection\n      const dataSource = await storage.createDataSource({\n        userId: req.user.id,\n        name: `${schemaName}.${tableName}`, // Simpler name without connection prefix\n        type: databaseType,\n        status: 'ready',\n        connectionId: connection.id, // Reference to parent connection\n        rowCount: tableMetadata?.rowCount,\n        columnCount: tableMetadata?.columns?.length || 0,\n        metadata: {\n          isTableDataset: true, // Flag to identify table-based datasets\n          connectorType: databaseType,\n          connectionName,\n          tableName,\n          schemaName,\n          tableType: tableMetadata?.type || 'table',\n          columns: tableMetadata?.columns || [],\n          parentConnection: connectionName,\n          // Store connection details for backwards compatibility during transition\n          host: connectionConfig.host,\n          port: connectionConfig.port,\n          database: connectionConfig.database,\n          username: connectionConfig.username,\n          password: connectionConfig.password,\n          connectionType: databaseType,\n        }\n      });\n\n      res.json(dataSource);\n    } catch (error) {\n      console.error('Table data source creation error:', error);\n      res.status(500).json({ \n        message: 'Failed to create table data source',\n        error: error instanceof Error ? error.message : 'Unknown error' \n      });\n    }\n  });\n\n  // Connection management endpoints\n  app.get('/api/connections', requireAuth, async (req: any, res) => {\n    try {\n      const connections = await storage.getConnections(req.user.id);\n      res.json(connections);\n    } catch (error) {\n      console.error('Failed to fetch connections:', error);\n      res.status(500).json({ message: 'Failed to fetch connections' });\n    }\n  });\n\n  app.get('/api/connections/:id', requireAuth, async (req: any, res) => {\n    try {\n      const connection = await storage.getConnection(req.params.id);\n      \n      if (!connection || connection.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Connection not found' });\n      }\n\n      res.json(connection);\n    } catch (error) {\n      console.error('Failed to fetch connection:', error);\n      res.status(500).json({ message: 'Failed to fetch connection' });\n    }\n  });\n\n  app.get('/api/connections/:id/tables', requireAuth, async (req: any, res) => {\n    try {\n      const connection = await storage.getConnection(req.params.id);\n      \n      if (!connection || connection.userId !== req.user.id) {\n        return res.status(404).json({ message: 'Connection not found' });\n      }\n\n      // Get all table datasets for this connection\n      const dataSources = await storage.getDataSources(req.user.id);\n      const connectionTables = dataSources.filter((ds: any) => \n        ds.connectionId === req.params.id && ds.metadata?.isTableDataset\n      );\n\n      res.json(connectionTables);\n    } catch (error) {\n      console.error('Failed to fetch connection tables:', error);\n      res.status(500).json({ message: 'Failed to fetch connection tables' });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":45844},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383}},"version":2}